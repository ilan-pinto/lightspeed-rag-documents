<!DOCTYPE html>
<html lang="en" dir="ltr" prefix="og: https://ogp.me/ns#">
  <head>
    <meta charset="utf-8" />
<link rel="canonical" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/index" />
<link rel="shortlink" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/index" />
<meta property="og:site_name" content="Red Hat Customer Portal" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/index" />
<meta property="og:title" content="Migrating from version 3 to 4 OpenShift Container Platform 4.13 | Red Hat Customer Portal" />
<meta property="og:description" content="This document provides instructions for migrating your OpenShift Container Platform cluster from version 3 to version 4." />
<meta property="og:image" content="https://access.redhat.com/webassets/avalon/g/shadowman-200.png" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="This document provides instructions for migrating your OpenShift Container Platform cluster from version 3 to version 4." />
<meta name="twitter:title" content="Migrating from version 3 to 4 OpenShift Container Platform 4.13 | Red Hat Customer Portal" />
<meta name="twitter:url" content="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/index" />
<meta name="twitter:image" content="https://access.redhat.com/webassets/avalon/g/shadowman-200.png" />
<meta name="title" content="Migrating from version 3 to 4 OpenShift Container Platform 4.13 | Red Hat Customer Portal" />
<link rel="alternate" hreflang="en" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/index" />
<link rel="alternate" hreflang="ko" href="https://access.redhat.com/documentation/ko-kr/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/index" />
<link rel="alternate" hreflang="zh-hans" href="https://access.redhat.com/documentation/zh-cn/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/index" />
<link rel="alternate" hreflang="ja" href="https://access.redhat.com/documentation/ja-jp/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/index" />
<link rel="alternate" hreflang="es" href="https://access.redhat.com/documentation/es-es/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/index" />
<link rel="alternate" hreflang="ru" href="https://access.redhat.com/documentation/ru-ru/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/index" />
<link rel="alternate" hreflang="pt-br" href="https://access.redhat.com/documentation/pt-br/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/index" />
<link rel="alternate" hreflang="it" href="https://access.redhat.com/documentation/it-it/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/index" />
<link rel="alternate" hreflang="de" href="https://access.redhat.com/documentation/de-de/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/index" />
<link rel="alternate" hreflang="fr" href="https://access.redhat.com/documentation/fr-fr/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/index" />
<link rel="alternate" hreflang="zh-hant" href="https://access.redhat.com/documentation/zh-tw/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/index" />
<link rel="alternate" hreflang="id" href="https://access.redhat.com/documentation/id-id/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/index" />
<link rel="alternate" hreflang="th" href="https://access.redhat.com/documentation/th-th/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/index" />
<link rel="alternate" hreflang="vi" href="https://access.redhat.com/documentation/vi-vn/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/index" />
<meta name="Generator" content="Drupal 9 (https://www.drupal.org)" />
<meta name="MobileOptimized" content="width" />
<meta name="HandheldFriendly" content="true" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="revision" product="b0738f19-59ac-47eb-9512-8a439cd6dfb0" title="a2c2b3ba-cceb-44f7-8055-60074ded6809" page="eb41af32-f441-4195-87a1-8c0405371fda" revision="a9b2f940183f7b22b049f578bab422b40265d849:en-us" body="a4c9336a1015774c65efdea46e0eddc2.html" toc="b6ccd93e67e257c58deb11865a0b586a.json" />

    <title>Migrating from version 3 to 4 OpenShift Container Platform 4.13 | Red Hat Customer Portal</title>
    <link rel="stylesheet" media="all" href="/sites/dxp-docs/files/css/css_87GMcmxT1ib8ziQiU2KUAnTDFtZQV6iP-KGslA9LigM.css" />
<link rel="stylesheet" media="all" href="/sites/dxp-docs/files/css/css__Xq4GfgPDJw9K_yYJFmlRZGJeCENu3R3r4s0K7Tr_9g.css" />

    
    <script type="application/json" data-drupal-selector="drupal-settings-json">{"path":{"baseUrl":"\/","scriptPath":null,"pathPrefix":"","currentPath":"documentation\/en-us\/openshift_container_platform\/4.13\/html-single\/migrating_from_version_3_to_4\/index","currentPathIsAdmin":false,"isFront":false,"currentLanguage":"en"},"pluralDelimiter":"\u0003","suppressDeprecationErrors":true,"red_hat_jwt":{"client_id":"customer-portal","cookie_name":"rh_jwt","leeway":"0","realm":"redhat-external","sso_host":"https:\/\/sso.redhat.com\/","user_integration":1,"user_plugin":"drupal_user_auth","use_external_js":0,"use_internal_js":0,"use_in_admin":0},"user":{"uid":0,"permissionsHash":"d8ea0bce2d740dacbdfe0257cf55baa0e33f7fb8468a26d055ce75daaaa2d315"}}</script>
<script src="/sites/dxp-docs/files/js/js_EQWKo9EokWkWS99x_e1oM-NEM0zlKyTkp_83mGdm5Ks.js"></script>

    <!-- CP_PRIMER_HEAD -->  <!-- TrustArc & DTM -->
  <script src="//static.redhat.com/libs/redhat/marketing/latest/trustarc/trustarc.js"></script>
  <script src="//www.redhat.com/dtm.js"></script><meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<!--[if IEMobile]><meta http-equiv="cleartype" content="on"><![endif]-->

<!-- metaInclude -->
<meta name="avalon-host-info" content="dxp-kbase-prod-139-77b4fb8768-25dr9" />
<meta name="avalon-version" content="27861f77" />
<meta name="cp-chrome-build-date" content="2023-10-06T19:17:59.039Z" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- Chrome, Firefox OS and Opera -->
<meta name="theme-color" content="#000000">
<!-- Windows Phone -->
<meta name="msapplication-navbutton-color" content="#000000">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-status-bar-style" content="#000000">
<link rel="manifest" href="https://access.redhat.com/webassets/avalon/j/manifest.json">
<!-- Open Search - Tap to search -->
<link rel="search" type="application/opensearchdescription+xml" title="Red Hat Customer Portal" href="https://access.redhat.com/webassets/avalon/j/opensearch.xml" />
<!-- title -->
<title>Red Hat Customer Portal - Access to 24x7 support and knowledge</title>
<!-- /title -->
<script type="text/javascript">
    window.portal = {
        analytics : {},
        host      : "https://access.redhat.com",
        idp_url   : "https://sso.redhat.com",
        lang      : "en", 
        version   : "27861f77",
        builddate : "2023-10-06T19:17:59.039Z",        fetchdate : "2023-10-10T17:45:08-0400",        nrid      : "NOLONGERSUPPORTED",
        nrlk      : "NOLONGERSUPPORTED"
    };
</script>
<script type="text/javascript">
    if (!/\/logout.*/.test(location.pathname) && portal.host === location.origin && document.cookie.indexOf('rh_sso_session') >= 0 && !(document.cookie.indexOf('rh_jwt') >= 0)) window.location = '/login?redirectTo=' + encodeURIComponent(window.location.href);
</script>
<!-- cssInclude -->

<link rel="shortcut icon" href="https://access.redhat.com/webassets/avalon/g/favicon.ico" /><link media="all" rel="stylesheet" type="text/css" href="https://access.redhat.com/chrome_themes/nimbus/css/bootstrap.css?v=27861f77" />
<link media="all" rel="stylesheet" type="text/css" href="https://access.redhat.com/chrome_themes/nimbus/css/bootstrap-grid.css?v=27861f77" />
<link media="all" rel="stylesheet" type="text/css" href="https://access.redhat.com/chrome_themes/nimbus/css/main.css?v=27861f77" />
<link media="all" rel="stylesheet" type="text/css" href="https://access.redhat.com/chrome_themes/nimbus/css/components.css?v=27861f77" />
<link media="all" rel="stylesheet" type="text/css" href="https://access.redhat.com/chrome_themes/nimbus/css/pages.css?v=27861f77" />

<link href="https://access.redhat.com/webassets/avalon/s/chosen.css?v=27861f77" rel="stylesheet" type="text/css" />

<!--[if lte IE 9]>
<link media="all" rel="stylesheet" type="text/css" href="https://access.redhat.com/chrome_themes/nimbus/css/ie.css" />
<![endif]--><noscript>
    <style type="text/css" media="screen"> .primary-nav { display: block; } </style>
</noscript>
<link media="all" rel="stylesheet" type="text/css" href="https://access.redhat.com/webassets/avalon/j/public_modules/node_modules/@cpelements/pfe-navigation/dist/pfe-navigation--lightdom.min.css" />
<!-- /cssInclude -->
<script src="https://access.redhat.com/webassets/avalon/j/public_modules/node_modules/@cpelements/pfe-navigation/dist/ie-polyfills.js?v=27861f77"></script>

<script async>
  if (!HTMLScriptElement.supports || !HTMLScriptElement.supports('importmap')) {
    import("https://www.redhatstatic.com/dx/v1-alpha/es-module-shims@1.7.3.js");
  }
</script>
<script type="importmap">
{
  "imports": {
    "@patternfly/elements/" : "https://www.redhatstatic.com/dx/v1-alpha/@patternfly/elements@2.2.2/",
    "@rhds/elements/":"https://www.redhatstatic.com/dx/v1-alpha/@rhds/elements@1.1.0/elements/",
    "@rhds/elements/lib/":"https://www.redhatstatic.com/dx/v1-alpha/@rhds/elements@1.1.0/lib/",
    "@cpelements/elements/":"https://www.redhatstatic.com/dx/v1-alpha/@cpelements/elements@2.0.0-alpha.7/elements/"
  }
}
</script><script type="text/javascript" src="https://access.redhat.com/webassets/avalon/j/lib/require.js?v=27861f77" data-main="/webassets/avalon/j/"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<script src="https://access.redhat.com/chrome_themes/nimbus/js/ie8.js"></script>
<![endif]-->
<script type="text/javascript" src="https://access.redhat.com/chrome_themes/nimbus/js/new-nav.js?v=27861f77" ></script>
<!-- /CP_PRIMER_HEAD -->

  </head>
  <body>
    
      <div class="dialog-off-canvas-main-canvas" data-off-canvas-main-canvas>
      <!-- CP_PRIMER_HEADER -->
<div id="page-wrap" class="page-wrap">
    <div id="pers-top-page-wrap" class="top-page-wrap pers-loader-bg">

      <div id="hero-bg-top-left" class="summit-bg-shapes"></div>
      <div id="hero-bg-top-right" class="summit-bg-shapes"></div>

        <!--googleoff: all-->
        <header class="masthead" id="masthead">

            <a href="#pfe-navigation" id="global-skip-to-nav" class="skip-link visually-hidden">Skip to navigation</a>
            <a href="#cp-main" class="skip-link visually-hidden">Skip to main content</a>            <nav id="portal-utility-nav" class="utility-navigation utility-navigation--bar hidden-at-mobile" data-analytics-region="utility" aria-labelledby="nav__utility-nav--desktop">
                <h3 id="nav__utility-nav--desktop" class="element-invisible">Utilities
                </h3>
                <ul aria-labelledby="nav__utility-nav--desktop">
                    <li id="nav-subscription" data-portal-tour-1="1">
                        <a class="top-nav-subscriptions" data-analytics-level="2" data-analytics-category="Utilities" data-analytics-text="Subscription" href="https://access.redhat.com/management/" >Subscriptions
                        </a>
                    </li>
                    <li id="nav-downloads" data-portal-tour-1="2">
                        <a class="top-nav-downloads" data-analytics-level="2" data-analytics-category="Utilities" data-analytics-text="Downloads" href="https://access.redhat.com/downloads/" >Downloads
                        </a>
                    </li>
                    <li id="nav-containers">
                        <a class="top-nav-containers" data-analytics-level="2" data-analytics-category="Utilities" data-analytics-text="Containers" href="https://catalog.redhat.com/software/containers/explore/" >Containers
                        </a>
                    </li>
                    <li id="nav-support" data-portal-tour-1="3">
                        <a class="top-nav-support-cases" data-analytics-level="2" data-analytics-category="Utilities" data-analytics-text="Support Cases" href="https://access.redhat.com/support/cases/" >Support Cases
                        </a>
                    </li>
                </ul>
            </nav>

            <pfe-navigation id="pfe-navigation" data-analytics-region="mega menu">
                <div class="pfe-navigation__logo-wrapper" id="pfe-navigation__logo-wrapper">
                    <a href="https://access.redhat.com/" class="pfe-navigation__logo-link" data-analytics-text="logo" data-analytics-category="MM|logo">
                        <img class="pfe-navigation__logo-image" alt="Red Hat Customer Portal" src="https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg" />
                    </a>
                </div>

                <nav class="pfe-navigation" aria-label="Main Navigation" data-analytics-region="main nav">
                    <ul class="pfe-navigation__menu" id="pfe-navigation__menu">                        <li class="pfe-navigation__menu-item hidden-at-tablet hidden-at-desktop" id="nav-subscription--mobile" data-portal-tour-1="1">
                            <a class="pfe-navigation__menu-link" data-analytics-level="1" data-analytics-text="Subscription" href="https://access.redhat.com/management/" >Subscriptions
                            </a>
                        </li>
                        <li class="pfe-navigation__menu-item hidden-at-tablet hidden-at-desktop" id="nav-downloads--mobile" data-portal-tour-1="2">
                            <a class="pfe-navigation__menu-link" data-analytics-level="1" data-analytics-text="Downloads" href="https://access.redhat.com/downloads/" >Downloads
                            </a>
                        </li>
                        <li class="pfe-navigation__menu-item hidden-at-tablet hidden-at-desktop" id="nav-containers--mobile">
                            <a class="pfe-navigation__menu-link" data-analytics-level="1" data-analytics-text="Containers" href="https://catalog.redhat.com/software/containers/explore/" >Containers
                            </a>
                        </li>
                        <li class="pfe-navigation__menu-item hidden-at-tablet hidden-at-desktop" id="nav-support--mobile" data-portal-tour-1="3">
                            <a class="pfe-navigation__menu-link" data-analytics-level="1" data-analytics-text="Support Cases" href="https://access.redhat.com/support/cases/" >Support Cases
                            </a>
                        </li>                        <li class="pfe-navigation__menu-item">
                            <a href="https://access.redhat.com/products/" class="pfe-navigation__menu-link" data-analytics-level="1" data-analytics-text="Products and Services">Products &amp; Services
                            </a>
                            <div class="pfe-navigation__dropdown has-primary-detail">                                <div class="desktop-col-span-2 tablet-col-span-all">
                                    <h3>
                                        <a data-analytics-level="2" data-analytics-category="Products and Services" data-analytics-text="Products" href="https://access.redhat.com/products/">Products
                                        </a>
                                    </h3>
                                    <slot name="main-menu__dropdown--product__product-listing"></slot>
                                </div>                                <div>
                                    <h3 id="nav__products__support">
                                        <a data-analytics-level="2" data-analytics-category="Products and Services" data-analytics-text="Support" href="https://access.redhat.com/support">Support
                                        </a>
                                    </h3>
                                    <ul aria-labelledby="nav__products__support">
                                        <li><a data-analytics-level="3" data-analytics-category="Products and Services|Support" data-analytics-text="Production Support" href="https://access.redhat.com/support/offerings/production/">Production Support
                                            </a></li>
                                            <li><a data-analytics-level="3" data-analytics-category="Products and Services|Support" data-analytics-text="Development Support" href="https://access.redhat.com/support/offerings/developer/">Development Support
                                                </a></li>
                                                <li><a data-analytics-level="3" data-analytics-category="Products and Services|Support" data-analytics-text="Product Life Cycles" href="https://access.redhat.com/product-life-cycles/">Product Life Cycles
                                                    </a></li>
                                    </ul>

                                    <h3 id="nav__products__services">
                                        <a data-analytics-level="2" data-analytics-category="Products and Services" data-analytics-text="Services" href="https://www.redhat.com/en/services">Services
                                        </a>
                                    </h3>
                                    <ul aria-labelledby="nav__products__services">
                                        <li><a data-analytics-level="3" data-analytics-category="Products and Services|Services" data-analytics-text="Consulting" href="https://www.redhat.com/en/services/consulting">Consulting
                                            </a></li>
                                            <li><a data-analytics-level="3" data-analytics-category="Products and Services|Services" data-analytics-text="Technical Account Management" href="https://access.redhat.com/support/offerings/tam/">Technical Account Management
                                                </a></li>
                                                <li><a data-analytics-level="3" data-analytics-category="Products and Services|Services" data-analytics-text="Training and Certifications" href="https://www.redhat.com/en/services/training-and-certification">Training &amp; Certifications
                                                    </a></li>
                                    </ul>
                                </div>                                <div>
                                    <h3 id="nav__products__documentation">
                                        <a data-analytics-level="2" data-analytics-category="Products and Services" data-analytics-text="Documentation" href="https://access.redhat.com/documentation">Documentation
                                        </a>
                                    </h3>
                                    <ul aria-labelledby="nav__products__documentation">
                                        <li><a data-analytics-level="3" data-analytics-category="Products and Services|Documentation" data-analytics-text="Red Hat Enterprise Linux" href="https://access.redhat.com/documentation/en/red_hat_enterprise_linux">Red Hat Enterprise Linux
                                            </a></li>
                                            <li><a data-analytics-level="3" data-analytics-category="Products and Services|Documentation" data-analytics-text="Red Hat JBoss Enterprise Application Platform" href="https://access.redhat.com/documentation/en/red_hat_jboss_enterprise_application_platform">Red Hat JBoss Enterprise Application Platform
                                                </a></li>
                                                <li><a data-analytics-level="3" data-analytics-category="Products and Services|Documentation" data-analytics-text="Red Hat OpenStack Platform" href="https://access.redhat.com/documentation/en/red_hat_openstack_platform">Red Hat OpenStack Platform
                                                    </a></li>
                                                    <li><a data-analytics-level="3" data-analytics-category="Products and Services|Documentation" data-analytics-text="Red Hat OpenShift Container Platform" href="https://access.redhat.com/documentation/en/openshift_container_platform">Red Hat OpenShift Container Platform
                                                        </a></li>
                                    </ul>
                                    <pfe-cta>
                                        <a data-analytics-level="3" data-analytics-category="Products and Services|Documentation" data-analytics-text="All Documentation" data-analytics-linkType="cta" href="https://access.redhat.com/documentation">All Documentation
                                        </a>
                                    </pfe-cta>

                                    <h3 id="nav__products__catalog"><a data-analytics-level="2" data-analytics-category="Products and Services" data-analytics-text="Ecosystem Catalog" href="https://catalog.redhat.com/">Ecosystem Catalog
                                        </a></h3>
                                        <ul aria-labelledby="nav__products__catalog">
                                            <li><a data-analytics-level="3" data-analytics-category="Products and Services|Ecosystem Catalog" data-analytics-text="Red Hat Partner Ecosystem" href="https://access.redhat.com/ecosystem/">Red Hat Partner Ecosystem
                                                </a></li>
                                                <li><a data-analytics-level="3" data-analytics-category="Products and Services|Ecosystem Catalog" data-analytics-text="Partner Resources" href="https://access.redhat.com/ecosystem/partner-resources">Partner Resources
                                                    </a></li>
                                        </ul>
                                </div>
                            </div>
                        </li>                        <li class="pfe-navigation__menu-item">
                            <a class="pfe-navigation__menu-link" data-analytics-level="1" data-analytics-text="Tools" href="https://access.redhat.com/labs/">Tools
                            </a>
                            <div class="pfe-navigation__dropdown pfe-navigation__dropdown--3-column">                                <div>
                                    <h3 id="nav__tools__tools" data-analytics-level="2" data-analytics-text="Tools" data-analytics-category="Tools">Tools
                                    </h3>
                                    <ul aria-labelledby="nav__tools__tools">
                                        <li><a data-analytics-level="3" data-analytics-category="Tools|Tools" data-analytics-text="Solution Engine" href="https://access.redhat.com/support/cases/#/troubleshoot">Troubleshoot a product issue
                                            </a></li>
                                            <li><a data-analytics-level="3" data-analytics-category="Tools|Tools" data-analytics-text="Packages" href="https://access.redhat.com/downloads/content/package-browser">Packages
                                                </a></li>
                                                <li><a data-analytics-level="3" data-analytics-category="Tools|Tools" data-analytics-text="Errata" href="https://access.redhat.com/errata/">Errata
                                                    </a></li>
                                    </ul>
                                </div>                                <div>
                                    <h3 id="nav__tools__labs">
                                        <a data-analytics-level="2" data-analytics-category="Tools" data-analytics-text="Customer Portal Labs" href="https://access.redhat.com/labs/">Customer Portal Labs
                                        </a>
                                    </h3>
                                    <ul aria-labelledby="nav__tools__labs">
                                        <li><a data-analytics-level="3" data-analytics-category="Tools|Customer Portal Labs" data-analytics-text="Configuration" href="https://access.redhat.com/labs/#!?type=config">Configuration
                                            </a></li>
                                            <li><a data-analytics-level="3" data-analytics-category="Tools|Customer Portal Labs" data-analytics-text="Deployment" href="https://access.redhat.com/labs/#!?type=deploy">Deployment
                                                </a></li>
                                                <li><a data-analytics-level="3" data-analytics-category="Tools|Customer Portal Labs" data-analytics-text="Security" href="https://access.redhat.com/labs/#!?type=security">Security
                                                    </a></li>                                                    <li><a data-analytics-level="3" data-analytics-category="Tools|Customer Portal Labs" data-analytics-text="Troubleshooting" href="https://access.redhat.com/labs/#!?type=troubleshoot">Troubleshoot
                                                        </a></li>
                                    </ul>
                                    <pfe-cta>
                                        <a data-analytics-level="3" data-analytics-category="Tools|Customer Portal Labs" data-analytics-text="All Labs" data-analytics-linkType="cta" href="https://access.redhat.com/labs/">All labs
                                        </a>
                                    </pfe-cta>
                                </div>                                <div>
                                    <h4 id="nav__tools__red-hat-insights">
                                        <a data-analytics-level="2" data-analytics-category="Tools" data-analytics-text="Red Hat Insights" href="//www.redhat.com/en/technologies/management/insights">Red Hat Insights
                                        </a>
                                    </h4>
                                    <p>Increase visibility into IT operations to detect and resolve technical issues before they impact your business.</p>
                                    <a data-analytics-level="3" data-analytics-category="Tools|Red Hat Insights" data-analytics-text="Learn more" href="https://www.redhat.com/en/technologies/management/insights">Learn More
                                    </a>
                                    <br>
                                    <a data-analytics-level="3" data-analytics-category="Tools|Red Hat Insights" data-analytics-text="Go to Insights" href="https://cloud.redhat.com/insights">Go to Insights
                                    </a>
                                </div>
                            </div>
                        </li>                        <li class="pfe-navigation__menu-item">
                            <a class="pfe-navigation__menu-link" data-analytics-level="1" data-analytics-text="Security" href="https://access.redhat.com/security/">Security
                            </a>
                            <div class="pfe-navigation__dropdown pfe-navigation__dropdown--3-column">                                <div>
                                    <h3 id="security__security-center">
                                        <a data-analytics-level="2" data-analytics-category="Security" data-analytics-text="Red Hat Product Security Center" href="https://access.redhat.com/security">Red Hat Product Security Center
                                        </a>
                                    </h3>
                                    <p>Engage with our Red Hat Product Security team, access security updates, and ensure your environments are not exposed to any known security vulnerabilities.
                                    </p>
                                    <pfe-cta pfe-priority="primary">
                                        <a data-analytics-level="3" data-analytics-category="Security|Red Hat Product Security Center" data-analytics-text="Product Security Center" data-analytics-linkType="cta" href="https://access.redhat.com/security/">Product Security Center
                                        </a>
                                    </pfe-cta>
                                </div>                                <div>
                                    <h3 id="nav__security__updates" data-analytics-level="2" data-analytics-text="Security Updates" data-analytics-category="Security">
                                        <a data-analytics-level="2" data-analytics-category="Security" data-analytics-text="Security Updates" href="/security">Security Updates
                                        </a>
                                    </h3>
                                    <ul aria-labelledby="nav__security__updates">
                                        <li><a data-analytics-level="3" data-analytics-category="Security|Security Updates" data-analytics-text="Security Advisories" href="https://access.redhat.com/security/security-updates/#/security-advisories">Security Advisories
                                            </a></li>
                                            <li><a data-analytics-level="3" data-analytics-category="Security|Security Updates" data-analytics-text="Red Hat CVE Database" href="https://access.redhat.com/security/security-updates/#/cve">Red Hat CVE Database
                                                </a></li>
                                                <li><a data-analytics-level="3" data-analytics-category="Security|Security Updates" data-analytics-text="Security Labs" href="https://access.redhat.com/security/security-updates/#/security-labs">Security Labs
                                                    </a></li>
                                    </ul>
                                    <p class="margin-top-xl">Keep your systems secure with Red Hat&#039;s specialized responses to security vulnerabilities.
                                    </p>
                                    <pfe-cta>
                                        <a data-analytics-level="3" data-analytics-category="Security|Security Updates" data-analytics-text="View Responses" data-analytics-linkType="cta" href="https://access.redhat.com/security/vulnerability">View Responses
                                        </a>
                                    </pfe-cta>
                                </div>                                <div>
                                    <h3 id="nav__security__resources">
                                        <a data-analytics-level="2" data-analytics-category="Security" data-analytics-text="Resources" href="https://access.redhat.com/security/overview">Resources
                                        </a>
                                    </h3>
                                    <ul aria-labelledby="nav__security__resources">                                            <li><a data-analytics-level="3" data-analytics-category="Security|Resources" data-analytics-text="Security Blog" href="//redhat.com/en/blog/channel/security">Security Blog
                                                </a></li>
                                                <li><a data-analytics-level="3" data-analytics-category="Security|Resources" data-analytics-text="Security Measurement" href="https://www.redhat.com/security/data/metrics/">Security Measurement
                                                    </a></li>
                                                    <li><a data-analytics-level="3" data-analytics-category="Security|Resources" data-analytics-text="Severity Ratings" href="https://access.redhat.com/security/updates/classification/">Severity Ratings
                                                        </a></li>
                                                        <li><a data-analytics-level="3" data-analytics-category="Security|Resources" data-analytics-text="Backporting Policies" href="https://access.redhat.com/security/updates/backporting/">Backporting Policies
                                                            </a></li>
                                                            <li><a data-analytics-level="3" data-analytics-category="Security|Resources" data-analytics-text="Product Signing (GPG) Keys" href="https://access.redhat.com/security/team/key/">Product Signing (GPG) Keys
                                                                </a></li>
                                    </ul>
                                </div>

                            </div>
                        </li>                        <li class="pfe-navigation__menu-item">
                            <a href="https://access.redhat.com/community/" class="pfe-navigation__menu-link" data-analytics-level="1" data-analytics-text="Community">Community
                            </a>
                            <div class="pfe-navigation__dropdown pfe-navigation__dropdown--3-column">                                <div>
                                    <h3 id="nav__community__cp-community">
                                        <a href="https://access.redhat.com/community" data-analytics-level="2" data-analytics-text="Customer Portal Community" data-analytics-text="Customer Portal Community" data-analytics-category="Community">Customer Portal Community
                                        </a>
                                    </h3>
                                    <ul aria-labelledby="nav__community__cp-community">
                                        <li><a data-analytics-level="3" data-analytics-category="Community|Customer Portal Community" data-analytics-text="Discussions" href="https://access.redhat.com/discussions">Discussions
                                            </a></li>                                                <li><a data-analytics-level="3" data-analytics-category="Community|Customer Portal Community" data-analytics-text="Private Groups" href="https://access.redhat.com/groups/">Private Groups
                                                    </a></li>
                                    </ul>

                                    <pfe-cta pfe-priority="primary">
                                        <a data-analytics-level="3" data-analytics-category="Community|Customer Portal Community" data-analytics-text="Community Activity" data-analytics-linkType="cta" href="https://access.redhat.com/community/">Community Activity
                                        </a>
                                    </pfe-cta>
                                </div>                                <div>
                                    <h3 id="nav__community__events" data-analytics-level="2" data-analytics-text="Customer Events" data-analytics-category="Community">Customer Events
                                    </h3>
                                    <ul aria-labelledby="nav__community__events">
                                        <li><a data-analytics-level="3" data-analytics-category="Community|Customer Events" data-analytics-text="Red Hat Convergence" href="https://access.redhat.com/convergence/">Red Hat Convergence
                                            </a></li>
                                            <li><a data-analytics-level="3" data-analytics-category="Community|Customer Events" data-analytics-text="Red Hat Summit" href="http://www.redhat.com/summit/">Red Hat Summit
                                                </a></li>
                                    </ul>
                                </div>                                <div>
                                    <h3 id="nav__community__stories" data-analytics-level="2" data-analytics-text="Stories" data-analytics-category="Community">Stories
                                    </h3>
                                    <ul aria-labelledby="nav__community__stories">
                                        <li><a data-analytics-level="3" data-analytics-category="Community|Stories" data-analytics-text="Red Hat Subscription Value" href="https://access.redhat.com/subscription-value/">Red Hat Subscription Value
                                            </a></li>
                                            <li><a data-analytics-level="3" data-analytics-text="You Asked. We Acted." data-analytics-category="Community|Stories" href="https://access.redhat.com/you-asked-we-acted/">You Asked. We Acted.
                                                </a></li>
                                                <li><a data-analytics-level="3" data-analytics-category="Community|Stories" data-analytics-text="Open Source Communities" href="http://www.redhat.com/en/open-source">Open Source Communities
                                                    </a></li>
                                    </ul>
                                </div>
                            </div>
                        </li>
                    </ul>                </nav>                <div id="site-search" slot="search" class="utility-link site-search">
                    <div class="content">
                        <form class="ng-pristine ng-valid topSearchForm" id="topSearchForm" name="topSearchForm" action="/search/browse/search/" method="get" enctype="application/x-www-form-urlencoded">
                            <cp-search-autocomplete class="push-bottom" path="/webassets/avalon/j/data.json"></cp-search-autocomplete>                            <div>Or <a href="/support/cases/#/troubleshoot">troubleshoot an issue</a>.
                            </div>
                        </form>
                    </div>
                </div>


                <div slot="secondary-links" id="localesMenu">
                    <button class="pfe-navigation__secondary-link">
                        <pfe-icon icon="web-icon-globe" size="sm" aria-hidden="true"></pfe-icon>English
                    </button>

                    <pfe-navigation-dropdown dropdown-width="single">
                        <h2 class="utility-header">Select Your Language
                        </h2>
                        <ul class="reset">
                            <li><a href="https://access.redhat.com/changeLanguage?language=en" data-lang="en" id="en" data-analytics-text="English">English</a></li>
                            <li><a href="https://access.redhat.com/changeLanguage?language=ko" data-lang="ko" id="ko" data-analytics-text="Korean">한국어</a></li>
                            <li><a href="https://access.redhat.com/changeLanguage?language=ja"    data-lang="ja"    id="ja" data-analytics-text="Japanese">日本語</a></li>
                            <li><a href="https://access.redhat.com/changeLanguage?language=zh_CN" data-lang="zh_CN" id="zh_CN" data-analytics-text="Chinese">中文 (中国)</a></li>
                        </ul>

                    </pfe-navigation-dropdown>
                </div>                <rh-account-dropdown slot="account"></rh-account-dropdown>                <pfe-primary-detail breakpoint-width="600" class="main-menu__dropdown--product__product-listing" slot="main-menu__dropdown--product__product-listing" consistent-height>
                    <h3 slot="details-nav">Infrastructure and Management                    </h3>
                    <div slot="details">
                        <ul>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Infrastructure and Management" data-analytics-text="Red Hat Enterprise Linux" href="https://access.redhat.com/products/red-hat-enterprise-linux/">Red Hat Enterprise Linux
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Infrastructure and Management" data-analytics-text="Red Hat Satellite" href="https://access.redhat.com/products/red-hat-satellite/">Red Hat Satellite
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Infrastructure and Management" data-analytics-text="Red Hat Subscription Management" href="https://access.redhat.com/products/red-hat-subscription-management/">Red Hat Subscription Management
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Infrastructure and Management" data-analytics-text="Red Hat Insights" href="https://access.redhat.com/products/red-hat-insights/">Red Hat Insights
                                </a>
                            </li>
                            <li><a data-analytics-level="3" data-analytics-category="Products and Services|Products:Infrastructure and Management" data-analytics-text="Red Hat Ansible Automation Platform" href="https://access.redhat.com/products/red-hat-ansible-automation-platform/">Red Hat Ansible Automation Platform
                                </a></li>
                        </ul>
                    </div>

                    <h3 slot="details-nav">Cloud Computing                    </h3>
                    <div slot="details">
                        <ul>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Cloud Computing" data-analytics-text="Red Hat OpenShift" href="https://access.redhat.com/products/openshift">Red Hat OpenShift
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Cloud Computing" data-analytics-text="Red Hat OpenStack Platform" href="https://access.redhat.com/products/red-hat-openstack-platform/">Red Hat OpenStack Platform
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Cloud Computing Platform" data-analytics-text="Red Hat OpenShift Container Platform" href="https://access.redhat.com/products/red-hat-openshift-container-platform/">Red Hat OpenShift Container Platform
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Cloud Computing Platform" data-analytics-text="Red Hat OpenShift Data Science" href="https://access.redhat.com/products/red-hat-openshift-data-science/">Red Hat OpenShift Data Science
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Cloud Computing" data-analytics-text="Red Hat OpenShift Dedicated" href="https://access.redhat.com/products/openshift-dedicated-red-hat/">Red Hat OpenShift Dedicated
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Cloud Computing Platform" data-analytics-text="Red Hat Advanced Cluster Security for Kubernetes" href="https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/">Red Hat Advanced Cluster Security for Kubernetes
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Cloud Computing" data-analytics-text="Red Hat Advanced Cluster Management for Kubernetes" href="https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/">Red Hat Advanced Cluster Management for Kubernetes
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Cloud Computing" data-analytics-text="Red Hat Quay" href="https://access.redhat.com/products/red-hat-quay/">Red Hat Quay
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Cloud Computing" data-analytics-text="Red Hat CodeReady Workspaces" href="https://access.redhat.com/products/red-hat-codeready-workspaces/">OpenShift Dev Spaces
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Cloud Computing" data-analytics-text="Red Hat OpenShift Service on AWS" href="https://access.redhat.com/products/red-hat-openshift-service-aws">Red Hat OpenShift Service on AWS
                                </a>
                            </li>
                        </ul>
                    </div>

                    <h3 slot="details-nav">Storage                    </h3>
                    <div slot="details">
                        <ul>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Storage" data-analytics-text="Red Hat Gluster Storage" href="https://access.redhat.com/products/red-hat-storage/">Red Hat Gluster Storage
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Storage" data-analytics-text="Red Hat Hyperconverged Infrastructure" href="https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/">Red Hat Hyperconverged Infrastructure
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Storage" data-analytics-text="Red Hat Ceph Storage" href="https://access.redhat.com/products/red-hat-ceph-storage/">Red Hat Ceph Storage
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Storage" data-analytics-text="Red Hat Openshift Container Storage" href="https://access.redhat.com/products/red-hat-openshift-data-foundation">Red Hat OpenShift Data Foundation
                                </a>
                            </li>
                        </ul>
                    </div>

                    <h3 slot="details-nav">Runtimes                    </h3>
                    <div slot="details">
                        <ul>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Runtimes" data-analytics-text="Red Hat Runtimes" href="https://access.redhat.com/products/red-hat-runtimes/">Red Hat Runtimes
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Runtimes" data-analytics-text="Red Hat JBoss Enterprise Application Platform" href="https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/">Red Hat JBoss Enterprise Application Platform
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Runtimes" data-analytics-text="Red Hat Data Grid" href="https://access.redhat.com/products/red-hat-data-grid/">Red Hat Data Grid
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Runtimes" data-analytics-text="Red Hat JBoss Web Server" href="https://access.redhat.com/products/red-hat-jboss-web-server/">Red Hat JBoss Web Server
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Runtimes" data-analytics-text="Red Hat Single Sign On" href="https://access.redhat.com/products/red-hat-single-sign-on/">Red Hat Single Sign On
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Runtimes" data-analytics-text="Red Hat support for Spring Boot" href="https://access.redhat.com/products/spring-boot/">Red Hat support for Spring Boot
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Runtimes" data-analytics-text="Red Hat build of Node.js" href="https://access.redhat.com/products/nodejs/">Red Hat build of Node.js
                                </a>
                            </li>                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Runtimes" data-analytics-text="Red Hat build of Quarkus" href="https://access.redhat.com/products/quarkus/">Red Hat build of Quarkus
                                </a>
                            </li>
                        </ul>
                    </div>

                    <h3 slot="details-nav">Integration and Automation                    </h3>
                    <div slot="details">
                        <ul class="border-bottom" id="portal-menu-border-bottom">
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Integration and Automation" data-analytics-text="Red Hat Application Foundations" href="https://access.redhat.com/products/red-hat-application-foundations/">Red Hat Application Foundations
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Integration and Automation" data-analytics-text="Red Hat Fuse" href="https://access.redhat.com/products/red-hat-fuse/">Red Hat Fuse
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Integration and Automation" data-analytics-text="Red Hat AMQ" href="https://access.redhat.com/products/red-hat-amq/">Red Hat AMQ
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Integration and Automation" data-analytics-text="Red Hat 3scale API Management" href="https://access.redhat.com/products/red-hat-3scale/">Red Hat 3scale API Management
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div slot="details-nav--footer">
                        <pfe-cta pfe-priority="primary">
                            <a href="https://access.redhat.com/products/" class="pfe-navigation__menu-link" data-analytics-level="2" data-analytics-text="All Products" data-analytics-category="Products and Services|Products:" data-analytics-linkType="cta">All Products
                            </a>
                        </pfe-cta>
                    </div>
                </pfe-primary-detail>

            </pfe-navigation>

            <div id="scroll-anchor"></div>

            <!--[if IE 8]>
                <div class="portal-messages">
                <div class="alert alert-warning alert-portal alert-w-icon">
                <span class="icon-warning alert-icon" aria-hidden="true"></span>
                You are using an unsupported web browser. Update to a supported browser for the best experience. <a href="/announcements/2120951">Read the announcement</a>.
                </div>
                </div>
            <![endif]-->
            <!--[if IE 9]>
                <div class="portal-messages">
                <div class="alert alert-warning alert-portal alert-w-icon">
                <span class="icon-warning alert-icon" aria-hidden="true"></span>As of March 1, 2016, the Red Hat Customer Portal will no longer support Internet Explorer 9. See our new <a href="/help/browsers">browser support policy</a> for more information.
                </div>
                </div>
            <![endif]-->
            <div id="site-section"></div>
        </header>
        <!--googleon: all-->

        <main id="cp-main" class="portal-content-area">
            <div id="cp-content" class="main-content">                            <!-- /CP_PRIMER_HEADER -->

      <div class="container">
        

                                                                                                        <script>breadcrumbs = [["Products & Services","\/products\/"],["Product Documentation","\/documentation"],["OpenShift Container Platform","\/documentation\/en-us\/openshift_container_platform"],["4.13","\/documentation\/en-us\/openshift_container_platform\/4.13"],["Migrating from version 3 to 4","\/documentation\/en-us\/openshift_container_platform\/4.13\/html\/migrating_from_version_3_to_4"],["Migrating from version 3 to 4","\/documentation\/en-us\/openshift_container_platform\/4.13\/html\/migrating_from_version_3_to_4\/--single-page-document--"]]</script>

<div data-drupal-messages-fallback class="hidden"></div>


    </div>
        <div class="container">
        

  

  


  <article class="pvof-doc__content-wrapper__outer pvof-doc__content-wrapper__outer--css-not-removed">
    <script>
      'use strict';

            var $outerWrapper = document.querySelector('.pvof-doc__content-wrapper__outer');
      if ($outerWrapper && $outerWrapper.closest) {
        var $containerWrapper = $outerWrapper.closest('.container');
        if ($containerWrapper) {
          $containerWrapper.classList.remove('container');
          $containerWrapper.classList.add('j-chrome-content-container');
        }
      }

            var cssRemoved = false;
      try {
        var $crapCss = document.querySelectorAll(
          'link[href*="/chrome_themes/nimbus/css/pages.css"], link[href*="/chrome_themes/nimbus/css/components.css"]'
        );
        if ($crapCss.length) {
          for (let index = 0; index < $crapCss.length; index++) {
            const $stylesheet = $crapCss[index];
            $stylesheet.remove();
          }
        }
        cssRemoved = true;
      }
      catch (error) {
        console.error('Ran into an issue while trying to retheme page', error);
        cssRemoved = false;
      }

            if (cssRemoved) {
        var $pvofOuterWrapper = document.querySelector('.pvof-doc__content-wrapper__outer--css-not-removed');
        if ($pvofOuterWrapper) {
          $pvofOuterWrapper.classList.remove('pvof-doc__content-wrapper__outer--css-not-removed');
        }
      }
    </script>
    <div itemscope="" itemtype="https://schema.org/TechArticle" itemref="techArticle-md1 techArticle-md2 techArticle-md3"></div>
    <div itemscope="" itemtype="https://schema.org/SoftwareApplication" itemref="softwareApplication-md1 softwareApplication-md2 softwareApplication-md3 softwareApplication-md4"></div>
    <div class="pvof-doc__content-wrapper pvof-doc__content-wrapper--has-sidebar">
                                <div class="pvof-doc__content-wrapper__inner j-superdoc j-superdoc--has-nav">
                            <div class="pvof-sidebar__wrapper j-doc-nav j-superdoc__nav">
            <div class="j-sidebar__menu-container">
              <button class="j-sidebar__menu-trigger content-expander__trigger">
                <span class="j-sidebar__menu-trigger__open-text">Jump To</span>
                <span class="j-sidebar__menu-trigger__close-text">Close</span>
              </button>

              <div class="pvof-sidebar__inner-wrapper j-doc-nav__wrapper content-expander">
                <div class="j-sidebar__menu-details-container">
                  <button class="j-sidebar__menu-details-button j-sidebar__menu-details-button--expand">
                    Expand all
                  </button>
                  <button class="j-sidebar__menu-details-button j-sidebar__menu-details-button--collapse">
                    Collapse all
                  </button>
                </div>
                

  <nav id="pvof-doc__toc" class="pvof-doc__toc">
  <h2 class="j-doc-nav__title" id="j-doc-nav__title">
    Table of contents
  </h2>
  <div class="pvof-doc__toc-inner">
              <ol class="j-doc-nav__list" aria-labelledby="j-doc-nav__title">
                  <li class="j-doc-nav__list-item">
                                    

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4" class="j-doc-nav__link ">
    Migrating from version 3 to 4
  </a>
  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-from-version-3-to-4-overview" class="j-doc-nav__link j-doc-nav__link--has-children">
    1. Migration from OpenShift Container Platform 3 to 4 overview
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "1. Migration from OpenShift Container Platform 3 to 4 overview"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "1. Migration from OpenShift Container Platform 3 to 4 overview"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#mtc-3-to-4-overview-differences-mtc" class="j-doc-nav__link ">
    1.1. Differences between OpenShift Container Platform 3 and 4
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#mtc-3-to-4-overview-planning-network-considerations-mtc" class="j-doc-nav__link ">
    1.2. Planning network considerations
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#mtc-overview-install-mtc" class="j-doc-nav__link ">
    1.3. Installing MTC
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#mtc-overview-upgrade-mtc" class="j-doc-nav__link ">
    1.4. Upgrading MTC
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#mtc-overview-mtc-checklists" class="j-doc-nav__link ">
    1.5. Reviewing premigration checklists
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#mtc-overview-migrate-mtc-applications" class="j-doc-nav__link ">
    1.6. Migrating applications
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#mtc-overview-advanced-migration-options" class="j-doc-nav__link ">
    1.7. Advanced migration options
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#mtc-overview-troubleshooting-mtc" class="j-doc-nav__link ">
    1.8. Troubleshooting migrations
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#mtc-overview-roll-back-mtc" class="j-doc-nav__link ">
    1.9. Rolling back a migration
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#mtc-overview-uninstall-mtc" class="j-doc-nav__link ">
    1.10. Uninstalling MTC and deleting resources
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                    

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#about-migrating-from-3-to-4" class="j-doc-nav__link ">
    2. About migrating from OpenShift Container Platform 3 to 4
  </a>
  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#planning-migration-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    3. Differences between OpenShift Container Platform 3 and 4
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "3. Differences between OpenShift Container Platform 3 and 4"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "3. Differences between OpenShift Container Platform 3 and 4"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-differences-architecture" class="j-doc-nav__link ">
    3.1. Architecture
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-differences-install" class="j-doc-nav__link ">
    3.2. Installation and upgrade
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-considerations" class="j-doc-nav__link j-doc-nav__link--has-children">
    3.3. Migration considerations
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "3.3. Migration considerations"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "3.3. Migration considerations"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-preparing-storage" class="j-doc-nav__link ">
    3.3.1. Storage considerations
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-preparing-networking" class="j-doc-nav__link ">
    3.3.2. Networking considerations
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-preparing-logging" class="j-doc-nav__link ">
    3.3.3. Logging considerations
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-preparing-security" class="j-doc-nav__link ">
    3.3.4. Security considerations
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-preparing-monitoring" class="j-doc-nav__link ">
    3.3.5. Monitoring considerations
  </a>
  
          </li>
              </ol>

  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#planning-considerations-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    4. Network considerations
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "4. Network considerations"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "4. Network considerations"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#dns-considerations_planning-considerations-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    4.1. DNS considerations
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "4.1. DNS considerations"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "4.1. DNS considerations"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-isolating-dns-domain-of-target-cluster-from-clients_planning-considerations-3-4" class="j-doc-nav__link ">
    4.1.1. Isolating the DNS domain of the target cluster from the clients
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-setting-up-target-cluster-to-accept-source-dns-domain_planning-considerations-3-4" class="j-doc-nav__link ">
    4.1.2. Setting up the target cluster to accept the source DNS domain
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-network-traffic-redirection-strategies_planning-considerations-3-4" class="j-doc-nav__link ">
    4.2. Network traffic redirection strategies
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#about-mtc-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    5. About the Migration Toolkit for Containers
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "5. About the Migration Toolkit for Containers"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "5. About the Migration Toolkit for Containers"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-terminology_about-mtc-3-4" class="j-doc-nav__link ">
    5.1. Terminology
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-mtc-workflow_about-mtc-3-4" class="j-doc-nav__link ">
    5.2. MTC workflow
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-understanding-data-copy-methods_about-mtc-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    5.3. About data copy methods
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "5.3. About data copy methods"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "5.3. About data copy methods"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#file-system-copy-method_about-mtc-3-4" class="j-doc-nav__link ">
    5.3.1. File system copy method
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#snapshot-copy-method_about-mtc-3-4" class="j-doc-nav__link ">
    5.3.2. Snapshot copy method
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-direct-volume-migration-and-direct-image-migration_about-mtc-3-4" class="j-doc-nav__link ">
    5.4. Direct volume migration and direct image migration
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#installing-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    6. Installing the Migration Toolkit for Containers
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "6. Installing the Migration Toolkit for Containers"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "6. Installing the Migration Toolkit for Containers"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-compatibility-guidelines_installing-3-4" class="j-doc-nav__link ">
    6.1. Compatibility guidelines
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-installing-legacy-operator_installing-3-4" class="j-doc-nav__link ">
    6.2. Installing the legacy Migration Toolkit for Containers Operator on OpenShift Container Platform 3
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-installing-mtc-on-ocp-4_installing-3-4" class="j-doc-nav__link ">
    6.3. Installing the Migration Toolkit for Containers Operator on OpenShift Container Platform 4.13
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-about-configuring-proxies_installing-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    6.4. Proxy configuration
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "6.4. Proxy configuration"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "6.4. Proxy configuration"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#direct-volume-migration_installing-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    6.4.1. Direct volume migration
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "6.4.1. Direct volume migration"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "6.4.1. Direct volume migration"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#tcp-proxy-setup-for-dvm_installing-3-4" class="j-doc-nav__link ">
    6.4.1.1. TCP proxy setup for DVM
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#why-tcp-proxy-instead-of-an-http-https-proxy_installing-3-4" class="j-doc-nav__link ">
    6.4.1.2. Why use a TCP proxy instead of an HTTP/HTTPS proxy?
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#dvm-known-issues_installing-3-4" class="j-doc-nav__link ">
    6.4.1.3. Known issue
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#tuning-network-policies-for-migrations_installing-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    6.4.2. Tuning network policies for migrations
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "6.4.2. Tuning network policies for migrations"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "6.4.2. Tuning network policies for migrations"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#dvm-network-policy-configuration_installing-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    6.4.2.1. NetworkPolicy configuration
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "6.4.2.1. NetworkPolicy configuration"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "6.4.2.1. NetworkPolicy configuration"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#egress-traffic-from-rsync-pods_installing-3-4" class="j-doc-nav__link ">
    6.4.2.1.1. Egress traffic from Rsync pods
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#ingress-traffic-to-rsync-pods_installing-3-4" class="j-doc-nav__link ">
    6.4.2.1.2. Ingress traffic to Rsync pods
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#egressnetworkpolicy-config_installing-3-4" class="j-doc-nav__link ">
    6.4.2.2. EgressNetworkPolicy configuration
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#choosing-alternate-endpoints-for-data-transfer_installing-3-4" class="j-doc-nav__link ">
    6.4.2.3. Choosing alternate endpoints for data transfer
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#configuring-supplemental-groups-for-rsync-pods_installing-3-4" class="j-doc-nav__link ">
    6.4.2.4. Configuring supplemental groups for Rsync pods
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-configuring-proxies_installing-3-4" class="j-doc-nav__link ">
    6.4.3. Configuring proxies
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#configuring-replication-repository_installing-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    6.5. Configuring a replication repository
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "6.5. Configuring a replication repository"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "6.5. Configuring a replication repository"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#replication-repository-prerequisites_installing-3-4" class="j-doc-nav__link ">
    6.5.1. Prerequisites
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-configuring-mcg_installing-3-4" class="j-doc-nav__link ">
    6.5.2. Retrieving Multicloud Object Gateway credentials
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-configuring-aws-s3_installing-3-4" class="j-doc-nav__link ">
    6.5.3. Configuring Amazon Web Services
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-configuring-gcp_installing-3-4" class="j-doc-nav__link ">
    6.5.4. Configuring Google Cloud Platform
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-configuring-azure_installing-3-4" class="j-doc-nav__link ">
    6.5.5. Configuring Microsoft Azure
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#installing-3-4_configuring-replication-repository-additional-resources" class="j-doc-nav__link ">
    6.5.6. Additional resources
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-uninstalling-mtc-clean-up_installing-3-4" class="j-doc-nav__link ">
    6.6. Uninstalling MTC and deleting resources
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#installing-restricted-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    7. Installing the Migration Toolkit for Containers in a restricted network environment
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "7. Installing the Migration Toolkit for Containers in a restricted network environment"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "7. Installing the Migration Toolkit for Containers in a restricted network environment"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-compatibility-guidelines_installing-restricted-3-4" class="j-doc-nav__link ">
    7.1. Compatibility guidelines
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-installing-mtc-on-ocp-4_installing-restricted-3-4" class="j-doc-nav__link ">
    7.2. Installing the Migration Toolkit for Containers Operator on OpenShift Container Platform 4.13
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-installing-legacy-operator_installing-restricted-3-4" class="j-doc-nav__link ">
    7.3. Installing the legacy Migration Toolkit for Containers Operator on OpenShift Container Platform 3
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-about-configuring-proxies_installing-restricted-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    7.4. Proxy configuration
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "7.4. Proxy configuration"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "7.4. Proxy configuration"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#direct-volume-migration_installing-restricted-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    7.4.1. Direct volume migration
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "7.4.1. Direct volume migration"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "7.4.1. Direct volume migration"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#tcp-proxy-setup-for-dvm_installing-restricted-3-4" class="j-doc-nav__link ">
    7.4.1.1. TCP proxy setup for DVM
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#why-tcp-proxy-instead-of-an-http-https-proxy_installing-restricted-3-4" class="j-doc-nav__link ">
    7.4.1.2. Why use a TCP proxy instead of an HTTP/HTTPS proxy?
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#dvm-known-issues_installing-restricted-3-4" class="j-doc-nav__link ">
    7.4.1.3. Known issue
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#tuning-network-policies-for-migrations_installing-restricted-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    7.4.2. Tuning network policies for migrations
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "7.4.2. Tuning network policies for migrations"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "7.4.2. Tuning network policies for migrations"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#dvm-network-policy-configuration_installing-restricted-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    7.4.2.1. NetworkPolicy configuration
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "7.4.2.1. NetworkPolicy configuration"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "7.4.2.1. NetworkPolicy configuration"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#egress-traffic-from-rsync-pods_installing-restricted-3-4" class="j-doc-nav__link ">
    7.4.2.1.1. Egress traffic from Rsync pods
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#ingress-traffic-to-rsync-pods_installing-restricted-3-4" class="j-doc-nav__link ">
    7.4.2.1.2. Ingress traffic to Rsync pods
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#egressnetworkpolicy-config_installing-restricted-3-4" class="j-doc-nav__link ">
    7.4.2.2. EgressNetworkPolicy configuration
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#choosing-alternate-endpoints-for-data-transfer_installing-restricted-3-4" class="j-doc-nav__link ">
    7.4.2.3. Choosing alternate endpoints for data transfer
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#configuring-supplemental-groups-for-rsync-pods_installing-restricted-3-4" class="j-doc-nav__link ">
    7.4.2.4. Configuring supplemental groups for Rsync pods
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-configuring-proxies_installing-restricted-3-4" class="j-doc-nav__link ">
    7.4.3. Configuring proxies
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#configuring-replication-repository_installing-restricted-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    7.5. Configuring a replication repository
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "7.5. Configuring a replication repository"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "7.5. Configuring a replication repository"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#replication-repository-prerequisites_installing-restricted-3-4" class="j-doc-nav__link ">
    7.5.1. Prerequisites
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-configuring-mcg_installing-restricted-3-4" class="j-doc-nav__link ">
    7.5.2. Retrieving Multicloud Object Gateway credentials
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#installing-restricted-3-4_configuring-replication-repository-additional-resources" class="j-doc-nav__link ">
    7.5.3. Additional resources
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-uninstalling-mtc-clean-up_installing-restricted-3-4" class="j-doc-nav__link ">
    7.6. Uninstalling MTC and deleting resources
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#upgrading-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    8. Upgrading the Migration Toolkit for Containers
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "8. Upgrading the Migration Toolkit for Containers"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "8. Upgrading the Migration Toolkit for Containers"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-upgrading-mtc-on-ocp-4_upgrading-3-4" class="j-doc-nav__link ">
    8.1. Upgrading the Migration Toolkit for Containers on OpenShift Container Platform 4.13
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-upgrading-mtc-with-legacy-operator_upgrading-3-4" class="j-doc-nav__link ">
    8.2. Upgrading the Migration Toolkit for Containers on OpenShift Container Platform 3
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-upgrading-from-mtc-1-3_upgrading-3-4" class="j-doc-nav__link ">
    8.3. Upgrading MTC 1.3 to 1.8
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#premigration-checklists-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    9. Premigration checklists
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "9. Premigration checklists"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "9. Premigration checklists"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#resources_premigration-checklists-3-4" class="j-doc-nav__link ">
    9.1. Resources
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#source-cluster_premigration-checklists-3-4" class="j-doc-nav__link ">
    9.2. Source cluster
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#target-cluster_premigration-checklists-3-4" class="j-doc-nav__link ">
    9.3. Target cluster
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#performance_premigration-checklists-3-4" class="j-doc-nav__link ">
    9.4. Performance
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migrating-applications-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    10. Migrating your applications
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "10. Migrating your applications"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "10. Migrating your applications"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-prerequisites_migrating-applications-3-4" class="j-doc-nav__link ">
    10.1. Migration prerequisites
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migrating-applications-mtc-web-console_migrating-applications-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    10.2. Migrating your applications by using the MTC web console
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "10.2. Migrating your applications by using the MTC web console"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "10.2. Migrating your applications by using the MTC web console"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-launching-cam_migrating-applications-3-4" class="j-doc-nav__link ">
    10.2.1. Launching the MTC web console
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-adding-cluster-to-cam_migrating-applications-3-4" class="j-doc-nav__link ">
    10.2.2. Adding a cluster to the MTC web console
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-adding-replication-repository-to-cam_migrating-applications-3-4" class="j-doc-nav__link ">
    10.2.3. Adding a replication repository to the MTC web console
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-creating-migration-plan-cam_migrating-applications-3-4" class="j-doc-nav__link ">
    10.2.4. Creating a migration plan in the MTC web console
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-running-migration-plan-cam_migrating-applications-3-4" class="j-doc-nav__link ">
    10.2.5. Running a migration plan in the MTC web console
  </a>
  
          </li>
              </ol>

  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#advanced-migration-options-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    11. Advanced migration options
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "11. Advanced migration options"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "11. Advanced migration options"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-terminology_advanced-migration-options-3-4" class="j-doc-nav__link ">
    11.1. Terminology
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-migrating-applications-on-prem-to-cloud_advanced-migration-options-3-4" class="j-doc-nav__link ">
    11.2. Migrating an application from on-premises to a cloud-based cluster
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migrating-applications-cli_advanced-migration-options-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    11.3. Migrating applications by using the command line
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "11.3. Migrating applications by using the command line"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "11.3. Migrating applications by using the command line"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-prerequisites_advanced-migration-options-3-4" class="j-doc-nav__link ">
    11.3.1. Migration prerequisites
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-creating-registry-route-for-dim_advanced-migration-options-3-4" class="j-doc-nav__link ">
    11.3.2. Creating a registry route for direct image migration
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-about-configuring-proxies_advanced-migration-options-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    11.3.3. Proxy configuration
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "11.3.3. Proxy configuration"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "11.3.3. Proxy configuration"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#direct-volume-migration_advanced-migration-options-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    11.3.3.1. Direct volume migration
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "11.3.3.1. Direct volume migration"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "11.3.3.1. Direct volume migration"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#tcp-proxy-setup-for-dvm_advanced-migration-options-3-4" class="j-doc-nav__link ">
    11.3.3.1.1. TCP proxy setup for DVM
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#why-tcp-proxy-instead-of-an-http-https-proxy_advanced-migration-options-3-4" class="j-doc-nav__link ">
    11.3.3.1.2. Why use a TCP proxy instead of an HTTP/HTTPS proxy?
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#dvm-known-issues_advanced-migration-options-3-4" class="j-doc-nav__link ">
    11.3.3.1.3. Known issue
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#tuning-network-policies-for-migrations_advanced-migration-options-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    11.3.3.2. Tuning network policies for migrations
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "11.3.3.2. Tuning network policies for migrations"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "11.3.3.2. Tuning network policies for migrations"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#dvm-network-policy-configuration_advanced-migration-options-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    11.3.3.2.1. NetworkPolicy configuration
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "11.3.3.2.1. NetworkPolicy configuration"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "11.3.3.2.1. NetworkPolicy configuration"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#egress-traffic-from-rsync-pods_advanced-migration-options-3-4" class="j-doc-nav__link ">
    11.3.3.2.1.1. Egress traffic from Rsync pods
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#ingress-traffic-to-rsync-pods_advanced-migration-options-3-4" class="j-doc-nav__link ">
    11.3.3.2.1.2. Ingress traffic to Rsync pods
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#egressnetworkpolicy-config_advanced-migration-options-3-4" class="j-doc-nav__link ">
    11.3.3.2.2. EgressNetworkPolicy configuration
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#choosing-alternate-endpoints-for-data-transfer_advanced-migration-options-3-4" class="j-doc-nav__link ">
    11.3.3.2.3. Choosing alternate endpoints for data transfer
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#configuring-supplemental-groups-for-rsync-pods_advanced-migration-options-3-4" class="j-doc-nav__link ">
    11.3.3.2.4. Configuring supplemental groups for Rsync pods
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-configuring-proxies_advanced-migration-options-3-4" class="j-doc-nav__link ">
    11.3.3.3. Configuring proxies
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-migrating-applications-api_advanced-migration-options-3-4" class="j-doc-nav__link ">
    11.3.4. Migrating an application by using the MTC API
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-state-migration-cli_advanced-migration-options-3-4" class="j-doc-nav__link ">
    11.3.5. State migration
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-hooks_advanced-migration-options-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    11.4. Migration hooks
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "11.4. Migration hooks"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "11.4. Migration hooks"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-writing-ansible-playbook-hook_advanced-migration-options-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    11.4.1. Writing an Ansible playbook for a migration hook
  </a>
                              <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "11.4.1. Writing an Ansible playbook for a migration hook"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "11.4.1. Writing an Ansible playbook for a migration hook"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-writing-ansible-playbook-hook-ansible-modules_advanced-migration-options-3-4" class="j-doc-nav__link ">
    11.4.1.1. Ansible modules
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-writing-ansible-playbook-hook-environment-variables_advanced-migration-options-3-4" class="j-doc-nav__link ">
    11.4.1.2. Environment variables
  </a>
  
          </li>
              </ol>

  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-plan-options_advanced-migration-options-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    11.5. Migration plan options
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "11.5. Migration plan options"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "11.5. Migration plan options"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-excluding-resources_advanced-migration-options-3-4" class="j-doc-nav__link ">
    11.5.1. Excluding resources
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-mapping-destination-namespaces-in-the-migplan-cr_advanced-migration-options-3-4" class="j-doc-nav__link ">
    11.5.2. Mapping namespaces
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-excluding-pvcs_advanced-migration-options-3-4" class="j-doc-nav__link ">
    11.5.3. Excluding persistent volume claims
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-mapping-pvcs_advanced-migration-options-3-4" class="j-doc-nav__link ">
    11.5.4. Mapping persistent volume claims
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-editing-pvs-in-migplan_advanced-migration-options-3-4" class="j-doc-nav__link ">
    11.5.5. Editing persistent volume attributes
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-kubernetes-objects_advanced-migration-options-3-4" class="j-doc-nav__link ">
    11.5.6. Performing a state migration of Kubernetes objects by using the MTC API
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-controller-options_advanced-migration-options-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    11.6. Migration controller options
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "11.6. Migration controller options"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "11.6. Migration controller options"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-changing-migration-plan-limits_advanced-migration-options-3-4" class="j-doc-nav__link ">
    11.6.1. Increasing limits for large migrations
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-enabling-pv-resizing-dvm_advanced-migration-options-3-4" class="j-doc-nav__link ">
    11.6.2. Enabling persistent volume resizing for direct volume migration
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-enabling-cached-kubernetes-clients_advanced-migration-options-3-4" class="j-doc-nav__link ">
    11.6.3. Enabling cached Kubernetes clients
  </a>
  
          </li>
              </ol>

  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#troubleshooting-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    12. Troubleshooting
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "12. Troubleshooting"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "12. Troubleshooting"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-mtc-workflow_troubleshooting-3-4" class="j-doc-nav__link ">
    12.1. MTC workflow
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-mtc-cr-manifests_troubleshooting-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    12.2. MTC custom resource manifests
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "12.2. MTC custom resource manifests"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "12.2. MTC custom resource manifests"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#directimagemigration_troubleshooting-3-4" class="j-doc-nav__link ">
    12.2.1. DirectImageMigration
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#directimagestreammigration_troubleshooting-3-4" class="j-doc-nav__link ">
    12.2.2. DirectImageStreamMigration
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#directvolumemigration_troubleshooting-3-4" class="j-doc-nav__link ">
    12.2.3. DirectVolumeMigration
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#directvolumemigrationprogress_troubleshooting-3-4" class="j-doc-nav__link ">
    12.2.4. DirectVolumeMigrationProgress
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#miganalytic_troubleshooting-3-4" class="j-doc-nav__link ">
    12.2.5. MigAnalytic
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migcluster_troubleshooting-3-4" class="j-doc-nav__link ">
    12.2.6. MigCluster
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#mighook_troubleshooting-3-4" class="j-doc-nav__link ">
    12.2.7. MigHook
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migmigration_troubleshooting-3-4" class="j-doc-nav__link ">
    12.2.8. MigMigration
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migplan_troubleshooting-3-4" class="j-doc-nav__link ">
    12.2.9. MigPlan
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migstorage_troubleshooting-3-4" class="j-doc-nav__link ">
    12.2.10. MigStorage
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#logs-and-debugging-tools_troubleshooting-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    12.3. Logs and debugging tools
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "12.3. Logs and debugging tools"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "12.3. Logs and debugging tools"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-viewing-migration-plan-resources_troubleshooting-3-4" class="j-doc-nav__link ">
    12.3.1. Viewing migration plan resources
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-viewing-migration-plan-log_troubleshooting-3-4" class="j-doc-nav__link ">
    12.3.2. Viewing a migration plan log
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-using-mig-log-reader_troubleshooting-3-4" class="j-doc-nav__link ">
    12.3.3. Using the migration log reader
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-accessing-performance-metrics_troubleshooting-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    12.3.4. Accessing performance metrics
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "12.3.4. Accessing performance metrics"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "12.3.4. Accessing performance metrics"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-provided-metrics_troubleshooting-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    12.3.4.1. Provided metrics
  </a>
                              <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "12.3.4.1. Provided metrics"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "12.3.4.1. Provided metrics"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#cam_app_workload_migrations-metric_troubleshooting-3-4" class="j-doc-nav__link ">
    12.3.4.1.1. cam_app_workload_migrations
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#mtc_client_request_count-metric_troubleshooting-3-4" class="j-doc-nav__link ">
    12.3.4.1.2. mtc_client_request_count
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#mtc_client_request_elapsed-metric_troubleshooting-3-4" class="j-doc-nav__link ">
    12.3.4.1.3. mtc_client_request_elapsed
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#useful-queries_troubleshooting-3-4" class="j-doc-nav__link ">
    12.3.4.1.4. Useful queries
  </a>
  
          </li>
              </ol>

  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-using-must-gather_troubleshooting-3-4" class="j-doc-nav__link ">
    12.3.5. Using the must-gather tool
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-debugging-velero-resources_troubleshooting-3-4" class="j-doc-nav__link ">
    12.3.6. Debugging Velero resources with the Velero CLI tool
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-partial-failure-velero_troubleshooting-3-4" class="j-doc-nav__link ">
    12.3.7. Debugging a partial migration failure
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-using-mtc-crs-for-troubleshooting_troubleshooting-3-4" class="j-doc-nav__link ">
    12.3.8. Using MTC custom resources for troubleshooting
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#common-issues-and-concerns_troubleshooting-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    12.4. Common issues and concerns
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "12.4. Common issues and concerns"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "12.4. Common issues and concerns"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-updating-deprecated-internal-images_troubleshooting-3-4" class="j-doc-nav__link ">
    12.4.1. Updating deprecated internal images
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-dvm-error-node-selectors_troubleshooting-3-4" class="j-doc-nav__link ">
    12.4.2. Direct volume migration does not complete
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-error-messages_troubleshooting-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    12.4.3. Error messages and resolutions
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "12.4.3. Error messages and resolutions"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "12.4.3. Error messages and resolutions"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#ca-certificate-error-displayed-when-accessing-console-for-first-time_troubleshooting-3-4" class="j-doc-nav__link ">
    12.4.3.1. CA certificate error displayed when accessing the MTC console for the first time
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#oauth-timeout-error-in-console_troubleshooting-3-4" class="j-doc-nav__link ">
    12.4.3.2. OAuth timeout error in the MTC console
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#certificate-signed-by-unknown-authority-error_troubleshooting-3-4" class="j-doc-nav__link ">
    12.4.3.3. Certificate signed by unknown authority error
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#backup-storage-location-errors-in-velero-pod-log_troubleshooting-3-4" class="j-doc-nav__link ">
    12.4.3.4. Backup storage location errors in the Velero pod log
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#pod-volume-backup-timeout-error-in-velero-pod-log_troubleshooting-3-4" class="j-doc-nav__link ">
    12.4.3.5. Pod volume backup timeout error in the Velero pod log
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#restic-verification-errors-in-migmigration-custom-resource_troubleshooting-3-4" class="j-doc-nav__link ">
    12.4.3.6. Restic verification errors in the MigMigration custom resource
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#restic-permission-error-when-migrating-from-nfs-storage-with-root-squash-enabled_troubleshooting-3-4" class="j-doc-nav__link ">
    12.4.3.7. Restic permission error when migrating from NFS storage with root_squash enabled
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-known-issues_troubleshooting-3-4" class="j-doc-nav__link ">
    12.4.4. Known issues
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#rolling-back-migration_troubleshooting-3-4" class="j-doc-nav__link j-doc-nav__link--has-children">
    12.5. Rolling back a migration
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "12.5. Rolling back a migration"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "12.5. Rolling back a migration"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-rolling-back-migration-web-console_troubleshooting-3-4" class="j-doc-nav__link ">
    12.5.1. Rolling back a migration by using the MTC web console
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-rolling-back-migration-cli_troubleshooting-3-4" class="j-doc-nav__link ">
    12.5.2. Rolling back a migration from the command line interface
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#migration-rolling-back-migration-manually_troubleshooting-3-4" class="j-doc-nav__link ">
    12.5.3. Rolling back a migration manually
  </a>
  
          </li>
              </ol>

  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                    

    <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4#idm139748690128400" class="j-doc-nav__link ">
    Legal Notice
  </a>
  
          </li>
              </ol>
    
  </div>
</nav>


              </div>
            </div>
            <div class="j-options-container j-options-container--mobile">
              <button class="j-sidebar__menu-trigger j-sidebar__menu-trigger--options content-expander__trigger">
                <span class="j-sidebar__menu-trigger__open-headline">
                  Settings
                </span>
                <span class="j-sidebar__menu-trigger__close-text">Close</span>
              </button>
              

  <ul class="j-doc-options__list content-expander">
    <li class="j-doc-options__item">
          <label class="j-doc-option__label j-doc-option__label--language" for="j-doc-language">
        Language:
      </label>
      <select id="j-doc-language" class="j-doc-option__select">
                  <option value="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4" selected=''>
            English
          </option>
                  <option value="/documentation/ko-kr/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4" >
            한국어
          </option>
                  <option value="/documentation/ja-jp/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4" >
            日本語
          </option>
                  <option value="/documentation/zh-cn/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4" >
            简体中文
          </option>
              </select>

            <noscript>
        <div class="j-doc-option__label j-doc-option__label--language" id="j-doc-option__label--language--nojs">
          Language:
        </div>
        <ul aria-labelledby="j-doc-option__label--language--nojs" class="j-doc-option__languages-list">
                      <li>
              <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4">English</a>
            </li>
                      <li>
              <a href="/documentation/ko-kr/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4">한국어</a>
            </li>
                      <li>
              <a href="/documentation/ja-jp/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4">日本語</a>
            </li>
                      <li>
              <a href="/documentation/zh-cn/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4">简体中文</a>
            </li>
                  </ul>
      </noscript>

      </li>

    <li class="j-doc-options__item">
    <label for="j-doc-mode" class="j-doc-option__label j-doc-option__label--format">
      Format:
    </label>
    <select id="j-doc-mode" class="j-doc-option__select">
              <option value="/documentation/en-us/openshift_container_platform/4.13/html/migrating_from_version_3_to_4"  class="j-doc-options__option j-doc-options__option--multi-page">
          Multi-page
        </option>
              <option value="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4" selected='' class="j-doc-options__option j-doc-options__option--single-page">
          Single-page
        </option>
              <option value="/documentation/en-us/openshift_container_platform/4.13/pdf/migrating_from_version_3_to_4/OpenShift_Container_Platform-4.13-Migrating_from_version_3_to_4-en-US.pdf"  class="j-doc-options__option j-doc-options__option--pdf">
          PDF
        </option>
          </select>

        <noscript>
      <div class="j-doc-option__label j-doc-option__label--format" id="j-doc-option__label--format--nojs">
        Format:
      </div>
      <ul class="j-doc-option__format-list" aria-labelledby="j-doc-option__label--format--nojs">
                  <li class="j-doc-mode-no-js__link j-doc-mode-no-js__link--multi-page"><a href="/documentation/en-us/openshift_container_platform/4.13/html/migrating_from_version_3_to_4">Multi-page</a></li>
                  <li class="j-doc-mode-no-js__link j-doc-mode-no-js__link--single-page"><a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4">Single-page</a></li>
                  <li class="j-doc-mode-no-js__link j-doc-mode-no-js__link--pdf"><a href="/documentation/en-us/openshift_container_platform/4.13/pdf/migrating_from_version_3_to_4/OpenShift_Container_Platform-4.13-Migrating_from_version_3_to_4-en-US.pdf">PDF</a></li>
              </ul>
    </noscript>
  </li>
</ul>


              </div>
          </div>
                <div class="pvof-doc__tertiary-sidebar j-doc__tertiary-sidebar">
          <div class="pvof-doc__tertiary-sidebar__inner j-doc__tertiary-sidebar__inner">
            <div class="j-doc__doc-options">
              <div class="j-options-container j-options-container--desktop">
                <button class="j-sidebar__menu-trigger j-sidebar__menu-trigger--tablet content-expander__trigger">
                  <span class="j-sidebar__menu-trigger-icon"></span>
                  <h2 class="visually-hidden">Language and Page Formatting Options</h2>
                </button>
                  

  <ul class="j-doc-options__list content-expander">
    <li class="j-doc-options__item">
          <label class="j-doc-option__label j-doc-option__label--language" for="j-doc-language--2">
        Language:
      </label>
      <select id="j-doc-language--2" class="j-doc-option__select">
                  <option value="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4" selected=''>
            English
          </option>
                  <option value="/documentation/ko-kr/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4" >
            한국어
          </option>
                  <option value="/documentation/ja-jp/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4" >
            日本語
          </option>
                  <option value="/documentation/zh-cn/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4" >
            简体中文
          </option>
              </select>

            <noscript>
        <div class="j-doc-option__label j-doc-option__label--language" id="j-doc-option__label--language--nojs">
          Language:
        </div>
        <ul aria-labelledby="j-doc-option__label--language--nojs" class="j-doc-option__languages-list">
                      <li>
              <a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4">English</a>
            </li>
                      <li>
              <a href="/documentation/ko-kr/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4">한국어</a>
            </li>
                      <li>
              <a href="/documentation/ja-jp/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4">日本語</a>
            </li>
                      <li>
              <a href="/documentation/zh-cn/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4">简体中文</a>
            </li>
                  </ul>
      </noscript>

      </li>

    <li class="j-doc-options__item">
    <label for="j-doc-mode--2" class="j-doc-option__label j-doc-option__label--format">
      Format:
    </label>
    <select id="j-doc-mode--2" class="j-doc-option__select">
              <option value="/documentation/en-us/openshift_container_platform/4.13/html/migrating_from_version_3_to_4"  class="j-doc-options__option j-doc-options__option--multi-page">
          Multi-page
        </option>
              <option value="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4" selected='' class="j-doc-options__option j-doc-options__option--single-page">
          Single-page
        </option>
              <option value="/documentation/en-us/openshift_container_platform/4.13/pdf/migrating_from_version_3_to_4/OpenShift_Container_Platform-4.13-Migrating_from_version_3_to_4-en-US.pdf"  class="j-doc-options__option j-doc-options__option--pdf">
          PDF
        </option>
          </select>

        <noscript>
      <div class="j-doc-option__label j-doc-option__label--format" id="j-doc-option__label--format--nojs">
        Format:
      </div>
      <ul class="j-doc-option__format-list" aria-labelledby="j-doc-option__label--format--nojs">
                  <li class="j-doc-mode-no-js__link j-doc-mode-no-js__link--multi-page"><a href="/documentation/en-us/openshift_container_platform/4.13/html/migrating_from_version_3_to_4">Multi-page</a></li>
                  <li class="j-doc-mode-no-js__link j-doc-mode-no-js__link--single-page"><a href="/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4">Single-page</a></li>
                  <li class="j-doc-mode-no-js__link j-doc-mode-no-js__link--pdf"><a href="/documentation/en-us/openshift_container_platform/4.13/pdf/migrating_from_version_3_to_4/OpenShift_Container_Platform-4.13-Migrating_from_version_3_to_4-en-US.pdf">PDF</a></li>
              </ul>
    </noscript>
  </li>
</ul>


                </div>
              </div>
          </div>
        </div>

                  <div class="doc-wrapper pvof-doc__wrapper j-superdoc__content-wrapper" id="doc-wrapper">
            

  <div class="pane-page-title">
    <h1 class="title" itemprop="name">Migrating from version 3 to 4</h1>
  </div>


  <div xml:lang="en-US" class="book" id="idm139748688360704"><div class="titlepage"><div><div class="producttitle"><span class="productname">OpenShift Container Platform</span> <span class="productnumber">4.13</span></div><div><h2 class="subtitle">Migrating to OpenShift Container Platform 4</h2></div><div><div xml:lang="en-US" class="authorgroup"><span class="orgname">Red Hat OpenShift Documentation Team</span></div></div><div><a href="#idm139748690128400">Legal Notice</a></div><div><div class="abstract"><p class="title"><strong>Abstract</strong></p><div class="para">
				This document provides instructions for migrating your OpenShift Container Platform cluster from version 3 to version 4.
			</div></div></div></div><hr/></div><section class="chapter" id="migration-from-version-3-to-4-overview"><div class="titlepage"><div><div><h1 class="title">Chapter 1. Migration from OpenShift Container Platform 3 to 4 overview</h1></div></div></div><p>
			OpenShift Container Platform 4 clusters are different from OpenShift Container Platform 3 clusters. OpenShift Container Platform 4 clusters contain new technologies and functionality that result in a cluster that is self-managing, flexible, and automated. To learn more about migrating from OpenShift Container Platform 3 to 4 see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#about-migrating-from-3-to-4">About migrating from OpenShift Container Platform 3 to 4</a>.
		</p><section class="section" id="mtc-3-to-4-overview-differences-mtc"><div class="titlepage"><div><div><h2 class="title">1.1. Differences between OpenShift Container Platform 3 and 4</h2></div></div></div><p>
				Before migrating from OpenShift Container Platform 3 to 4, you can check <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#planning-migration-3-4">differences between OpenShift Container Platform 3 and 4</a>. Review the following information:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/architecture/#architecture">Architecture</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/architecture/#architecture-installation">Installation and update</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/storage/#index">Storage</a>, <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/networking/#understanding-networking">network</a>, <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/logging/#cluster-logging">logging</a>, <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/security_and_compliance/#index">security</a>, and <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/monitoring/#monitoring-overview">monitoring considerations</a>
					</li></ul></div></section><section class="section" id="mtc-3-to-4-overview-planning-network-considerations-mtc"><div class="titlepage"><div><div><h2 class="title">1.2. Planning network considerations</h2></div></div></div><p>
				Before migrating from OpenShift Container Platform 3 to 4, review the <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#planning-migration-3-4">differences between OpenShift Container Platform 3 and 4</a> for information about the following areas:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#dns-considerations_planning-considerations-3-4">DNS considerations</a>
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-isolating-dns-domain-of-target-cluster-from-clients_planning-considerations-3-4">Isolating the DNS domain of the target cluster from the clients</a>.
							</li><li class="listitem">
								<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-setting-up-target-cluster-to-accept-source-dns-domain_planning-considerations-3-4">Setting up the target cluster to accept the source DNS domain</a>.
							</li></ul></div></li></ul></div><p>
				You can migrate stateful application workloads from OpenShift Container Platform 3 to 4 at the granularity of a namespace. To learn more about MTC see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#about-mtc-3-4">Understanding MTC</a>.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					If you are migrating from OpenShift Container Platform 3, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#about-migrating-from-3-to-4">About migrating from OpenShift Container Platform 3 to 4</a> and <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-installing-legacy-operator_installing-3-4">Installing the legacy Migration Toolkit for Containers Operator on OpenShift Container Platform 3</a>.
				</p></div></div></section><section class="section" id="mtc-overview-install-mtc"><div class="titlepage"><div><div><h2 class="title">1.3. Installing MTC</h2></div></div></div><p>
				Review the following tasks to install the MTC:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-installing-mtc-on-ocp-4_installing-3-4">Install the Migration Toolkit for Containers Operator on target cluster by using Operator Lifecycle Manager (OLM)</a>.
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-installing-legacy-operator_installing-3-4">Install the legacy Migration Toolkit for Containers Operator on the source cluster manually</a>.
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#configuring-replication-repository_installing-3-4">Configure object storage to use as a replication repository</a>.
					</li></ol></div></section><section class="section" id="mtc-overview-upgrade-mtc"><div class="titlepage"><div><div><h2 class="title">1.4. Upgrading MTC</h2></div></div></div><p>
				You <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#upgrading-3-4">upgrade the Migration Toolkit for Containers (MTC)</a> on OpenShift Container Platform 4.13 by using OLM. You upgrade MTC on OpenShift Container Platform 3 by reinstalling the legacy Migration Toolkit for Containers Operator.
			</p></section><section class="section" id="mtc-overview-mtc-checklists"><div class="titlepage"><div><div><h2 class="title">1.5. Reviewing premigration checklists</h2></div></div></div><p>
				Before you migrate your application workloads with the Migration Toolkit for Containers (MTC), review the <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#premigration-checklists-3-4">premigration checklists</a>.
			</p></section><section class="section" id="mtc-overview-migrate-mtc-applications"><div class="titlepage"><div><div><h2 class="title">1.6. Migrating applications</h2></div></div></div><p>
				You can migrate your applications by using the MTC <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migrating-applications-mtc-web-console_migrating-applications-3-4">web console</a> or <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migrating-applications-cli_advanced-migration-options-3-4">the command line</a>.
			</p></section><section class="section" id="mtc-overview-advanced-migration-options"><div class="titlepage"><div><div><h2 class="title">1.7. Advanced migration options</h2></div></div></div><p>
				You can automate your migrations and modify MTC custom resources to improve the performance of large-scale migrations by using the following options:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-state-migration-cli_advanced-migration-options-3-4">Running a state migration</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-hooks_advanced-migration-options-3-4">Creating migration hooks</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-plan-options_advanced-migration-options-3-4">Editing, excluding, and mapping migrated resources</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-controller-options_advanced-migration-options-3-4">Configuring the migration controller for large migrations</a>
					</li></ul></div></section><section class="section" id="mtc-overview-troubleshooting-mtc"><div class="titlepage"><div><div><h2 class="title">1.8. Troubleshooting migrations</h2></div></div></div><p>
				You can perform the following troubleshooting tasks:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-viewing-migration-plan-resources_troubleshooting-3-4">Viewing migration plan resources by using the MTC web console</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-viewing-migration-plan-log_troubleshooting-3-4">Viewing the migration plan aggregated log file</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-using-mig-log-reader_troubleshooting-3-4">Using the migration log reader</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-accessing-performance-metrics_troubleshooting-3-4">Accessing performance metrics</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-using-must-gather_troubleshooting-3-4">Using the <code class="literal">must-gather</code> tool</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-debugging-velero-resources_troubleshooting-3-4">Using the Velero CLI to debug <code class="literal">Backup</code> and <code class="literal">Restore</code> CRs</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-using-mtc-crs-for-troubleshooting_troubleshooting-3-4">Using MTC custom resources for troubleshooting</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#common-issues-and-concerns_troubleshooting-3-4">Checking common issues and concerns</a>
					</li></ul></div></section><section class="section" id="mtc-overview-roll-back-mtc"><div class="titlepage"><div><div><h2 class="title">1.9. Rolling back a migration</h2></div></div></div><p>
				You can <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#rolling-back-migration_troubleshooting-3-4">roll back a migration</a> by using the MTC web console, by using the CLI, or manually.
			</p></section><section class="section" id="mtc-overview-uninstall-mtc"><div class="titlepage"><div><div><h2 class="title">1.10. Uninstalling MTC and deleting resources</h2></div></div></div><p>
				You can <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-uninstalling-mtc-clean-up_installing-3-4">uninstall the MTC and delete its resources</a> to clean up the cluster.
			</p></section></section><section class="chapter" id="about-migrating-from-3-to-4"><div class="titlepage"><div><div><h1 class="title">Chapter 2. About migrating from OpenShift Container Platform 3 to 4</h1></div></div></div><p>
			OpenShift Container Platform 4 contains new technologies and functionality that result in a cluster that is self-managing, flexible, and automated. OpenShift Container Platform 4 clusters are deployed and managed very differently from OpenShift Container Platform 3.
		</p><p>
			The most effective way to migrate from OpenShift Container Platform 3 to 4 is by using a CI/CD pipeline to automate deployments in an <a class="link" href="https://www.redhat.com/en/topics/devops/what-is-application-lifecycle-management-alm">application lifecycle management</a> framework.
		</p><p>
			If you do not have a CI/CD pipeline or if you are migrating stateful applications, you can use the Migration Toolkit for Containers (MTC) to migrate your application workloads.
		</p><p>
			You can use Red Hat Advanced Cluster Management for Kubernetes to help you import and manage your OpenShift Container Platform 3 clusters easily, enforce policies, and redeploy your applications. Take advantage of the <a class="link" href="https://www.redhat.com/en/engage/free-access-redhat-e-202202170127">free subscription</a> to use Red Hat Advanced Cluster Management to simplify your migration process.
		</p><p>
			To successfully transition to OpenShift Container Platform 4, review the following information:
		</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#planning-migration-3-4">Differences between OpenShift Container Platform 3 and 4</a></span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Architecture
							</li><li class="listitem">
								Installation and upgrade
							</li><li class="listitem">
								Storage, network, logging, security, and monitoring considerations
							</li></ul></div></dd><dt><span class="term"><a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#about-mtc-3-4">About the Migration Toolkit for Containers</a></span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Workflow
							</li><li class="listitem">
								File system and snapshot copy methods for persistent volumes (PVs)
							</li><li class="listitem">
								Direct volume migration
							</li><li class="listitem">
								Direct image migration
							</li></ul></div></dd><dt><span class="term"><a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#advanced-migration-options-3-4">Advanced migration options</a></span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Automating your migration with migration hooks
							</li><li class="listitem">
								Using the MTC API
							</li><li class="listitem">
								Excluding resources from a migration plan
							</li><li class="listitem">
								Configuring the <code class="literal">MigrationController</code> custom resource for large-scale migrations
							</li><li class="listitem">
								Enabling automatic PV resizing for direct volume migration
							</li><li class="listitem">
								Enabling cached Kubernetes clients for improved performance
							</li></ul></div></dd></dl></div><p>
			For new features and enhancements, technical changes, and known issues, see the <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migration_toolkit_for_containers/#mtc-release-notes">MTC release notes</a>.
		</p></section><section class="chapter" id="planning-migration-3-4"><div class="titlepage"><div><div><h1 class="title">Chapter 3. Differences between OpenShift Container Platform 3 and 4</h1></div></div></div><p>
			OpenShift Container Platform 4.13 introduces architectural changes and enhancements/ The procedures that you used to manage your OpenShift Container Platform 3 cluster might not apply to OpenShift Container Platform 4.
		</p><p>
			For information on configuring your OpenShift Container Platform 4 cluster, review the appropriate sections of the OpenShift Container Platform documentation. For information on new features and other notable technical changes, review the <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/release_notes/#ocp-4-13-release-notes">OpenShift Container Platform 4.13 release notes</a>.
		</p><p>
			It is not possible to upgrade your existing OpenShift Container Platform 3 cluster to OpenShift Container Platform 4. You must start with a new OpenShift Container Platform 4 installation. Tools are available to assist in migrating your control plane settings and application workloads.
		</p><section class="section" id="migration-differences-architecture"><div class="titlepage"><div><div><h2 class="title">3.1. Architecture</h2></div></div></div><p>
				With OpenShift Container Platform 3, administrators individually deployed Red Hat Enterprise Linux (RHEL) hosts, and then installed OpenShift Container Platform on top of these hosts to form a cluster. Administrators were responsible for properly configuring these hosts and performing updates.
			</p><p>
				OpenShift Container Platform 4 represents a significant change in the way that OpenShift Container Platform clusters are deployed and managed. OpenShift Container Platform 4 includes new technologies and functionality, such as Operators, machine sets, and Red Hat Enterprise Linux CoreOS (RHCOS), which are core to the operation of the cluster. This technology shift enables clusters to self-manage some functions previously performed by administrators. This also ensures platform stability and consistency, and simplifies installation and scaling.
			</p><p>
				Beginning with OpenShift Container Platform 4.13, RHCOS now uses Red Hat Enterprise Linux (RHEL) 9.2 packages. This enhancement enables the latest fixes and features as well as the latest hardware support and driver updates. For more information about how this upgrade to RHEL 9.2 might affect your options configuration and services as well as driver and container support, see the <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/release_notes/#ocp-4-13-rhcos-rhel-9-2-packages">RHCOS now uses RHEL 9.2</a> in the <span class="emphasis"><em>OpenShift Container Platform 4.13 release notes</em></span>.
			</p><p>
				For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/architecture/#architecture">OpenShift Container Platform architecture</a>.
			</p><h4 id="immutable-infrastructure">Immutable infrastructure</h4><p>
				OpenShift Container Platform 4 uses Red Hat Enterprise Linux CoreOS (RHCOS), which is designed to run containerized applications, and provides efficient installation, Operator-based management, and simplified upgrades. RHCOS is an immutable container host, rather than a customizable operating system like RHEL. RHCOS enables OpenShift Container Platform 4 to manage and automate the deployment of the underlying container host. RHCOS is a part of OpenShift Container Platform, which means that everything runs inside a container and is deployed using OpenShift Container Platform.
			</p><p>
				In OpenShift Container Platform 4, control plane nodes must run RHCOS, ensuring that full-stack automation is maintained for the control plane. This makes rolling out updates and upgrades a much easier process than in OpenShift Container Platform 3.
			</p><p>
				For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/architecture/#architecture-rhcos">Red Hat Enterprise Linux CoreOS (RHCOS)</a>.
			</p><h4 id="operators">Operators</h4><p>
				Operators are a method of packaging, deploying, and managing a Kubernetes application. Operators ease the operational complexity of running another piece of software. They watch over your environment and use the current state to make decisions in real time. Advanced Operators are designed to upgrade and react to failures automatically.
			</p><p>
				For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/operators/#olm-what-operators-are">Understanding Operators</a>.
			</p></section><section class="section" id="migration-differences-install"><div class="titlepage"><div><div><h2 class="title">3.2. Installation and upgrade</h2></div></div></div><h4 id="installation-process">Installation process</h4><p>
				To install OpenShift Container Platform 3.11, you prepared your Red Hat Enterprise Linux (RHEL) hosts, set all of the configuration values your cluster needed, and then ran an Ansible playbook to install and set up your cluster.
			</p><p>
				In OpenShift Container Platform 4.13, you use the OpenShift installation program to create a minimum set of resources required for a cluster. After the cluster is running, you use Operators to further configure your cluster and to install new services. After first boot, Red Hat Enterprise Linux CoreOS (RHCOS) systems are managed by the Machine Config Operator (MCO) that runs in the OpenShift Container Platform cluster.
			</p><p>
				For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/architecture/#installation-process_architecture-installation">Installation process</a>.
			</p><p>
				If you want to add Red Hat Enterprise Linux (RHEL) worker machines to your OpenShift Container Platform 4.13 cluster, you use an Ansible playbook to join the RHEL worker machines after the cluster is running. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/machine_management/#adding-rhel-compute">Adding RHEL compute machines to an OpenShift Container Platform cluster</a>.
			</p><h4 id="infrastructure-options">Infrastructure options</h4><p>
				In OpenShift Container Platform 3.11, you installed your cluster on infrastructure that you prepared and maintained. In addition to providing your own infrastructure, OpenShift Container Platform 4 offers an option to deploy a cluster on infrastructure that the OpenShift Container Platform installation program provisions and the cluster maintains.
			</p><p>
				For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/architecture/#installation-overview_architecture-installation">OpenShift Container Platform installation overview</a>.
			</p><h4 id="upgrading-your-cluster">Upgrading your cluster</h4><p>
				In OpenShift Container Platform 3.11, you upgraded your cluster by running Ansible playbooks. In OpenShift Container Platform 4.13, the cluster manages its own updates, including updates to Red Hat Enterprise Linux CoreOS (RHCOS) on cluster nodes. You can easily upgrade your cluster by using the web console or by using the <code class="literal">oc adm upgrade</code> command from the OpenShift CLI and the Operators will automatically upgrade themselves. If your OpenShift Container Platform 4.13 cluster has RHEL worker machines, then you will still need to run an Ansible playbook to upgrade those worker machines.
			</p><p>
				For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/updating_clusters/#updating-cluster-within-minor">Updating clusters</a>.
			</p></section><section class="section" id="migration-considerations"><div class="titlepage"><div><div><h2 class="title">3.3. Migration considerations</h2></div></div></div><p>
				Review the changes and other considerations that might affect your transition from OpenShift Container Platform 3.11 to OpenShift Container Platform 4.
			</p><section class="section" id="migration-preparing-storage"><div class="titlepage"><div><div><h3 class="title">3.3.1. Storage considerations</h3></div></div></div><p>
					Review the following storage changes to consider when transitioning from OpenShift Container Platform 3.11 to OpenShift Container Platform 4.13.
				</p><h5 id="local-volume-persistent-storage">Local volume persistent storage</h5><p>
					Local storage is only supported by using the Local Storage Operator in OpenShift Container Platform 4.13. It is not supported to use the local provisioner method from OpenShift Container Platform 3.11.
				</p><p>
					For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/storage/#persistent-storage-using-local-volume">Persistent storage using local volumes</a>.
				</p><h5 id="flexvolume-persistent-storage">FlexVolume persistent storage</h5><p>
					The FlexVolume plugin location changed from OpenShift Container Platform 3.11. The new location in OpenShift Container Platform 4.13 is <code class="literal">/etc/kubernetes/kubelet-plugins/volume/exec</code>. Attachable FlexVolume plugins are no longer supported.
				</p><p>
					For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/storage/#persistent-storage-using-flexvolume">Persistent storage using FlexVolume</a>.
				</p><h5 id="container-storage-interface-csi-persistent-storage">Container Storage Interface (CSI) persistent storage</h5><p>
					Persistent storage using the Container Storage Interface (CSI) was <a class="link" href="https://access.redhat.com/support/offerings/techpreview">Technology Preview</a> in OpenShift Container Platform 3.11. OpenShift Container Platform 4.13 ships with <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/storage/#csi-drivers-supported_persistent-storage-csi">several CSI drivers</a>. You can also install your own driver.
				</p><p>
					For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/storage/#persistent-storage-using-csi">Persistent storage using the Container Storage Interface (CSI)</a>.
				</p><h5 id="red-hat-openshift-data-foundation">Red Hat OpenShift Data Foundation</h5><p>
					OpenShift Container Storage 3, which is available for use with OpenShift Container Platform 3.11, uses Red Hat Gluster Storage as the backing storage.
				</p><p>
					Red Hat OpenShift Data Foundation 4, which is available for use with OpenShift Container Platform 4, uses Red Hat Ceph Storage as the backing storage.
				</p><p>
					For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/storage/#red-hat-openshift-data-foundation">Persistent storage using Red Hat OpenShift Data Foundation</a> and the <a class="link" href="https://access.redhat.com/articles/4731161">interoperability matrix</a> article.
				</p><h5 id="unsupported-persistent-storage-options">Unsupported persistent storage options</h5><p>
					Support for the following persistent storage options from OpenShift Container Platform 3.11 has changed in OpenShift Container Platform 4.13:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							GlusterFS is no longer supported.
						</li><li class="listitem">
							CephFS as a standalone product is no longer supported.
						</li><li class="listitem">
							Ceph RBD as a standalone product is no longer supported.
						</li></ul></div><p>
					If you used one of these in OpenShift Container Platform 3.11, you must choose a different persistent storage option for full support in OpenShift Container Platform 4.13.
				</p><p>
					For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/storage/#understanding-persistent-storage">Understanding persistent storage</a>.
				</p><h5 id="migration-of-in-tree-volumes-to-csi-drivers">Migration of in-tree volumes to CSI drivers</h5><p>
					OpenShift Container Platform 4 is migrating in-tree volume plugins to their Container Storage Interface (CSI) counterparts. In OpenShift Container Platform 4.13, CSI drivers are the new default for the following in-tree volume types:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Amazon Web Services (AWS) Elastic Block Storage (EBS)
						</li><li class="listitem">
							Azure Disk
						</li><li class="listitem">
							Azure File
						</li><li class="listitem">
							Google Cloud Platform Persistent Disk (GCP PD)
						</li><li class="listitem">
							OpenStack Cinder
						</li><li class="listitem"><p class="simpara">
							VMware vSphere
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								As of OpenShift Container Platform 4.13, VMware vSphere is not available by default. However, you can opt into VMware vSphere.
							</p></div></div></li></ul></div><p>
					All aspects of volume lifecycle, such as creation, deletion, mounting, and unmounting, is handled by the CSI driver.
				</p><p>
					For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/storage/#persistent-storage-csi-migration">CSI automatic migration</a>.
				</p></section><section class="section" id="migration-preparing-networking"><div class="titlepage"><div><div><h3 class="title">3.3.2. Networking considerations</h3></div></div></div><p>
					Review the following networking changes to consider when transitioning from OpenShift Container Platform 3.11 to OpenShift Container Platform 4.13.
				</p><h5 id="network-isolation-mode">Network isolation mode</h5><p>
					The default network isolation mode for OpenShift Container Platform 3.11 was <code class="literal">ovs-subnet</code>, though users frequently switched to use <code class="literal">ovn-multitenant</code>. The default network isolation mode for OpenShift Container Platform 4.13 is controlled by a network policy.
				</p><p>
					If your OpenShift Container Platform 3.11 cluster used the <code class="literal">ovs-subnet</code> or <code class="literal">ovs-multitenant</code> mode, it is recommended to switch to a network policy for your OpenShift Container Platform 4.13 cluster. Network policies are supported upstream, are more flexible, and they provide the functionality that <code class="literal">ovs-multitenant</code> does. If you want to maintain the <code class="literal">ovs-multitenant</code> behavior while using a network policy in OpenShift Container Platform 4.13, follow the steps to <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/networking/#multitenant-network-policy">configure multitenant isolation using network policy</a>.
				</p><p>
					For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/networking/#about-network-policy">About network policy</a>.
				</p><h5 id="ovn-kubernetes-as-the-default-networking-plugin-in-red-hat-openshift-networking">OVN-Kubernetes as the default networking plugin in Red Hat OpenShift Networking</h5><p>
					In OpenShift Container Platform 3.11, OpenShift SDN was the default networking plugin in Red Hat OpenShift Networking. In OpenShift Container Platform 4.13, OVN-Kubernetes is now the default networking plugin.
				</p><p>
					For information on migrating to OVN-Kubernetes from OpenShift SDN, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/networking/#migrate-from-openshift-sdn">Migrating from the OpenShift SDN network plugin</a>.
				</p></section><section class="section" id="migration-preparing-logging"><div class="titlepage"><div><div><h3 class="title">3.3.3. Logging considerations</h3></div></div></div><p>
					Review the following logging changes to consider when transitioning from OpenShift Container Platform 3.11 to OpenShift Container Platform 4.13.
				</p><h5 id="deploying-openshift-logging">Deploying OpenShift Logging</h5><p>
					OpenShift Container Platform 4 provides a simple deployment mechanism for OpenShift Logging, by using a Cluster Logging custom resource.
				</p><p>
					For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/logging/#cluster-logging-deploying_cluster-logging-deploying">Installing OpenShift Logging</a>.
				</p><h5 id="aggregated-logging-data">Aggregated logging data</h5><p>
					You cannot transition your aggregate logging data from OpenShift Container Platform 3.11 into your new OpenShift Container Platform 4 cluster.
				</p><p>
					For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/logging/#cluster-logging-about_cluster-logging">About OpenShift Logging</a>.
				</p><h5 id="unsupported-logging-configurations">Unsupported logging configurations</h5><p>
					Some logging configurations that were available in OpenShift Container Platform 3.11 are no longer supported in OpenShift Container Platform 4.13.
				</p><p>
					For more information on the explicitly unsupported logging cases, see the <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/logging/#cluster-logging-support">logging support documentation</a>.
				</p></section><section class="section" id="migration-preparing-security"><div class="titlepage"><div><div><h3 class="title">3.3.4. Security considerations</h3></div></div></div><p>
					Review the following security changes to consider when transitioning from OpenShift Container Platform 3.11 to OpenShift Container Platform 4.13.
				</p><h5 id="unauthenticated-access-to-discovery-endpoints">Unauthenticated access to discovery endpoints</h5><p>
					In OpenShift Container Platform 3.11, an unauthenticated user could access the discovery endpoints (for example, <code class="literal">/api/*</code> and <code class="literal">/apis/*</code>). For security reasons, unauthenticated access to the discovery endpoints is no longer allowed in OpenShift Container Platform 4.13. If you do need to allow unauthenticated access, you can configure the RBAC settings as necessary; however, be sure to consider the security implications as this can expose internal cluster components to the external network.
				</p><h5 id="identity-providers">Identity providers</h5><p>
					Configuration for identity providers has changed for OpenShift Container Platform 4, including the following notable changes:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							The request header identity provider in OpenShift Container Platform 4.13 requires mutual TLS, where in OpenShift Container Platform 3.11 it did not.
						</li><li class="listitem">
							The configuration of the OpenID Connect identity provider was simplified in OpenShift Container Platform 4.13. It now obtains data, which previously had to specified in OpenShift Container Platform 3.11, from the provider’s <code class="literal">/.well-known/openid-configuration</code> endpoint.
						</li></ul></div><p>
					For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/authentication_and_authorization/#understanding-identity-provider">Understanding identity provider configuration</a>.
				</p><h5 id="oauth-token-storage-format">OAuth token storage format</h5><p>
					Newly created OAuth HTTP bearer tokens no longer match the names of their OAuth access token objects. The object names are now a hash of the bearer token and are no longer sensitive. This reduces the risk of leaking sensitive information.
				</p><h5 id="default-security-context-constraints">Default security context constraints</h5><p>
					The <code class="literal">restricted</code> security context constraints (SCC) in OpenShift Container Platform 4 can no longer be accessed by any authenticated user as the <code class="literal">restricted</code> SCC in OpenShift Container Platform 3.11. The broad authenticated access is now granted to the <code class="literal">restricted-v2</code> SCC, which is more restrictive than the old <code class="literal">restricted</code> SCC. The <code class="literal">restricted</code> SCC still exists; users that want to use it must be specifically given permissions to do it.
				</p><p>
					For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/authentication_and_authorization/#managing-pod-security-policies">Managing security context constraints</a>.
				</p></section><section class="section" id="migration-preparing-monitoring"><div class="titlepage"><div><div><h3 class="title">3.3.5. Monitoring considerations</h3></div></div></div><p>
					Review the following monitoring changes when transitioning from OpenShift Container Platform 3.11 to OpenShift Container Platform 4.13. You cannot migrate Hawkular configurations and metrics to Prometheus.
				</p><h5 id="alert-for-monitoring-infrastructure-availability">Alert for monitoring infrastructure availability</h5><p>
					The default alert that triggers to ensure the availability of the monitoring structure was called <code class="literal">DeadMansSwitch</code> in OpenShift Container Platform 3.11. This was renamed to <code class="literal">Watchdog</code> in OpenShift Container Platform 4. If you had PagerDuty integration set up with this alert in OpenShift Container Platform 3.11, you must set up the PagerDuty integration for the <code class="literal">Watchdog</code> alert in OpenShift Container Platform 4.
				</p><p>
					For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/monitoring/#applying-custom-alertmanager-configuration_managing-alerts">Applying custom Alertmanager configuration</a>.
				</p></section></section></section><section class="chapter" id="planning-considerations-3-4"><div class="titlepage"><div><div><h1 class="title">Chapter 4. Network considerations</h1></div></div></div><p>
			Review the strategies for redirecting your application network traffic after migration.
		</p><section class="section" id="dns-considerations_planning-considerations-3-4"><div class="titlepage"><div><div><h2 class="title">4.1. DNS considerations</h2></div></div></div><p>
				The DNS domain of the target cluster is different from the domain of the source cluster. By default, applications get FQDNs of the target cluster after migration.
			</p><p>
				To preserve the source DNS domain of migrated applications, select one of the two options described below.
			</p><section class="section" id="migration-isolating-dns-domain-of-target-cluster-from-clients_planning-considerations-3-4"><div class="titlepage"><div><div><h3 class="title">4.1.1. Isolating the DNS domain of the target cluster from the clients</h3></div></div></div><p>
					You can allow the clients' requests sent to the DNS domain of the source cluster to reach the DNS domain of the target cluster without exposing the target cluster to the clients.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Place an exterior network component, such as an application load balancer or a reverse proxy, between the clients and the target cluster.
						</li><li class="listitem">
							Update the application FQDN on the source cluster in the DNS server to return the IP address of the exterior network component.
						</li><li class="listitem">
							Configure the network component to send requests received for the application in the source domain to the load balancer in the target cluster domain.
						</li><li class="listitem">
							Create a wildcard DNS record for the <code class="literal">*.apps.source.example.com</code> domain that points to the IP address of the load balancer of the source cluster.
						</li><li class="listitem">
							Create a DNS record for each application that points to the IP address of the exterior network component in front of the target cluster. A specific DNS record has higher priority than a wildcard record, so no conflict arises when the application FQDN is resolved.
						</li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								The exterior network component must terminate all secure TLS connections. If the connections pass through to the target cluster load balancer, the FQDN of the target application is exposed to the client and certificate errors occur.
							</li><li class="listitem">
								The applications must not return links referencing the target cluster domain to the clients. Otherwise, parts of the application might not load or work properly.
							</li></ul></div></div></div></section><section class="section" id="migration-setting-up-target-cluster-to-accept-source-dns-domain_planning-considerations-3-4"><div class="titlepage"><div><div><h3 class="title">4.1.2. Setting up the target cluster to accept the source DNS domain</h3></div></div></div><p>
					You can set up the target cluster to accept requests for a migrated application in the DNS domain of the source cluster.
				</p><div class="formalpara"><p class="title"><strong>Procedure</strong></p><p>
						For both non-secure HTTP access and secure HTTPS access, perform the following steps:
					</p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Create a route in the target cluster’s project that is configured to accept requests addressed to the application’s FQDN in the source cluster:
						</p><pre class="programlisting language-terminal">$ oc expose svc &lt;app1-svc&gt; --hostname &lt;app1.apps.source.example.com&gt; \
 -n &lt;app1-namespace&gt;</pre><p class="simpara">
							With this new route in place, the server accepts any request for that FQDN and sends it to the corresponding application pods. In addition, when you migrate the application, another route is created in the target cluster domain. Requests reach the migrated application using either of these hostnames.
						</p></li><li class="listitem"><p class="simpara">
							Create a DNS record with your DNS provider that points the application’s FQDN in the source cluster to the IP address of the default load balancer of the target cluster. This will redirect traffic away from your source cluster to your target cluster.
						</p><p class="simpara">
							The FQDN of the application resolves to the load balancer of the target cluster. The default Ingress Controller router accept requests for that FQDN because a route for that hostname is exposed.
						</p></li></ol></div><p>
					For secure HTTPS access, perform the following additional step:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Replace the x509 certificate of the default Ingress Controller created during the installation process with a custom certificate.
						</li><li class="listitem"><p class="simpara">
							Configure this certificate to include the wildcard DNS domains for both the source and target clusters in the <code class="literal">subjectAltName</code> field.
						</p><p class="simpara">
							The new certificate is valid for securing connections made using either DNS domain.
						</p></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							See <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/security_and_compliance/#replacing-default-ingress">Replacing the default ingress certificate</a> for more information.
						</li></ul></div></section></section><section class="section" id="migration-network-traffic-redirection-strategies_planning-considerations-3-4"><div class="titlepage"><div><div><h2 class="title">4.2. Network traffic redirection strategies</h2></div></div></div><p>
				After a successful migration, you must redirect network traffic of your stateless applications from the source cluster to the target cluster.
			</p><p>
				The strategies for redirecting network traffic are based on the following assumptions:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						The application pods are running on both the source and target clusters.
					</li><li class="listitem">
						Each application has a route that contains the source cluster hostname.
					</li><li class="listitem">
						The route with the source cluster hostname contains a CA certificate.
					</li><li class="listitem">
						For HTTPS, the target router CA certificate contains a Subject Alternative Name for the wildcard DNS record of the source cluster.
					</li></ul></div><p>
				Consider the following strategies and select the one that meets your objectives.
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Redirecting all network traffic for all applications at the same time
					</p><p class="simpara">
						Change the wildcard DNS record of the source cluster to point to the target cluster router’s virtual IP address (VIP).
					</p><p class="simpara">
						This strategy is suitable for simple applications or small migrations.
					</p></li><li class="listitem"><p class="simpara">
						Redirecting network traffic for individual applications
					</p><p class="simpara">
						Create a DNS record for each application with the source cluster hostname pointing to the target cluster router’s VIP. This DNS record takes precedence over the source cluster wildcard DNS record.
					</p></li><li class="listitem"><p class="simpara">
						Redirecting network traffic gradually for individual applications
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								Create a proxy that can direct traffic to both the source cluster router’s VIP and the target cluster router’s VIP, for each application.
							</li><li class="listitem">
								Create a DNS record for each application with the source cluster hostname pointing to the proxy.
							</li><li class="listitem">
								Configure the proxy entry for the application to route a percentage of the traffic to the target cluster router’s VIP and the rest of the traffic to the source cluster router’s VIP.
							</li><li class="listitem">
								Gradually increase the percentage of traffic that you route to the target cluster router’s VIP until all the network traffic is redirected.
							</li></ol></div></li><li class="listitem"><p class="simpara">
						User-based redirection of traffic for individual applications
					</p><p class="simpara">
						Using this strategy, you can filter TCP/IP headers of user requests to redirect network traffic for predefined groups of users. This allows you to test the redirection process on specific populations of users before redirecting the entire network traffic.
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								Create a proxy that can direct traffic to both the source cluster router’s VIP and the target cluster router’s VIP, for each application.
							</li><li class="listitem">
								Create a DNS record for each application with the source cluster hostname pointing to the proxy.
							</li><li class="listitem">
								Configure the proxy entry for the application to route traffic matching a given header pattern, such as <code class="literal">test customers</code>, to the target cluster router’s VIP and the rest of the traffic to the source cluster router’s VIP.
							</li><li class="listitem">
								Redirect traffic to the target cluster router’s VIP in stages until all the traffic is on the target cluster router’s VIP.
							</li></ol></div></li></ul></div></section></section><section class="chapter" id="about-mtc-3-4"><div class="titlepage"><div><div><h1 class="title">Chapter 5. About the Migration Toolkit for Containers</h1></div></div></div><p>
			The Migration Toolkit for Containers (MTC) enables you to migrate stateful application workloads from OpenShift Container Platform 3 to 4.13 at the granularity of a namespace.
		</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
				Before you begin your migration, be sure to review the <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#planning-migration-3-4">differences between OpenShift Container Platform 3 and 4</a>.
			</p></div></div><p>
			MTC provides a web console and an API, based on Kubernetes custom resources, to help you control the migration and minimize application downtime.
		</p><p>
			The MTC console is installed on the target cluster by default. You can configure the Migration Toolkit for Containers Operator to install the console on an <a class="link" href="https://access.redhat.com/articles/5064151">OpenShift Container Platform 3 source cluster or on a remote cluster</a>.
		</p><p>
			MTC supports the file system and snapshot data copy methods for migrating data from the source cluster to the target cluster. You can select a method that is suited for your environment and is supported by your storage provider.
		</p><p>
			The service catalog is deprecated in OpenShift Container Platform 4. You can migrate workload resources provisioned with the service catalog from OpenShift Container Platform 3 to 4 but you cannot perform service catalog actions such as <code class="literal">provision</code>, <code class="literal">deprovision</code>, or <code class="literal">update</code> on these workloads after migration. The MTC console displays a message if the service catalog resources cannot be migrated.
		</p><section class="section" id="migration-terminology_about-mtc-3-4"><div class="titlepage"><div><div><h2 class="title">5.1. Terminology</h2></div></div></div><div class="table" id="idm139748685736112"><p class="title"><strong>Table 5.1. MTC terminology</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 25%; " class="col_1"><!--Empty--></col><col style="width: 75%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139748676301408" scope="col">Term</th><th align="left" valign="top" id="idm139748676300384" scope="col">Definition</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139748676301408"> <p>
								Source cluster
							</p>
							 </td><td align="left" valign="top" headers="idm139748676300384"> <p>
								Cluster from which the applications are migrated.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139748676301408"> <p>
								Destination cluster<sup>[1]</sup>
							</p>
							 </td><td align="left" valign="top" headers="idm139748676300384"> <p>
								Cluster to which the applications are migrated.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139748676301408"> <p>
								Replication repository
							</p>
							 </td><td align="left" valign="top" headers="idm139748676300384"> <p>
								Object storage used for copying images, volumes, and Kubernetes objects during indirect migration or for Kubernetes objects during direct volume migration or direct image migration.
							</p>
							 <p>
								The replication repository must be accessible to all clusters.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139748676301408"> <p>
								Host cluster
							</p>
							 </td><td align="left" valign="top" headers="idm139748676300384"> <p>
								Cluster on which the <code class="literal">migration-controller</code> pod and the web console are running. The host cluster is usually the destination cluster but this is not required.
							</p>
							 <p>
								The host cluster does not require an exposed registry route for direct image migration.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139748676301408"> <p>
								Remote cluster
							</p>
							 </td><td align="left" valign="top" headers="idm139748676300384"> <p>
								A remote cluster is usually the source cluster but this is not required.
							</p>
							 <p>
								A remote cluster requires a <code class="literal">Secret</code> custom resource that contains the <code class="literal">migration-controller</code> service account token.
							</p>
							 <p>
								A remote cluster requires an exposed secure registry route for direct image migration.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139748676301408"> <p>
								Indirect migration
							</p>
							 </td><td align="left" valign="top" headers="idm139748676300384"> <p>
								Images, volumes, and Kubernetes objects are copied from the source cluster to the replication repository and then from the replication repository to the destination cluster.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139748676301408"> <p>
								Direct volume migration
							</p>
							 </td><td align="left" valign="top" headers="idm139748676300384"> <p>
								Persistent volumes are copied directly from the source cluster to the destination cluster.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139748676301408"> <p>
								Direct image migration
							</p>
							 </td><td align="left" valign="top" headers="idm139748676300384"> <p>
								Images are copied directly from the source cluster to the destination cluster.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139748676301408"> <p>
								Stage migration
							</p>
							 </td><td align="left" valign="top" headers="idm139748676300384"> <p>
								Data is copied to the destination cluster without stopping the application.
							</p>
							 <p>
								Running a stage migration multiple times reduces the duration of the cutover migration.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139748676301408"> <p>
								Cutover migration
							</p>
							 </td><td align="left" valign="top" headers="idm139748676300384"> <p>
								The application is stopped on the source cluster and its resources are migrated to the destination cluster.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139748676301408"> <p>
								State migration
							</p>
							 </td><td align="left" valign="top" headers="idm139748676300384"> <p>
								Application state is migrated by copying specific persistent volume claims to the destination cluster.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139748676301408"> <p>
								Rollback migration
							</p>
							 </td><td align="left" valign="top" headers="idm139748676300384"> <p>
								Rollback migration rolls back a completed migration.
							</p>
							 </td></tr></tbody></table></div></div><p>
				<sup>1</sup> Called the <span class="emphasis"><em>target</em></span> cluster in the MTC web console.
			</p></section><section class="section" id="migration-mtc-workflow_about-mtc-3-4"><div class="titlepage"><div><div><h2 class="title">5.2. MTC workflow</h2></div></div></div><p>
				You can migrate Kubernetes resources, persistent volume data, and internal container images to OpenShift Container Platform 4.13 by using the Migration Toolkit for Containers (MTC) web console or the Kubernetes API.
			</p><p>
				MTC migrates the following resources:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						A namespace specified in a migration plan.
					</li><li class="listitem"><p class="simpara">
						Namespace-scoped resources: When the MTC migrates a namespace, it migrates all the objects and resources associated with that namespace, such as services or pods. Additionally, if a resource that exists in the namespace but not at the cluster level depends on a resource that exists at the cluster level, the MTC migrates both resources.
					</p><p class="simpara">
						For example, a security context constraint (SCC) is a resource that exists at the cluster level and a service account (SA) is a resource that exists at the namespace level. If an SA exists in a namespace that the MTC migrates, the MTC automatically locates any SCCs that are linked to the SA and also migrates those SCCs. Similarly, the MTC migrates persistent volumes that are linked to the persistent volume claims of the namespace.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							Cluster-scoped resources might have to be migrated manually, depending on the resource.
						</p></div></div></li><li class="listitem">
						Custom resources (CRs) and custom resource definitions (CRDs): MTC automatically migrates CRs and CRDs at the namespace level.
					</li></ul></div><p>
				Migrating an application with the MTC web console involves the following steps:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Install the Migration Toolkit for Containers Operator on all clusters.
					</p><p class="simpara">
						You can install the Migration Toolkit for Containers Operator in a restricted environment with limited or no internet access. The source and target clusters must have network access to each other and to a mirror registry.
					</p></li><li class="listitem"><p class="simpara">
						Configure the replication repository, an intermediate object storage that MTC uses to migrate data.
					</p><p class="simpara">
						The source and target clusters must have network access to the replication repository during migration. If you are using a proxy server, you must configure it to allow network traffic between the replication repository and the clusters.
					</p></li><li class="listitem">
						Add the source cluster to the MTC web console.
					</li><li class="listitem">
						Add the replication repository to the MTC web console.
					</li><li class="listitem"><p class="simpara">
						Create a migration plan, with one of the following data migration options:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								<span class="strong strong"><strong>Copy</strong></span>: MTC copies the data from the source cluster to the replication repository, and from the replication repository to the target cluster.
							</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
									If you are using direct image migration or direct volume migration, the images or volumes are copied directly from the source cluster to the target cluster.
								</p></div></div><div class="informalfigure"><div class="mediaobject"><img src="https://access.redhat.com/webassets/avalon/d/OpenShift_Container_Platform-4.13-Migrating_from_version_3_to_4-en-US/images/6f34f274d8204ad77c50bc657505641d/migration-PV-copy.png" alt="migration PV copy"/></div></div></li><li class="listitem"><p class="simpara">
								<span class="strong strong"><strong>Move</strong></span>: MTC unmounts a remote volume, for example, NFS, from the source cluster, creates a PV resource on the target cluster pointing to the remote volume, and then mounts the remote volume on the target cluster. Applications running on the target cluster use the same remote volume that the source cluster was using. The remote volume must be accessible to the source and target clusters.
							</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
									Although the replication repository does not appear in this diagram, it is required for migration.
								</p></div></div><div class="informalfigure"><div class="mediaobject"><img src="https://access.redhat.com/webassets/avalon/d/OpenShift_Container_Platform-4.13-Migrating_from_version_3_to_4-en-US/images/882c7cbe8dfa21b24793dfd7596aec4a/migration-PV-move.png" alt="migration PV move"/></div></div></li></ul></div></li><li class="listitem"><p class="simpara">
						Run the migration plan, with one of the following options:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								<span class="strong strong"><strong>Stage</strong></span> copies data to the target cluster without stopping the application.
							</p><p class="simpara">
								A stage migration can be run multiple times so that most of the data is copied to the target before migration. Running one or more stage migrations reduces the duration of the cutover migration.
							</p></li><li class="listitem"><p class="simpara">
								<span class="strong strong"><strong>Cutover</strong></span> stops the application on the source cluster and moves the resources to the target cluster.
							</p><p class="simpara">
								Optional: You can clear the <span class="strong strong"><strong>Halt transactions on the source cluster during migration</strong></span> checkbox.
							</p></li></ul></div></li></ol></div><div class="informalfigure"><div class="mediaobject"><img src="https://access.redhat.com/webassets/avalon/d/OpenShift_Container_Platform-4.13-Migrating_from_version_3_to_4-en-US/images/6153b64756a2813de0249237abf8d251/OCP_3_to_4_App_migration.png" alt="OCP 3 to 4 App migration"/></div></div></section><section class="section" id="migration-understanding-data-copy-methods_about-mtc-3-4"><div class="titlepage"><div><div><h2 class="title">5.3. About data copy methods</h2></div></div></div><p>
				The Migration Toolkit for Containers (MTC) supports the file system and snapshot data copy methods for migrating data from the source cluster to the target cluster. You can select a method that is suited for your environment and is supported by your storage provider.
			</p><section class="section" id="file-system-copy-method_about-mtc-3-4"><div class="titlepage"><div><div><h3 class="title">5.3.1. File system copy method</h3></div></div></div><p>
					MTC copies data files from the source cluster to the replication repository, and from there to the target cluster.
				</p><p>
					The file system copy method uses Restic for indirect migration or Rsync for direct volume migration.
				</p><div class="table" id="idm139748691196816"><p class="title"><strong>Table 5.2. File system copy method summary</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--></col><col style="width: 50%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139748686352832" scope="col">Benefits</th><th align="left" valign="top" id="idm139748686351744" scope="col">Limitations</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139748686352832"> <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
											Clusters can have different storage classes.
										</li><li class="listitem">
											Supported for all S3 storage providers.
										</li><li class="listitem">
											Optional data verification with checksum.
										</li><li class="listitem">
											Supports direct volume migration, which significantly increases performance.
										</li></ul></div>
								 </td><td align="left" valign="top" headers="idm139748686351744"> <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
											Slower than the snapshot copy method.
										</li><li class="listitem">
											Optional data verification significantly reduces performance.
										</li></ul></div>
								 </td></tr></tbody></table></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						The Restic and Rsync PV migration assumes that the PVs supported are only <code class="literal">volumeMode=filesystem</code>. Using <code class="literal">volumeMode=Block</code> for file system migration is <span class="emphasis"><em>not</em></span> supported.
					</p></div></div></section><section class="section" id="snapshot-copy-method_about-mtc-3-4"><div class="titlepage"><div><div><h3 class="title">5.3.2. Snapshot copy method</h3></div></div></div><p>
					MTC copies a snapshot of the source cluster data to the replication repository of a cloud provider. The data is restored on the target cluster.
				</p><p>
					The snapshot copy method can be used with Amazon Web Services, Google Cloud Provider, and Microsoft Azure.
				</p><div class="table" id="idm139748687922000"><p class="title"><strong>Table 5.3. Snapshot copy method summary</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--></col><col style="width: 50%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139748686794048" scope="col">Benefits</th><th align="left" valign="top" id="idm139748686792960" scope="col">Limitations</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139748686794048"> <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
											Faster than the file system copy method.
										</li></ul></div>
								 </td><td align="left" valign="top" headers="idm139748686792960"> <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
											Cloud provider must support snapshots.
										</li><li class="listitem">
											Clusters must be on the same cloud provider.
										</li><li class="listitem">
											Clusters must be in the same location or region.
										</li><li class="listitem">
											Clusters must have the same storage class.
										</li><li class="listitem">
											Storage class must be compatible with snapshots.
										</li><li class="listitem">
											Does not support direct volume migration.
										</li></ul></div>
								 </td></tr></tbody></table></div></div></section></section><section class="section" id="migration-direct-volume-migration-and-direct-image-migration_about-mtc-3-4"><div class="titlepage"><div><div><h2 class="title">5.4. Direct volume migration and direct image migration</h2></div></div></div><p>
				You can use direct image migration (DIM) and direct volume migration (DVM) to migrate images and data directly from the source cluster to the target cluster.
			</p><p>
				If you run DVM with nodes that are in different availability zones, the migration might fail because the migrated pods cannot access the persistent volume claim.
			</p><p>
				DIM and DVM have significant performance benefits because the intermediate steps of backing up files from the source cluster to the replication repository and restoring files from the replication repository to the target cluster are skipped. The data is transferred with <a class="link" href="https://rsync.samba.org/">Rsync</a>.
			</p><p>
				DIM and DVM have additional prerequisites.
			</p></section></section><section class="chapter" id="installing-3-4"><div class="titlepage"><div><div><h1 class="title">Chapter 6. Installing the Migration Toolkit for Containers</h1></div></div></div><p>
			You can install the Migration Toolkit for Containers (MTC) on OpenShift Container Platform 3 and 4.
		</p><p>
			After you install the Migration Toolkit for Containers Operator on OpenShift Container Platform 4.13 by using the Operator Lifecycle Manager, you manually install the legacy Migration Toolkit for Containers Operator on OpenShift Container Platform 3.
		</p><p>
			By default, the MTC web console and the <code class="literal">Migration Controller</code> pod run on the target cluster. You can configure the <code class="literal">Migration Controller</code> custom resource manifest to run the MTC web console and the <code class="literal">Migration Controller</code> pod on a <a class="link" href="https://access.redhat.com/articles/5064151">source cluster or on a remote cluster</a>.
		</p><p>
			After you have installed MTC, you must configure an object storage to use as a replication repository.
		</p><p>
			To uninstall MTC, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-uninstalling-mtc-clean-up_installing-3-4">Uninstalling MTC and deleting resources</a>.
		</p><section class="section" id="migration-compatibility-guidelines_installing-3-4"><div class="titlepage"><div><div><h2 class="title">6.1. Compatibility guidelines</h2></div></div></div><p>
				You must install the Migration Toolkit for Containers (MTC) Operator that is compatible with your OpenShift Container Platform version.
			</p><div class="variablelist"><p class="title"><strong>Definitions</strong></p><dl class="variablelist"><dt><span class="term">legacy platform</span></dt><dd>
							OpenShift Container Platform 4.5 and earlier.
						</dd><dt><span class="term">modern platform</span></dt><dd>
							OpenShift Container Platform 4.6 and later.
						</dd><dt><span class="term">legacy operator</span></dt><dd>
							The MTC Operator designed for legacy platforms.
						</dd><dt><span class="term">modern operator</span></dt><dd>
							The MTC Operator designed for modern platforms.
						</dd><dt><span class="term">control cluster</span></dt><dd>
							The cluster that runs the MTC controller and GUI.
						</dd><dt><span class="term">remote cluster</span></dt><dd>
							A source or destination cluster for a migration that runs Velero. The Control Cluster communicates with Remote clusters via the Velero API to drive migrations.
						</dd></dl></div><div class="table" id="idm139748691124736"><p class="title"><strong>Table 6.1. MTC compatibility: Migrating from a legacy platform</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 20%; " class="col_1"><!--Empty--></col><col style="width: 40%; " class="col_2"><!--Empty--></col><col style="width: 40%; " class="col_3"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139748691136928" scope="col"> </th><th align="left" valign="top" id="idm139748691136112" scope="col">OpenShift Container Platform 4.5 or earlier</th><th align="left" valign="top" id="idm139748691134992" scope="col">OpenShift Container Platform 4.6 or later</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139748691136928"> <p>
								Stable MTC version
							</p>
							 </td><td align="left" valign="top" headers="idm139748691136112"> <p>
								MTC 1.8.<span class="emphasis"><em>z</em></span>
							</p>
							 <p>
								Legacy 1.8 operator: Install manually with the <code class="literal">operator.yml</code> file.
							</p>
							 <div class="admonition important"><div class="admonition_header">Important</div><div><p>
									This cluster cannot be the control cluster.
								</p></div></div>
							 </td><td align="left" valign="top" headers="idm139748691134992"> <p>
								MTC 1.8.<span class="emphasis"><em>z</em></span>
							</p>
							 <p>
								Install with OLM, release channel <code class="literal">release-v1.7</code>
							</p>
							 </td></tr></tbody></table></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Edge cases exist in which network restrictions prevent modern clusters from connecting to other clusters involved in the migration. For example, when migrating from an OpenShift Container Platform 3.11 cluster on premises to a modern OpenShift Container Platform cluster in the cloud, where the modern cluster cannot connect to the OpenShift Container Platform 3.11 cluster.
				</p><p>
					With MTC 1.8, if one of the remote clusters is unable to communicate with the control cluster because of network restrictions, use the <code class="literal">crane tunnel-api</code> command.
				</p><p>
					With the stable MTC release, although you should always designate the most modern cluster as the control cluster, in this specific case it is possible to designate the legacy cluster as the control cluster and push workloads to the remote cluster.
				</p></div></div></section><section class="section" id="migration-installing-legacy-operator_installing-3-4"><div class="titlepage"><div><div><h2 class="title">6.2. Installing the legacy Migration Toolkit for Containers Operator on OpenShift Container Platform 3</h2></div></div></div><p>
				You can install the legacy Migration Toolkit for Containers Operator manually on OpenShift Container Platform 3.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You must be logged in as a user with <code class="literal">cluster-admin</code> privileges on all clusters.
					</li><li class="listitem">
						You must have access to <code class="literal">registry.redhat.io</code>.
					</li><li class="listitem">
						You must have <code class="literal">podman</code> installed.
					</li><li class="listitem">
						You must create an <a class="link" href="https://access.redhat.com/solutions/3772061">image stream secret</a> and copy it to each node in the cluster.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Log in to <code class="literal">registry.redhat.io</code> with your Red Hat Customer Portal credentials:
					</p><pre class="programlisting language-terminal">$ podman login registry.redhat.io</pre></li><li class="listitem"><p class="simpara">
						Download the <code class="literal">operator.yml</code> file by entering the following command:
					</p><pre class="programlisting language-terminal">$ podman cp $(podman create \
  registry.redhat.io/rhmtc/openshift-migration-legacy-rhel8-operator:v1.8):/operator.yml ./</pre></li><li class="listitem"><p class="simpara">
						Download the <code class="literal">controller.yml</code> file by entering the following command:
					</p><pre class="programlisting language-terminal">$ podman cp $(podman create \
  registry.redhat.io/rhmtc/openshift-migration-legacy-rhel8-operator:v1.8):/controller.yml ./</pre></li><li class="listitem">
						Log in to your OpenShift Container Platform source cluster.
					</li><li class="listitem"><p class="simpara">
						Verify that the cluster can authenticate with <code class="literal">registry.redhat.io</code>:
					</p><pre class="programlisting language-terminal">$ oc run test --image registry.redhat.io/ubi9 --command sleep infinity</pre></li><li class="listitem"><p class="simpara">
						Create the Migration Toolkit for Containers Operator object:
					</p><pre class="programlisting language-terminal">$ oc create -f operator.yml</pre><div class="formalpara"><p class="title"><strong>Example output</strong></p><p>
							
<pre class="programlisting language-terminal">namespace/openshift-migration created
rolebinding.rbac.authorization.k8s.io/system:deployers created
serviceaccount/migration-operator created
customresourcedefinition.apiextensions.k8s.io/migrationcontrollers.migration.openshift.io created
role.rbac.authorization.k8s.io/migration-operator created
rolebinding.rbac.authorization.k8s.io/migration-operator created
clusterrolebinding.rbac.authorization.k8s.io/migration-operator created
deployment.apps/migration-operator created
Error from server (AlreadyExists): error when creating "./operator.yml":
rolebindings.rbac.authorization.k8s.io "system:image-builders" already exists <span id="CO1-1"><!--Empty--></span><span class="callout">1</span>
Error from server (AlreadyExists): error when creating "./operator.yml":
rolebindings.rbac.authorization.k8s.io "system:image-pullers" already exists</pre>

						</p></div><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO1-1"><span class="callout">1</span></a> </dt><dd><div class="para">
								You can ignore <code class="literal">Error from server (AlreadyExists)</code> messages. They are caused by the Migration Toolkit for Containers Operator creating resources for earlier versions of OpenShift Container Platform 4 that are provided in later releases.
							</div></dd></dl></div></li><li class="listitem"><p class="simpara">
						Create the <code class="literal">MigrationController</code> object:
					</p><pre class="programlisting language-terminal">$ oc create -f controller.yml</pre></li><li class="listitem"><p class="simpara">
						Verify that the MTC pods are running:
					</p><pre class="programlisting language-terminal">$ oc get pods -n openshift-migration</pre></li></ol></div></section><section class="section" id="migration-installing-mtc-on-ocp-4_installing-3-4"><div class="titlepage"><div><div><h2 class="title">6.3. Installing the Migration Toolkit for Containers Operator on OpenShift Container Platform 4.13</h2></div></div></div><p>
				You install the Migration Toolkit for Containers Operator on OpenShift Container Platform 4.13 by using the Operator Lifecycle Manager.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You must be logged in as a user with <code class="literal">cluster-admin</code> privileges on all clusters.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						In the OpenShift Container Platform web console, click <span class="strong strong"><strong>Operators</strong></span> → <span class="strong strong"><strong>OperatorHub</strong></span>.
					</li><li class="listitem">
						Use the <span class="strong strong"><strong>Filter by keyword</strong></span> field to find the <span class="strong strong"><strong>Migration Toolkit for Containers Operator</strong></span>.
					</li><li class="listitem">
						Select the <span class="strong strong"><strong>Migration Toolkit for Containers Operator</strong></span> and click <span class="strong strong"><strong>Install</strong></span>.
					</li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Install</strong></span>.
					</p><p class="simpara">
						On the <span class="strong strong"><strong>Installed Operators</strong></span> page, the <span class="strong strong"><strong>Migration Toolkit for Containers Operator</strong></span> appears in the <span class="strong strong"><strong>openshift-migration</strong></span> project with the status <span class="strong strong"><strong>Succeeded</strong></span>.
					</p></li><li class="listitem">
						Click <span class="strong strong"><strong>Migration Toolkit for Containers Operator</strong></span>.
					</li><li class="listitem">
						Under <span class="strong strong"><strong>Provided APIs</strong></span>, locate the <span class="strong strong"><strong>Migration Controller</strong></span> tile, and click <span class="strong strong"><strong>Create Instance</strong></span>.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Create</strong></span>.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Workloads</strong></span> → <span class="strong strong"><strong>Pods</strong></span> to verify that the MTC pods are running.
					</li></ol></div></section><section class="section" id="migration-about-configuring-proxies_installing-3-4"><div class="titlepage"><div><div><h2 class="title">6.4. Proxy configuration</h2></div></div></div><p>
				For OpenShift Container Platform 4.1 and earlier versions, you must configure proxies in the <code class="literal">MigrationController</code> custom resource (CR) manifest after you install the Migration Toolkit for Containers Operator because these versions do not support a cluster-wide <code class="literal">proxy</code> object.
			</p><p>
				For OpenShift Container Platform 4.2 to 4.13, the Migration Toolkit for Containers (MTC) inherits the cluster-wide proxy settings. You can change the proxy parameters if you want to override the cluster-wide proxy settings.
			</p><section class="section" id="direct-volume-migration_installing-3-4"><div class="titlepage"><div><div><h3 class="title">6.4.1. Direct volume migration</h3></div></div></div><p>
					Direct Volume Migration (DVM) was introduced in MTC 1.4.2. DVM supports only one proxy. The source cluster cannot access the route of the target cluster if the target cluster is also behind a proxy.
				</p><p>
					If you want to perform a DVM from a source cluster behind a proxy, you must configure a TCP proxy that works at the transport layer and forwards the SSL connections transparently without decrypting and re-encrypting them with their own SSL certificates. A Stunnel proxy is an example of such a proxy.
				</p><section class="section" id="tcp-proxy-setup-for-dvm_installing-3-4"><div class="titlepage"><div><div><h4 class="title">6.4.1.1. TCP proxy setup for DVM</h4></div></div></div><p>
						You can set up a direct connection between the source and the target cluster through a TCP proxy and configure the <code class="literal">stunnel_tcp_proxy</code> variable in the <code class="literal">MigrationController</code> CR to use the proxy:
					</p><pre class="programlisting language-yaml">apiVersion: migration.openshift.io/v1alpha1
kind: MigrationController
metadata:
  name: migration-controller
  namespace: openshift-migration
spec:
  [...]
  stunnel_tcp_proxy: http://username:password@ip:port</pre><p>
						Direct volume migration (DVM) supports only basic authentication for the proxy. Moreover, DVM works only from behind proxies that can tunnel a TCP connection transparently. HTTP/HTTPS proxies in man-in-the-middle mode do not work. The existing cluster-wide proxies might not support this behavior. As a result, the proxy settings for DVM are intentionally kept different from the usual proxy configuration in MTC.
					</p></section><section class="section" id="why-tcp-proxy-instead-of-an-http-https-proxy_installing-3-4"><div class="titlepage"><div><div><h4 class="title">6.4.1.2. Why use a TCP proxy instead of an HTTP/HTTPS proxy?</h4></div></div></div><p>
						You can enable DVM by running Rsync between the source and the target cluster over an OpenShift route. Traffic is encrypted using Stunnel, a TCP proxy. The Stunnel running on the source cluster initiates a TLS connection with the target Stunnel and transfers data over an encrypted channel.
					</p><p>
						Cluster-wide HTTP/HTTPS proxies in OpenShift are usually configured in man-in-the-middle mode where they negotiate their own TLS session with the outside servers. However, this does not work with Stunnel. Stunnel requires that its TLS session be untouched by the proxy, essentially making the proxy a transparent tunnel which simply forwards the TCP connection as-is. Therefore, you must use a TCP proxy.
					</p></section><section class="section" id="dvm-known-issues_installing-3-4"><div class="titlepage"><div><div><h4 class="title">6.4.1.3. Known issue</h4></div></div></div><div class="formalpara"><p class="title"><strong>Migration fails with error <code class="literal">Upgrade request required</code></strong></p><p>
							The migration Controller uses the SPDY protocol to execute commands within remote pods. If the remote cluster is behind a proxy or a firewall that does not support the SPDY protocol, the migration controller fails to execute remote commands. The migration fails with the error message <code class="literal">Upgrade request required</code>. Workaround: Use a proxy that supports the SPDY protocol.
						</p></div><p>
						In addition to supporting the SPDY protocol, the proxy or firewall also must pass the <code class="literal">Upgrade</code> HTTP header to the API server. The client uses this header to open a websocket connection with the API server. If the <code class="literal">Upgrade</code> header is blocked by the proxy or firewall, the migration fails with the error message <code class="literal">Upgrade request required</code>. Workaround: Ensure that the proxy forwards the <code class="literal">Upgrade</code> header.
					</p></section></section><section class="section" id="tuning-network-policies-for-migrations_installing-3-4"><div class="titlepage"><div><div><h3 class="title">6.4.2. Tuning network policies for migrations</h3></div></div></div><p>
					OpenShift supports restricting traffic to or from pods using <span class="emphasis"><em>NetworkPolicy</em></span> or <span class="emphasis"><em>EgressFirewalls</em></span> based on the network plugin used by the cluster. If any of the source namespaces involved in a migration use such mechanisms to restrict network traffic to pods, the restrictions might inadvertently stop traffic to Rsync pods during migration.
				</p><p>
					Rsync pods running on both the source and the target clusters must connect to each other over an OpenShift Route. Existing <span class="emphasis"><em>NetworkPolicy</em></span> or <span class="emphasis"><em>EgressNetworkPolicy</em></span> objects can be configured to automatically exempt Rsync pods from these traffic restrictions.
				</p><section class="section" id="dvm-network-policy-configuration_installing-3-4"><div class="titlepage"><div><div><h4 class="title">6.4.2.1. NetworkPolicy configuration</h4></div></div></div><section class="section" id="egress-traffic-from-rsync-pods_installing-3-4"><div class="titlepage"><div><div><h5 class="title">6.4.2.1.1. Egress traffic from Rsync pods</h5></div></div></div><p>
							You can use the unique labels of Rsync pods to allow egress traffic to pass from them if the <code class="literal">NetworkPolicy</code> configuration in the source or destination namespaces blocks this type of traffic. The following policy allows <span class="strong strong"><strong>all</strong></span> egress traffic from Rsync pods in the namespace:
						</p><pre class="programlisting language-yaml">apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-all-egress-from-rsync-pods
spec:
  podSelector:
    matchLabels:
      owner: directvolumemigration
      app: directvolumemigration-rsync-transfer
  egress:
  - {}
  policyTypes:
  - Egress</pre></section><section class="section" id="ingress-traffic-to-rsync-pods_installing-3-4"><div class="titlepage"><div><div><h5 class="title">6.4.2.1.2. Ingress traffic to Rsync pods</h5></div></div></div><pre class="programlisting language-yaml">apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-all-egress-from-rsync-pods
spec:
  podSelector:
    matchLabels:
      owner: directvolumemigration
      app: directvolumemigration-rsync-transfer
  ingress:
  - {}
  policyTypes:
  - Ingress</pre></section></section><section class="section" id="egressnetworkpolicy-config_installing-3-4"><div class="titlepage"><div><div><h4 class="title">6.4.2.2. EgressNetworkPolicy configuration</h4></div></div></div><p>
						The <code class="literal">EgressNetworkPolicy</code> object or <span class="emphasis"><em>Egress Firewalls</em></span> are OpenShift constructs designed to block egress traffic leaving the cluster.
					</p><p>
						Unlike the <code class="literal">NetworkPolicy</code> object, the Egress Firewall works at a project level because it applies to all pods in the namespace. Therefore, the unique labels of Rsync pods do not exempt only Rsync pods from the restrictions. However, you can add the CIDR ranges of the source or target cluster to the <span class="emphasis"><em>Allow</em></span> rule of the policy so that a direct connection can be setup between two clusters.
					</p><p>
						Based on which cluster the Egress Firewall is present in, you can add the CIDR range of the other cluster to allow egress traffic between the two:
					</p><pre class="programlisting language-yaml">apiVersion: network.openshift.io/v1
kind: EgressNetworkPolicy
metadata:
  name: test-egress-policy
  namespace: &lt;namespace&gt;
spec:
  egress:
  - to:
      cidrSelector: &lt;cidr_of_source_or_target_cluster&gt;
    type: Deny</pre></section><section class="section" id="choosing-alternate-endpoints-for-data-transfer_installing-3-4"><div class="titlepage"><div><div><h4 class="title">6.4.2.3. Choosing alternate endpoints for data transfer</h4></div></div></div><p>
						By default, DVM uses an OpenShift Container Platform route as an endpoint to transfer PV data to destination clusters. You can choose another type of supported endpoint, if cluster topologies allow.
					</p><p>
						For each cluster, you can configure an endpoint by setting the <code class="literal">rsync_endpoint_type</code> variable on the appropriate <span class="strong strong"><strong>destination</strong></span> cluster in your <code class="literal">MigrationController</code> CR:
					</p><pre class="programlisting language-yaml">apiVersion: migration.openshift.io/v1alpha1
kind: MigrationController
metadata:
  name: migration-controller
  namespace: openshift-migration
spec:
  [...]
  rsync_endpoint_type: [NodePort|ClusterIP|Route]</pre></section><section class="section" id="configuring-supplemental-groups-for-rsync-pods_installing-3-4"><div class="titlepage"><div><div><h4 class="title">6.4.2.4. Configuring supplemental groups for Rsync pods</h4></div></div></div><p>
						When your PVCs use a shared storage, you can configure the access to that storage by adding supplemental groups to Rsync pod definitions in order for the pods to allow access:
					</p><div class="table" id="idm139748686020064"><p class="title"><strong>Table 6.2. Supplementary groups for Rsync pods</strong></p><div class="table-contents"><table class="gt-4-cols lt-7-rows"><colgroup><col style="width: 25%; " class="col_1"><!--Empty--></col><col style="width: 25%; " class="col_2"><!--Empty--></col><col style="width: 25%; " class="col_3"><!--Empty--></col><col style="width: 25%; " class="col_4"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139748687674384" scope="col">Variable</th><th align="left" valign="top" id="idm139748687673296" scope="col">Type</th><th align="left" valign="top" id="idm139748687672208" scope="col">Default</th><th align="left" valign="top" id="idm139748687671120" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139748687674384"> <p>
										<code class="literal">src_supplemental_groups</code>
									</p>
									 </td><td align="left" valign="top" headers="idm139748687673296"> <p>
										string
									</p>
									 </td><td align="left" valign="top" headers="idm139748687672208"> <p>
										Not set
									</p>
									 </td><td align="left" valign="top" headers="idm139748687671120"> <p>
										Comma-separated list of supplemental groups for source Rsync pods
									</p>
									 </td></tr><tr><td align="left" valign="top" headers="idm139748687674384"> <p>
										<code class="literal">target_supplemental_groups</code>
									</p>
									 </td><td align="left" valign="top" headers="idm139748687673296"> <p>
										string
									</p>
									 </td><td align="left" valign="top" headers="idm139748687672208"> <p>
										Not set
									</p>
									 </td><td align="left" valign="top" headers="idm139748687671120"> <p>
										Comma-separated list of supplemental groups for target Rsync pods
									</p>
									 </td></tr></tbody></table></div></div><div class="formalpara"><p class="title"><strong>Example usage</strong></p><p>
							The <code class="literal">MigrationController</code> CR can be updated to set values for these supplemental groups:
						</p></div><pre class="programlisting language-yaml">spec:
  src_supplemental_groups: "1000,2000"
  target_supplemental_groups: "2000,3000"</pre></section></section><section class="section" id="migration-configuring-proxies_installing-3-4"><div class="titlepage"><div><div><h3 class="title">6.4.3. Configuring proxies</h3></div></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							You must be logged in as a user with <code class="literal">cluster-admin</code> privileges on all clusters.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Get the <code class="literal">MigrationController</code> CR manifest:
						</p><pre class="programlisting language-terminal">$ oc get migrationcontroller &lt;migration_controller&gt; -n openshift-migration</pre></li><li class="listitem"><p class="simpara">
							Update the proxy parameters:
						</p><pre class="programlisting language-yaml">apiVersion: migration.openshift.io/v1alpha1
kind: MigrationController
metadata:
  name: &lt;migration_controller&gt;
  namespace: openshift-migration
...
spec:
  stunnel_tcp_proxy: http://&lt;username&gt;:&lt;password&gt;@&lt;ip&gt;:&lt;port&gt; <span id="CO2-1"><!--Empty--></span><span class="callout">1</span>
  noProxy: example.com <span id="CO2-2"><!--Empty--></span><span class="callout">2</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO2-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Stunnel proxy URL for direct volume migration.
								</div></dd><dt><a href="#CO2-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Comma-separated list of destination domain names, domains, IP addresses, or other network CIDRs to exclude proxying.
								</div></dd></dl></div><p class="simpara">
							Preface a domain with <code class="literal">.</code> to match subdomains only. For example, <code class="literal">.y.com</code> matches <code class="literal">x.y.com</code>, but not <code class="literal">y.com</code>. Use <code class="literal">*</code> to bypass proxy for all destinations. If you scale up workers that are not included in the network defined by the <code class="literal">networking.machineNetwork[].cidr</code> field from the installation configuration, you must add them to this list to prevent connection issues.
						</p><p class="simpara">
							This field is ignored if neither the <code class="literal">httpProxy</code> nor the <code class="literal">httpsProxy</code> field is set.
						</p></li><li class="listitem">
							Save the manifest as <code class="literal">migration-controller.yaml</code>.
						</li><li class="listitem"><p class="simpara">
							Apply the updated manifest:
						</p><pre class="programlisting language-terminal">$ oc replace -f migration-controller.yaml -n openshift-migration</pre></li></ol></div><p>
					For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/networking/#nw-proxy-configure-object_config-cluster-wide-proxy">Configuring the cluster-wide proxy</a>.
				</p></section></section><section class="section" id="configuring-replication-repository_installing-3-4"><div class="titlepage"><div><div><h2 class="title">6.5. Configuring a replication repository</h2></div></div></div><p>
				You must configure an object storage to use as a replication repository. The Migration Toolkit for Containers (MTC) copies data from the source cluster to the replication repository, and then from the replication repository to the target cluster.
			</p><p>
				MTC supports the <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-understanding-data-copy-methods_about-mtc-3-4">file system and snapshot data copy methods</a> for migrating data from the source cluster to the target cluster. You can select a method that is suited for your environment and is supported by your storage provider.
			</p><p>
				The following storage providers are supported:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-configuring-mcg_installing-3-4">Multicloud Object Gateway</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-configuring-aws-s3_installing-3-4">Amazon Web Services S3</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-configuring-gcp_installing-3-4">Google Cloud Platform</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-configuring-azure_installing-3-4">Microsoft Azure Blob</a>
					</li><li class="listitem">
						Generic S3 object storage, for example, Minio or Ceph S3
					</li></ul></div><section class="section" id="replication-repository-prerequisites_installing-3-4"><div class="titlepage"><div><div><h3 class="title">6.5.1. Prerequisites</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							All clusters must have uninterrupted network access to the replication repository.
						</li><li class="listitem">
							If you use a proxy server with an internally hosted replication repository, you must ensure that the proxy allows access to the replication repository.
						</li></ul></div></section><section class="section" id="migration-configuring-mcg_installing-3-4"><div class="titlepage"><div><div><h3 class="title">6.5.2. Retrieving Multicloud Object Gateway credentials</h3></div></div></div><p>
					You must retrieve the Multicloud Object Gateway (MCG) credentials and S3 endpoint in order to configure MCG as a replication repository for the Migration Toolkit for Containers (MTC). You must retrieve the Multicloud Object Gateway (MCG) credentials in order to create a <code class="literal">Secret</code> custom resource (CR) for the OpenShift API for Data Protection (OADP).
				</p><p>
					MCG is a component of OpenShift Data Foundation.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							You must deploy OpenShift Data Foundation by using the appropriate <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_openshift_data_foundation/4.9">OpenShift Data Foundation deployment guide</a>.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Obtain the S3 endpoint, <code class="literal">AWS_ACCESS_KEY_ID</code>, and <code class="literal">AWS_SECRET_ACCESS_KEY</code> by running the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_openshift_data_foundation/4.9/html/managing_hybrid_and_multicloud_resources/accessing-the-multicloud-object-gateway-with-your-applications_rhodf#accessing-the-Multicloud-object-gateway-from-the-terminal_rhodf"><code class="literal">describe</code> command</a> on the <code class="literal">NooBaa</code> custom resource.
						</p><p class="simpara">
							You use these credentials to add MCG as a replication repository.
						</p></li></ol></div></section><section class="section" id="migration-configuring-aws-s3_installing-3-4"><div class="titlepage"><div><div><h3 class="title">6.5.3. Configuring Amazon Web Services</h3></div></div></div><p>
					You configure Amazon Web Services (AWS) S3 object storage as a replication repository for the Migration Toolkit for Containers (MTC).
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							You must have the <a class="link" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-welcome.html">AWS CLI</a> installed.
						</li><li class="listitem">
							The AWS S3 storage bucket must be accessible to the source and target clusters.
						</li><li class="listitem"><p class="simpara">
							If you are using the snapshot copy method:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									You must have access to EC2 Elastic Block Storage (EBS).
								</li><li class="listitem">
									The source and target clusters must be in the same region.
								</li><li class="listitem">
									The source and target clusters must have the same storage class.
								</li><li class="listitem">
									The storage class must be compatible with snapshots.
								</li></ul></div></li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Set the <code class="literal">BUCKET</code> variable:
						</p><pre class="programlisting language-terminal">$ BUCKET=&lt;your_bucket&gt;</pre></li><li class="listitem"><p class="simpara">
							Set the <code class="literal">REGION</code> variable:
						</p><pre class="programlisting language-terminal">$ REGION=&lt;your_region&gt;</pre></li><li class="listitem"><p class="simpara">
							Create an AWS S3 bucket:
						</p><pre class="programlisting language-terminal">$ aws s3api create-bucket \
    --bucket $BUCKET \
    --region $REGION \
    --create-bucket-configuration LocationConstraint=$REGION <span id="CO3-1"><!--Empty--></span><span class="callout">1</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO3-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									<code class="literal">us-east-1</code> does not support a <code class="literal">LocationConstraint</code>. If your region is <code class="literal">us-east-1</code>, omit <code class="literal">--create-bucket-configuration LocationConstraint=$REGION</code>.
								</div></dd></dl></div></li><li class="listitem"><p class="simpara">
							Create an IAM user:
						</p><pre class="programlisting language-terminal">$ aws iam create-user --user-name velero <span id="CO4-1"><!--Empty--></span><span class="callout">1</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO4-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									If you want to use Velero to back up multiple clusters with multiple S3 buckets, create a unique user name for each cluster.
								</div></dd></dl></div></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">velero-policy.json</code> file:
						</p><pre class="programlisting language-terminal">$ cat &gt; velero-policy.json &lt;&lt;EOF
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "ec2:DescribeVolumes",
                "ec2:DescribeSnapshots",
                "ec2:CreateTags",
                "ec2:CreateVolume",
                "ec2:CreateSnapshot",
                "ec2:DeleteSnapshot"
            ],
            "Resource": "*"
        },
        {
            "Effect": "Allow",
            "Action": [
                "s3:GetObject",
                "s3:DeleteObject",
                "s3:PutObject",
                "s3:AbortMultipartUpload",
                "s3:ListMultipartUploadParts"
            ],
            "Resource": [
                "arn:aws:s3:::${BUCKET}/*"
            ]
        },
        {
            "Effect": "Allow",
            "Action": [
                "s3:ListBucket",
                "s3:GetBucketLocation",
                "s3:ListBucketMultipartUploads"
            ],
            "Resource": [
                "arn:aws:s3:::${BUCKET}"
            ]
        }
    ]
}
EOF</pre></li><li class="listitem"><p class="simpara">
							Attach the policies to give the <code class="literal">velero</code> user the minimum necessary permissions:
						</p><pre class="programlisting language-terminal">$ aws iam put-user-policy \
  --user-name velero \
  --policy-name velero \
  --policy-document file://velero-policy.json</pre></li><li class="listitem"><p class="simpara">
							Create an access key for the <code class="literal">velero</code> user:
						</p><pre class="programlisting language-terminal">$ aws iam create-access-key --user-name velero</pre><div class="formalpara"><p class="title"><strong>Example output</strong></p><p>
								
<pre class="programlisting language-terminal">{
  "AccessKey": {
        "UserName": "velero",
        "Status": "Active",
        "CreateDate": "2017-07-31T22:24:41.576Z",
        "SecretAccessKey": &lt;AWS_SECRET_ACCESS_KEY&gt;,
        "AccessKeyId": &lt;AWS_ACCESS_KEY_ID&gt;
  }
}</pre>

							</p></div><p class="simpara">
							Record the <code class="literal">AWS_SECRET_ACCESS_KEY</code> and the <code class="literal">AWS_ACCESS_KEY_ID</code>. You use the credentials to add AWS as a replication repository.
						</p></li></ol></div></section><section class="section" id="migration-configuring-gcp_installing-3-4"><div class="titlepage"><div><div><h3 class="title">6.5.4. Configuring Google Cloud Platform</h3></div></div></div><p>
					You configure a Google Cloud Platform (GCP) storage bucket as a replication repository for the Migration Toolkit for Containers (MTC).
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							You must have the <code class="literal">gcloud</code> and <code class="literal">gsutil</code> CLI tools installed. See the <a class="link" href="https://cloud.google.com/sdk/docs/">Google cloud documentation</a> for details.
						</li><li class="listitem">
							The GCP storage bucket must be accessible to the source and target clusters.
						</li><li class="listitem"><p class="simpara">
							If you are using the snapshot copy method:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									The source and target clusters must be in the same region.
								</li><li class="listitem">
									The source and target clusters must have the same storage class.
								</li><li class="listitem">
									The storage class must be compatible with snapshots.
								</li></ul></div></li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Log in to GCP:
						</p><pre class="programlisting language-terminal">$ gcloud auth login</pre></li><li class="listitem"><p class="simpara">
							Set the <code class="literal">BUCKET</code> variable:
						</p><pre class="programlisting language-terminal">$ BUCKET=&lt;bucket&gt; <span id="CO5-1"><!--Empty--></span><span class="callout">1</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO5-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specify your bucket name.
								</div></dd></dl></div></li><li class="listitem"><p class="simpara">
							Create the storage bucket:
						</p><pre class="programlisting language-terminal">$ gsutil mb gs://$BUCKET/</pre></li><li class="listitem"><p class="simpara">
							Set the <code class="literal">PROJECT_ID</code> variable to your active project:
						</p><pre class="programlisting language-terminal">$ PROJECT_ID=$(gcloud config get-value project)</pre></li><li class="listitem"><p class="simpara">
							Create a service account:
						</p><pre class="programlisting language-terminal">$ gcloud iam service-accounts create velero \
    --display-name "Velero service account"</pre></li><li class="listitem"><p class="simpara">
							List your service accounts:
						</p><pre class="programlisting language-terminal">$ gcloud iam service-accounts list</pre></li><li class="listitem"><p class="simpara">
							Set the <code class="literal">SERVICE_ACCOUNT_EMAIL</code> variable to match its <code class="literal">email</code> value:
						</p><pre class="programlisting language-terminal">$ SERVICE_ACCOUNT_EMAIL=$(gcloud iam service-accounts list \
    --filter="displayName:Velero service account" \
    --format 'value(email)')</pre></li><li class="listitem"><p class="simpara">
							Attach the policies to give the <code class="literal">velero</code> user the minimum necessary permissions:
						</p><pre class="programlisting language-terminal">$ ROLE_PERMISSIONS=(
    compute.disks.get
    compute.disks.create
    compute.disks.createSnapshot
    compute.snapshots.get
    compute.snapshots.create
    compute.snapshots.useReadOnly
    compute.snapshots.delete
    compute.zones.get
    storage.objects.create
    storage.objects.delete
    storage.objects.get
    storage.objects.list
    iam.serviceAccounts.signBlob
)</pre></li><li class="listitem"><p class="simpara">
							Create the <code class="literal">velero.server</code> custom role:
						</p><pre class="programlisting language-terminal">$ gcloud iam roles create velero.server \
    --project $PROJECT_ID \
    --title "Velero Server" \
    --permissions "$(IFS=","; echo "${ROLE_PERMISSIONS[*]}")"</pre></li><li class="listitem"><p class="simpara">
							Add IAM policy binding to the project:
						</p><pre class="programlisting language-terminal">$ gcloud projects add-iam-policy-binding $PROJECT_ID \
    --member serviceAccount:$SERVICE_ACCOUNT_EMAIL \
    --role projects/$PROJECT_ID/roles/velero.server</pre></li><li class="listitem"><p class="simpara">
							Update the IAM service account:
						</p><pre class="programlisting language-terminal">$ gsutil iam ch serviceAccount:$SERVICE_ACCOUNT_EMAIL:objectAdmin gs://${BUCKET}</pre></li><li class="listitem"><p class="simpara">
							Save the IAM service account keys to the <code class="literal">credentials-velero</code> file in the current directory:
						</p><pre class="programlisting language-terminal">$ gcloud iam service-accounts keys create credentials-velero \
    --iam-account $SERVICE_ACCOUNT_EMAIL</pre><p class="simpara">
							You use the <code class="literal">credentials-velero</code> file to add GCP as a replication repository.
						</p></li></ol></div></section><section class="section" id="migration-configuring-azure_installing-3-4"><div class="titlepage"><div><div><h3 class="title">6.5.5. Configuring Microsoft Azure</h3></div></div></div><p>
					You configure a Microsoft Azure Blob storage container as a replication repository for the Migration Toolkit for Containers (MTC).
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							You must have the <a class="link" href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli">Azure CLI</a> installed.
						</li><li class="listitem">
							The Azure Blob storage container must be accessible to the source and target clusters.
						</li><li class="listitem"><p class="simpara">
							If you are using the snapshot copy method:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									The source and target clusters must be in the same region.
								</li><li class="listitem">
									The source and target clusters must have the same storage class.
								</li><li class="listitem">
									The storage class must be compatible with snapshots.
								</li></ul></div></li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Log in to Azure:
						</p><pre class="programlisting language-terminal">$ az login</pre></li><li class="listitem"><p class="simpara">
							Set the <code class="literal">AZURE_RESOURCE_GROUP</code> variable:
						</p><pre class="programlisting language-terminal">$ AZURE_RESOURCE_GROUP=Velero_Backups</pre></li><li class="listitem"><p class="simpara">
							Create an Azure resource group:
						</p><pre class="programlisting language-terminal">$ az group create -n $AZURE_RESOURCE_GROUP --location CentralUS <span id="CO6-1"><!--Empty--></span><span class="callout">1</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO6-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specify your location.
								</div></dd></dl></div></li><li class="listitem"><p class="simpara">
							Set the <code class="literal">AZURE_STORAGE_ACCOUNT_ID</code> variable:
						</p><pre class="programlisting language-terminal">$ AZURE_STORAGE_ACCOUNT_ID="velero$(uuidgen | cut -d '-' -f5 | tr '[A-Z]' '[a-z]')"</pre></li><li class="listitem"><p class="simpara">
							Create an Azure storage account:
						</p><pre class="programlisting language-terminal">$ az storage account create \
    --name $AZURE_STORAGE_ACCOUNT_ID \
    --resource-group $AZURE_RESOURCE_GROUP \
    --sku Standard_GRS \
    --encryption-services blob \
    --https-only true \
    --kind BlobStorage \
    --access-tier Hot</pre></li><li class="listitem"><p class="simpara">
							Set the <code class="literal">BLOB_CONTAINER</code> variable:
						</p><pre class="programlisting language-terminal">$ BLOB_CONTAINER=velero</pre></li><li class="listitem"><p class="simpara">
							Create an Azure Blob storage container:
						</p><pre class="programlisting language-terminal">$ az storage container create \
  -n $BLOB_CONTAINER \
  --public-access off \
  --account-name $AZURE_STORAGE_ACCOUNT_ID</pre></li><li class="listitem"><p class="simpara">
							Create a service principal and credentials for <code class="literal">velero</code>:
						</p><pre class="programlisting language-terminal">$ AZURE_SUBSCRIPTION_ID=`az account list --query '[?isDefault].id' -o tsv` \
  AZURE_TENANT_ID=`az account list --query '[?isDefault].tenantId' -o tsv` \
  AZURE_CLIENT_SECRET=`az ad sp create-for-rbac --name "velero" \
  --role "Contributor" --query 'password' -o tsv` \
  AZURE_CLIENT_ID=`az ad sp list --display-name "velero" \
  --query '[0].appId' -o tsv`</pre></li><li class="listitem"><p class="simpara">
							Save the service principal credentials in the <code class="literal">credentials-velero</code> file:
						</p><pre class="programlisting language-terminal">$ cat &lt;&lt; EOF &gt; ./credentials-velero
AZURE_SUBSCRIPTION_ID=${AZURE_SUBSCRIPTION_ID}
AZURE_TENANT_ID=${AZURE_TENANT_ID}
AZURE_CLIENT_ID=${AZURE_CLIENT_ID}
AZURE_CLIENT_SECRET=${AZURE_CLIENT_SECRET}
AZURE_RESOURCE_GROUP=${AZURE_RESOURCE_GROUP}
AZURE_CLOUD_NAME=AzurePublicCloud
EOF</pre><p class="simpara">
							You use the <code class="literal">credentials-velero</code> file to add Azure as a replication repository.
						</p></li></ol></div></section><section class="section _additional-resources" id="installing-3-4_configuring-replication-repository-additional-resources"><div class="titlepage"><div><div><h3 class="title">6.5.6. Additional resources</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-mtc-workflow_about-mtc-3-4">MTC workflow</a>
						</li><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-understanding-data-copy-methods_about-mtc-3-4">About data copy methods</a>
						</li><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-adding-replication-repository-to-cam_migrating-applications-3-4">Adding a replication repository to the MTC web console</a>
						</li></ul></div></section></section><section class="section" id="migration-uninstalling-mtc-clean-up_installing-3-4"><div class="titlepage"><div><div><h2 class="title">6.6. Uninstalling MTC and deleting resources</h2></div></div></div><p>
				You can uninstall the Migration Toolkit for Containers (MTC) and delete its resources to clean up the cluster.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Deleting the <code class="literal">velero</code> CRDs removes Velero from the cluster.
				</p></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You must be logged in as a user with <code class="literal">cluster-admin</code> privileges.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Delete the <code class="literal">MigrationController</code> custom resource (CR) on all clusters:
					</p><pre class="programlisting language-terminal">$ oc delete migrationcontroller &lt;migration_controller&gt;</pre></li><li class="listitem">
						Uninstall the Migration Toolkit for Containers Operator on OpenShift Container Platform 4 by using the Operator Lifecycle Manager.
					</li><li class="listitem"><p class="simpara">
						Delete cluster-scoped resources on all clusters by running the following commands:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								<code class="literal">migration</code> custom resource definitions (CRDs):
							</p><pre class="programlisting language-terminal">$ oc delete $(oc get crds -o name | grep 'migration.openshift.io')</pre></li><li class="listitem"><p class="simpara">
								<code class="literal">velero</code> CRDs:
							</p><pre class="programlisting language-terminal">$ oc delete $(oc get crds -o name | grep 'velero')</pre></li><li class="listitem"><p class="simpara">
								<code class="literal">migration</code> cluster roles:
							</p><pre class="programlisting language-terminal">$ oc delete $(oc get clusterroles -o name | grep 'migration.openshift.io')</pre></li><li class="listitem"><p class="simpara">
								<code class="literal">migration-operator</code> cluster role:
							</p><pre class="programlisting language-terminal">$ oc delete clusterrole migration-operator</pre></li><li class="listitem"><p class="simpara">
								<code class="literal">velero</code> cluster roles:
							</p><pre class="programlisting language-terminal">$ oc delete $(oc get clusterroles -o name | grep 'velero')</pre></li><li class="listitem"><p class="simpara">
								<code class="literal">migration</code> cluster role bindings:
							</p><pre class="programlisting language-terminal">$ oc delete $(oc get clusterrolebindings -o name | grep 'migration.openshift.io')</pre></li><li class="listitem"><p class="simpara">
								<code class="literal">migration-operator</code> cluster role bindings:
							</p><pre class="programlisting language-terminal">$ oc delete clusterrolebindings migration-operator</pre></li><li class="listitem"><p class="simpara">
								<code class="literal">velero</code> cluster role bindings:
							</p><pre class="programlisting language-terminal">$ oc delete $(oc get clusterrolebindings -o name | grep 'velero')</pre></li></ul></div></li></ol></div></section></section><section class="chapter" id="installing-restricted-3-4"><div class="titlepage"><div><div><h1 class="title">Chapter 7. Installing the Migration Toolkit for Containers in a restricted network environment</h1></div></div></div><p>
			You can install the Migration Toolkit for Containers (MTC) on OpenShift Container Platform 3 and 4 in a restricted network environment by performing the following procedures:
		</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
					Create a <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/operators/#olm-mirror-catalog_olm-restricted-networks">mirrored Operator catalog</a>.
				</p><p class="simpara">
					This process creates a <code class="literal">mapping.txt</code> file, which contains the mapping between the <code class="literal">registry.redhat.io</code> image and your mirror registry image. The <code class="literal">mapping.txt</code> file is required for installing the Operator on the source cluster.
				</p></li><li class="listitem"><p class="simpara">
					Install the Migration Toolkit for Containers Operator on the OpenShift Container Platform 4.13 target cluster by using Operator Lifecycle Manager.
				</p><p class="simpara">
					By default, the MTC web console and the <code class="literal">Migration Controller</code> pod run on the target cluster. You can configure the <code class="literal">Migration Controller</code> custom resource manifest to run the MTC web console and the <code class="literal">Migration Controller</code> pod on a <a class="link" href="https://access.redhat.com/articles/5064151">source cluster or on a remote cluster</a>.
				</p></li><li class="listitem">
					Install the <span class="emphasis"><em>legacy</em></span> Migration Toolkit for Containers Operator on the OpenShift Container Platform 3 source cluster from the command line interface.
				</li><li class="listitem">
					Configure object storage to use as a replication repository.
				</li></ol></div><p>
			To uninstall MTC, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-uninstalling-mtc-clean-up_installing-restricted-3-4">Uninstalling MTC and deleting resources</a>.
		</p><section class="section" id="migration-compatibility-guidelines_installing-restricted-3-4"><div class="titlepage"><div><div><h2 class="title">7.1. Compatibility guidelines</h2></div></div></div><p>
				You must install the Migration Toolkit for Containers (MTC) Operator that is compatible with your OpenShift Container Platform version.
			</p><div class="variablelist"><p class="title"><strong>Definitions</strong></p><dl class="variablelist"><dt><span class="term">legacy platform</span></dt><dd>
							OpenShift Container Platform 4.5 and earlier.
						</dd><dt><span class="term">modern platform</span></dt><dd>
							OpenShift Container Platform 4.6 and later.
						</dd><dt><span class="term">legacy operator</span></dt><dd>
							The MTC Operator designed for legacy platforms.
						</dd><dt><span class="term">modern operator</span></dt><dd>
							The MTC Operator designed for modern platforms.
						</dd><dt><span class="term">control cluster</span></dt><dd>
							The cluster that runs the MTC controller and GUI.
						</dd><dt><span class="term">remote cluster</span></dt><dd>
							A source or destination cluster for a migration that runs Velero. The Control Cluster communicates with Remote clusters via the Velero API to drive migrations.
						</dd></dl></div><div class="table" id="idm139748686805152"><p class="title"><strong>Table 7.1. MTC compatibility: Migrating from a legacy platform</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 20%; " class="col_1"><!--Empty--></col><col style="width: 40%; " class="col_2"><!--Empty--></col><col style="width: 40%; " class="col_3"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139748686414640" scope="col"> </th><th align="left" valign="top" id="idm139748686413712" scope="col">OpenShift Container Platform 4.5 or earlier</th><th align="left" valign="top" id="idm139748686412592" scope="col">OpenShift Container Platform 4.6 or later</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139748686414640"> <p>
								Stable MTC version
							</p>
							 </td><td align="left" valign="top" headers="idm139748686413712"> <p>
								MTC 1.8.<span class="emphasis"><em>z</em></span>
							</p>
							 <p>
								Legacy 1.8 operator: Install manually with the <code class="literal">operator.yml</code> file.
							</p>
							 <div class="admonition important"><div class="admonition_header">Important</div><div><p>
									This cluster cannot be the control cluster.
								</p></div></div>
							 </td><td align="left" valign="top" headers="idm139748686412592"> <p>
								MTC 1.8.<span class="emphasis"><em>z</em></span>
							</p>
							 <p>
								Install with OLM, release channel <code class="literal">release-v1.7</code>
							</p>
							 </td></tr></tbody></table></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Edge cases exist in which network restrictions prevent modern clusters from connecting to other clusters involved in the migration. For example, when migrating from an OpenShift Container Platform 3.11 cluster on premises to a modern OpenShift Container Platform cluster in the cloud, where the modern cluster cannot connect to the OpenShift Container Platform 3.11 cluster.
				</p><p>
					With MTC 1.8, if one of the remote clusters is unable to communicate with the control cluster because of network restrictions, use the <code class="literal">crane tunnel-api</code> command.
				</p><p>
					With the stable MTC release, although you should always designate the most modern cluster as the control cluster, in this specific case it is possible to designate the legacy cluster as the control cluster and push workloads to the remote cluster.
				</p></div></div></section><section class="section" id="migration-installing-mtc-on-ocp-4_installing-restricted-3-4"><div class="titlepage"><div><div><h2 class="title">7.2. Installing the Migration Toolkit for Containers Operator on OpenShift Container Platform 4.13</h2></div></div></div><p>
				You install the Migration Toolkit for Containers Operator on OpenShift Container Platform 4.13 by using the Operator Lifecycle Manager.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You must be logged in as a user with <code class="literal">cluster-admin</code> privileges on all clusters.
					</li><li class="listitem">
						You must create an Operator catalog from a mirror image in a local registry.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						In the OpenShift Container Platform web console, click <span class="strong strong"><strong>Operators</strong></span> → <span class="strong strong"><strong>OperatorHub</strong></span>.
					</li><li class="listitem">
						Use the <span class="strong strong"><strong>Filter by keyword</strong></span> field to find the <span class="strong strong"><strong>Migration Toolkit for Containers Operator</strong></span>.
					</li><li class="listitem">
						Select the <span class="strong strong"><strong>Migration Toolkit for Containers Operator</strong></span> and click <span class="strong strong"><strong>Install</strong></span>.
					</li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Install</strong></span>.
					</p><p class="simpara">
						On the <span class="strong strong"><strong>Installed Operators</strong></span> page, the <span class="strong strong"><strong>Migration Toolkit for Containers Operator</strong></span> appears in the <span class="strong strong"><strong>openshift-migration</strong></span> project with the status <span class="strong strong"><strong>Succeeded</strong></span>.
					</p></li><li class="listitem">
						Click <span class="strong strong"><strong>Migration Toolkit for Containers Operator</strong></span>.
					</li><li class="listitem">
						Under <span class="strong strong"><strong>Provided APIs</strong></span>, locate the <span class="strong strong"><strong>Migration Controller</strong></span> tile, and click <span class="strong strong"><strong>Create Instance</strong></span>.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Create</strong></span>.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Workloads</strong></span> → <span class="strong strong"><strong>Pods</strong></span> to verify that the MTC pods are running.
					</li></ol></div></section><section class="section" id="migration-installing-legacy-operator_installing-restricted-3-4"><div class="titlepage"><div><div><h2 class="title">7.3. Installing the legacy Migration Toolkit for Containers Operator on OpenShift Container Platform 3</h2></div></div></div><p>
				You can install the legacy Migration Toolkit for Containers Operator manually on OpenShift Container Platform 3.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You must be logged in as a user with <code class="literal">cluster-admin</code> privileges on all clusters.
					</li><li class="listitem">
						You must have access to <code class="literal">registry.redhat.io</code>.
					</li><li class="listitem">
						You must have <code class="literal">podman</code> installed.
					</li><li class="listitem">
						You must create an <a class="link" href="https://access.redhat.com/solutions/3772061">image stream secret</a> and copy it to each node in the cluster.
					</li><li class="listitem">
						You must have a Linux workstation with network access in order to download files from <code class="literal">registry.redhat.io</code>.
					</li><li class="listitem">
						You must create a mirror image of the Operator catalog.
					</li><li class="listitem">
						You must install the Migration Toolkit for Containers Operator from the mirrored Operator catalog on OpenShift Container Platform 4.13.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Log in to <code class="literal">registry.redhat.io</code> with your Red Hat Customer Portal credentials:
					</p><pre class="programlisting language-terminal">$ podman login registry.redhat.io</pre></li><li class="listitem"><p class="simpara">
						Download the <code class="literal">operator.yml</code> file by entering the following command:
					</p><pre class="programlisting language-terminal">$ podman cp $(podman create \
  registry.redhat.io/rhmtc/openshift-migration-legacy-rhel8-operator:v1.8):/operator.yml ./</pre></li><li class="listitem"><p class="simpara">
						Download the <code class="literal">controller.yml</code> file by entering the following command:
					</p><pre class="programlisting language-terminal">$ podman cp $(podman create \
  registry.redhat.io/rhmtc/openshift-migration-legacy-rhel8-operator:v1.8):/controller.yml ./</pre></li><li class="listitem"><p class="simpara">
						Obtain the Operator image mapping by running the following command:
					</p><pre class="programlisting language-terminal">$ grep openshift-migration-legacy-rhel8-operator ./mapping.txt | grep rhmtc</pre><p class="simpara">
						The <code class="literal">mapping.txt</code> file was created when you mirrored the Operator catalog. The output shows the mapping between the <code class="literal">registry.redhat.io</code> image and your mirror registry image.
					</p><div class="formalpara"><p class="title"><strong>Example output</strong></p><p>
							
<pre class="programlisting language-terminal">registry.redhat.io/rhmtc/openshift-migration-legacy-rhel8-operator@sha256:468a6126f73b1ee12085ca53a312d1f96ef5a2ca03442bcb63724af5e2614e8a=&lt;registry.apps.example.com&gt;/rhmtc/openshift-migration-legacy-rhel8-operator</pre>

						</p></div></li><li class="listitem"><p class="simpara">
						Update the <code class="literal">image</code> values for the <code class="literal">ansible</code> and <code class="literal">operator</code> containers and the <code class="literal">REGISTRY</code> value in the <code class="literal">operator.yml</code> file:
					</p><pre class="programlisting language-yaml">containers:
  - name: ansible
    image: &lt;registry.apps.example.com&gt;/rhmtc/openshift-migration-legacy-rhel8-operator@sha256:&lt;468a6126f73b1ee12085ca53a312d1f96ef5a2ca03442bcb63724af5e2614e8a&gt; <span id="CO7-1"><!--Empty--></span><span class="callout">1</span>
...
  - name: operator
    image: &lt;registry.apps.example.com&gt;/rhmtc/openshift-migration-legacy-rhel8-operator@sha256:&lt;468a6126f73b1ee12085ca53a312d1f96ef5a2ca03442bcb63724af5e2614e8a&gt; <span id="CO7-2"><!--Empty--></span><span class="callout">2</span>
...
    env:
    - name: REGISTRY
      value: &lt;registry.apps.example.com&gt; <span id="CO7-3"><!--Empty--></span><span class="callout">3</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO7-1"><span class="callout">1</span></a> <a href="#CO7-2"><span class="callout">2</span></a> </dt><dd><div class="para">
								Specify your mirror registry and the <code class="literal">sha256</code> value of the Operator image.
							</div></dd><dt><a href="#CO7-3"><span class="callout">3</span></a> </dt><dd><div class="para">
								Specify your mirror registry.
							</div></dd></dl></div></li><li class="listitem">
						Log in to your OpenShift Container Platform source cluster.
					</li><li class="listitem"><p class="simpara">
						Create the Migration Toolkit for Containers Operator object:
					</p><pre class="programlisting language-terminal">$ oc create -f operator.yml</pre><div class="formalpara"><p class="title"><strong>Example output</strong></p><p>
							
<pre class="programlisting language-terminal">namespace/openshift-migration created
rolebinding.rbac.authorization.k8s.io/system:deployers created
serviceaccount/migration-operator created
customresourcedefinition.apiextensions.k8s.io/migrationcontrollers.migration.openshift.io created
role.rbac.authorization.k8s.io/migration-operator created
rolebinding.rbac.authorization.k8s.io/migration-operator created
clusterrolebinding.rbac.authorization.k8s.io/migration-operator created
deployment.apps/migration-operator created
Error from server (AlreadyExists): error when creating "./operator.yml":
rolebindings.rbac.authorization.k8s.io "system:image-builders" already exists <span id="CO8-1"><!--Empty--></span><span class="callout">1</span>
Error from server (AlreadyExists): error when creating "./operator.yml":
rolebindings.rbac.authorization.k8s.io "system:image-pullers" already exists</pre>

						</p></div><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO8-1"><span class="callout">1</span></a> </dt><dd><div class="para">
								You can ignore <code class="literal">Error from server (AlreadyExists)</code> messages. They are caused by the Migration Toolkit for Containers Operator creating resources for earlier versions of OpenShift Container Platform 4 that are provided in later releases.
							</div></dd></dl></div></li><li class="listitem"><p class="simpara">
						Create the <code class="literal">MigrationController</code> object:
					</p><pre class="programlisting language-terminal">$ oc create -f controller.yml</pre></li><li class="listitem"><p class="simpara">
						Verify that the MTC pods are running:
					</p><pre class="programlisting language-terminal">$ oc get pods -n openshift-migration</pre></li></ol></div></section><section class="section" id="migration-about-configuring-proxies_installing-restricted-3-4"><div class="titlepage"><div><div><h2 class="title">7.4. Proxy configuration</h2></div></div></div><p>
				For OpenShift Container Platform 4.1 and earlier versions, you must configure proxies in the <code class="literal">MigrationController</code> custom resource (CR) manifest after you install the Migration Toolkit for Containers Operator because these versions do not support a cluster-wide <code class="literal">proxy</code> object.
			</p><p>
				For OpenShift Container Platform 4.2 to 4.13, the Migration Toolkit for Containers (MTC) inherits the cluster-wide proxy settings. You can change the proxy parameters if you want to override the cluster-wide proxy settings.
			</p><section class="section" id="direct-volume-migration_installing-restricted-3-4"><div class="titlepage"><div><div><h3 class="title">7.4.1. Direct volume migration</h3></div></div></div><p>
					Direct Volume Migration (DVM) was introduced in MTC 1.4.2. DVM supports only one proxy. The source cluster cannot access the route of the target cluster if the target cluster is also behind a proxy.
				</p><p>
					If you want to perform a DVM from a source cluster behind a proxy, you must configure a TCP proxy that works at the transport layer and forwards the SSL connections transparently without decrypting and re-encrypting them with their own SSL certificates. A Stunnel proxy is an example of such a proxy.
				</p><section class="section" id="tcp-proxy-setup-for-dvm_installing-restricted-3-4"><div class="titlepage"><div><div><h4 class="title">7.4.1.1. TCP proxy setup for DVM</h4></div></div></div><p>
						You can set up a direct connection between the source and the target cluster through a TCP proxy and configure the <code class="literal">stunnel_tcp_proxy</code> variable in the <code class="literal">MigrationController</code> CR to use the proxy:
					</p><pre class="programlisting language-yaml">apiVersion: migration.openshift.io/v1alpha1
kind: MigrationController
metadata:
  name: migration-controller
  namespace: openshift-migration
spec:
  [...]
  stunnel_tcp_proxy: http://username:password@ip:port</pre><p>
						Direct volume migration (DVM) supports only basic authentication for the proxy. Moreover, DVM works only from behind proxies that can tunnel a TCP connection transparently. HTTP/HTTPS proxies in man-in-the-middle mode do not work. The existing cluster-wide proxies might not support this behavior. As a result, the proxy settings for DVM are intentionally kept different from the usual proxy configuration in MTC.
					</p></section><section class="section" id="why-tcp-proxy-instead-of-an-http-https-proxy_installing-restricted-3-4"><div class="titlepage"><div><div><h4 class="title">7.4.1.2. Why use a TCP proxy instead of an HTTP/HTTPS proxy?</h4></div></div></div><p>
						You can enable DVM by running Rsync between the source and the target cluster over an OpenShift route. Traffic is encrypted using Stunnel, a TCP proxy. The Stunnel running on the source cluster initiates a TLS connection with the target Stunnel and transfers data over an encrypted channel.
					</p><p>
						Cluster-wide HTTP/HTTPS proxies in OpenShift are usually configured in man-in-the-middle mode where they negotiate their own TLS session with the outside servers. However, this does not work with Stunnel. Stunnel requires that its TLS session be untouched by the proxy, essentially making the proxy a transparent tunnel which simply forwards the TCP connection as-is. Therefore, you must use a TCP proxy.
					</p></section><section class="section" id="dvm-known-issues_installing-restricted-3-4"><div class="titlepage"><div><div><h4 class="title">7.4.1.3. Known issue</h4></div></div></div><div class="formalpara"><p class="title"><strong>Migration fails with error <code class="literal">Upgrade request required</code></strong></p><p>
							The migration Controller uses the SPDY protocol to execute commands within remote pods. If the remote cluster is behind a proxy or a firewall that does not support the SPDY protocol, the migration controller fails to execute remote commands. The migration fails with the error message <code class="literal">Upgrade request required</code>. Workaround: Use a proxy that supports the SPDY protocol.
						</p></div><p>
						In addition to supporting the SPDY protocol, the proxy or firewall also must pass the <code class="literal">Upgrade</code> HTTP header to the API server. The client uses this header to open a websocket connection with the API server. If the <code class="literal">Upgrade</code> header is blocked by the proxy or firewall, the migration fails with the error message <code class="literal">Upgrade request required</code>. Workaround: Ensure that the proxy forwards the <code class="literal">Upgrade</code> header.
					</p></section></section><section class="section" id="tuning-network-policies-for-migrations_installing-restricted-3-4"><div class="titlepage"><div><div><h3 class="title">7.4.2. Tuning network policies for migrations</h3></div></div></div><p>
					OpenShift supports restricting traffic to or from pods using <span class="emphasis"><em>NetworkPolicy</em></span> or <span class="emphasis"><em>EgressFirewalls</em></span> based on the network plugin used by the cluster. If any of the source namespaces involved in a migration use such mechanisms to restrict network traffic to pods, the restrictions might inadvertently stop traffic to Rsync pods during migration.
				</p><p>
					Rsync pods running on both the source and the target clusters must connect to each other over an OpenShift Route. Existing <span class="emphasis"><em>NetworkPolicy</em></span> or <span class="emphasis"><em>EgressNetworkPolicy</em></span> objects can be configured to automatically exempt Rsync pods from these traffic restrictions.
				</p><section class="section" id="dvm-network-policy-configuration_installing-restricted-3-4"><div class="titlepage"><div><div><h4 class="title">7.4.2.1. NetworkPolicy configuration</h4></div></div></div><section class="section" id="egress-traffic-from-rsync-pods_installing-restricted-3-4"><div class="titlepage"><div><div><h5 class="title">7.4.2.1.1. Egress traffic from Rsync pods</h5></div></div></div><p>
							You can use the unique labels of Rsync pods to allow egress traffic to pass from them if the <code class="literal">NetworkPolicy</code> configuration in the source or destination namespaces blocks this type of traffic. The following policy allows <span class="strong strong"><strong>all</strong></span> egress traffic from Rsync pods in the namespace:
						</p><pre class="programlisting language-yaml">apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-all-egress-from-rsync-pods
spec:
  podSelector:
    matchLabels:
      owner: directvolumemigration
      app: directvolumemigration-rsync-transfer
  egress:
  - {}
  policyTypes:
  - Egress</pre></section><section class="section" id="ingress-traffic-to-rsync-pods_installing-restricted-3-4"><div class="titlepage"><div><div><h5 class="title">7.4.2.1.2. Ingress traffic to Rsync pods</h5></div></div></div><pre class="programlisting language-yaml">apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-all-egress-from-rsync-pods
spec:
  podSelector:
    matchLabels:
      owner: directvolumemigration
      app: directvolumemigration-rsync-transfer
  ingress:
  - {}
  policyTypes:
  - Ingress</pre></section></section><section class="section" id="egressnetworkpolicy-config_installing-restricted-3-4"><div class="titlepage"><div><div><h4 class="title">7.4.2.2. EgressNetworkPolicy configuration</h4></div></div></div><p>
						The <code class="literal">EgressNetworkPolicy</code> object or <span class="emphasis"><em>Egress Firewalls</em></span> are OpenShift constructs designed to block egress traffic leaving the cluster.
					</p><p>
						Unlike the <code class="literal">NetworkPolicy</code> object, the Egress Firewall works at a project level because it applies to all pods in the namespace. Therefore, the unique labels of Rsync pods do not exempt only Rsync pods from the restrictions. However, you can add the CIDR ranges of the source or target cluster to the <span class="emphasis"><em>Allow</em></span> rule of the policy so that a direct connection can be setup between two clusters.
					</p><p>
						Based on which cluster the Egress Firewall is present in, you can add the CIDR range of the other cluster to allow egress traffic between the two:
					</p><pre class="programlisting language-yaml">apiVersion: network.openshift.io/v1
kind: EgressNetworkPolicy
metadata:
  name: test-egress-policy
  namespace: &lt;namespace&gt;
spec:
  egress:
  - to:
      cidrSelector: &lt;cidr_of_source_or_target_cluster&gt;
    type: Deny</pre></section><section class="section" id="choosing-alternate-endpoints-for-data-transfer_installing-restricted-3-4"><div class="titlepage"><div><div><h4 class="title">7.4.2.3. Choosing alternate endpoints for data transfer</h4></div></div></div><p>
						By default, DVM uses an OpenShift Container Platform route as an endpoint to transfer PV data to destination clusters. You can choose another type of supported endpoint, if cluster topologies allow.
					</p><p>
						For each cluster, you can configure an endpoint by setting the <code class="literal">rsync_endpoint_type</code> variable on the appropriate <span class="strong strong"><strong>destination</strong></span> cluster in your <code class="literal">MigrationController</code> CR:
					</p><pre class="programlisting language-yaml">apiVersion: migration.openshift.io/v1alpha1
kind: MigrationController
metadata:
  name: migration-controller
  namespace: openshift-migration
spec:
  [...]
  rsync_endpoint_type: [NodePort|ClusterIP|Route]</pre></section><section class="section" id="configuring-supplemental-groups-for-rsync-pods_installing-restricted-3-4"><div class="titlepage"><div><div><h4 class="title">7.4.2.4. Configuring supplemental groups for Rsync pods</h4></div></div></div><p>
						When your PVCs use a shared storage, you can configure the access to that storage by adding supplemental groups to Rsync pod definitions in order for the pods to allow access:
					</p><div class="table" id="idm139748678936544"><p class="title"><strong>Table 7.2. Supplementary groups for Rsync pods</strong></p><div class="table-contents"><table class="gt-4-cols lt-7-rows"><colgroup><col style="width: 25%; " class="col_1"><!--Empty--></col><col style="width: 25%; " class="col_2"><!--Empty--></col><col style="width: 25%; " class="col_3"><!--Empty--></col><col style="width: 25%; " class="col_4"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139748686544144" scope="col">Variable</th><th align="left" valign="top" id="idm139748686543056" scope="col">Type</th><th align="left" valign="top" id="idm139748686541968" scope="col">Default</th><th align="left" valign="top" id="idm139748686540880" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139748686544144"> <p>
										<code class="literal">src_supplemental_groups</code>
									</p>
									 </td><td align="left" valign="top" headers="idm139748686543056"> <p>
										string
									</p>
									 </td><td align="left" valign="top" headers="idm139748686541968"> <p>
										Not set
									</p>
									 </td><td align="left" valign="top" headers="idm139748686540880"> <p>
										Comma-separated list of supplemental groups for source Rsync pods
									</p>
									 </td></tr><tr><td align="left" valign="top" headers="idm139748686544144"> <p>
										<code class="literal">target_supplemental_groups</code>
									</p>
									 </td><td align="left" valign="top" headers="idm139748686543056"> <p>
										string
									</p>
									 </td><td align="left" valign="top" headers="idm139748686541968"> <p>
										Not set
									</p>
									 </td><td align="left" valign="top" headers="idm139748686540880"> <p>
										Comma-separated list of supplemental groups for target Rsync pods
									</p>
									 </td></tr></tbody></table></div></div><div class="formalpara"><p class="title"><strong>Example usage</strong></p><p>
							The <code class="literal">MigrationController</code> CR can be updated to set values for these supplemental groups:
						</p></div><pre class="programlisting language-yaml">spec:
  src_supplemental_groups: "1000,2000"
  target_supplemental_groups: "2000,3000"</pre></section></section><section class="section" id="migration-configuring-proxies_installing-restricted-3-4"><div class="titlepage"><div><div><h3 class="title">7.4.3. Configuring proxies</h3></div></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							You must be logged in as a user with <code class="literal">cluster-admin</code> privileges on all clusters.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Get the <code class="literal">MigrationController</code> CR manifest:
						</p><pre class="programlisting language-terminal">$ oc get migrationcontroller &lt;migration_controller&gt; -n openshift-migration</pre></li><li class="listitem"><p class="simpara">
							Update the proxy parameters:
						</p><pre class="programlisting language-yaml">apiVersion: migration.openshift.io/v1alpha1
kind: MigrationController
metadata:
  name: &lt;migration_controller&gt;
  namespace: openshift-migration
...
spec:
  stunnel_tcp_proxy: http://&lt;username&gt;:&lt;password&gt;@&lt;ip&gt;:&lt;port&gt; <span id="CO9-1"><!--Empty--></span><span class="callout">1</span>
  noProxy: example.com <span id="CO9-2"><!--Empty--></span><span class="callout">2</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO9-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Stunnel proxy URL for direct volume migration.
								</div></dd><dt><a href="#CO9-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Comma-separated list of destination domain names, domains, IP addresses, or other network CIDRs to exclude proxying.
								</div></dd></dl></div><p class="simpara">
							Preface a domain with <code class="literal">.</code> to match subdomains only. For example, <code class="literal">.y.com</code> matches <code class="literal">x.y.com</code>, but not <code class="literal">y.com</code>. Use <code class="literal">*</code> to bypass proxy for all destinations. If you scale up workers that are not included in the network defined by the <code class="literal">networking.machineNetwork[].cidr</code> field from the installation configuration, you must add them to this list to prevent connection issues.
						</p><p class="simpara">
							This field is ignored if neither the <code class="literal">httpProxy</code> nor the <code class="literal">httpsProxy</code> field is set.
						</p></li><li class="listitem">
							Save the manifest as <code class="literal">migration-controller.yaml</code>.
						</li><li class="listitem"><p class="simpara">
							Apply the updated manifest:
						</p><pre class="programlisting language-terminal">$ oc replace -f migration-controller.yaml -n openshift-migration</pre></li></ol></div><p>
					For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/networking/#nw-proxy-configure-object_config-cluster-wide-proxy">Configuring the cluster-wide proxy</a>.
				</p></section></section><section class="section" id="configuring-replication-repository_installing-restricted-3-4"><div class="titlepage"><div><div><h2 class="title">7.5. Configuring a replication repository</h2></div></div></div><p>
				The Multicloud Object Gateway is the only supported option for a restricted network environment.
			</p><p>
				MTC supports the <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-understanding-data-copy-methods_about-mtc-3-4">file system and snapshot data copy methods</a> for migrating data from the source cluster to the target cluster. You can select a method that is suited for your environment and is supported by your storage provider.
			</p><section class="section" id="replication-repository-prerequisites_installing-restricted-3-4"><div class="titlepage"><div><div><h3 class="title">7.5.1. Prerequisites</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							All clusters must have uninterrupted network access to the replication repository.
						</li><li class="listitem">
							If you use a proxy server with an internally hosted replication repository, you must ensure that the proxy allows access to the replication repository.
						</li></ul></div></section><section class="section" id="migration-configuring-mcg_installing-restricted-3-4"><div class="titlepage"><div><div><h3 class="title">7.5.2. Retrieving Multicloud Object Gateway credentials</h3></div></div></div><p>
					You must retrieve the Multicloud Object Gateway (MCG) credentials in order to create a <code class="literal">Secret</code> custom resource (CR) for the OpenShift API for Data Protection (OADP).
				</p><p>
					MCG is a component of OpenShift Data Foundation.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							You must deploy OpenShift Data Foundation by using the appropriate <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_openshift_data_foundation/4.9">OpenShift Data Foundation deployment guide</a>.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Obtain the S3 endpoint, <code class="literal">AWS_ACCESS_KEY_ID</code>, and <code class="literal">AWS_SECRET_ACCESS_KEY</code> by running the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_openshift_data_foundation/4.9/html/managing_hybrid_and_multicloud_resources/accessing-the-multicloud-object-gateway-with-your-applications_rhodf#accessing-the-Multicloud-object-gateway-from-the-terminal_rhodf"><code class="literal">describe</code> command</a> on the <code class="literal">NooBaa</code> custom resource.
						</li></ol></div></section><section class="section _additional-resources" id="installing-restricted-3-4_configuring-replication-repository-additional-resources"><div class="titlepage"><div><div><h3 class="title">7.5.3. Additional resources</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_openshift_data_foundation/4.9/html/planning_your_deployment/disconnected-environment_rhodf">Disconnected environment</a> in the Red Hat OpenShift Data Foundation documentation.
						</li><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-mtc-workflow_about-mtc-3-4">MTC workflow</a>
						</li><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-understanding-data-copy-methods_about-mtc-3-4">About data copy methods</a>
						</li><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-adding-replication-repository-to-cam_migrating-applications-3-4">Adding a replication repository to the MTC web console</a>
						</li></ul></div></section></section><section class="section" id="migration-uninstalling-mtc-clean-up_installing-restricted-3-4"><div class="titlepage"><div><div><h2 class="title">7.6. Uninstalling MTC and deleting resources</h2></div></div></div><p>
				You can uninstall the Migration Toolkit for Containers (MTC) and delete its resources to clean up the cluster.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Deleting the <code class="literal">velero</code> CRDs removes Velero from the cluster.
				</p></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You must be logged in as a user with <code class="literal">cluster-admin</code> privileges.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Delete the <code class="literal">MigrationController</code> custom resource (CR) on all clusters:
					</p><pre class="programlisting language-terminal">$ oc delete migrationcontroller &lt;migration_controller&gt;</pre></li><li class="listitem">
						Uninstall the Migration Toolkit for Containers Operator on OpenShift Container Platform 4 by using the Operator Lifecycle Manager.
					</li><li class="listitem"><p class="simpara">
						Delete cluster-scoped resources on all clusters by running the following commands:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								<code class="literal">migration</code> custom resource definitions (CRDs):
							</p><pre class="programlisting language-terminal">$ oc delete $(oc get crds -o name | grep 'migration.openshift.io')</pre></li><li class="listitem"><p class="simpara">
								<code class="literal">velero</code> CRDs:
							</p><pre class="programlisting language-terminal">$ oc delete $(oc get crds -o name | grep 'velero')</pre></li><li class="listitem"><p class="simpara">
								<code class="literal">migration</code> cluster roles:
							</p><pre class="programlisting language-terminal">$ oc delete $(oc get clusterroles -o name | grep 'migration.openshift.io')</pre></li><li class="listitem"><p class="simpara">
								<code class="literal">migration-operator</code> cluster role:
							</p><pre class="programlisting language-terminal">$ oc delete clusterrole migration-operator</pre></li><li class="listitem"><p class="simpara">
								<code class="literal">velero</code> cluster roles:
							</p><pre class="programlisting language-terminal">$ oc delete $(oc get clusterroles -o name | grep 'velero')</pre></li><li class="listitem"><p class="simpara">
								<code class="literal">migration</code> cluster role bindings:
							</p><pre class="programlisting language-terminal">$ oc delete $(oc get clusterrolebindings -o name | grep 'migration.openshift.io')</pre></li><li class="listitem"><p class="simpara">
								<code class="literal">migration-operator</code> cluster role bindings:
							</p><pre class="programlisting language-terminal">$ oc delete clusterrolebindings migration-operator</pre></li><li class="listitem"><p class="simpara">
								<code class="literal">velero</code> cluster role bindings:
							</p><pre class="programlisting language-terminal">$ oc delete $(oc get clusterrolebindings -o name | grep 'velero')</pre></li></ul></div></li></ol></div></section></section><section class="chapter" id="upgrading-3-4"><div class="titlepage"><div><div><h1 class="title">Chapter 8. Upgrading the Migration Toolkit for Containers</h1></div></div></div><p>
			You can upgrade the Migration Toolkit for Containers (MTC) on OpenShift Container Platform 4.13 by using Operator Lifecycle Manager.
		</p><p>
			You can upgrade MTC on OpenShift Container Platform 3 by reinstalling the legacy Migration Toolkit for Containers Operator.
		</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
				If you are upgrading from MTC version 1.3, you must perform an additional procedure to update the <code class="literal">MigPlan</code> custom resource (CR).
			</p></div></div><section class="section" id="migration-upgrading-mtc-on-ocp-4_upgrading-3-4"><div class="titlepage"><div><div><h2 class="title">8.1. Upgrading the Migration Toolkit for Containers on OpenShift Container Platform 4.13</h2></div></div></div><p>
				You can upgrade the Migration Toolkit for Containers (MTC) on OpenShift Container Platform 4.13 by using the Operator Lifecycle Manager.
			</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					When upgrading the MTC by using the Operator Lifecycle Manager, you must use a supported migration path.
				</p></div></div><div class="itemizedlist"><p class="title"><strong>Migration paths</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						Migrating from OpenShift Container Platform 3 to OpenShift Container Platform 4 requires a legacy MTC Operator and MTC 1.7.x.
					</li><li class="listitem">
						Migrating from MTC 1.7.x to MTC 1.8.x is not supported.
					</li><li class="listitem"><p class="simpara">
						You must use MTC 1.7.x to migrate anything with a source of OpenShift Container Platform 4.9 or earlier.
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								MTC 1.7.x must be used on both source and destination.
							</li></ul></div></li><li class="listitem"><p class="simpara">
						MTC 1.8.x only supports migrations from OpenShift Container Platform 4.10 or later to OpenShift Container Platform 4.10 or later. For migrations only involving cluster versions 4.10 and later, either 1.7.x or 1.8.x may be used. However, it must be the same MTC version on both source &amp; destination.
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								Migration from source MTC 1.7.x to destination MTC 1.8.x is unsupported.
							</li><li class="listitem">
								Migration from source MTC 1.8.x to destination MTC 1.7.x is unsupported.
							</li><li class="listitem">
								Migration from source MTC 1.7.x to destination MTC 1.7.x is supported.
							</li><li class="listitem">
								Migration from source MTC 1.8.x to destination MTC 1.8.x is supported
							</li></ul></div></li></ul></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You must be logged in as a user with <code class="literal">cluster-admin</code> privileges.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						In the OpenShift Container Platform console, navigate to <span class="strong strong"><strong>Operators</strong></span> → <span class="strong strong"><strong>Installed Operators</strong></span>.
					</p><p class="simpara">
						Operators that have a pending upgrade display an <span class="strong strong"><strong>Upgrade available</strong></span> status.
					</p></li><li class="listitem">
						Click <span class="strong strong"><strong>Migration Toolkit for Containers Operator</strong></span>.
					</li><li class="listitem">
						Click the <span class="strong strong"><strong>Subscription</strong></span> tab. Any upgrades requiring approval are displayed next to <span class="strong strong"><strong>Upgrade Status</strong></span>. For example, it might display <span class="strong strong"><strong>1 requires approval</strong></span>.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>1 requires approval</strong></span>, then click <span class="strong strong"><strong>Preview Install Plan</strong></span>.
					</li><li class="listitem">
						Review the resources that are listed as available for upgrade and click <span class="strong strong"><strong>Approve</strong></span>.
					</li><li class="listitem">
						Navigate back to the <span class="strong strong"><strong>Operators → Installed Operators</strong></span> page to monitor the progress of the upgrade. When complete, the status changes to <span class="strong strong"><strong>Succeeded</strong></span> and <span class="strong strong"><strong>Up to date</strong></span>.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Workloads</strong></span> → <span class="strong strong"><strong>Pods</strong></span> to verify that the MTC pods are running.
					</li></ol></div></section><section class="section" id="migration-upgrading-mtc-with-legacy-operator_upgrading-3-4"><div class="titlepage"><div><div><h2 class="title">8.2. Upgrading the Migration Toolkit for Containers on OpenShift Container Platform 3</h2></div></div></div><p>
				You can upgrade Migration Toolkit for Containers (MTC) on OpenShift Container Platform 3 by manually installing the legacy Migration Toolkit for Containers Operator.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You must be logged in as a user with <code class="literal">cluster-admin</code> privileges.
					</li><li class="listitem">
						You must have access to <code class="literal">registry.redhat.io</code>.
					</li><li class="listitem">
						You must have <code class="literal">podman</code> installed.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Log in to <code class="literal">registry.redhat.io</code> with your Red Hat Customer Portal credentials by entering the following command:
					</p><pre class="programlisting language-terminal">$ podman login registry.redhat.io</pre></li><li class="listitem"><p class="simpara">
						Download the <code class="literal">operator.yml</code> file by entering the following command:
					</p><pre class="programlisting language-terminal">$ podman cp $(podman create \
  registry.redhat.io/rhmtc/openshift-migration-legacy-rhel8-operator:v1.8):/operator.yml ./</pre></li><li class="listitem"><p class="simpara">
						Replace the Migration Toolkit for Containers Operator by entering the following command:
					</p><pre class="programlisting language-terminal">$ oc replace --force -f operator.yml</pre></li><li class="listitem"><p class="simpara">
						Scale the <code class="literal">migration-operator</code> deployment to <code class="literal">0</code> to stop the deployment by entering the following command:
					</p><pre class="programlisting language-terminal">$ oc scale -n openshift-migration --replicas=0 deployment/migration-operator</pre></li><li class="listitem"><p class="simpara">
						Scale the <code class="literal">migration-operator</code> deployment to <code class="literal">1</code> to start the deployment and apply the changes by entering the following command:
					</p><pre class="programlisting language-terminal">$ oc scale -n openshift-migration --replicas=1 deployment/migration-operator</pre></li><li class="listitem"><p class="simpara">
						Verify that the <code class="literal">migration-operator</code> was upgraded by entering the following command:
					</p><pre class="programlisting language-terminal">$ oc -o yaml -n openshift-migration get deployment/migration-operator | grep image: | awk -F ":" '{ print $NF }'</pre></li><li class="listitem"><p class="simpara">
						Download the <code class="literal">controller.yml</code> file by entering the following command:
					</p><pre class="programlisting language-terminal">$ podman cp $(podman create \
  registry.redhat.io/rhmtc/openshift-migration-legacy-rhel8-operator:v1.8):/controller.yml ./</pre></li><li class="listitem"><p class="simpara">
						Create the <code class="literal">migration-controller</code> object by entering the following command:
					</p><pre class="programlisting language-terminal">$ oc create -f controller.yml</pre></li><li class="listitem"><p class="simpara">
						If you have previously added the OpenShift Container Platform 3 cluster to the MTC web console, you must update the service account token in the web console because the upgrade process deletes and restores the <code class="literal">openshift-migration</code> namespace:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
								Obtain the service account token by entering the following command:
							</p><pre class="programlisting language-terminal">$ oc sa get-token migration-controller -n openshift-migration</pre></li><li class="listitem">
								In the MTC web console, click <span class="strong strong"><strong>Clusters</strong></span>.
							</li><li class="listitem">
								Click the Options menu 
								<span class="inlinemediaobject"><img src="https://access.redhat.com/webassets/avalon/d/OpenShift_Container_Platform-4.13-Migrating_from_version_3_to_4-en-US/images/f468284ec3cc9bf27e6bd2c83849ca50/kebab.png" alt="kebab"/></span>
								 next to the cluster and select <span class="strong strong"><strong>Edit</strong></span>.
							</li><li class="listitem">
								Enter the new service account token in the <span class="strong strong"><strong>Service account token</strong></span> field.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Update cluster</strong></span> and then click <span class="strong strong"><strong>Close</strong></span>.
							</li></ol></div></li><li class="listitem"><p class="simpara">
						Verify that the MTC pods are running by entering the following command:
					</p><pre class="programlisting language-terminal">$ oc get pods -n openshift-migration</pre></li></ol></div></section><section class="section" id="migration-upgrading-from-mtc-1-3_upgrading-3-4"><div class="titlepage"><div><div><h2 class="title">8.3. Upgrading MTC 1.3 to 1.8</h2></div></div></div><p>
				If you are upgrading Migration Toolkit for Containers (MTC) version 1.3.x to 1.8, you must update the <code class="literal">MigPlan</code> custom resource (CR) manifest on the cluster on which the <code class="literal">MigrationController</code> pod is running.
			</p><p>
				Because the <code class="literal">indirectImageMigration</code> and <code class="literal">indirectVolumeMigration</code> parameters do not exist in MTC 1.3, their default value in version 1.4 is <code class="literal">false</code>, which means that direct image migration and direct volume migration are enabled. Because the direct migration requirements are not fulfilled, the migration plan cannot reach a <code class="literal">Ready</code> state unless these parameter values are changed to <code class="literal">true</code>.
			</p><div class="admonition important"><div class="admonition_header">Important</div><div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Migrating from OpenShift Container Platform 3 to OpenShift Container Platform 4 requires a legacy MTC Operator and MTC 1.7.x.
						</li><li class="listitem">
							Upgrading MTC 1.7.x to 1.8.x requires manually updating the OADP channel from <code class="literal">stable-1.0</code> to <code class="literal">stable-1.2</code> in order to successfully complete the upgrade from 1.7.x to 1.8.x.
						</li></ul></div></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You must be logged in as a user with <code class="literal">cluster-admin</code> privileges.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Log in to the cluster on which the <code class="literal">MigrationController</code> pod is running.
					</li><li class="listitem"><p class="simpara">
						Get the <code class="literal">MigPlan</code> CR manifest:
					</p><pre class="programlisting language-terminal">$ oc get migplan &lt;migplan&gt; -o yaml -n openshift-migration</pre></li><li class="listitem"><p class="simpara">
						Update the following parameter values and save the file as <code class="literal">migplan.yaml</code>:
					</p><pre class="programlisting language-yaml">...
spec:
  indirectImageMigration: true
  indirectVolumeMigration: true</pre></li><li class="listitem"><p class="simpara">
						Replace the <code class="literal">MigPlan</code> CR manifest to apply the changes:
					</p><pre class="programlisting language-terminal">$ oc replace -f migplan.yaml -n openshift-migration</pre></li><li class="listitem"><p class="simpara">
						Get the updated <code class="literal">MigPlan</code> CR manifest to verify the changes:
					</p><pre class="programlisting language-terminal">$ oc get migplan &lt;migplan&gt; -o yaml -n openshift-migration</pre></li></ol></div></section></section><section class="chapter" id="premigration-checklists-3-4"><div class="titlepage"><div><div><h1 class="title">Chapter 9. Premigration checklists</h1></div></div></div><p>
			Before you migrate your application workloads with the Migration Toolkit for Containers (MTC), review the following checklists.
		</p><section class="section" id="resources_premigration-checklists-3-4"><div class="titlepage"><div><div><h2 class="title">9.1. Resources</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="none"><li class="listitem">
						❏ If your application uses an internal service network or an external route for communicating with services, the relevant route exists.
					</li><li class="listitem">
						❏ If your application uses cluster-level resources, you have re-created them on the target cluster.
					</li><li class="listitem">
						❏ You have <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-excluding-resources_advanced-migration-options-3-4">excluded</a> persistent volumes (PVs), image streams, and other resources that you do not want to migrate.
					</li><li class="listitem">
						❏ PV data has been backed up in case an application displays unexpected behavior after migration and corrupts the data.
					</li></ul></div></section><section class="section" id="source-cluster_premigration-checklists-3-4"><div class="titlepage"><div><div><h2 class="title">9.2. Source cluster</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="none"><li class="listitem">
						❏ The cluster meets the <a class="link" href="https://docs.openshift.com/container-platform/3.11/install/prerequisites.html#hardware">minimum hardware requirements</a>.
					</li><li class="listitem"><p class="simpara">
						❏ You have installed the correct legacy Migration Toolkit for Containers Operator version:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<code class="literal">operator-3.7.yml</code> on OpenShift Container Platform version 3.7.
							</li><li class="listitem">
								<code class="literal">operator.yml</code> on OpenShift Container Platform versions 3.9 to 4.5.
							</li></ul></div></li><li class="listitem">
						❏ All nodes have an active OpenShift Container Platform subscription.
					</li><li class="listitem">
						❏ You have performed all the <a class="link" href="https://docs.openshift.com/container-platform/3.11/day_two_guide/run_once_tasks.html#day-two-guide-default-storage-class">run-once tasks</a>.
					</li><li class="listitem">
						❏ You have performed all the <a class="link" href="https://docs.openshift.com/container-platform/3.11/day_two_guide/environment_health_checks.html">environment health checks</a>.
					</li><li class="listitem"><p class="simpara">
						❏ You have checked for PVs with abnormal configurations stuck in a <span class="strong strong"><strong>Terminating</strong></span> state by running the following command:
					</p><pre class="programlisting language-terminal">$ oc get pv</pre></li><li class="listitem"><p class="simpara">
						❏ You have checked for pods whose status is other than <span class="strong strong"><strong>Running</strong></span> or <span class="strong strong"><strong>Completed</strong></span> by running the following command:
					</p><pre class="programlisting language-terminal">$ oc get pods --all-namespaces | egrep -v 'Running | Completed'</pre></li><li class="listitem"><p class="simpara">
						❏ You have checked for pods with a high restart count by running the following command:
					</p><pre class="programlisting language-terminal">$ oc get pods --all-namespaces --field-selector=status.phase=Running \
  -o json | jq '.items[]|select(any( .status.containerStatuses[]; \
  .restartCount &gt; 3))|.metadata.name'</pre><p class="simpara">
						Even if the pods are in a <span class="strong strong"><strong>Running</strong></span> state, a high restart count might indicate underlying problems.
					</p></li><li class="listitem">
						❏ You have removed old builds, deployments, and images from each namespace to be migrated by <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/building_applications/#pruning-objects">pruning</a>.
					</li><li class="listitem">
						❏ The OpenShift image registry uses a <a class="link" href="https://docs.openshift.com/container-platform/3.11/scaling_performance/optimizing_storage.html#registry">supported storage type</a>.
					</li><li class="listitem">
						❏ Direct image migration only: The OpenShift image registry is <a class="link" href="https://docs.openshift.com/container-platform/3.11/install_config/registry/securing_and_exposing_registry.html#exposing-the-registry">exposed</a> to external traffic.
					</li><li class="listitem">
						❏ You can read and write images to the registry.
					</li><li class="listitem">
						❏ The <a class="link" href="https://access.redhat.com/articles/3093761">etcd cluster</a> is healthy.
					</li><li class="listitem">
						❏ The <a class="link" href="https://docs.openshift.com/container-platform/3.11/install_config/master_node_configuration.html#master-node-configuration-node-qps-burst">average API server response time</a> on the source cluster is less than 50 ms.
					</li><li class="listitem">
						❏ The cluster certificates are <a class="link" href="https://docs.openshift.com/container-platform/3.11/install_config/redeploying_certificates.html#install-config-cert-expiry">valid</a> for the duration of the migration process.
					</li><li class="listitem"><p class="simpara">
						❏ You have checked for pending certificate-signing requests by running the following command:
					</p><pre class="programlisting language-terminal">$ oc get csr -A | grep pending -i</pre></li><li class="listitem">
						❏ The <a class="link" href="https://docs.openshift.com/container-platform/3.11/install_config/configuring_authentication.html#overview">identity provider</a> is working.
					</li><li class="listitem">
						❏ You have set the value of the <code class="literal">openshift.io/host.generated</code> annotation parameter to <code class="literal">true</code> for each OpenShift Container Platform route, which updates the host name of the route for the target cluster. Otherwise, the migrated routes retain the source cluster host name.
					</li></ul></div></section><section class="section" id="target-cluster_premigration-checklists-3-4"><div class="titlepage"><div><div><h2 class="title">9.3. Target cluster</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="none"><li class="listitem">
						❏ You have installed Migration Toolkit for Containers Operator version 1.5.1.
					</li><li class="listitem">
						❏ All <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-prerequisites_migrating-applications-3-4">MTC prerequisites</a> are met.
					</li><li class="listitem">
						❏ The cluster meets the minimum hardware requirements for the specific platform and installation method, for example, on <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#minimum-resource-requirements_installing-bare-metal">bare metal</a>.
					</li><li class="listitem"><p class="simpara">
						❏ The cluster has <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/storage/#defining-storage-classes_dynamic-provisioning">storage classes</a> defined for the storage types used by the source cluster, for example, block volume, file system, or object storage.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							NFS does not require a defined storage class.
						</p></div></div></li><li class="listitem">
						❏ The cluster has the correct network configuration and permissions to access external services, for example, databases, source code repositories, container image registries, and CI/CD tools.
					</li><li class="listitem">
						❏ External applications and services that use services provided by the cluster have the correct network configuration and permissions to access the cluster.
					</li><li class="listitem"><p class="simpara">
						❏ Internal container image dependencies are met.
					</p><p class="simpara">
						If an application uses an internal image in the <code class="literal">openshift</code> namespace that is not supported by OpenShift Container Platform 4.13, you can manually update the <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-updating-deprecated-internal-images_troubleshooting-3-4">OpenShift Container Platform 3 image stream tag</a> with <code class="literal">podman</code>.
					</p></li><li class="listitem">
						❏ The target cluster and the replication repository have sufficient storage space.
					</li><li class="listitem">
						❏ The <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/authentication_and_authorization/#supported-identity-providers">identity provider</a> is working.
					</li><li class="listitem">
						❏ DNS records for your application exist on the target cluster.
					</li><li class="listitem">
						❏ Certificates that your application uses exist on the target cluster.
					</li><li class="listitem">
						❏ You have configured appropriate firewall rules on the target cluster.
					</li><li class="listitem">
						❏ You have correctly configured load balancing on the target cluster.
					</li><li class="listitem"><p class="simpara">
						❏ If you migrate objects to an existing namespace on the target cluster that has the same name as the namespace being migrated from the source, the target namespace contains no objects of the same name and type as the objects being migrated.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							Do not create namespaces for your application on the target cluster before migration because this might cause quotas to change.
						</p></div></div></li></ul></div></section><section class="section" id="performance_premigration-checklists-3-4"><div class="titlepage"><div><div><h2 class="title">9.4. Performance</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="none"><li class="listitem">
						❏ The migration network has a minimum throughput of 10 Gbps.
					</li><li class="listitem"><p class="simpara">
						❏ The clusters have sufficient resources for migration.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							Clusters require additional memory, CPUs, and storage in order to run a migration on top of normal workloads. Actual resource requirements depend on the number of Kubernetes resources being migrated in a single migration plan. You must test migrations in a non-production environment in order to estimate the resource requirements.
						</p></div></div></li><li class="listitem">
						❏ The <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/support/#reviewing-node-status-use-and-configuration_verifying-node-health">memory and CPU usage</a> of the nodes are healthy.
					</li><li class="listitem">
						❏ The <a class="link" href="https://access.redhat.com/solutions/4885641">etcd disk performance</a> of the clusters has been checked with <code class="literal">fio</code>.
					</li></ul></div></section></section><section class="chapter" id="migrating-applications-3-4"><div class="titlepage"><div><div><h1 class="title">Chapter 10. Migrating your applications</h1></div></div></div><p>
			You can migrate your applications by using the Migration Toolkit for Containers (MTC) web console or from the <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migrating-applications-cli_advanced-migration-options-3-4">command line</a>.
		</p><p>
			You can use stage migration and cutover migration to migrate an application between clusters:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					Stage migration copies data from the source cluster to the target cluster without stopping the application. You can run a stage migration multiple times to reduce the duration of the cutover migration.
				</li><li class="listitem">
					Cutover migration stops the transactions on the source cluster and moves the resources to the target cluster.
				</li></ul></div><p>
			You can use state migration to migrate an application’s state:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					State migration copies selected persistent volume claims (PVCs).
				</li><li class="listitem">
					You can use state migration to migrate a namespace within the same cluster.
				</li></ul></div><p>
			Most cluster-scoped resources are not yet handled by MTC. If your applications require cluster-scoped resources, you might have to create them manually on the target cluster.
		</p><p>
			During migration, MTC preserves the following namespace annotations:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					<code class="literal">openshift.io/sa.scc.mcs</code>
				</li><li class="listitem">
					<code class="literal">openshift.io/sa.scc.supplemental-groups</code>
				</li><li class="listitem">
					<code class="literal">openshift.io/sa.scc.uid-range</code>
				</li></ul></div><p>
			These annotations preserve the UID range, ensuring that the containers retain their file system permissions on the target cluster. There is a risk that the migrated UIDs could duplicate UIDs within an existing or future namespace on the target cluster.
		</p><section class="section" id="migration-prerequisites_migrating-applications-3-4"><div class="titlepage"><div><div><h2 class="title">10.1. Migration prerequisites</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						You must be logged in as a user with <code class="literal">cluster-admin</code> privileges on all clusters.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Direct image migration</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You must ensure that the secure OpenShift image registry of the source cluster is exposed.
					</li><li class="listitem">
						You must create a route to the exposed registry.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Direct volume migration</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						If your clusters use proxies, you must configure an Stunnel TCP proxy.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Internal images</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						If your application uses internal images from the <code class="literal">openshift</code> namespace, you must ensure that the required versions of the images are present on the target cluster.
					</p><p class="simpara">
						You can manually update an image stream tag in order to use a deprecated OpenShift Container Platform 3 image on an OpenShift Container Platform 4.13 cluster.
					</p></li></ul></div><div class="itemizedlist"><p class="title"><strong>Clusters</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The source cluster must be upgraded to the latest MTC z-stream release.
					</li><li class="listitem">
						The MTC version must be the same on all clusters.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Network</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The clusters have unrestricted network access to each other and to the replication repository.
					</li><li class="listitem">
						If you copy the persistent volumes with <code class="literal">move</code>, the clusters must have unrestricted network access to the remote volumes.
					</li><li class="listitem"><p class="simpara">
						You must enable the following ports on an OpenShift Container Platform 3 cluster:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								<code class="literal">8443</code> (API server)
							</li><li class="listitem">
								<code class="literal">443</code> (routes)
							</li><li class="listitem">
								<code class="literal">53</code> (DNS)
							</li></ul></div></li><li class="listitem"><p class="simpara">
						You must enable the following ports on an OpenShift Container Platform 4 cluster:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								<code class="literal">6443</code> (API server)
							</li><li class="listitem">
								<code class="literal">443</code> (routes)
							</li><li class="listitem">
								<code class="literal">53</code> (DNS)
							</li></ul></div></li><li class="listitem">
						You must enable port <code class="literal">443</code> on the replication repository if you are using TLS.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Persistent volumes (PVs)</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The PVs must be valid.
					</li><li class="listitem">
						The PVs must be bound to persistent volume claims.
					</li><li class="listitem"><p class="simpara">
						If you use snapshots to copy the PVs, the following additional prerequisites apply:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								The cloud provider must support snapshots.
							</li><li class="listitem">
								The PVs must have the same cloud provider.
							</li><li class="listitem">
								The PVs must be located in the same geographic region.
							</li><li class="listitem">
								The PVs must have the same storage class.
							</li></ul></div></li></ul></div><h4 id="additional-resources-for-migration-prerequisites_migrating-applications-3-4">Additional resources for migration prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<a class="link" href="https://docs.openshift.com/container-platform/3.11/install_config/registry/securing_and_exposing_registry.html#exposing-the-registry">Manually exposing a secure registry for OpenShift Container Platform 3</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-updating-deprecated-internal-images_troubleshooting-3-4">Updating deprecated internal images</a>
					</li></ul></div></section><section class="section" id="migrating-applications-mtc-web-console_migrating-applications-3-4"><div class="titlepage"><div><div><h2 class="title">10.2. Migrating your applications by using the MTC web console</h2></div></div></div><p>
				You can configure clusters and a replication repository by using the MTC web console. Then, you can create and run a migration plan.
			</p><section class="section" id="migration-launching-cam_migrating-applications-3-4"><div class="titlepage"><div><div><h3 class="title">10.2.1. Launching the MTC web console</h3></div></div></div><p>
					You can launch the Migration Toolkit for Containers (MTC) web console in a browser.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							The MTC web console must have network access to the OpenShift Container Platform web console.
						</li><li class="listitem">
							The MTC web console must have network access to the OAuth authorization server.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Log in to the OpenShift Container Platform cluster on which you have installed MTC.
						</li><li class="listitem"><p class="simpara">
							Obtain the MTC web console URL by entering the following command:
						</p><pre class="programlisting language-terminal">$ oc get -n openshift-migration route/migration -o go-template='https://{{ .spec.host }}'</pre><p class="simpara">
							The output resembles the following: <code class="literal">https://migration-openshift-migration.apps.cluster.openshift.com</code>.
						</p></li><li class="listitem"><p class="simpara">
							Launch a browser and navigate to the MTC web console.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								If you try to access the MTC web console immediately after installing the Migration Toolkit for Containers Operator, the console might not load because the Operator is still configuring the cluster. Wait a few minutes and retry.
							</p></div></div></li><li class="listitem">
							If you are using self-signed CA certificates, you will be prompted to accept the CA certificate of the source cluster API server. The web page guides you through the process of accepting the remaining certificates.
						</li><li class="listitem">
							Log in with your OpenShift Container Platform <span class="strong strong"><strong>username</strong></span> and <span class="strong strong"><strong>password</strong></span>.
						</li></ol></div></section><section class="section" id="migration-adding-cluster-to-cam_migrating-applications-3-4"><div class="titlepage"><div><div><h3 class="title">10.2.2. Adding a cluster to the MTC web console</h3></div></div></div><p>
					You can add a cluster to the Migration Toolkit for Containers (MTC) web console.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							If you are using Azure snapshots to copy data:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									You must specify the Azure resource group name for the cluster.
								</li><li class="listitem">
									The clusters must be in the same Azure resource group.
								</li><li class="listitem">
									The clusters must be in the same geographic location.
								</li></ul></div></li><li class="listitem">
							If you are using direct image migration, you must expose a route to the image registry of the source cluster.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Log in to the cluster.
						</li><li class="listitem"><p class="simpara">
							Obtain the <code class="literal">migration-controller</code> service account token:
						</p><pre class="programlisting language-terminal">$ oc sa get-token migration-controller -n openshift-migration</pre><div class="formalpara"><p class="title"><strong>Example output</strong></p><p>
								
<pre class="programlisting language-terminal">eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJtaWciLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlY3JldC5uYW1lIjoibWlnLXRva2VuLWs4dDJyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6Im1pZyIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6ImE1YjFiYWMwLWMxYmYtMTFlOS05Y2NiLTAyOWRmODYwYjMwOCIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDptaWc6bWlnIn0.xqeeAINK7UXpdRqAtOj70qhBJPeMwmgLomV9iFxr5RoqUgKchZRG2J2rkqmPm6vr7K-cm7ibD1IBpdQJCcVDuoHYsFgV4mp9vgOfn9osSDp2TGikwNz4Az95e81xnjVUmzh-NjDsEpw71DH92iHV_xt2sTwtzftS49LpPW2LjrV0evtNBP_t_RfskdArt5VSv25eORl7zScqfe1CiMkcVbf2UqACQjo3LbkpfN26HAioO2oH0ECPiRzT0Xyh-KwFutJLS9Xgghyw-LD9kPKcE_xbbJ9Y4Rqajh7WdPYuB0Jd9DPVrslmzK-F6cgHHYoZEv0SvLQi-PO0rpDrcjOEQQ</pre>

							</p></div></li><li class="listitem">
							In the MTC web console, click <span class="strong strong"><strong>Clusters</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add cluster</strong></span>.
						</li><li class="listitem"><p class="simpara">
							Fill in the following fields:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									<span class="strong strong"><strong>Cluster name</strong></span>: The cluster name can contain lower-case letters (<code class="literal">a-z</code>) and numbers (<code class="literal">0-9</code>). It must not contain spaces or international characters.
								</li><li class="listitem">
									<span class="strong strong"><strong>URL</strong></span>: Specify the API server URL, for example, <code class="literal">https://&lt;www.example.com&gt;:8443</code>.
								</li><li class="listitem">
									<span class="strong strong"><strong>Service account token</strong></span>: Paste the <code class="literal">migration-controller</code> service account token.
								</li><li class="listitem"><p class="simpara">
									<span class="strong strong"><strong>Exposed route host to image registry</strong></span>: If you are using direct image migration, specify the exposed route to the image registry of the source cluster.
								</p><p class="simpara">
									To create the route, run the following command:
								</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p class="simpara">
											For OpenShift Container Platform 3:
										</p><pre class="programlisting language-terminal">$ oc create route passthrough --service=docker-registry --port=5000 -n default</pre></li><li class="listitem"><p class="simpara">
											For OpenShift Container Platform 4:
										</p><pre class="programlisting language-terminal">$ oc create route passthrough --service=image-registry --port=5000 -n openshift-image-registry</pre></li></ul></div></li><li class="listitem">
									<span class="strong strong"><strong>Azure cluster</strong></span>: You must select this option if you use Azure snapshots to copy your data.
								</li><li class="listitem">
									<span class="strong strong"><strong>Azure resource group</strong></span>: This field is displayed if <span class="strong strong"><strong>Azure cluster</strong></span> is selected. Specify the Azure resource group.
								</li><li class="listitem">
									<span class="strong strong"><strong>Require SSL verification</strong></span>: Optional: Select this option to verify SSL connections to the cluster.
								</li><li class="listitem">
									<span class="strong strong"><strong>CA bundle file</strong></span>: This field is displayed if <span class="strong strong"><strong>Require SSL verification</strong></span> is selected. If you created a custom CA certificate bundle file for self-signed certificates, click <span class="strong strong"><strong>Browse</strong></span>, select the CA bundle file, and upload it.
								</li></ul></div></li><li class="listitem"><p class="simpara">
							Click <span class="strong strong"><strong>Add cluster</strong></span>.
						</p><p class="simpara">
							The cluster appears in the <span class="strong strong"><strong>Clusters</strong></span> list.
						</p></li></ol></div></section><section class="section" id="migration-adding-replication-repository-to-cam_migrating-applications-3-4"><div class="titlepage"><div><div><h3 class="title">10.2.3. Adding a replication repository to the MTC web console</h3></div></div></div><p>
					You can add an object storage as a replication repository to the Migration Toolkit for Containers (MTC) web console.
				</p><p>
					MTC supports the following storage providers:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Amazon Web Services (AWS) S3
						</li><li class="listitem">
							Multi-Cloud Object Gateway (MCG)
						</li><li class="listitem">
							Generic S3 object storage, for example, Minio or Ceph S3
						</li><li class="listitem">
							Google Cloud Provider (GCP)
						</li><li class="listitem">
							Microsoft Azure Blob
						</li></ul></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							You must configure the object storage as a replication repository.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							In the MTC web console, click <span class="strong strong"><strong>Replication repositories</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add repository</strong></span>.
						</li><li class="listitem"><p class="simpara">
							Select a <span class="strong strong"><strong>Storage provider type</strong></span> and fill in the following fields:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
									<span class="strong strong"><strong>AWS</strong></span> for S3 providers, including AWS and MCG:
								</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
											<span class="strong strong"><strong>Replication repository name</strong></span>: Specify the replication repository name in the MTC web console.
										</li><li class="listitem">
											<span class="strong strong"><strong>S3 bucket name</strong></span>: Specify the name of the S3 bucket.
										</li><li class="listitem">
											<span class="strong strong"><strong>S3 bucket region</strong></span>: Specify the S3 bucket region. <span class="strong strong"><strong>Required</strong></span> for AWS S3. <span class="strong strong"><strong>Optional</strong></span> for some S3 providers. Check the product documentation of your S3 provider for expected values.
										</li><li class="listitem">
											<span class="strong strong"><strong>S3 endpoint</strong></span>: Specify the URL of the S3 service, not the bucket, for example, <code class="literal">https://&lt;s3-storage.apps.cluster.com&gt;</code>. <span class="strong strong"><strong>Required</strong></span> for a generic S3 provider. You must use the <code class="literal">https://</code> prefix.
										</li><li class="listitem">
											<span class="strong strong"><strong>S3 provider access key</strong></span>: Specify the <code class="literal">&lt;AWS_SECRET_ACCESS_KEY&gt;</code> for AWS or the S3 provider access key for MCG and other S3 providers.
										</li><li class="listitem">
											<span class="strong strong"><strong>S3 provider secret access key</strong></span>: Specify the <code class="literal">&lt;AWS_ACCESS_KEY_ID&gt;</code> for AWS or the S3 provider secret access key for MCG and other S3 providers.
										</li><li class="listitem">
											<span class="strong strong"><strong>Require SSL verification</strong></span>: Clear this checkbox if you are using a generic S3 provider.
										</li><li class="listitem">
											If you created a custom CA certificate bundle for self-signed certificates, click <span class="strong strong"><strong>Browse</strong></span> and browse to the Base64-encoded file.
										</li></ul></div></li><li class="listitem"><p class="simpara">
									<span class="strong strong"><strong>GCP</strong></span>:
								</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
											<span class="strong strong"><strong>Replication repository name</strong></span>: Specify the replication repository name in the MTC web console.
										</li><li class="listitem">
											<span class="strong strong"><strong>GCP bucket name</strong></span>: Specify the name of the GCP bucket.
										</li><li class="listitem">
											<span class="strong strong"><strong>GCP credential JSON blob</strong></span>: Specify the string in the <code class="literal">credentials-velero</code> file.
										</li></ul></div></li><li class="listitem"><p class="simpara">
									<span class="strong strong"><strong>Azure</strong></span>:
								</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
											<span class="strong strong"><strong>Replication repository name</strong></span>: Specify the replication repository name in the MTC web console.
										</li><li class="listitem">
											<span class="strong strong"><strong>Azure resource group</strong></span>: Specify the resource group of the Azure Blob storage.
										</li><li class="listitem">
											<span class="strong strong"><strong>Azure storage account name</strong></span>: Specify the Azure Blob storage account name.
										</li><li class="listitem">
											<span class="strong strong"><strong>Azure credentials - INI file contents</strong></span>: Specify the string in the <code class="literal">credentials-velero</code> file.
										</li></ul></div></li></ul></div></li><li class="listitem">
							Click <span class="strong strong"><strong>Add repository</strong></span> and wait for connection validation.
						</li><li class="listitem"><p class="simpara">
							Click <span class="strong strong"><strong>Close</strong></span>.
						</p><p class="simpara">
							The new repository appears in the <span class="strong strong"><strong>Replication repositories</strong></span> list.
						</p></li></ol></div></section><section class="section" id="migration-creating-migration-plan-cam_migrating-applications-3-4"><div class="titlepage"><div><div><h3 class="title">10.2.4. Creating a migration plan in the MTC web console</h3></div></div></div><p>
					You can create a migration plan in the Migration Toolkit for Containers (MTC) web console.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							You must be logged in as a user with <code class="literal">cluster-admin</code> privileges on all clusters.
						</li><li class="listitem">
							You must ensure that the same MTC version is installed on all clusters.
						</li><li class="listitem">
							You must add the clusters and the replication repository to the MTC web console.
						</li><li class="listitem">
							If you want to use the <span class="emphasis"><em>move</em></span> data copy method to migrate a persistent volume (PV), the source and target clusters must have uninterrupted network access to the remote volume.
						</li><li class="listitem">
							If you want to use direct image migration, you must specify the exposed route to the image registry of the source cluster. This can be done by using the MTC web console or by updating the <code class="literal">MigCluster</code> custom resource manifest.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							In the MTC web console, click <span class="strong strong"><strong>Migration plans</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add migration plan</strong></span>.
						</li><li class="listitem"><p class="simpara">
							Enter the <span class="strong strong"><strong>Plan name</strong></span>.
						</p><p class="simpara">
							The migration plan name must not exceed 253 lower-case alphanumeric characters (<code class="literal">a-z, 0-9</code>) and must not contain spaces or underscores (<code class="literal">_</code>).
						</p></li><li class="listitem">
							Select a <span class="strong strong"><strong>Source cluster</strong></span>, a <span class="strong strong"><strong>Target cluster</strong></span>, and a <span class="strong strong"><strong>Repository</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Next</strong></span>.
						</li><li class="listitem">
							Select the projects for migration.
						</li><li class="listitem">
							Optional: Click the edit icon beside a project to change the target namespace.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Next</strong></span>.
						</li><li class="listitem"><p class="simpara">
							Select a <span class="strong strong"><strong>Migration type</strong></span> for each PV:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									The <span class="strong strong"><strong>Copy</strong></span> option copies the data from the PV of a source cluster to the replication repository and then restores the data on a newly created PV, with similar characteristics, in the target cluster.
								</li><li class="listitem">
									The <span class="strong strong"><strong>Move</strong></span> option unmounts a remote volume, for example, NFS, from the source cluster, creates a PV resource on the target cluster pointing to the remote volume, and then mounts the remote volume on the target cluster. Applications running on the target cluster use the same remote volume that the source cluster was using.
								</li></ul></div></li><li class="listitem">
							Click <span class="strong strong"><strong>Next</strong></span>.
						</li><li class="listitem"><p class="simpara">
							Select a <span class="strong strong"><strong>Copy method</strong></span> for each PV:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									<span class="strong strong"><strong>Snapshot copy</strong></span> backs up and restores data using the cloud provider’s snapshot functionality. It is significantly faster than <span class="strong strong"><strong>Filesystem copy</strong></span>.
								</li><li class="listitem"><p class="simpara">
									<span class="strong strong"><strong>Filesystem copy</strong></span> backs up the files on the source cluster and restores them on the target cluster.
								</p><p class="simpara">
									The file system copy method is required for direct volume migration.
								</p></li></ul></div></li><li class="listitem">
							You can select <span class="strong strong"><strong>Verify copy</strong></span> to verify data migrated with <span class="strong strong"><strong>Filesystem copy</strong></span>. Data is verified by generating a checksum for each source file and checking the checksum after restoration. Data verification significantly reduces performance.
						</li><li class="listitem"><p class="simpara">
							Select a <span class="strong strong"><strong>Target storage class</strong></span>.
						</p><p class="simpara">
							If you selected <span class="strong strong"><strong>Filesystem copy</strong></span>, you can change the target storage class.
						</p></li><li class="listitem">
							Click <span class="strong strong"><strong>Next</strong></span>.
						</li><li class="listitem"><p class="simpara">
							On the <span class="strong strong"><strong>Migration options</strong></span> page, the <span class="strong strong"><strong>Direct image migration</strong></span> option is selected if you specified an exposed image registry route for the source cluster. The <span class="strong strong"><strong>Direct PV migration</strong></span> option is selected if you are migrating data with <span class="strong strong"><strong>Filesystem copy</strong></span>.
						</p><p class="simpara">
							The direct migration options copy images and files directly from the source cluster to the target cluster. This option is much faster than copying images and files from the source cluster to the replication repository and then from the replication repository to the target cluster.
						</p></li><li class="listitem">
							Click <span class="strong strong"><strong>Next</strong></span>.
						</li><li class="listitem"><p class="simpara">
							Optional: Click <span class="strong strong"><strong>Add Hook</strong></span> to add a hook to the migration plan.
						</p><p class="simpara">
							A hook runs custom code. You can add up to four hooks to a single migration plan. Each hook runs during a different migration step.
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									Enter the name of the hook to display in the web console.
								</li><li class="listitem">
									If the hook is an Ansible playbook, select <span class="strong strong"><strong>Ansible playbook</strong></span> and click <span class="strong strong"><strong>Browse</strong></span> to upload the playbook or paste the contents of the playbook in the field.
								</li><li class="listitem">
									Optional: Specify an Ansible runtime image if you are not using the default hook image.
								</li><li class="listitem"><p class="simpara">
									If the hook is not an Ansible playbook, select <span class="strong strong"><strong>Custom container image</strong></span> and specify the image name and path.
								</p><p class="simpara">
									A custom container image can include Ansible playbooks.
								</p></li><li class="listitem">
									Select <span class="strong strong"><strong>Source cluster</strong></span> or <span class="strong strong"><strong>Target cluster</strong></span>.
								</li><li class="listitem">
									Enter the <span class="strong strong"><strong>Service account name</strong></span> and the <span class="strong strong"><strong>Service account namespace</strong></span>.
								</li><li class="listitem"><p class="simpara">
									Select the migration step for the hook:
								</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
											<span class="strong strong"><strong>preBackup</strong></span>: Before the application workload is backed up on the source cluster
										</li><li class="listitem">
											<span class="strong strong"><strong>postBackup</strong></span>: After the application workload is backed up on the source cluster
										</li><li class="listitem">
											<span class="strong strong"><strong>preRestore</strong></span>: Before the application workload is restored on the target cluster
										</li><li class="listitem">
											<span class="strong strong"><strong>postRestore</strong></span>: After the application workload is restored on the target cluster
										</li></ul></div></li><li class="listitem">
									Click <span class="strong strong"><strong>Add</strong></span>.
								</li></ol></div></li><li class="listitem"><p class="simpara">
							Click <span class="strong strong"><strong>Finish</strong></span>.
						</p><p class="simpara">
							The migration plan is displayed in the <span class="strong strong"><strong>Migration plans</strong></span> list.
						</p></li></ol></div><h4 id="additional-resources-for-persistent-volume-copy-methods_migrating-applications-3-4">Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#file-system-copy-method_about-mtc-3-4">MTC file system copy method</a>
						</li><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#snapshot-copy-method_about-mtc-3-4">MTC snapshot copy method</a>
						</li></ul></div></section><section class="section" id="migration-running-migration-plan-cam_migrating-applications-3-4"><div class="titlepage"><div><div><h3 class="title">10.2.5. Running a migration plan in the MTC web console</h3></div></div></div><p>
					You can migrate applications and data with the migration plan you created in the Migration Toolkit for Containers (MTC) web console.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						During migration, MTC sets the reclaim policy of migrated persistent volumes (PVs) to <code class="literal">Retain</code> on the target cluster.
					</p><p>
						The <code class="literal">Backup</code> custom resource contains a <code class="literal">PVOriginalReclaimPolicy</code> annotation that indicates the original reclaim policy. You can manually restore the reclaim policy of the migrated PVs.
					</p></div></div><div class="formalpara"><p class="title"><strong>Prerequisites</strong></p><p>
						The MTC web console must contain the following:
					</p></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Source cluster in a <code class="literal">Ready</code> state
						</li><li class="listitem">
							Target cluster in a <code class="literal">Ready</code> state
						</li><li class="listitem">
							Replication repository
						</li><li class="listitem">
							Valid migration plan
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Log in to the MTC web console and click <span class="strong strong"><strong>Migration plans</strong></span>.
						</li><li class="listitem"><p class="simpara">
							Click the Options menu 
							<span class="inlinemediaobject"><img src="https://access.redhat.com/webassets/avalon/d/OpenShift_Container_Platform-4.13-Migrating_from_version_3_to_4-en-US/images/f468284ec3cc9bf27e6bd2c83849ca50/kebab.png" alt="kebab"/></span>
							 next to a migration plan and select one of the following options under <span class="strong strong"><strong>Migration</strong></span>:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									<span class="strong strong"><strong>Stage</strong></span> copies data from the source cluster to the target cluster without stopping the application.
								</li><li class="listitem"><p class="simpara">
									<span class="strong strong"><strong>Cutover</strong></span> stops the transactions on the source cluster and moves the resources to the target cluster.
								</p><p class="simpara">
									Optional: In the <span class="strong strong"><strong>Cutover migration</strong></span> dialog, you can clear the <span class="strong strong"><strong>Halt transactions on the source cluster during migration</strong></span> checkbox.
								</p></li><li class="listitem"><p class="simpara">
									<span class="strong strong"><strong>State</strong></span> copies selected persistent volume claims (PVCs).
								</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
										Do not use state migration to migrate a namespace between clusters. Use stage or cutover migration instead.
									</p></div></div><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
											Select one or more PVCs in the <span class="strong strong"><strong>State migration</strong></span> dialog and click <span class="strong strong"><strong>Migrate</strong></span>.
										</li></ul></div></li></ul></div></li><li class="listitem"><p class="simpara">
							When the migration is complete, verify that the application migrated successfully in the OpenShift Container Platform web console:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									Click <span class="strong strong"><strong>Home</strong></span> → <span class="strong strong"><strong>Projects</strong></span>.
								</li><li class="listitem">
									Click the migrated project to view its status.
								</li><li class="listitem">
									In the <span class="strong strong"><strong>Routes</strong></span> section, click <span class="strong strong"><strong>Location</strong></span> to verify that the application is functioning, if applicable.
								</li><li class="listitem">
									Click <span class="strong strong"><strong>Workloads</strong></span> → <span class="strong strong"><strong>Pods</strong></span> to verify that the pods are running in the migrated namespace.
								</li><li class="listitem">
									Click <span class="strong strong"><strong>Storage</strong></span> → <span class="strong strong"><strong>Persistent volumes</strong></span> to verify that the migrated persistent volumes are correctly provisioned.
								</li></ol></div></li></ol></div></section></section></section><section class="chapter" id="advanced-migration-options-3-4"><div class="titlepage"><div><div><h1 class="title">Chapter 11. Advanced migration options</h1></div></div></div><p>
			You can automate your migrations and modify the <code class="literal">MigPlan</code> and <code class="literal">MigrationController</code> custom resources in order to perform large-scale migrations and to improve performance.
		</p><section class="section" id="migration-terminology_advanced-migration-options-3-4"><div class="titlepage"><div><div><h2 class="title">11.1. Terminology</h2></div></div></div><div class="table" id="idm139748680602800"><p class="title"><strong>Table 11.1. MTC terminology</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 25%; " class="col_1"><!--Empty--></col><col style="width: 75%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139748680597968" scope="col">Term</th><th align="left" valign="top" id="idm139748680596880" scope="col">Definition</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139748680597968"> <p>
								Source cluster
							</p>
							 </td><td align="left" valign="top" headers="idm139748680596880"> <p>
								Cluster from which the applications are migrated.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139748680597968"> <p>
								Destination cluster<sup>[1]</sup>
							</p>
							 </td><td align="left" valign="top" headers="idm139748680596880"> <p>
								Cluster to which the applications are migrated.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139748680597968"> <p>
								Replication repository
							</p>
							 </td><td align="left" valign="top" headers="idm139748680596880"> <p>
								Object storage used for copying images, volumes, and Kubernetes objects during indirect migration or for Kubernetes objects during direct volume migration or direct image migration.
							</p>
							 <p>
								The replication repository must be accessible to all clusters.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139748680597968"> <p>
								Host cluster
							</p>
							 </td><td align="left" valign="top" headers="idm139748680596880"> <p>
								Cluster on which the <code class="literal">migration-controller</code> pod and the web console are running. The host cluster is usually the destination cluster but this is not required.
							</p>
							 <p>
								The host cluster does not require an exposed registry route for direct image migration.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139748680597968"> <p>
								Remote cluster
							</p>
							 </td><td align="left" valign="top" headers="idm139748680596880"> <p>
								A remote cluster is usually the source cluster but this is not required.
							</p>
							 <p>
								A remote cluster requires a <code class="literal">Secret</code> custom resource that contains the <code class="literal">migration-controller</code> service account token.
							</p>
							 <p>
								A remote cluster requires an exposed secure registry route for direct image migration.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139748680597968"> <p>
								Indirect migration
							</p>
							 </td><td align="left" valign="top" headers="idm139748680596880"> <p>
								Images, volumes, and Kubernetes objects are copied from the source cluster to the replication repository and then from the replication repository to the destination cluster.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139748680597968"> <p>
								Direct volume migration
							</p>
							 </td><td align="left" valign="top" headers="idm139748680596880"> <p>
								Persistent volumes are copied directly from the source cluster to the destination cluster.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139748680597968"> <p>
								Direct image migration
							</p>
							 </td><td align="left" valign="top" headers="idm139748680596880"> <p>
								Images are copied directly from the source cluster to the destination cluster.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139748680597968"> <p>
								Stage migration
							</p>
							 </td><td align="left" valign="top" headers="idm139748680596880"> <p>
								Data is copied to the destination cluster without stopping the application.
							</p>
							 <p>
								Running a stage migration multiple times reduces the duration of the cutover migration.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139748680597968"> <p>
								Cutover migration
							</p>
							 </td><td align="left" valign="top" headers="idm139748680596880"> <p>
								The application is stopped on the source cluster and its resources are migrated to the destination cluster.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139748680597968"> <p>
								State migration
							</p>
							 </td><td align="left" valign="top" headers="idm139748680596880"> <p>
								Application state is migrated by copying specific persistent volume claims to the destination cluster.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139748680597968"> <p>
								Rollback migration
							</p>
							 </td><td align="left" valign="top" headers="idm139748680596880"> <p>
								Rollback migration rolls back a completed migration.
							</p>
							 </td></tr></tbody></table></div></div><p>
				<sup>1</sup> Called the <span class="emphasis"><em>target</em></span> cluster in the MTC web console.
			</p></section><section class="section" id="migration-migrating-applications-on-prem-to-cloud_advanced-migration-options-3-4"><div class="titlepage"><div><div><h2 class="title">11.2. Migrating an application from on-premises to a cloud-based cluster</h2></div></div></div><p>
				You can migrate from a source cluster that is behind a firewall to a cloud-based destination cluster by establishing a network tunnel between the two clusters. The <code class="literal">crane tunnel-api</code> command establishes such a tunnel by creating a VPN tunnel on the source cluster and then connecting to a VPN server running on the destination cluster. The VPN server is exposed to the client using a load balancer address on the destination cluster.
			</p><p>
				A service created on the destination cluster exposes the source cluster’s API to MTC, which is running on the destination cluster.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The system that creates the VPN tunnel must have access and be logged in to both clusters.
					</li><li class="listitem">
						It must be possible to create a load balancer on the destination cluster. Refer to your cloud provider to ensure this is possible.
					</li><li class="listitem">
						Have names prepared to assign to namespaces, on both the source cluster and the destination cluster, in which to run the VPN tunnel. These namespaces should not be created in advance. For information about namespace rules, see https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#dns-subdomain-names.
					</li><li class="listitem">
						When connecting multiple firewall-protected source clusters to the cloud cluster, each source cluster requires its own namespace.
					</li><li class="listitem">
						OpenVPN server is installed on the destination cluster.
					</li><li class="listitem">
						OpenVPN client is installed on the source cluster.
					</li><li class="listitem"><p class="simpara">
						When configuring the source cluster in MTC, the API URL takes the form of <code class="literal">https://proxied-cluster.&lt;namespace&gt;.svc.cluster.local:8443</code>.
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								If you use the API, see <span class="emphasis"><em>Create a MigCluster CR manifest for each remote cluster</em></span>.
							</li><li class="listitem">
								If you use the MTC web console, see <span class="emphasis"><em>Migrating your applications using the MTC web console</em></span>.
							</li></ul></div></li><li class="listitem">
						The MTC web console and Migration Controller must be installed on the target cluster.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Install the <code class="literal">crane</code> utility:
					</p><pre class="programlisting language-terminal">$ podman cp $(podman create registry.redhat.io/rhmtc/openshift-migration-controller-rhel8:v1.8):/crane ./</pre></li><li class="listitem">
						Log in remotely to a node on the source cluster and a node on the destination cluster.
					</li><li class="listitem"><p class="simpara">
						Obtain the cluster context for both clusters after logging in:
					</p><pre class="programlisting language-terminal">$ oc config view</pre></li><li class="listitem"><p class="simpara">
						Establish a tunnel by entering the following command on the command system:
					</p><pre class="programlisting language-terminal">$ crane tunnel-api [--namespace &lt;namespace&gt;] \
      --destination-context &lt;destination-cluster&gt; \
      --source-context &lt;source-cluster&gt;</pre><p class="simpara">
						If you don’t specify a namespace, the command uses the default value <code class="literal">openvpn</code>.
					</p><p class="simpara">
						For example:
					</p><pre class="programlisting language-terminal">$ crane tunnel-api --namespace my_tunnel \
      --destination-context openshift-migration/c131-e-us-east-containers-cloud-ibm-com/admin \
      --source-context default/192-168-122-171-nip-io:8443/admin</pre><div class="admonition tip"><div class="admonition_header">Tip</div><div><p>
						See all available parameters for the <code class="literal">crane tunnel-api</code> command by entering <code class="literal">crane tunnel-api --help</code>.
					</p></div></div><p class="simpara">
						The command generates TSL/SSL Certificates. This process might take several minutes. A message appears when the process completes.
					</p><p class="simpara">
						The OpenVPN server starts on the destination cluster and the OpenVPN client starts on the source cluster.
					</p><p class="simpara">
						After a few minutes, the load balancer resolves on the source node.
					</p><div class="admonition tip"><div class="admonition_header">Tip</div><div><p>
						You can view the log for the OpenVPN pods to check the status of this process by entering the following commands with root privileges:
					</p><pre class="programlisting language-terminal"># oc get po -n &lt;namespace&gt;</pre><div class="formalpara"><p class="title"><strong>Example output</strong></p><p>
							
<pre class="programlisting language-terminal">NAME            READY     STATUS      RESTARTS    AGE
&lt;pod_name&gt;    2/2       Running     0           44s</pre>

						</p></div><pre class="programlisting language-terminal"># oc logs -f -n &lt;namespace&gt; &lt;pod_name&gt; -c openvpn</pre><p>
						When the address of the load balancer is resolved, the message <code class="literal">Initialization Sequence Completed</code> appears at the end of the log.
					</p></div></div></li><li class="listitem"><p class="simpara">
						On the OpenVPN server, which is on a destination control node, verify that the <code class="literal">openvpn</code> service and the <code class="literal">proxied-cluster</code> service are running:
					</p><pre class="programlisting language-terminal">$ oc get service -n &lt;namespace&gt;</pre></li><li class="listitem"><p class="simpara">
						On the source node, get the service account (SA) token for the migration controller:
					</p><pre class="programlisting language-terminal"># oc sa get-token -n openshift-migration migration-controller</pre></li><li class="listitem"><p class="simpara">
						Open the MTC web console and add the source cluster, using the following values:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<span class="strong strong"><strong>Cluster name</strong></span>: The source cluster name.
							</li><li class="listitem">
								<span class="strong strong"><strong>URL</strong></span>: <code class="literal">proxied-cluster.&lt;namespace&gt;.svc.cluster.local:8443</code>. If you did not define a value for <code class="literal">&lt;namespace&gt;</code>, use <code class="literal">openvpn</code>.
							</li><li class="listitem">
								<span class="strong strong"><strong>Service account token</strong></span>: The token of the migration controller service account.
							</li><li class="listitem">
								<span class="strong strong"><strong>Exposed route host to image registry</strong></span>: <code class="literal">proxied-cluster.&lt;namespace&gt;.svc.cluster.local:5000</code>. If you did not define a value for <code class="literal">&lt;namespace&gt;</code>, use <code class="literal">openvpn</code>.
							</li></ul></div></li></ol></div><p>
				After MTC has successfully validated the connection, you can proceed to create and run a migration plan. The namespace for the source cluster should appear in the list of namespaces.
			</p><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						For information about creating a MigCluster CR manifest for each remote cluster, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-migrating-applications-api_advanced-migration-options-3-4">Migrating an application by using the MTC API</a>.
					</li><li class="listitem">
						For information about adding a cluster using the web console, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migrating-applications-mtc-web-console_migrating-applications-3-4">Migrating your applications by using the MTC web console</a>
					</li></ul></div></section><section class="section" id="migrating-applications-cli_advanced-migration-options-3-4"><div class="titlepage"><div><div><h2 class="title">11.3. Migrating applications by using the command line</h2></div></div></div><p>
				You can migrate applications with the MTC API by using the command line interface (CLI) in order to automate the migration.
			</p><section class="section" id="migration-prerequisites_advanced-migration-options-3-4"><div class="titlepage"><div><div><h3 class="title">11.3.1. Migration prerequisites</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							You must be logged in as a user with <code class="literal">cluster-admin</code> privileges on all clusters.
						</li></ul></div><div class="itemizedlist"><p class="title"><strong>Direct image migration</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							You must ensure that the secure OpenShift image registry of the source cluster is exposed.
						</li><li class="listitem">
							You must create a route to the exposed registry.
						</li></ul></div><div class="itemizedlist"><p class="title"><strong>Direct volume migration</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							If your clusters use proxies, you must configure an Stunnel TCP proxy.
						</li></ul></div><div class="itemizedlist"><p class="title"><strong>Internal images</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							If your application uses internal images from the <code class="literal">openshift</code> namespace, you must ensure that the required versions of the images are present on the target cluster.
						</p><p class="simpara">
							You can manually update an image stream tag in order to use a deprecated OpenShift Container Platform 3 image on an OpenShift Container Platform 4.13 cluster.
						</p></li></ul></div><div class="itemizedlist"><p class="title"><strong>Clusters</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							The source cluster must be upgraded to the latest MTC z-stream release.
						</li><li class="listitem">
							The MTC version must be the same on all clusters.
						</li></ul></div><div class="itemizedlist"><p class="title"><strong>Network</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							The clusters have unrestricted network access to each other and to the replication repository.
						</li><li class="listitem">
							If you copy the persistent volumes with <code class="literal">move</code>, the clusters must have unrestricted network access to the remote volumes.
						</li><li class="listitem"><p class="simpara">
							You must enable the following ports on an OpenShift Container Platform 3 cluster:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									<code class="literal">8443</code> (API server)
								</li><li class="listitem">
									<code class="literal">443</code> (routes)
								</li><li class="listitem">
									<code class="literal">53</code> (DNS)
								</li></ul></div></li><li class="listitem"><p class="simpara">
							You must enable the following ports on an OpenShift Container Platform 4 cluster:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									<code class="literal">6443</code> (API server)
								</li><li class="listitem">
									<code class="literal">443</code> (routes)
								</li><li class="listitem">
									<code class="literal">53</code> (DNS)
								</li></ul></div></li><li class="listitem">
							You must enable port <code class="literal">443</code> on the replication repository if you are using TLS.
						</li></ul></div><div class="itemizedlist"><p class="title"><strong>Persistent volumes (PVs)</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							The PVs must be valid.
						</li><li class="listitem">
							The PVs must be bound to persistent volume claims.
						</li><li class="listitem"><p class="simpara">
							If you use snapshots to copy the PVs, the following additional prerequisites apply:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									The cloud provider must support snapshots.
								</li><li class="listitem">
									The PVs must have the same cloud provider.
								</li><li class="listitem">
									The PVs must be located in the same geographic region.
								</li><li class="listitem">
									The PVs must have the same storage class.
								</li></ul></div></li></ul></div></section><section class="section" id="migration-creating-registry-route-for-dim_advanced-migration-options-3-4"><div class="titlepage"><div><div><h3 class="title">11.3.2. Creating a registry route for direct image migration</h3></div></div></div><p>
					For direct image migration, you must create a route to the exposed OpenShift image registry on all remote clusters.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							The OpenShift image registry must be exposed to external traffic on all remote clusters.
						</p><p class="simpara">
							The OpenShift Container Platform 4 registry is exposed by default.
						</p><p class="simpara">
							The OpenShift Container Platform 3 registry must be <a class="link" href="https://docs.openshift.com/container-platform/3.11/install_config/registry/securing_and_exposing_registry.html#exposing-the-registry">exposed manually</a>.
						</p></li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							To create a route to an OpenShift Container Platform 3 registry, run the following command:
						</p><pre class="programlisting language-terminal">$ oc create route passthrough --service=docker-registry -n default</pre></li><li class="listitem"><p class="simpara">
							To create a route to an OpenShift Container Platform 4 registry, run the following command:
						</p><pre class="programlisting language-terminal">$ oc create route passthrough --service=image-registry -n openshift-image-registry</pre></li></ul></div></section><section class="section" id="migration-about-configuring-proxies_advanced-migration-options-3-4"><div class="titlepage"><div><div><h3 class="title">11.3.3. Proxy configuration</h3></div></div></div><p>
					For OpenShift Container Platform 4.1 and earlier versions, you must configure proxies in the <code class="literal">MigrationController</code> custom resource (CR) manifest after you install the Migration Toolkit for Containers Operator because these versions do not support a cluster-wide <code class="literal">proxy</code> object.
				</p><p>
					For OpenShift Container Platform 4.2 to 4.13, the Migration Toolkit for Containers (MTC) inherits the cluster-wide proxy settings. You can change the proxy parameters if you want to override the cluster-wide proxy settings.
				</p><section class="section" id="direct-volume-migration_advanced-migration-options-3-4"><div class="titlepage"><div><div><h4 class="title">11.3.3.1. Direct volume migration</h4></div></div></div><p>
						Direct Volume Migration (DVM) was introduced in MTC 1.4.2. DVM supports only one proxy. The source cluster cannot access the route of the target cluster if the target cluster is also behind a proxy.
					</p><p>
						If you want to perform a DVM from a source cluster behind a proxy, you must configure a TCP proxy that works at the transport layer and forwards the SSL connections transparently without decrypting and re-encrypting them with their own SSL certificates. A Stunnel proxy is an example of such a proxy.
					</p><section class="section" id="tcp-proxy-setup-for-dvm_advanced-migration-options-3-4"><div class="titlepage"><div><div><h5 class="title">11.3.3.1.1. TCP proxy setup for DVM</h5></div></div></div><p>
							You can set up a direct connection between the source and the target cluster through a TCP proxy and configure the <code class="literal">stunnel_tcp_proxy</code> variable in the <code class="literal">MigrationController</code> CR to use the proxy:
						</p><pre class="programlisting language-yaml">apiVersion: migration.openshift.io/v1alpha1
kind: MigrationController
metadata:
  name: migration-controller
  namespace: openshift-migration
spec:
  [...]
  stunnel_tcp_proxy: http://username:password@ip:port</pre><p>
							Direct volume migration (DVM) supports only basic authentication for the proxy. Moreover, DVM works only from behind proxies that can tunnel a TCP connection transparently. HTTP/HTTPS proxies in man-in-the-middle mode do not work. The existing cluster-wide proxies might not support this behavior. As a result, the proxy settings for DVM are intentionally kept different from the usual proxy configuration in MTC.
						</p></section><section class="section" id="why-tcp-proxy-instead-of-an-http-https-proxy_advanced-migration-options-3-4"><div class="titlepage"><div><div><h5 class="title">11.3.3.1.2. Why use a TCP proxy instead of an HTTP/HTTPS proxy?</h5></div></div></div><p>
							You can enable DVM by running Rsync between the source and the target cluster over an OpenShift route. Traffic is encrypted using Stunnel, a TCP proxy. The Stunnel running on the source cluster initiates a TLS connection with the target Stunnel and transfers data over an encrypted channel.
						</p><p>
							Cluster-wide HTTP/HTTPS proxies in OpenShift are usually configured in man-in-the-middle mode where they negotiate their own TLS session with the outside servers. However, this does not work with Stunnel. Stunnel requires that its TLS session be untouched by the proxy, essentially making the proxy a transparent tunnel which simply forwards the TCP connection as-is. Therefore, you must use a TCP proxy.
						</p></section><section class="section" id="dvm-known-issues_advanced-migration-options-3-4"><div class="titlepage"><div><div><h5 class="title">11.3.3.1.3. Known issue</h5></div></div></div><div class="formalpara"><p class="title"><strong>Migration fails with error <code class="literal">Upgrade request required</code></strong></p><p>
								The migration Controller uses the SPDY protocol to execute commands within remote pods. If the remote cluster is behind a proxy or a firewall that does not support the SPDY protocol, the migration controller fails to execute remote commands. The migration fails with the error message <code class="literal">Upgrade request required</code>. Workaround: Use a proxy that supports the SPDY protocol.
							</p></div><p>
							In addition to supporting the SPDY protocol, the proxy or firewall also must pass the <code class="literal">Upgrade</code> HTTP header to the API server. The client uses this header to open a websocket connection with the API server. If the <code class="literal">Upgrade</code> header is blocked by the proxy or firewall, the migration fails with the error message <code class="literal">Upgrade request required</code>. Workaround: Ensure that the proxy forwards the <code class="literal">Upgrade</code> header.
						</p></section></section><section class="section" id="tuning-network-policies-for-migrations_advanced-migration-options-3-4"><div class="titlepage"><div><div><h4 class="title">11.3.3.2. Tuning network policies for migrations</h4></div></div></div><p>
						OpenShift supports restricting traffic to or from pods using <span class="emphasis"><em>NetworkPolicy</em></span> or <span class="emphasis"><em>EgressFirewalls</em></span> based on the network plugin used by the cluster. If any of the source namespaces involved in a migration use such mechanisms to restrict network traffic to pods, the restrictions might inadvertently stop traffic to Rsync pods during migration.
					</p><p>
						Rsync pods running on both the source and the target clusters must connect to each other over an OpenShift Route. Existing <span class="emphasis"><em>NetworkPolicy</em></span> or <span class="emphasis"><em>EgressNetworkPolicy</em></span> objects can be configured to automatically exempt Rsync pods from these traffic restrictions.
					</p><section class="section" id="dvm-network-policy-configuration_advanced-migration-options-3-4"><div class="titlepage"><div><div><h5 class="title">11.3.3.2.1. NetworkPolicy configuration</h5></div></div></div><section class="section" id="egress-traffic-from-rsync-pods_advanced-migration-options-3-4"><div class="titlepage"><div><div><h6 class="title">11.3.3.2.1.1. Egress traffic from Rsync pods</h6></div></div></div><p>
								You can use the unique labels of Rsync pods to allow egress traffic to pass from them if the <code class="literal">NetworkPolicy</code> configuration in the source or destination namespaces blocks this type of traffic. The following policy allows <span class="strong strong"><strong>all</strong></span> egress traffic from Rsync pods in the namespace:
							</p><pre class="programlisting language-yaml">apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-all-egress-from-rsync-pods
spec:
  podSelector:
    matchLabels:
      owner: directvolumemigration
      app: directvolumemigration-rsync-transfer
  egress:
  - {}
  policyTypes:
  - Egress</pre></section><section class="section" id="ingress-traffic-to-rsync-pods_advanced-migration-options-3-4"><div class="titlepage"><div><div><h6 class="title">11.3.3.2.1.2. Ingress traffic to Rsync pods</h6></div></div></div><pre class="programlisting language-yaml">apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-all-egress-from-rsync-pods
spec:
  podSelector:
    matchLabels:
      owner: directvolumemigration
      app: directvolumemigration-rsync-transfer
  ingress:
  - {}
  policyTypes:
  - Ingress</pre></section></section><section class="section" id="egressnetworkpolicy-config_advanced-migration-options-3-4"><div class="titlepage"><div><div><h5 class="title">11.3.3.2.2. EgressNetworkPolicy configuration</h5></div></div></div><p>
							The <code class="literal">EgressNetworkPolicy</code> object or <span class="emphasis"><em>Egress Firewalls</em></span> are OpenShift constructs designed to block egress traffic leaving the cluster.
						</p><p>
							Unlike the <code class="literal">NetworkPolicy</code> object, the Egress Firewall works at a project level because it applies to all pods in the namespace. Therefore, the unique labels of Rsync pods do not exempt only Rsync pods from the restrictions. However, you can add the CIDR ranges of the source or target cluster to the <span class="emphasis"><em>Allow</em></span> rule of the policy so that a direct connection can be setup between two clusters.
						</p><p>
							Based on which cluster the Egress Firewall is present in, you can add the CIDR range of the other cluster to allow egress traffic between the two:
						</p><pre class="programlisting language-yaml">apiVersion: network.openshift.io/v1
kind: EgressNetworkPolicy
metadata:
  name: test-egress-policy
  namespace: &lt;namespace&gt;
spec:
  egress:
  - to:
      cidrSelector: &lt;cidr_of_source_or_target_cluster&gt;
    type: Deny</pre></section><section class="section" id="choosing-alternate-endpoints-for-data-transfer_advanced-migration-options-3-4"><div class="titlepage"><div><div><h5 class="title">11.3.3.2.3. Choosing alternate endpoints for data transfer</h5></div></div></div><p>
							By default, DVM uses an OpenShift Container Platform route as an endpoint to transfer PV data to destination clusters. You can choose another type of supported endpoint, if cluster topologies allow.
						</p><p>
							For each cluster, you can configure an endpoint by setting the <code class="literal">rsync_endpoint_type</code> variable on the appropriate <span class="strong strong"><strong>destination</strong></span> cluster in your <code class="literal">MigrationController</code> CR:
						</p><pre class="programlisting language-yaml">apiVersion: migration.openshift.io/v1alpha1
kind: MigrationController
metadata:
  name: migration-controller
  namespace: openshift-migration
spec:
  [...]
  rsync_endpoint_type: [NodePort|ClusterIP|Route]</pre></section><section class="section" id="configuring-supplemental-groups-for-rsync-pods_advanced-migration-options-3-4"><div class="titlepage"><div><div><h5 class="title">11.3.3.2.4. Configuring supplemental groups for Rsync pods</h5></div></div></div><p>
							When your PVCs use a shared storage, you can configure the access to that storage by adding supplemental groups to Rsync pod definitions in order for the pods to allow access:
						</p><div class="table" id="idm139748681320240"><p class="title"><strong>Table 11.2. Supplementary groups for Rsync pods</strong></p><div class="table-contents"><table class="gt-4-cols lt-7-rows"><colgroup><col style="width: 25%; " class="col_1"><!--Empty--></col><col style="width: 25%; " class="col_2"><!--Empty--></col><col style="width: 25%; " class="col_3"><!--Empty--></col><col style="width: 25%; " class="col_4"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139748681313536" scope="col">Variable</th><th align="left" valign="top" id="idm139748681312448" scope="col">Type</th><th align="left" valign="top" id="idm139748681311360" scope="col">Default</th><th align="left" valign="top" id="idm139748681310272" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139748681313536"> <p>
											<code class="literal">src_supplemental_groups</code>
										</p>
										 </td><td align="left" valign="top" headers="idm139748681312448"> <p>
											string
										</p>
										 </td><td align="left" valign="top" headers="idm139748681311360"> <p>
											Not set
										</p>
										 </td><td align="left" valign="top" headers="idm139748681310272"> <p>
											Comma-separated list of supplemental groups for source Rsync pods
										</p>
										 </td></tr><tr><td align="left" valign="top" headers="idm139748681313536"> <p>
											<code class="literal">target_supplemental_groups</code>
										</p>
										 </td><td align="left" valign="top" headers="idm139748681312448"> <p>
											string
										</p>
										 </td><td align="left" valign="top" headers="idm139748681311360"> <p>
											Not set
										</p>
										 </td><td align="left" valign="top" headers="idm139748681310272"> <p>
											Comma-separated list of supplemental groups for target Rsync pods
										</p>
										 </td></tr></tbody></table></div></div><div class="formalpara"><p class="title"><strong>Example usage</strong></p><p>
								The <code class="literal">MigrationController</code> CR can be updated to set values for these supplemental groups:
							</p></div><pre class="programlisting language-yaml">spec:
  src_supplemental_groups: "1000,2000"
  target_supplemental_groups: "2000,3000"</pre></section></section><section class="section" id="migration-configuring-proxies_advanced-migration-options-3-4"><div class="titlepage"><div><div><h4 class="title">11.3.3.3. Configuring proxies</h4></div></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
								You must be logged in as a user with <code class="literal">cluster-admin</code> privileges on all clusters.
							</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
								Get the <code class="literal">MigrationController</code> CR manifest:
							</p><pre class="programlisting language-terminal">$ oc get migrationcontroller &lt;migration_controller&gt; -n openshift-migration</pre></li><li class="listitem"><p class="simpara">
								Update the proxy parameters:
							</p><pre class="programlisting language-yaml">apiVersion: migration.openshift.io/v1alpha1
kind: MigrationController
metadata:
  name: &lt;migration_controller&gt;
  namespace: openshift-migration
...
spec:
  stunnel_tcp_proxy: http://&lt;username&gt;:&lt;password&gt;@&lt;ip&gt;:&lt;port&gt; <span id="CO10-1"><!--Empty--></span><span class="callout">1</span>
  noProxy: example.com <span id="CO10-2"><!--Empty--></span><span class="callout">2</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO10-1"><span class="callout">1</span></a> </dt><dd><div class="para">
										Stunnel proxy URL for direct volume migration.
									</div></dd><dt><a href="#CO10-2"><span class="callout">2</span></a> </dt><dd><div class="para">
										Comma-separated list of destination domain names, domains, IP addresses, or other network CIDRs to exclude proxying.
									</div></dd></dl></div><p class="simpara">
								Preface a domain with <code class="literal">.</code> to match subdomains only. For example, <code class="literal">.y.com</code> matches <code class="literal">x.y.com</code>, but not <code class="literal">y.com</code>. Use <code class="literal">*</code> to bypass proxy for all destinations. If you scale up workers that are not included in the network defined by the <code class="literal">networking.machineNetwork[].cidr</code> field from the installation configuration, you must add them to this list to prevent connection issues.
							</p><p class="simpara">
								This field is ignored if neither the <code class="literal">httpProxy</code> nor the <code class="literal">httpsProxy</code> field is set.
							</p></li><li class="listitem">
								Save the manifest as <code class="literal">migration-controller.yaml</code>.
							</li><li class="listitem"><p class="simpara">
								Apply the updated manifest:
							</p><pre class="programlisting language-terminal">$ oc replace -f migration-controller.yaml -n openshift-migration</pre></li></ol></div></section></section><section class="section" id="migration-migrating-applications-api_advanced-migration-options-3-4"><div class="titlepage"><div><div><h3 class="title">11.3.4. Migrating an application by using the MTC API</h3></div></div></div><p>
					You can migrate an application from the command line by using the Migration Toolkit for Containers (MTC) API.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">MigCluster</code> CR manifest for the host cluster:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: migration.openshift.io/v1alpha1
kind: MigCluster
metadata:
  name: &lt;host_cluster&gt;
  namespace: openshift-migration
spec:
  isHostCluster: true
EOF</pre></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">Secret</code> object manifest for each remote cluster:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: &lt;cluster_secret&gt;
  namespace: openshift-config
type: Opaque
data:
  saToken: &lt;sa_token&gt; <span id="CO11-1"><!--Empty--></span><span class="callout">1</span>
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO11-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specify the base64-encoded <code class="literal">migration-controller</code> service account (SA) token of the remote cluster. You can obtain the token by running the following command:
								</div></dd></dl></div><pre class="programlisting language-terminal">$ oc sa get-token migration-controller -n openshift-migration | base64 -w 0</pre></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">MigCluster</code> CR manifest for each remote cluster:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: migration.openshift.io/v1alpha1
kind: MigCluster
metadata:
  name: &lt;remote_cluster&gt; <span id="CO12-1"><!--Empty--></span><span class="callout">1</span>
  namespace: openshift-migration
spec:
  exposedRegistryPath: &lt;exposed_registry_route&gt; <span id="CO12-2"><!--Empty--></span><span class="callout">2</span>
  insecure: false <span id="CO12-3"><!--Empty--></span><span class="callout">3</span>
  isHostCluster: false
  serviceAccountSecretRef:
    name: &lt;remote_cluster_secret&gt; <span id="CO12-4"><!--Empty--></span><span class="callout">4</span>
    namespace: openshift-config
  url: &lt;remote_cluster_url&gt; <span id="CO12-5"><!--Empty--></span><span class="callout">5</span>
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO12-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specify the <code class="literal">Cluster</code> CR of the remote cluster.
								</div></dd><dt><a href="#CO12-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Optional: For direct image migration, specify the exposed registry route.
								</div></dd><dt><a href="#CO12-3"><span class="callout">3</span></a> </dt><dd><div class="para">
									SSL verification is enabled if <code class="literal">false</code>. CA certificates are not required or checked if <code class="literal">true</code>.
								</div></dd><dt><a href="#CO12-4"><span class="callout">4</span></a> </dt><dd><div class="para">
									Specify the <code class="literal">Secret</code> object of the remote cluster.
								</div></dd><dt><a href="#CO12-5"><span class="callout">5</span></a> </dt><dd><div class="para">
									Specify the URL of the remote cluster.
								</div></dd></dl></div></li><li class="listitem"><p class="simpara">
							Verify that all clusters are in a <code class="literal">Ready</code> state:
						</p><pre class="programlisting language-terminal">$ oc describe cluster &lt;cluster&gt;</pre></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">Secret</code> object manifest for the replication repository:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: v1
kind: Secret
metadata:
  namespace: openshift-config
  name: &lt;migstorage_creds&gt;
type: Opaque
data:
  aws-access-key-id: &lt;key_id_base64&gt; <span id="CO13-1"><!--Empty--></span><span class="callout">1</span>
  aws-secret-access-key: &lt;secret_key_base64&gt; <span id="CO13-2"><!--Empty--></span><span class="callout">2</span>
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO13-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specify the key ID in base64 format.
								</div></dd><dt><a href="#CO13-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Specify the secret key in base64 format.
								</div></dd></dl></div><p class="simpara">
							AWS credentials are base64-encoded by default. For other storage providers, you must encode your credentials by running the following command with each key:
						</p><pre class="programlisting language-terminal">$ echo -n "&lt;key&gt;" | base64 -w 0 <span id="CO14-1"><!--Empty--></span><span class="callout">1</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO14-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specify the key ID or the secret key. Both keys must be base64-encoded.
								</div></dd></dl></div></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">MigStorage</code> CR manifest for the replication repository:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: migration.openshift.io/v1alpha1
kind: MigStorage
metadata:
  name: &lt;migstorage&gt;
  namespace: openshift-migration
spec:
  backupStorageConfig:
    awsBucketName: &lt;bucket&gt; <span id="CO15-1"><!--Empty--></span><span class="callout">1</span>
    credsSecretRef:
      name: &lt;storage_secret&gt; <span id="CO15-2"><!--Empty--></span><span class="callout">2</span>
      namespace: openshift-config
  backupStorageProvider: &lt;storage_provider&gt; <span id="CO15-3"><!--Empty--></span><span class="callout">3</span>
  volumeSnapshotConfig:
    credsSecretRef:
      name: &lt;storage_secret&gt; <span id="CO15-4"><!--Empty--></span><span class="callout">4</span>
      namespace: openshift-config
  volumeSnapshotProvider: &lt;storage_provider&gt; <span id="CO15-5"><!--Empty--></span><span class="callout">5</span>
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO15-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specify the bucket name.
								</div></dd><dt><a href="#CO15-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Specify the <code class="literal">Secrets</code> CR of the object storage. You must ensure that the credentials stored in the <code class="literal">Secrets</code> CR of the object storage are correct.
								</div></dd><dt><a href="#CO15-3"><span class="callout">3</span></a> </dt><dd><div class="para">
									Specify the storage provider.
								</div></dd><dt><a href="#CO15-4"><span class="callout">4</span></a> </dt><dd><div class="para">
									Optional: If you are copying data by using snapshots, specify the <code class="literal">Secrets</code> CR of the object storage. You must ensure that the credentials stored in the <code class="literal">Secrets</code> CR of the object storage are correct.
								</div></dd><dt><a href="#CO15-5"><span class="callout">5</span></a> </dt><dd><div class="para">
									Optional: If you are copying data by using snapshots, specify the storage provider.
								</div></dd></dl></div></li><li class="listitem"><p class="simpara">
							Verify that the <code class="literal">MigStorage</code> CR is in a <code class="literal">Ready</code> state:
						</p><pre class="programlisting language-terminal">$ oc describe migstorage &lt;migstorage&gt;</pre></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">MigPlan</code> CR manifest:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: migration.openshift.io/v1alpha1
kind: MigPlan
metadata:
  name: &lt;migplan&gt;
  namespace: openshift-migration
spec:
  destMigClusterRef:
    name: &lt;host_cluster&gt;
    namespace: openshift-migration
  indirectImageMigration: true <span id="CO16-1"><!--Empty--></span><span class="callout">1</span>
  indirectVolumeMigration: true <span id="CO16-2"><!--Empty--></span><span class="callout">2</span>
  migStorageRef:
    name: &lt;migstorage&gt; <span id="CO16-3"><!--Empty--></span><span class="callout">3</span>
    namespace: openshift-migration
  namespaces:
    - &lt;source_namespace_1&gt; <span id="CO16-4"><!--Empty--></span><span class="callout">4</span>
    - &lt;source_namespace_2&gt;
    - &lt;source_namespace_3&gt;:&lt;destination_namespace&gt; <span id="CO16-5"><!--Empty--></span><span class="callout">5</span>
  srcMigClusterRef:
    name: &lt;remote_cluster&gt; <span id="CO16-6"><!--Empty--></span><span class="callout">6</span>
    namespace: openshift-migration
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO16-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Direct image migration is enabled if <code class="literal">false</code>.
								</div></dd><dt><a href="#CO16-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Direct volume migration is enabled if <code class="literal">false</code>.
								</div></dd><dt><a href="#CO16-3"><span class="callout">3</span></a> </dt><dd><div class="para">
									Specify the name of the <code class="literal">MigStorage</code> CR instance.
								</div></dd><dt><a href="#CO16-4"><span class="callout">4</span></a> </dt><dd><div class="para">
									Specify one or more source namespaces. By default, the destination namespace has the same name.
								</div></dd><dt><a href="#CO16-5"><span class="callout">5</span></a> </dt><dd><div class="para">
									Specify a destination namespace if it is different from the source namespace.
								</div></dd><dt><a href="#CO16-6"><span class="callout">6</span></a> </dt><dd><div class="para">
									Specify the name of the source cluster <code class="literal">MigCluster</code> instance.
								</div></dd></dl></div></li><li class="listitem"><p class="simpara">
							Verify that the <code class="literal">MigPlan</code> instance is in a <code class="literal">Ready</code> state:
						</p><pre class="programlisting language-terminal">$ oc describe migplan &lt;migplan&gt; -n openshift-migration</pre></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">MigMigration</code> CR manifest to start the migration defined in the <code class="literal">MigPlan</code> instance:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: migration.openshift.io/v1alpha1
kind: MigMigration
metadata:
  name: &lt;migmigration&gt;
  namespace: openshift-migration
spec:
  migPlanRef:
    name: &lt;migplan&gt; <span id="CO17-1"><!--Empty--></span><span class="callout">1</span>
    namespace: openshift-migration
  quiescePods: true <span id="CO17-2"><!--Empty--></span><span class="callout">2</span>
  stage: false <span id="CO17-3"><!--Empty--></span><span class="callout">3</span>
  rollback: false <span id="CO17-4"><!--Empty--></span><span class="callout">4</span>
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO17-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specify the <code class="literal">MigPlan</code> CR name.
								</div></dd><dt><a href="#CO17-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									The pods on the source cluster are stopped before migration if <code class="literal">true</code>.
								</div></dd><dt><a href="#CO17-3"><span class="callout">3</span></a> </dt><dd><div class="para">
									A stage migration, which copies most of the data without stopping the application, is performed if <code class="literal">true</code>.
								</div></dd><dt><a href="#CO17-4"><span class="callout">4</span></a> </dt><dd><div class="para">
									A completed migration is rolled back if <code class="literal">true</code>.
								</div></dd></dl></div></li><li class="listitem"><p class="simpara">
							Verify the migration by watching the <code class="literal">MigMigration</code> CR progress:
						</p><pre class="programlisting language-terminal">$ oc watch migmigration &lt;migmigration&gt; -n openshift-migration</pre><p class="simpara">
							The output resembles the following:
						</p><div class="formalpara"><p class="title"><strong>Example output</strong></p><p>
								
<pre class="programlisting language-text">Name:         c8b034c0-6567-11eb-9a4f-0bc004db0fbc
Namespace:    openshift-migration
Labels:       migration.openshift.io/migplan-name=django
Annotations:  openshift.io/touch: e99f9083-6567-11eb-8420-0a580a81020c
API Version:  migration.openshift.io/v1alpha1
Kind:         MigMigration
...
Spec:
  Mig Plan Ref:
    Name:       migplan
    Namespace:  openshift-migration
  Stage:        false
Status:
  Conditions:
    Category:              Advisory
    Last Transition Time:  2021-02-02T15:04:09Z
    Message:               Step: 19/47
    Reason:                InitialBackupCreated
    Status:                True
    Type:                  Running
    Category:              Required
    Last Transition Time:  2021-02-02T15:03:19Z
    Message:               The migration is ready.
    Status:                True
    Type:                  Ready
    Category:              Required
    Durable:               true
    Last Transition Time:  2021-02-02T15:04:05Z
    Message:               The migration registries are healthy.
    Status:                True
    Type:                  RegistriesHealthy
  Itinerary:               Final
  Observed Digest:         7fae9d21f15979c71ddc7dd075cb97061895caac5b936d92fae967019ab616d5
  Phase:                   InitialBackupCreated
  Pipeline:
    Completed:  2021-02-02T15:04:07Z
    Message:    Completed
    Name:       Prepare
    Started:    2021-02-02T15:03:18Z
    Message:    Waiting for initial Velero backup to complete.
    Name:       Backup
    Phase:      InitialBackupCreated
    Progress:
      Backup openshift-migration/c8b034c0-6567-11eb-9a4f-0bc004db0fbc-wpc44: 0 out of estimated total of 0 objects backed up (5s)
    Started:        2021-02-02T15:04:07Z
    Message:        Not started
    Name:           StageBackup
    Message:        Not started
    Name:           StageRestore
    Message:        Not started
    Name:           DirectImage
    Message:        Not started
    Name:           DirectVolume
    Message:        Not started
    Name:           Restore
    Message:        Not started
    Name:           Cleanup
  Start Timestamp:  2021-02-02T15:03:18Z
Events:
  Type    Reason   Age                 From                     Message
  ----    ------   ----                ----                     -------
  Normal  Running  57s                 migmigration_controller  Step: 2/47
  Normal  Running  57s                 migmigration_controller  Step: 3/47
  Normal  Running  57s (x3 over 57s)   migmigration_controller  Step: 4/47
  Normal  Running  54s                 migmigration_controller  Step: 5/47
  Normal  Running  54s                 migmigration_controller  Step: 6/47
  Normal  Running  52s (x2 over 53s)   migmigration_controller  Step: 7/47
  Normal  Running  51s (x2 over 51s)   migmigration_controller  Step: 8/47
  Normal  Ready    50s (x12 over 57s)  migmigration_controller  The migration is ready.
  Normal  Running  50s                 migmigration_controller  Step: 9/47
  Normal  Running  50s                 migmigration_controller  Step: 10/47</pre>

							</p></div></li></ol></div></section><section class="section" id="migration-state-migration-cli_advanced-migration-options-3-4"><div class="titlepage"><div><div><h3 class="title">11.3.5. State migration</h3></div></div></div><p>
					You can perform repeatable, state-only migrations by using Migration Toolkit for Containers (MTC) to migrate persistent volume claims (PVCs) that constitute an application’s state. You migrate specified PVCs by excluding other PVCs from the migration plan. You can map the PVCs to ensure that the source and the target PVCs are synchronized. Persistent volume (PV) data is copied to the target cluster. The PV references are not moved, and the application pods continue to run on the source cluster.
				</p><p>
					State migration is specifically designed to be used in conjunction with external CD mechanisms, such as OpenShift Gitops. You can migrate application manifests using GitOps while migrating the state using MTC.
				</p><p>
					If you have a CI/CD pipeline, you can migrate stateless components by deploying them on the target cluster. Then you can migrate stateful components by using MTC.
				</p><p>
					You can perform a state migration between clusters or within the same cluster.
				</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						State migration migrates only the components that constitute an application’s state. If you want to migrate an entire namespace, use stage or cutover migration.
					</p></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							The state of the application on the source cluster is persisted in <code class="literal">PersistentVolumes</code> provisioned through <code class="literal">PersistentVolumeClaims</code>.
						</li><li class="listitem">
							The manifests of the application are available in a central repository that is accessible from both the source and the target clusters.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Migrate persistent volume data from the source to the target cluster.
						</p><p class="simpara">
							You can perform this step as many times as needed. The source application continues running.
						</p></li><li class="listitem"><p class="simpara">
							Quiesce the source application.
						</p><p class="simpara">
							You can do this by setting the replicas of workload resources to <code class="literal">0</code>, either directly on the source cluster or by updating the manifests in GitHub and re-syncing the Argo CD application.
						</p></li><li class="listitem"><p class="simpara">
							Clone application manifests to the target cluster.
						</p><p class="simpara">
							You can use Argo CD to clone the application manifests to the target cluster.
						</p></li><li class="listitem"><p class="simpara">
							Migrate the remaining volume data from the source to the target cluster.
						</p><p class="simpara">
							Migrate any new data created by the application during the state migration process by performing a final data migration.
						</p></li><li class="listitem">
							If the cloned application is in a quiesced state, unquiesce it.
						</li><li class="listitem">
							Switch the DNS record to the target cluster to re-direct user traffic to the migrated application.
						</li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						MTC 1.6 cannot quiesce applications automatically when performing state migration. It can only migrate PV data. Therefore, you must use your CD mechanisms for quiescing or unquiescing applications.
					</p><p>
						MTC 1.7 introduces explicit Stage and Cutover flows. You can use staging to perform initial data transfers as many times as needed. Then you can perform a cutover, in which the source applications are quiesced automatically.
					</p></div></div><h4 id="additional-resources-for-state-migration_advanced-migration-options-3-4">Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							See <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-excluding-pvcs_advanced-migration-options-3-4">Excluding PVCs from migration</a> to select PVCs for state migration.
						</li><li class="listitem">
							See <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-mapping-pvcs_advanced-migration-options-3-4">Mapping PVCs</a> to migrate source PV data to provisioned PVCs on the destination cluster.
						</li><li class="listitem">
							See <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-kubernetes-objects_advanced-migration-options-3-4">Migrating Kubernetes objects</a> to migrate the Kubernetes objects that constitute an application’s state.
						</li></ul></div></section></section><section class="section" id="migration-hooks_advanced-migration-options-3-4"><div class="titlepage"><div><div><h2 class="title">11.4. Migration hooks</h2></div></div></div><p>
				You can add up to four migration hooks to a single migration plan, with each hook running at a different phase of the migration. Migration hooks perform tasks such as customizing application quiescence, manually migrating unsupported data types, and updating applications after migration.
			</p><p>
				A migration hook runs on a source or a target cluster at one of the following migration steps:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">PreBackup</code>: Before resources are backed up on the source cluster.
					</li><li class="listitem">
						<code class="literal">PostBackup</code>: After resources are backed up on the source cluster.
					</li><li class="listitem">
						<code class="literal">PreRestore</code>: Before resources are restored on the target cluster.
					</li><li class="listitem">
						<code class="literal">PostRestore</code>: After resources are restored on the target cluster.
					</li></ul></div><p>
				You can create a hook by creating an Ansible playbook that runs with the default Ansible image or with a custom hook container.
			</p><div class="formalpara"><p class="title"><strong>Ansible playbook</strong></p><p>
					The Ansible playbook is mounted on a hook container as a config map. The hook container runs as a job, using the cluster, service account, and namespace specified in the <code class="literal">MigPlan</code> custom resource. The job continues to run until it reaches the default limit of 6 retries or a successful completion. This continues even if the initial pod is evicted or killed.
				</p></div><p>
				The default Ansible runtime image is <code class="literal">registry.redhat.io/rhmtc/openshift-migration-hook-runner-rhel7:1.8</code>. This image is based on the Ansible Runner image and includes <code class="literal">python-openshift</code> for Ansible Kubernetes resources and an updated <code class="literal">oc</code> binary.
			</p><div class="formalpara"><p class="title"><strong>Custom hook container</strong></p><p>
					You can use a custom hook container instead of the default Ansible image.
				</p></div><section class="section" id="migration-writing-ansible-playbook-hook_advanced-migration-options-3-4"><div class="titlepage"><div><div><h3 class="title">11.4.1. Writing an Ansible playbook for a migration hook</h3></div></div></div><p>
					You can write an Ansible playbook to use as a migration hook. The hook is added to a migration plan by using the MTC web console or by specifying values for the <code class="literal">spec.hooks</code> parameters in the <code class="literal">MigPlan</code> custom resource (CR) manifest.
				</p><p>
					The Ansible playbook is mounted onto a hook container as a config map. The hook container runs as a job, using the cluster, service account, and namespace specified in the <code class="literal">MigPlan</code> CR. The hook container uses a specified service account token so that the tasks do not require authentication before they run in the cluster.
				</p><section class="section" id="migration-writing-ansible-playbook-hook-ansible-modules_advanced-migration-options-3-4"><div class="titlepage"><div><div><h4 class="title">11.4.1.1. Ansible modules</h4></div></div></div><p>
						You can use the Ansible <code class="literal">shell</code> module to run <code class="literal">oc</code> commands.
					</p><div class="formalpara"><p class="title"><strong>Example <code class="literal">shell</code> module</strong></p><p>
							
<pre class="programlisting language-yaml">- hosts: localhost
  gather_facts: false
  tasks:
  - name: get pod name
    shell: oc get po --all-namespaces</pre>

						</p></div><p>
						You can use <code class="literal">kubernetes.core</code> modules, such as <code class="literal">k8s_info</code>, to interact with Kubernetes resources.
					</p><div class="formalpara"><p class="title"><strong>Example <code class="literal">k8s_facts</code> module</strong></p><p>
							
<pre class="programlisting language-yaml">- hosts: localhost
  gather_facts: false
  tasks:
  - name: Get pod
    k8s_info:
      kind: pods
      api: v1
      namespace: openshift-migration
      name: "{{ lookup( 'env', 'HOSTNAME') }}"
    register: pods

  - name: Print pod name
    debug:
      msg: "{{ pods.resources[0].metadata.name }}"</pre>

						</p></div><p>
						You can use the <code class="literal">fail</code> module to produce a non-zero exit status in cases where a non-zero exit status would not normally be produced, ensuring that the success or failure of a hook is detected. Hooks run as jobs and the success or failure status of a hook is based on the exit status of the job container.
					</p><div class="formalpara"><p class="title"><strong>Example <code class="literal">fail</code> module</strong></p><p>
							
<pre class="programlisting language-yaml">- hosts: localhost
  gather_facts: false
  tasks:
  - name: Set a boolean
    set_fact:
      do_fail: true

  - name: "fail"
    fail:
      msg: "Cause a failure"
    when: do_fail</pre>

						</p></div></section><section class="section" id="migration-writing-ansible-playbook-hook-environment-variables_advanced-migration-options-3-4"><div class="titlepage"><div><div><h4 class="title">11.4.1.2. Environment variables</h4></div></div></div><p>
						The <code class="literal">MigPlan</code> CR name and migration namespaces are passed as environment variables to the hook container. These variables are accessed by using the <code class="literal">lookup</code> plugin.
					</p><div class="formalpara"><p class="title"><strong>Example environment variables</strong></p><p>
							
<pre class="programlisting language-yaml">- hosts: localhost
  gather_facts: false
  tasks:
  - set_fact:
      namespaces: "{{ (lookup( 'env', 'MIGRATION_NAMESPACES')).split(',') }}"

  - debug:
      msg: "{{ item }}"
    with_items: "{{ namespaces }}"

  - debug:
      msg: "{{ lookup( 'env', 'MIGRATION_PLAN_NAME') }}"</pre>

						</p></div></section></section></section><section class="section" id="migration-plan-options_advanced-migration-options-3-4"><div class="titlepage"><div><div><h2 class="title">11.5. Migration plan options</h2></div></div></div><p>
				You can exclude, edit, and map components in the <code class="literal">MigPlan</code> custom resource (CR).
			</p><section class="section" id="migration-excluding-resources_advanced-migration-options-3-4"><div class="titlepage"><div><div><h3 class="title">11.5.1. Excluding resources</h3></div></div></div><p>
					You can exclude resources, for example, image streams, persistent volumes (PVs), or subscriptions, from a Migration Toolkit for Containers (MTC) migration plan to reduce the resource load for migration or to migrate images or PVs with a different tool.
				</p><p>
					By default, the MTC excludes service catalog resources and Operator Lifecycle Manager (OLM) resources from migration. These resources are parts of the service catalog API group and the OLM API group, neither of which is supported for migration at this time.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Edit the <code class="literal">MigrationController</code> custom resource manifest:
						</p><pre class="programlisting language-terminal">$ oc edit migrationcontroller &lt;migration_controller&gt; -n openshift-migration</pre></li><li class="listitem"><p class="simpara">
							Update the <code class="literal">spec</code> section by adding parameters to exclude specific resources. For those resources that do not have their own exclusion parameters, add the <code class="literal">additional_excluded_resources</code> parameter:
						</p><pre class="programlisting language-yaml">apiVersion: migration.openshift.io/v1alpha1
kind: MigrationController
metadata:
  name: migration-controller
  namespace: openshift-migration
spec:
  disable_image_migration: true <span id="CO18-1"><!--Empty--></span><span class="callout">1</span>
  disable_pv_migration: true <span id="CO18-2"><!--Empty--></span><span class="callout">2</span>
  additional_excluded_resources: <span id="CO18-3"><!--Empty--></span><span class="callout">3</span>
  - resource1
  - resource2
  ...</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO18-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Add <code class="literal">disable_image_migration: true</code> to exclude image streams from the migration. <code class="literal">imagestreams</code> is added to the <code class="literal">excluded_resources</code> list in <code class="literal">main.yml</code> when the <code class="literal">MigrationController</code> pod restarts.
								</div></dd><dt><a href="#CO18-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Add <code class="literal">disable_pv_migration: true</code> to exclude PVs from the migration plan. <code class="literal">persistentvolumes</code> and <code class="literal">persistentvolumeclaims</code> are added to the <code class="literal">excluded_resources</code> list in <code class="literal">main.yml</code> when the <code class="literal">MigrationController</code> pod restarts. Disabling PV migration also disables PV discovery when you create the migration plan.
								</div></dd><dt><a href="#CO18-3"><span class="callout">3</span></a> </dt><dd><div class="para">
									You can add OpenShift Container Platform resources that you want to exclude to the <code class="literal">additional_excluded_resources</code> list.
								</div></dd></dl></div></li><li class="listitem">
							Wait two minutes for the <code class="literal">MigrationController</code> pod to restart so that the changes are applied.
						</li><li class="listitem"><p class="simpara">
							Verify that the resource is excluded:
						</p><pre class="programlisting language-terminal">$ oc get deployment -n openshift-migration migration-controller -o yaml | grep EXCLUDED_RESOURCES -A1</pre><p class="simpara">
							The output contains the excluded resources:
						</p><div class="formalpara"><p class="title"><strong>Example output</strong></p><p>
								
<pre class="programlisting language-yaml">name: EXCLUDED_RESOURCES
value:
resource1,resource2,imagetags,templateinstances,clusterserviceversions,packagemanifests,subscriptions,servicebrokers,servicebindings,serviceclasses,serviceinstances,serviceplans,imagestreams,persistentvolumes,persistentvolumeclaims</pre>

							</p></div></li></ol></div></section><section class="section" id="migration-mapping-destination-namespaces-in-the-migplan-cr_advanced-migration-options-3-4"><div class="titlepage"><div><div><h3 class="title">11.5.2. Mapping namespaces</h3></div></div></div><p>
					If you map namespaces in the <code class="literal">MigPlan</code> custom resource (CR), you must ensure that the namespaces are not duplicated on the source or the destination clusters because the UID and GID ranges of the namespaces are copied during migration.
				</p><div class="formalpara"><p class="title"><strong>Two source namespaces mapped to the same destination namespace</strong></p><p>
						
<pre class="programlisting language-yaml">spec:
  namespaces:
    - namespace_2
    - namespace_1:namespace_2</pre>

					</p></div><p>
					If you want the source namespace to be mapped to a namespace of the same name, you do not need to create a mapping. By default, a source namespace and a target namespace have the same name.
				</p><div class="formalpara"><p class="title"><strong>Incorrect namespace mapping</strong></p><p>
						
<pre class="programlisting language-yaml">spec:
  namespaces:
    - namespace_1:namespace_1</pre>

					</p></div><div class="formalpara"><p class="title"><strong>Correct namespace reference</strong></p><p>
						
<pre class="programlisting language-yaml">spec:
  namespaces:
    - namespace_1</pre>

					</p></div></section><section class="section" id="migration-excluding-pvcs_advanced-migration-options-3-4"><div class="titlepage"><div><div><h3 class="title">11.5.3. Excluding persistent volume claims</h3></div></div></div><p>
					You select persistent volume claims (PVCs) for state migration by excluding the PVCs that you do not want to migrate. You exclude PVCs by setting the <code class="literal">spec.persistentVolumes.pvc.selection.action</code> parameter of the <code class="literal">MigPlan</code> custom resource (CR) after the persistent volumes (PVs) have been discovered.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							<code class="literal">MigPlan</code> CR is in a <code class="literal">Ready</code> state.
						</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							Add the <code class="literal">spec.persistentVolumes.pvc.selection.action</code> parameter to the <code class="literal">MigPlan</code> CR and set it to <code class="literal">skip</code>:
						</p><pre class="programlisting language-yaml">apiVersion: migration.openshift.io/v1alpha1
kind: MigPlan
metadata:
  name: &lt;migplan&gt;
  namespace: openshift-migration
spec:
...
  persistentVolumes:
  - capacity: 10Gi
    name: &lt;pv_name&gt;
    pvc:
...
    selection:
      action: skip</pre></li></ul></div></section><section class="section" id="migration-mapping-pvcs_advanced-migration-options-3-4"><div class="titlepage"><div><div><h3 class="title">11.5.4. Mapping persistent volume claims</h3></div></div></div><p>
					You can migrate persistent volume (PV) data from the source cluster to persistent volume claims (PVCs) that are already provisioned in the destination cluster in the <code class="literal">MigPlan</code> CR by mapping the PVCs. This mapping ensures that the destination PVCs of migrated applications are synchronized with the source PVCs.
				</p><p>
					You map PVCs by updating the <code class="literal">spec.persistentVolumes.pvc.name</code> parameter in the <code class="literal">MigPlan</code> custom resource (CR) after the PVs have been discovered.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							<code class="literal">MigPlan</code> CR is in a <code class="literal">Ready</code> state.
						</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							Update the <code class="literal">spec.persistentVolumes.pvc.name</code> parameter in the <code class="literal">MigPlan</code> CR:
						</p><pre class="programlisting language-yaml">apiVersion: migration.openshift.io/v1alpha1
kind: MigPlan
metadata:
  name: &lt;migplan&gt;
  namespace: openshift-migration
spec:
...
  persistentVolumes:
  - capacity: 10Gi
    name: &lt;pv_name&gt;
    pvc:
      name: &lt;source_pvc&gt;:&lt;destination_pvc&gt; <span id="CO19-1"><!--Empty--></span><span class="callout">1</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO19-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specify the PVC on the source cluster and the PVC on the destination cluster. If the destination PVC does not exist, it will be created. You can use this mapping to change the PVC name during migration.
								</div></dd></dl></div></li></ul></div></section><section class="section" id="migration-editing-pvs-in-migplan_advanced-migration-options-3-4"><div class="titlepage"><div><div><h3 class="title">11.5.5. Editing persistent volume attributes</h3></div></div></div><p>
					After you create a <code class="literal">MigPlan</code> custom resource (CR), the <code class="literal">MigrationController</code> CR discovers the persistent volumes (PVs). The <code class="literal">spec.persistentVolumes</code> block and the <code class="literal">status.destStorageClasses</code> block are added to the <code class="literal">MigPlan</code> CR.
				</p><p>
					You can edit the values in the <code class="literal">spec.persistentVolumes.selection</code> block. If you change values outside the <code class="literal">spec.persistentVolumes.selection</code> block, the values are overwritten when the <code class="literal">MigPlan</code> CR is reconciled by the <code class="literal">MigrationController</code> CR.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						The default value for the <code class="literal">spec.persistentVolumes.selection.storageClass</code> parameter is determined by the following logic:
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								If the source cluster PV is Gluster or NFS, the default is either <code class="literal">cephfs</code>, for <code class="literal">accessMode: ReadWriteMany</code>, or <code class="literal">cephrbd</code>, for <code class="literal">accessMode: ReadWriteOnce</code>.
							</li><li class="listitem">
								If the PV is neither Gluster nor NFS <span class="emphasis"><em>or</em></span> if <code class="literal">cephfs</code> or <code class="literal">cephrbd</code> are not available, the default is a storage class for the same provisioner.
							</li><li class="listitem">
								If a storage class for the same provisioner is not available, the default is the default storage class of the destination cluster.
							</li></ol></div><p>
						You can change the <code class="literal">storageClass</code> value to the value of any <code class="literal">name</code> parameter in the <code class="literal">status.destStorageClasses</code> block of the <code class="literal">MigPlan</code> CR.
					</p><p>
						If the <code class="literal">storageClass</code> value is empty, the PV will have no storage class after migration. This option is appropriate if, for example, you want to move the PV to an NFS volume on the destination cluster.
					</p></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							<code class="literal">MigPlan</code> CR is in a <code class="literal">Ready</code> state.
						</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							Edit the <code class="literal">spec.persistentVolumes.selection</code> values in the <code class="literal">MigPlan</code> CR:
						</p><pre class="programlisting language-yaml">apiVersion: migration.openshift.io/v1alpha1
kind: MigPlan
metadata:
  name: &lt;migplan&gt;
  namespace: openshift-migration
spec:
  persistentVolumes:
  - capacity: 10Gi
    name: pvc-095a6559-b27f-11eb-b27f-021bddcaf6e4
    proposedCapacity: 10Gi
    pvc:
      accessModes:
      - ReadWriteMany
      hasReference: true
      name: mysql
      namespace: mysql-persistent
    selection:
      action: &lt;copy&gt; <span id="CO20-1"><!--Empty--></span><span class="callout">1</span>
      copyMethod: &lt;filesystem&gt; <span id="CO20-2"><!--Empty--></span><span class="callout">2</span>
      verify: true <span id="CO20-3"><!--Empty--></span><span class="callout">3</span>
      storageClass: &lt;gp2&gt; <span id="CO20-4"><!--Empty--></span><span class="callout">4</span>
      accessMode: &lt;ReadWriteMany&gt; <span id="CO20-5"><!--Empty--></span><span class="callout">5</span>
    storageClass: cephfs</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO20-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Allowed values are <code class="literal">move</code>, <code class="literal">copy</code>, and <code class="literal">skip</code>. If only one action is supported, the default value is the supported action. If multiple actions are supported, the default value is <code class="literal">copy</code>.
								</div></dd><dt><a href="#CO20-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Allowed values are <code class="literal">snapshot</code> and <code class="literal">filesystem</code>. Default value is <code class="literal">filesystem</code>.
								</div></dd><dt><a href="#CO20-3"><span class="callout">3</span></a> </dt><dd><div class="para">
									The <code class="literal">verify</code> parameter is displayed if you select the verification option for file system copy in the MTC web console. You can set it to <code class="literal">false</code>.
								</div></dd><dt><a href="#CO20-4"><span class="callout">4</span></a> </dt><dd><div class="para">
									You can change the default value to the value of any <code class="literal">name</code> parameter in the <code class="literal">status.destStorageClasses</code> block of the <code class="literal">MigPlan</code> CR. If no value is specified, the PV will have no storage class after migration.
								</div></dd><dt><a href="#CO20-5"><span class="callout">5</span></a> </dt><dd><div class="para">
									Allowed values are <code class="literal">ReadWriteOnce</code> and <code class="literal">ReadWriteMany</code>. If this value is not specified, the default is the access mode of the source cluster PVC. You can only edit the access mode in the <code class="literal">MigPlan</code> CR. You cannot edit it by using the MTC web console.
								</div></dd></dl></div></li></ul></div><h5 id="additional-resources-for-editing-pv-attributes_advanced-migration-options-3-4">Additional resources</h5><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							For details about the <code class="literal">move</code> and <code class="literal">copy</code> actions, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-mtc-workflow_about-mtc-3-4">MTC workflow</a>.
						</li><li class="listitem">
							For details about the <code class="literal">skip</code> action, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-excluding-pvcs_advanced-migration-options-3-4">Excluding PVCs from migration</a>.
						</li><li class="listitem">
							For details about the file system and snapshot copy methods, see <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-understanding-data-copy-methods_about-mtc-3-4">About data copy methods</a>.
						</li></ul></div></section><section class="section" id="migration-kubernetes-objects_advanced-migration-options-3-4"><div class="titlepage"><div><div><h3 class="title">11.5.6. Performing a state migration of Kubernetes objects by using the MTC API</h3></div></div></div><p>
					After you migrate all the PV data, you can use the Migration Toolkit for Containers (MTC) API to perform a one-time state migration of Kubernetes objects that constitute an application.
				</p><p>
					You do this by configuring <code class="literal">MigPlan</code> custom resource (CR) fields to provide a list of Kubernetes resources with an additional label selector to further filter those resources, and then performing a migration by creating a <code class="literal">MigMigration</code> CR. The <code class="literal">MigPlan</code> resource is closed after the migration.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						Selecting Kubernetes resources is an API-only feature. You must update the <code class="literal">MigPlan</code> CR and create a <code class="literal">MigMigration</code> CR for it by using the CLI. The MTC web console does not support migrating Kubernetes objects.
					</p></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						After migration, the <code class="literal">closed</code> parameter of the <code class="literal">MigPlan</code> CR is set to <code class="literal">true</code>. You cannot create another <code class="literal">MigMigration</code> CR for this <code class="literal">MigPlan</code> CR.
					</p></div></div><p>
					You add Kubernetes objects to the <code class="literal">MigPlan</code> CR by using one of the following options:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Adding the Kubernetes objects to the <code class="literal">includedResources</code> section. When the <code class="literal">includedResources</code> field is specified in the <code class="literal">MigPlan</code> CR, the plan takes a list of <code class="literal">group-kind</code> as input. Only resources present in the list are included in the migration.
						</li><li class="listitem">
							Adding the optional <code class="literal">labelSelector</code> parameter to filter the <code class="literal">includedResources</code> in the <code class="literal">MigPlan</code>. When this field is specified, only resources matching the label selector are included in the migration. For example, you can filter a list of <code class="literal">Secret</code> and <code class="literal">ConfigMap</code> resources by using the label <code class="literal">app: frontend</code> as a filter.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Update the <code class="literal">MigPlan</code> CR to include Kubernetes resources and, optionally, to filter the included resources by adding the <code class="literal">labelSelector</code> parameter:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
									To update the <code class="literal">MigPlan</code> CR to include Kubernetes resources:
								</p><pre class="programlisting language-yaml">apiVersion: migration.openshift.io/v1alpha1
kind: MigPlan
metadata:
  name: &lt;migplan&gt;
  namespace: openshift-migration
spec:
  includedResources:
  - kind: &lt;kind&gt; <span id="CO21-1"><!--Empty--></span><span class="callout">1</span>
    group: ""
  - kind: &lt;kind&gt;
    group: ""</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO21-1"><span class="callout">1</span></a> </dt><dd><div class="para">
											Specify the Kubernetes object, for example, <code class="literal">Secret</code> or <code class="literal">ConfigMap</code>.
										</div></dd></dl></div></li><li class="listitem"><p class="simpara">
									Optional: To filter the included resources by adding the <code class="literal">labelSelector</code> parameter:
								</p><pre class="programlisting language-yaml">apiVersion: migration.openshift.io/v1alpha1
kind: MigPlan
metadata:
  name: &lt;migplan&gt;
  namespace: openshift-migration
spec:
  includedResources:
  - kind: &lt;kind&gt; <span id="CO22-1"><!--Empty--></span><span class="callout">1</span>
    group: ""
  - kind: &lt;kind&gt;
    group: ""
...
  labelSelector:
    matchLabels:
      &lt;label&gt; <span id="CO22-2"><!--Empty--></span><span class="callout">2</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO22-1"><span class="callout">1</span></a> </dt><dd><div class="para">
											Specify the Kubernetes object, for example, <code class="literal">Secret</code> or <code class="literal">ConfigMap</code>.
										</div></dd><dt><a href="#CO22-2"><span class="callout">2</span></a> </dt><dd><div class="para">
											Specify the label of the resources to migrate, for example, <code class="literal">app: frontend</code>.
										</div></dd></dl></div></li></ol></div></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">MigMigration</code> CR to migrate the selected Kubernetes resources. Verify that the correct <code class="literal">MigPlan</code> is referenced in <code class="literal">migPlanRef</code>:
						</p><pre class="programlisting language-yaml">apiVersion: migration.openshift.io/v1alpha1
kind: MigMigration
metadata:
  generateName: &lt;migplan&gt;
  namespace: openshift-migration
spec:
  migPlanRef:
    name: &lt;migplan&gt;
    namespace: openshift-migration
  stage: false</pre></li></ol></div></section></section><section class="section" id="migration-controller-options_advanced-migration-options-3-4"><div class="titlepage"><div><div><h2 class="title">11.6. Migration controller options</h2></div></div></div><p>
				You can edit migration plan limits, enable persistent volume resizing, or enable cached Kubernetes clients in the <code class="literal">MigrationController</code> custom resource (CR) for large migrations and improved performance.
			</p><section class="section" id="migration-changing-migration-plan-limits_advanced-migration-options-3-4"><div class="titlepage"><div><div><h3 class="title">11.6.1. Increasing limits for large migrations</h3></div></div></div><p>
					You can increase the limits on migration objects and container resources for large migrations with the Migration Toolkit for Containers (MTC).
				</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						You must test these changes before you perform a migration in a production environment.
					</p></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Edit the <code class="literal">MigrationController</code> custom resource (CR) manifest:
						</p><pre class="programlisting language-terminal">$ oc edit migrationcontroller -n openshift-migration</pre></li><li class="listitem"><p class="simpara">
							Update the following parameters:
						</p><pre class="programlisting language-yaml">...
mig_controller_limits_cpu: "1" <span id="CO23-1"><!--Empty--></span><span class="callout">1</span>
mig_controller_limits_memory: "10Gi" <span id="CO23-2"><!--Empty--></span><span class="callout">2</span>
...
mig_controller_requests_cpu: "100m" <span id="CO23-3"><!--Empty--></span><span class="callout">3</span>
mig_controller_requests_memory: "350Mi" <span id="CO23-4"><!--Empty--></span><span class="callout">4</span>
...
mig_pv_limit: 100 <span id="CO23-5"><!--Empty--></span><span class="callout">5</span>
mig_pod_limit: 100 <span id="CO23-6"><!--Empty--></span><span class="callout">6</span>
mig_namespace_limit: 10 <span id="CO23-7"><!--Empty--></span><span class="callout">7</span>
...</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO23-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specifies the number of CPUs available to the <code class="literal">MigrationController</code> CR.
								</div></dd><dt><a href="#CO23-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Specifies the amount of memory available to the <code class="literal">MigrationController</code> CR.
								</div></dd><dt><a href="#CO23-3"><span class="callout">3</span></a> </dt><dd><div class="para">
									Specifies the number of CPU units available for <code class="literal">MigrationController</code> CR requests. <code class="literal">100m</code> represents 0.1 CPU units (100 * 1e-3).
								</div></dd><dt><a href="#CO23-4"><span class="callout">4</span></a> </dt><dd><div class="para">
									Specifies the amount of memory available for <code class="literal">MigrationController</code> CR requests.
								</div></dd><dt><a href="#CO23-5"><span class="callout">5</span></a> </dt><dd><div class="para">
									Specifies the number of persistent volumes that can be migrated.
								</div></dd><dt><a href="#CO23-6"><span class="callout">6</span></a> </dt><dd><div class="para">
									Specifies the number of pods that can be migrated.
								</div></dd><dt><a href="#CO23-7"><span class="callout">7</span></a> </dt><dd><div class="para">
									Specifies the number of namespaces that can be migrated.
								</div></dd></dl></div></li><li class="listitem"><p class="simpara">
							Create a migration plan that uses the updated parameters to verify the changes.
						</p><p class="simpara">
							If your migration plan exceeds the <code class="literal">MigrationController</code> CR limits, the MTC console displays a warning message when you save the migration plan.
						</p></li></ol></div></section><section class="section" id="migration-enabling-pv-resizing-dvm_advanced-migration-options-3-4"><div class="titlepage"><div><div><h3 class="title">11.6.2. Enabling persistent volume resizing for direct volume migration</h3></div></div></div><p>
					You can enable persistent volume (PV) resizing for direct volume migration to avoid running out of disk space on the destination cluster.
				</p><p>
					When the disk usage of a PV reaches a configured level, the <code class="literal">MigrationController</code> custom resource (CR) compares the requested storage capacity of a persistent volume claim (PVC) to its actual provisioned capacity. Then, it calculates the space required on the destination cluster.
				</p><p>
					A <code class="literal">pv_resizing_threshold</code> parameter determines when PV resizing is used. The default threshold is <code class="literal">3%</code>. This means that PV resizing occurs when the disk usage of a PV is more than <code class="literal">97%</code>. You can increase this threshold so that PV resizing occurs at a lower disk usage level.
				</p><p>
					PVC capacity is calculated according to the following criteria:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							If the requested storage capacity (<code class="literal">spec.resources.requests.storage</code>) of the PVC is not equal to its actual provisioned capacity (<code class="literal">status.capacity.storage</code>), the greater value is used.
						</li><li class="listitem">
							If a PV is provisioned through a PVC and then subsequently changed so that its PV and PVC capacities no longer match, the greater value is used.
						</li></ul></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							The PVCs must be attached to one or more running pods so that the <code class="literal">MigrationController</code> CR can execute commands.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Log in to the host cluster.
						</li><li class="listitem"><p class="simpara">
							Enable PV resizing by patching the <code class="literal">MigrationController</code> CR:
						</p><pre class="programlisting language-terminal">$ oc patch migrationcontroller migration-controller -p '{"spec":{"enable_dvm_pv_resizing":true}}' \ <span id="CO24-1"><!--Empty--></span><span class="callout">1</span>
  --type='merge' -n openshift-migration</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO24-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Set the value to <code class="literal">false</code> to disable PV resizing.
								</div></dd></dl></div></li><li class="listitem"><p class="simpara">
							Optional: Update the <code class="literal">pv_resizing_threshold</code> parameter to increase the threshold:
						</p><pre class="programlisting language-terminal">$ oc patch migrationcontroller migration-controller -p '{"spec":{"pv_resizing_threshold":41}}' \ <span id="CO25-1"><!--Empty--></span><span class="callout">1</span>
  --type='merge' -n openshift-migration</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO25-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									The default value is <code class="literal">3</code>.
								</div></dd></dl></div><p class="simpara">
							When the threshold is exceeded, the following status message is displayed in the <code class="literal">MigPlan</code> CR status:
						</p><pre class="programlisting language-yaml">status:
  conditions:
...
  - category: Warn
    durable: true
    lastTransitionTime: "2021-06-17T08:57:01Z"
    message: 'Capacity of the following volumes will be automatically adjusted to avoid disk capacity issues in the target cluster:  [pvc-b800eb7b-cf3b-11eb-a3f7-0eae3e0555f3]'
    reason: Done
    status: "False"
    type: PvCapacityAdjustmentRequired</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								For AWS gp2 storage, this message does not appear unless the <code class="literal">pv_resizing_threshold</code> is 42% or greater because of the way gp2 calculates volume usage and size. (<a class="link" href="https://bugzilla.redhat.com/show_bug.cgi?id=1973148"><span class="strong strong"><strong>BZ#1973148</strong></span></a>)
							</p></div></div></li></ol></div></section><section class="section" id="migration-enabling-cached-kubernetes-clients_advanced-migration-options-3-4"><div class="titlepage"><div><div><h3 class="title">11.6.3. Enabling cached Kubernetes clients</h3></div></div></div><p>
					You can enable cached Kubernetes clients in the <code class="literal">MigrationController</code> custom resource (CR) for improved performance during migration. The greatest performance benefit is displayed when migrating between clusters in different regions or with significant network latency.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						Delegated tasks, for example, Rsync backup for direct volume migration or Velero backup and restore, however, do not show improved performance with cached clients.
					</p></div></div><p>
					Cached clients require extra memory because the <code class="literal">MigrationController</code> CR caches all API resources that are required for interacting with <code class="literal">MigCluster</code> CRs. Requests that are normally sent to the API server are directed to the cache instead. The cache watches the API server for updates.
				</p><p>
					You can increase the memory limits and requests of the <code class="literal">MigrationController</code> CR if <code class="literal">OOMKilled</code> errors occur after you enable cached clients.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Enable cached clients by running the following command:
						</p><pre class="programlisting language-terminal">$ oc -n openshift-migration patch migrationcontroller migration-controller --type=json --patch \
  '[{ "op": "replace", "path": "/spec/mig_controller_enable_cache", "value": true}]'</pre></li><li class="listitem"><p class="simpara">
							Optional: Increase the <code class="literal">MigrationController</code> CR memory limits by running the following command:
						</p><pre class="programlisting language-terminal">$ oc -n openshift-migration patch migrationcontroller migration-controller --type=json --patch \
  '[{ "op": "replace", "path": "/spec/mig_controller_limits_memory", "value": &lt;10Gi&gt;}]'</pre></li><li class="listitem"><p class="simpara">
							Optional: Increase the <code class="literal">MigrationController</code> CR memory requests by running the following command:
						</p><pre class="programlisting language-terminal">$ oc -n openshift-migration patch migrationcontroller migration-controller --type=json --patch \
  '[{ "op": "replace", "path": "/spec/mig_controller_requests_memory", "value": &lt;350Mi&gt;}]'</pre></li></ol></div></section></section></section><section class="chapter" id="troubleshooting-3-4"><div class="titlepage"><div><div><h1 class="title">Chapter 12. Troubleshooting</h1></div></div></div><p>
			This section describes resources for troubleshooting the Migration Toolkit for Containers (MTC).
		</p><p>
			For known issues, see the <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migration_toolkit_for_containers/#mtc-release-notes">MTC release notes</a>.
		</p><section class="section" id="migration-mtc-workflow_troubleshooting-3-4"><div class="titlepage"><div><div><h2 class="title">12.1. MTC workflow</h2></div></div></div><p>
				You can migrate Kubernetes resources, persistent volume data, and internal container images to OpenShift Container Platform 4.13 by using the Migration Toolkit for Containers (MTC) web console or the Kubernetes API.
			</p><p>
				MTC migrates the following resources:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						A namespace specified in a migration plan.
					</li><li class="listitem"><p class="simpara">
						Namespace-scoped resources: When the MTC migrates a namespace, it migrates all the objects and resources associated with that namespace, such as services or pods. Additionally, if a resource that exists in the namespace but not at the cluster level depends on a resource that exists at the cluster level, the MTC migrates both resources.
					</p><p class="simpara">
						For example, a security context constraint (SCC) is a resource that exists at the cluster level and a service account (SA) is a resource that exists at the namespace level. If an SA exists in a namespace that the MTC migrates, the MTC automatically locates any SCCs that are linked to the SA and also migrates those SCCs. Similarly, the MTC migrates persistent volumes that are linked to the persistent volume claims of the namespace.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							Cluster-scoped resources might have to be migrated manually, depending on the resource.
						</p></div></div></li><li class="listitem">
						Custom resources (CRs) and custom resource definitions (CRDs): MTC automatically migrates CRs and CRDs at the namespace level.
					</li></ul></div><p>
				Migrating an application with the MTC web console involves the following steps:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Install the Migration Toolkit for Containers Operator on all clusters.
					</p><p class="simpara">
						You can install the Migration Toolkit for Containers Operator in a restricted environment with limited or no internet access. The source and target clusters must have network access to each other and to a mirror registry.
					</p></li><li class="listitem"><p class="simpara">
						Configure the replication repository, an intermediate object storage that MTC uses to migrate data.
					</p><p class="simpara">
						The source and target clusters must have network access to the replication repository during migration. If you are using a proxy server, you must configure it to allow network traffic between the replication repository and the clusters.
					</p></li><li class="listitem">
						Add the source cluster to the MTC web console.
					</li><li class="listitem">
						Add the replication repository to the MTC web console.
					</li><li class="listitem"><p class="simpara">
						Create a migration plan, with one of the following data migration options:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								<span class="strong strong"><strong>Copy</strong></span>: MTC copies the data from the source cluster to the replication repository, and from the replication repository to the target cluster.
							</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
									If you are using direct image migration or direct volume migration, the images or volumes are copied directly from the source cluster to the target cluster.
								</p></div></div><div class="informalfigure"><div class="mediaobject"><img src="https://access.redhat.com/webassets/avalon/d/OpenShift_Container_Platform-4.13-Migrating_from_version_3_to_4-en-US/images/6f34f274d8204ad77c50bc657505641d/migration-PV-copy.png" alt="migration PV copy"/></div></div></li><li class="listitem"><p class="simpara">
								<span class="strong strong"><strong>Move</strong></span>: MTC unmounts a remote volume, for example, NFS, from the source cluster, creates a PV resource on the target cluster pointing to the remote volume, and then mounts the remote volume on the target cluster. Applications running on the target cluster use the same remote volume that the source cluster was using. The remote volume must be accessible to the source and target clusters.
							</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
									Although the replication repository does not appear in this diagram, it is required for migration.
								</p></div></div><div class="informalfigure"><div class="mediaobject"><img src="https://access.redhat.com/webassets/avalon/d/OpenShift_Container_Platform-4.13-Migrating_from_version_3_to_4-en-US/images/882c7cbe8dfa21b24793dfd7596aec4a/migration-PV-move.png" alt="migration PV move"/></div></div></li></ul></div></li><li class="listitem"><p class="simpara">
						Run the migration plan, with one of the following options:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								<span class="strong strong"><strong>Stage</strong></span> copies data to the target cluster without stopping the application.
							</p><p class="simpara">
								A stage migration can be run multiple times so that most of the data is copied to the target before migration. Running one or more stage migrations reduces the duration of the cutover migration.
							</p></li><li class="listitem"><p class="simpara">
								<span class="strong strong"><strong>Cutover</strong></span> stops the application on the source cluster and moves the resources to the target cluster.
							</p><p class="simpara">
								Optional: You can clear the <span class="strong strong"><strong>Halt transactions on the source cluster during migration</strong></span> checkbox.
							</p></li></ul></div></li></ol></div><div class="informalfigure"><div class="mediaobject"><img src="https://access.redhat.com/webassets/avalon/d/OpenShift_Container_Platform-4.13-Migrating_from_version_3_to_4-en-US/images/6153b64756a2813de0249237abf8d251/OCP_3_to_4_App_migration.png" alt="OCP 3 to 4 App migration"/></div></div><h4 id="migration-about-mtc-custom-resources_troubleshooting-3-4">About MTC custom resources</h4><p>
				The Migration Toolkit for Containers (MTC) creates the following custom resources (CRs):
			</p><div class="informalfigure"><div class="mediaobject"><img src="https://access.redhat.com/webassets/avalon/d/OpenShift_Container_Platform-4.13-Migrating_from_version_3_to_4-en-US/images/9c565dd538804d80f27449082a30d3cf/migration-architecture.png" alt="migration architecture diagram"/></div></div><p>
				<span class="inlinemediaobject"><img src="https://access.redhat.com/webassets/avalon/d/OpenShift_Container_Platform-4.13-Migrating_from_version_3_to_4-en-US/images/066d390945eb233d66d1b10310fec9e7/darkcircle-1.png" width="20" alt="20"/></span>
				 <a class="link" href="https://github.com/konveyor/mig-controller/blob/master/pkg/apis/migration/v1alpha1/migcluster_types.go">MigCluster</a> (configuration, MTC cluster): Cluster definition
			</p><p>
				<span class="inlinemediaobject"><img src="https://access.redhat.com/webassets/avalon/d/OpenShift_Container_Platform-4.13-Migrating_from_version_3_to_4-en-US/images/dffcf5a2ed44061a19f38d92a8a3d1bb/darkcircle-2.png" width="20" alt="20"/></span>
				 <a class="link" href="https://github.com/konveyor/mig-controller/blob/master/pkg/apis/migration/v1alpha1/migstorage_types.go">MigStorage</a> (configuration, MTC cluster): Storage definition
			</p><p>
				<span class="inlinemediaobject"><img src="https://access.redhat.com/webassets/avalon/d/OpenShift_Container_Platform-4.13-Migrating_from_version_3_to_4-en-US/images/e4171dd0f615beb50be5dc701259f444/darkcircle-3.png" width="20" alt="20"/></span>
				 <a class="link" href="https://github.com/konveyor/mig-controller/blob/master/pkg/apis/migration/v1alpha1/migplan_types.go">MigPlan</a> (configuration, MTC cluster): Migration plan
			</p><p>
				The <code class="literal">MigPlan</code> CR describes the source and target clusters, replication repository, and namespaces being migrated. It is associated with 0, 1, or many <code class="literal">MigMigration</code> CRs.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Deleting a <code class="literal">MigPlan</code> CR deletes the associated <code class="literal">MigMigration</code> CRs.
				</p></div></div><p>
				<span class="inlinemediaobject"><img src="https://access.redhat.com/webassets/avalon/d/OpenShift_Container_Platform-4.13-Migrating_from_version_3_to_4-en-US/images/dd170f3f40e17838a75352ca1962f9bb/darkcircle-4.png" width="20" alt="20"/></span>
				 <a class="link" href="https://github.com/vmware-tanzu/velero/blob/main/pkg/apis/velero/v1/backupstoragelocation_types.go">BackupStorageLocation</a> (configuration, MTC cluster): Location of <code class="literal">Velero</code> backup objects
			</p><p>
				<span class="inlinemediaobject"><img src="https://access.redhat.com/webassets/avalon/d/OpenShift_Container_Platform-4.13-Migrating_from_version_3_to_4-en-US/images/b86066dfcdf40a6c7ce19b770a9d3868/darkcircle-5.png" width="20" alt="20"/></span>
				 <a class="link" href="https://github.com/vmware-tanzu/velero/blob/main/pkg/apis/velero/v1/volume_snapshot_location.go">VolumeSnapshotLocation</a> (configuration, MTC cluster): Location of <code class="literal">Velero</code> volume snapshots
			</p><p>
				<span class="inlinemediaobject"><img src="https://access.redhat.com/webassets/avalon/d/OpenShift_Container_Platform-4.13-Migrating_from_version_3_to_4-en-US/images/3355b6bb1a911bd888724ef147bddf81/darkcircle-6.png" width="20" alt="20"/></span>
				 <a class="link" href="https://github.com/konveyor/mig-controller/blob/master/pkg/apis/migration/v1alpha1/migmigration_types.go">MigMigration</a> (action, MTC cluster): Migration, created every time you stage or migrate data. Each <code class="literal">MigMigration</code> CR is associated with a <code class="literal">MigPlan</code> CR.
			</p><p>
				<span class="inlinemediaobject"><img src="https://access.redhat.com/webassets/avalon/d/OpenShift_Container_Platform-4.13-Migrating_from_version_3_to_4-en-US/images/c375237f874aa152901afcfc636b49aa/darkcircle-7.png" width="20" alt="20"/></span>
				 <a class="link" href="https://github.com/vmware-tanzu/velero/blob/main/pkg/apis/velero/v1/backup.go">Backup</a> (action, source cluster): When you run a migration plan, the <code class="literal">MigMigration</code> CR creates two <code class="literal">Velero</code> backup CRs on each source cluster:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Backup CR #1 for Kubernetes objects
					</li><li class="listitem">
						Backup CR #2 for PV data
					</li></ul></div><p>
				<span class="inlinemediaobject"><img src="https://access.redhat.com/webassets/avalon/d/OpenShift_Container_Platform-4.13-Migrating_from_version_3_to_4-en-US/images/a6d6413c1aa40b05d8373cb664db1913/darkcircle-8.png" width="20" alt="20"/></span>
				 <a class="link" href="https://github.com/vmware-tanzu/velero/blob/main/pkg/apis/velero/v1/restore.go">Restore</a> (action, target cluster): When you run a migration plan, the <code class="literal">MigMigration</code> CR creates two <code class="literal">Velero</code> restore CRs on the target cluster:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Restore CR #1 (using Backup CR #2) for PV data
					</li><li class="listitem">
						Restore CR #2 (using Backup CR #1) for Kubernetes objects
					</li></ul></div></section><section class="section" id="migration-mtc-cr-manifests_troubleshooting-3-4"><div class="titlepage"><div><div><h2 class="title">12.2. MTC custom resource manifests</h2></div></div></div><p>
				Migration Toolkit for Containers (MTC) uses the following custom resource (CR) manifests for migrating applications.
			</p><section class="section" id="directimagemigration_troubleshooting-3-4"><div class="titlepage"><div><div><h3 class="title">12.2.1. DirectImageMigration</h3></div></div></div><p>
					The <code class="literal">DirectImageMigration</code> CR copies images directly from the source cluster to the destination cluster.
				</p><pre class="programlisting language-yaml">apiVersion: migration.openshift.io/v1alpha1
kind: DirectImageMigration
metadata:
  labels:
    controller-tools.k8s.io: "1.0"
  name: &lt;direct_image_migration&gt;
spec:
  srcMigClusterRef:
    name: &lt;source_cluster&gt;
    namespace: openshift-migration
  destMigClusterRef:
    name: &lt;destination_cluster&gt;
    namespace: openshift-migration
  namespaces: <span id="CO26-1"><!--Empty--></span><span class="callout">1</span>
    - &lt;source_namespace_1&gt;
    - &lt;source_namespace_2&gt;:&lt;destination_namespace_3&gt; <span id="CO26-2"><!--Empty--></span><span class="callout">2</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO26-1"><span class="callout">1</span></a> </dt><dd><div class="para">
							One or more namespaces containing images to be migrated. By default, the destination namespace has the same name as the source namespace.
						</div></dd><dt><a href="#CO26-2"><span class="callout">2</span></a> </dt><dd><div class="para">
							Source namespace mapped to a destination namespace with a different name.
						</div></dd></dl></div></section><section class="section" id="directimagestreammigration_troubleshooting-3-4"><div class="titlepage"><div><div><h3 class="title">12.2.2. DirectImageStreamMigration</h3></div></div></div><p>
					The <code class="literal">DirectImageStreamMigration</code> CR copies image stream references directly from the source cluster to the destination cluster.
				</p><pre class="programlisting language-yaml">apiVersion: migration.openshift.io/v1alpha1
kind: DirectImageStreamMigration
metadata:
  labels:
    controller-tools.k8s.io: "1.0"
  name: &lt;direct_image_stream_migration&gt;
spec:
  srcMigClusterRef:
    name: &lt;source_cluster&gt;
    namespace: openshift-migration
  destMigClusterRef:
    name: &lt;destination_cluster&gt;
    namespace: openshift-migration
  imageStreamRef:
    name: &lt;image_stream&gt;
    namespace: &lt;source_image_stream_namespace&gt;
  destNamespace: &lt;destination_image_stream_namespace&gt;</pre></section><section class="section" id="directvolumemigration_troubleshooting-3-4"><div class="titlepage"><div><div><h3 class="title">12.2.3. DirectVolumeMigration</h3></div></div></div><p>
					The <code class="literal">DirectVolumeMigration</code> CR copies persistent volumes (PVs) directly from the source cluster to the destination cluster.
				</p><pre class="programlisting language-yaml">apiVersion: migration.openshift.io/v1alpha1
kind: DirectVolumeMigration
metadata:
  name: &lt;direct_volume_migration&gt;
  namespace: openshift-migration
spec:
  createDestinationNamespaces: false <span id="CO27-1"><!--Empty--></span><span class="callout">1</span>
  deleteProgressReportingCRs: false <span id="CO27-2"><!--Empty--></span><span class="callout">2</span>
  destMigClusterRef:
    name: &lt;host_cluster&gt; <span id="CO27-3"><!--Empty--></span><span class="callout">3</span>
    namespace: openshift-migration
  persistentVolumeClaims:
  - name: &lt;pvc&gt; <span id="CO27-4"><!--Empty--></span><span class="callout">4</span>
    namespace: &lt;pvc_namespace&gt;
  srcMigClusterRef:
    name: &lt;source_cluster&gt;
    namespace: openshift-migration</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO27-1"><span class="callout">1</span></a> </dt><dd><div class="para">
							Set to <code class="literal">true</code> to create namespaces for the PVs on the destination cluster.
						</div></dd><dt><a href="#CO27-2"><span class="callout">2</span></a> </dt><dd><div class="para">
							Set to <code class="literal">true</code> to delete <code class="literal">DirectVolumeMigrationProgress</code> CRs after migration. The default is <code class="literal">false</code> so that <code class="literal">DirectVolumeMigrationProgress</code> CRs are retained for troubleshooting.
						</div></dd><dt><a href="#CO27-3"><span class="callout">3</span></a> </dt><dd><div class="para">
							Update the cluster name if the destination cluster is not the host cluster.
						</div></dd><dt><a href="#CO27-4"><span class="callout">4</span></a> </dt><dd><div class="para">
							Specify one or more PVCs to be migrated.
						</div></dd></dl></div></section><section class="section" id="directvolumemigrationprogress_troubleshooting-3-4"><div class="titlepage"><div><div><h3 class="title">12.2.4. DirectVolumeMigrationProgress</h3></div></div></div><p>
					The <code class="literal">DirectVolumeMigrationProgress</code> CR shows the progress of the <code class="literal">DirectVolumeMigration</code> CR.
				</p><pre class="programlisting language-yaml">apiVersion: migration.openshift.io/v1alpha1
kind: DirectVolumeMigrationProgress
metadata:
  labels:
    controller-tools.k8s.io: "1.0"
  name: &lt;direct_volume_migration_progress&gt;
spec:
  clusterRef:
    name: &lt;source_cluster&gt;
    namespace: openshift-migration
  podRef:
    name: &lt;rsync_pod&gt;
    namespace: openshift-migration</pre></section><section class="section" id="miganalytic_troubleshooting-3-4"><div class="titlepage"><div><div><h3 class="title">12.2.5. MigAnalytic</h3></div></div></div><p>
					The <code class="literal">MigAnalytic</code> CR collects the number of images, Kubernetes resources, and the persistent volume (PV) capacity from an associated <code class="literal">MigPlan</code> CR.
				</p><p>
					You can configure the data that it collects.
				</p><pre class="programlisting language-yaml">apiVersion: migration.openshift.io/v1alpha1
kind: MigAnalytic
metadata:
  annotations:
    migplan: &lt;migplan&gt;
  name: &lt;miganalytic&gt;
  namespace: openshift-migration
  labels:
    migplan: &lt;migplan&gt;
spec:
  analyzeImageCount: true <span id="CO28-1"><!--Empty--></span><span class="callout">1</span>
  analyzeK8SResources: true <span id="CO28-2"><!--Empty--></span><span class="callout">2</span>
  analyzePVCapacity: true <span id="CO28-3"><!--Empty--></span><span class="callout">3</span>
  listImages: false <span id="CO28-4"><!--Empty--></span><span class="callout">4</span>
  listImagesLimit: 50 <span id="CO28-5"><!--Empty--></span><span class="callout">5</span>
  migPlanRef:
    name: &lt;migplan&gt;
    namespace: openshift-migration</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO28-1"><span class="callout">1</span></a> </dt><dd><div class="para">
							Optional: Returns the number of images.
						</div></dd><dt><a href="#CO28-2"><span class="callout">2</span></a> </dt><dd><div class="para">
							Optional: Returns the number, kind, and API version of the Kubernetes resources.
						</div></dd><dt><a href="#CO28-3"><span class="callout">3</span></a> </dt><dd><div class="para">
							Optional: Returns the PV capacity.
						</div></dd><dt><a href="#CO28-4"><span class="callout">4</span></a> </dt><dd><div class="para">
							Returns a list of image names. The default is <code class="literal">false</code> so that the output is not excessively long.
						</div></dd><dt><a href="#CO28-5"><span class="callout">5</span></a> </dt><dd><div class="para">
							Optional: Specify the maximum number of image names to return if <code class="literal">listImages</code> is <code class="literal">true</code>.
						</div></dd></dl></div></section><section class="section" id="migcluster_troubleshooting-3-4"><div class="titlepage"><div><div><h3 class="title">12.2.6. MigCluster</h3></div></div></div><p>
					The <code class="literal">MigCluster</code> CR defines a host, local, or remote cluster.
				</p><pre class="programlisting language-yaml">apiVersion: migration.openshift.io/v1alpha1
kind: MigCluster
metadata:
  labels:
    controller-tools.k8s.io: "1.0"
  name: &lt;host_cluster&gt; <span id="CO29-1"><!--Empty--></span><span class="callout">1</span>
  namespace: openshift-migration
spec:
  isHostCluster: true <span id="CO29-2"><!--Empty--></span><span class="callout">2</span>
# The 'azureResourceGroup' parameter is relevant only for Microsoft Azure.
  azureResourceGroup: &lt;azure_resource_group&gt; <span id="CO29-3"><!--Empty--></span><span class="callout">3</span>
  caBundle: &lt;ca_bundle_base64&gt; <span id="CO29-4"><!--Empty--></span><span class="callout">4</span>
  insecure: false <span id="CO29-5"><!--Empty--></span><span class="callout">5</span>
  refresh: false <span id="CO29-6"><!--Empty--></span><span class="callout">6</span>
# The 'restartRestic' parameter is relevant for a source cluster.
  restartRestic: true <span id="CO29-7"><!--Empty--></span><span class="callout">7</span>
# The following parameters are relevant for a remote cluster.
  exposedRegistryPath: &lt;registry_route&gt; <span id="CO29-8"><!--Empty--></span><span class="callout">8</span>
  url: &lt;destination_cluster_url&gt; <span id="CO29-9"><!--Empty--></span><span class="callout">9</span>
  serviceAccountSecretRef:
    name: &lt;source_secret&gt; <span id="CO29-10"><!--Empty--></span><span class="callout">10</span>
    namespace: openshift-config</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO29-1"><span class="callout">1</span></a> </dt><dd><div class="para">
							Update the cluster name if the <code class="literal">migration-controller</code> pod is not running on this cluster.
						</div></dd><dt><a href="#CO29-2"><span class="callout">2</span></a> </dt><dd><div class="para">
							The <code class="literal">migration-controller</code> pod runs on this cluster if <code class="literal">true</code>.
						</div></dd><dt><a href="#CO29-3"><span class="callout">3</span></a> </dt><dd><div class="para">
							Microsoft Azure only: Specify the resource group.
						</div></dd><dt><a href="#CO29-4"><span class="callout">4</span></a> </dt><dd><div class="para">
							Optional: If you created a certificate bundle for self-signed CA certificates and if the <code class="literal">insecure</code> parameter value is <code class="literal">false</code>, specify the base64-encoded certificate bundle.
						</div></dd><dt><a href="#CO29-5"><span class="callout">5</span></a> </dt><dd><div class="para">
							Set to <code class="literal">true</code> to disable SSL verification.
						</div></dd><dt><a href="#CO29-6"><span class="callout">6</span></a> </dt><dd><div class="para">
							Set to <code class="literal">true</code> to validate the cluster.
						</div></dd><dt><a href="#CO29-7"><span class="callout">7</span></a> </dt><dd><div class="para">
							Set to <code class="literal">true</code> to restart the <code class="literal">Restic</code> pods on the source cluster after the <code class="literal">Stage</code> pods are created.
						</div></dd><dt><a href="#CO29-8"><span class="callout">8</span></a> </dt><dd><div class="para">
							Remote cluster and direct image migration only: Specify the exposed secure registry path.
						</div></dd><dt><a href="#CO29-9"><span class="callout">9</span></a> </dt><dd><div class="para">
							Remote cluster only: Specify the URL.
						</div></dd><dt><a href="#CO29-10"><span class="callout">10</span></a> </dt><dd><div class="para">
							Remote cluster only: Specify the name of the <code class="literal">Secret</code> object.
						</div></dd></dl></div></section><section class="section" id="mighook_troubleshooting-3-4"><div class="titlepage"><div><div><h3 class="title">12.2.7. MigHook</h3></div></div></div><p>
					The <code class="literal">MigHook</code> CR defines a migration hook that runs custom code at a specified stage of the migration. You can create up to four migration hooks. Each hook runs during a different phase of the migration.
				</p><p>
					You can configure the hook name, runtime duration, a custom image, and the cluster where the hook will run.
				</p><p>
					The migration phases and namespaces of the hooks are configured in the <code class="literal">MigPlan</code> CR.
				</p><pre class="programlisting language-yaml">apiVersion: migration.openshift.io/v1alpha1
kind: MigHook
metadata:
  generateName: &lt;hook_name_prefix&gt; <span id="CO30-1"><!--Empty--></span><span class="callout">1</span>
  name: &lt;mighook&gt; <span id="CO30-2"><!--Empty--></span><span class="callout">2</span>
  namespace: openshift-migration
spec:
  activeDeadlineSeconds: 1800 <span id="CO30-3"><!--Empty--></span><span class="callout">3</span>
  custom: false <span id="CO30-4"><!--Empty--></span><span class="callout">4</span>
  image: &lt;hook_image&gt; <span id="CO30-5"><!--Empty--></span><span class="callout">5</span>
  playbook: &lt;ansible_playbook_base64&gt; <span id="CO30-6"><!--Empty--></span><span class="callout">6</span>
  targetCluster: source <span id="CO30-7"><!--Empty--></span><span class="callout">7</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO30-1"><span class="callout">1</span></a> </dt><dd><div class="para">
							Optional: A unique hash is appended to the value for this parameter so that each migration hook has a unique name. You do not need to specify the value of the <code class="literal">name</code> parameter.
						</div></dd><dt><a href="#CO30-2"><span class="callout">2</span></a> </dt><dd><div class="para">
							Specify the migration hook name, unless you specify the value of the <code class="literal">generateName</code> parameter.
						</div></dd><dt><a href="#CO30-3"><span class="callout">3</span></a> </dt><dd><div class="para">
							Optional: Specify the maximum number of seconds that a hook can run. The default is <code class="literal">1800</code>.
						</div></dd><dt><a href="#CO30-4"><span class="callout">4</span></a> </dt><dd><div class="para">
							The hook is a custom image if <code class="literal">true</code>. The custom image can include Ansible or it can be written in a different programming language.
						</div></dd><dt><a href="#CO30-5"><span class="callout">5</span></a> </dt><dd><div class="para">
							Specify the custom image, for example, <code class="literal">quay.io/konveyor/hook-runner:latest</code>. Required if <code class="literal">custom</code> is <code class="literal">true</code>.
						</div></dd><dt><a href="#CO30-6"><span class="callout">6</span></a> </dt><dd><div class="para">
							Base64-encoded Ansible playbook. Required if <code class="literal">custom</code> is <code class="literal">false</code>.
						</div></dd><dt><a href="#CO30-7"><span class="callout">7</span></a> </dt><dd><div class="para">
							Specify the cluster on which the hook will run. Valid values are <code class="literal">source</code> or <code class="literal">destination</code>.
						</div></dd></dl></div></section><section class="section" id="migmigration_troubleshooting-3-4"><div class="titlepage"><div><div><h3 class="title">12.2.8. MigMigration</h3></div></div></div><p>
					The <code class="literal">MigMigration</code> CR runs a <code class="literal">MigPlan</code> CR.
				</p><p>
					You can configure a <code class="literal">Migmigration</code> CR to run a stage or incremental migration, to cancel a migration in progress, or to roll back a completed migration.
				</p><pre class="programlisting language-yaml">apiVersion: migration.openshift.io/v1alpha1
kind: MigMigration
metadata:
  labels:
    controller-tools.k8s.io: "1.0"
  name: &lt;migmigration&gt;
  namespace: openshift-migration
spec:
  canceled: false <span id="CO31-1"><!--Empty--></span><span class="callout">1</span>
  rollback: false <span id="CO31-2"><!--Empty--></span><span class="callout">2</span>
  stage: false <span id="CO31-3"><!--Empty--></span><span class="callout">3</span>
  quiescePods: true <span id="CO31-4"><!--Empty--></span><span class="callout">4</span>
  keepAnnotations: true <span id="CO31-5"><!--Empty--></span><span class="callout">5</span>
  verify: false <span id="CO31-6"><!--Empty--></span><span class="callout">6</span>
  migPlanRef:
    name: &lt;migplan&gt;
    namespace: openshift-migration</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO31-1"><span class="callout">1</span></a> </dt><dd><div class="para">
							Set to <code class="literal">true</code> to cancel a migration in progress.
						</div></dd><dt><a href="#CO31-2"><span class="callout">2</span></a> </dt><dd><div class="para">
							Set to <code class="literal">true</code> to roll back a completed migration.
						</div></dd><dt><a href="#CO31-3"><span class="callout">3</span></a> </dt><dd><div class="para">
							Set to <code class="literal">true</code> to run a stage migration. Data is copied incrementally and the pods on the source cluster are not stopped.
						</div></dd><dt><a href="#CO31-4"><span class="callout">4</span></a> </dt><dd><div class="para">
							Set to <code class="literal">true</code> to stop the application during migration. The pods on the source cluster are scaled to <code class="literal">0</code> after the <code class="literal">Backup</code> stage.
						</div></dd><dt><a href="#CO31-5"><span class="callout">5</span></a> </dt><dd><div class="para">
							Set to <code class="literal">true</code> to retain the labels and annotations applied during the migration.
						</div></dd><dt><a href="#CO31-6"><span class="callout">6</span></a> </dt><dd><div class="para">
							Set to <code class="literal">true</code> to check the status of the migrated pods on the destination cluster are checked and to return the names of pods that are not in a <code class="literal">Running</code> state.
						</div></dd></dl></div></section><section class="section" id="migplan_troubleshooting-3-4"><div class="titlepage"><div><div><h3 class="title">12.2.9. MigPlan</h3></div></div></div><p>
					The <code class="literal">MigPlan</code> CR defines the parameters of a migration plan.
				</p><p>
					You can configure destination namespaces, hook phases, and direct or indirect migration.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						By default, a destination namespace has the same name as the source namespace. If you configure a different destination namespace, you must ensure that the namespaces are not duplicated on the source or the destination clusters because the UID and GID ranges are copied during migration.
					</p></div></div><pre class="programlisting language-yaml">apiVersion: migration.openshift.io/v1alpha1
kind: MigPlan
metadata:
  labels:
    controller-tools.k8s.io: "1.0"
  name: &lt;migplan&gt;
  namespace: openshift-migration
spec:
  closed: false <span id="CO32-1"><!--Empty--></span><span class="callout">1</span>
  srcMigClusterRef:
    name: &lt;source_cluster&gt;
    namespace: openshift-migration
  destMigClusterRef:
    name: &lt;destination_cluster&gt;
    namespace: openshift-migration
  hooks: <span id="CO32-2"><!--Empty--></span><span class="callout">2</span>
    - executionNamespace: &lt;namespace&gt; <span id="CO32-3"><!--Empty--></span><span class="callout">3</span>
      phase: &lt;migration_phase&gt; <span id="CO32-4"><!--Empty--></span><span class="callout">4</span>
      reference:
        name: &lt;hook&gt; <span id="CO32-5"><!--Empty--></span><span class="callout">5</span>
        namespace: &lt;hook_namespace&gt; <span id="CO32-6"><!--Empty--></span><span class="callout">6</span>
      serviceAccount: &lt;service_account&gt; <span id="CO32-7"><!--Empty--></span><span class="callout">7</span>
  indirectImageMigration: true <span id="CO32-8"><!--Empty--></span><span class="callout">8</span>
  indirectVolumeMigration: false <span id="CO32-9"><!--Empty--></span><span class="callout">9</span>
  migStorageRef:
    name: &lt;migstorage&gt;
    namespace: openshift-migration
  namespaces:
    - &lt;source_namespace_1&gt; <span id="CO32-10"><!--Empty--></span><span class="callout">10</span>
    - &lt;source_namespace_2&gt;
    - &lt;source_namespace_3&gt;:&lt;destination_namespace_4&gt; <span id="CO32-11"><!--Empty--></span><span class="callout">11</span>
  refresh: false  <span id="CO32-12"><!--Empty--></span><span class="callout">12</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO32-1"><span class="callout">1</span></a> </dt><dd><div class="para">
							The migration has completed if <code class="literal">true</code>. You cannot create another <code class="literal">MigMigration</code> CR for this <code class="literal">MigPlan</code> CR.
						</div></dd><dt><a href="#CO32-2"><span class="callout">2</span></a> </dt><dd><div class="para">
							Optional: You can specify up to four migration hooks. Each hook must run during a different migration phase.
						</div></dd><dt><a href="#CO32-3"><span class="callout">3</span></a> </dt><dd><div class="para">
							Optional: Specify the namespace in which the hook will run.
						</div></dd><dt><a href="#CO32-4"><span class="callout">4</span></a> </dt><dd><div class="para">
							Optional: Specify the migration phase during which a hook runs. One hook can be assigned to one phase. Valid values are <code class="literal">PreBackup</code>, <code class="literal">PostBackup</code>, <code class="literal">PreRestore</code>, and <code class="literal">PostRestore</code>.
						</div></dd><dt><a href="#CO32-5"><span class="callout">5</span></a> </dt><dd><div class="para">
							Optional: Specify the name of the <code class="literal">MigHook</code> CR.
						</div></dd><dt><a href="#CO32-6"><span class="callout">6</span></a> </dt><dd><div class="para">
							Optional: Specify the namespace of <code class="literal">MigHook</code> CR.
						</div></dd><dt><a href="#CO32-7"><span class="callout">7</span></a> </dt><dd><div class="para">
							Optional: Specify a service account with <code class="literal">cluster-admin</code> privileges.
						</div></dd><dt><a href="#CO32-8"><span class="callout">8</span></a> </dt><dd><div class="para">
							Direct image migration is disabled if <code class="literal">true</code>. Images are copied from the source cluster to the replication repository and from the replication repository to the destination cluster.
						</div></dd><dt><a href="#CO32-9"><span class="callout">9</span></a> </dt><dd><div class="para">
							Direct volume migration is disabled if <code class="literal">true</code>. PVs are copied from the source cluster to the replication repository and from the replication repository to the destination cluster.
						</div></dd><dt><a href="#CO32-10"><span class="callout">10</span></a> </dt><dd><div class="para">
							Specify one or more source namespaces. If you specify only the source namespace, the destination namespace is the same.
						</div></dd><dt><a href="#CO32-11"><span class="callout">11</span></a> </dt><dd><div class="para">
							Specify the destination namespace if it is different from the source namespace.
						</div></dd><dt><a href="#CO32-12"><span class="callout">12</span></a> </dt><dd><div class="para">
							The <code class="literal">MigPlan</code> CR is validated if <code class="literal">true</code>.
						</div></dd></dl></div></section><section class="section" id="migstorage_troubleshooting-3-4"><div class="titlepage"><div><div><h3 class="title">12.2.10. MigStorage</h3></div></div></div><p>
					The <code class="literal">MigStorage</code> CR describes the object storage for the replication repository.
				</p><p>
					Amazon Web Services (AWS), Microsoft Azure, Google Cloud Storage, Multi-Cloud Object Gateway, and generic S3-compatible cloud storage are supported.
				</p><p>
					AWS and the snapshot copy method have additional parameters.
				</p><pre class="programlisting language-yaml">apiVersion: migration.openshift.io/v1alpha1
kind: MigStorage
metadata:
  labels:
    controller-tools.k8s.io: "1.0"
  name: &lt;migstorage&gt;
  namespace: openshift-migration
spec:
  backupStorageProvider: &lt;backup_storage_provider&gt; <span id="CO33-1"><!--Empty--></span><span class="callout">1</span>
  volumeSnapshotProvider: &lt;snapshot_storage_provider&gt; <span id="CO33-2"><!--Empty--></span><span class="callout">2</span>
  backupStorageConfig:
    awsBucketName: &lt;bucket&gt; <span id="CO33-3"><!--Empty--></span><span class="callout">3</span>
    awsRegion: &lt;region&gt; <span id="CO33-4"><!--Empty--></span><span class="callout">4</span>
    credsSecretRef:
      namespace: openshift-config
      name: &lt;storage_secret&gt; <span id="CO33-5"><!--Empty--></span><span class="callout">5</span>
    awsKmsKeyId: &lt;key_id&gt; <span id="CO33-6"><!--Empty--></span><span class="callout">6</span>
    awsPublicUrl: &lt;public_url&gt; <span id="CO33-7"><!--Empty--></span><span class="callout">7</span>
    awsSignatureVersion: &lt;signature_version&gt; <span id="CO33-8"><!--Empty--></span><span class="callout">8</span>
  volumeSnapshotConfig:
    awsRegion: &lt;region&gt; <span id="CO33-9"><!--Empty--></span><span class="callout">9</span>
    credsSecretRef:
      namespace: openshift-config
      name: &lt;storage_secret&gt; <span id="CO33-10"><!--Empty--></span><span class="callout">10</span>
  refresh: false <span id="CO33-11"><!--Empty--></span><span class="callout">11</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO33-1"><span class="callout">1</span></a> </dt><dd><div class="para">
							Specify the storage provider.
						</div></dd><dt><a href="#CO33-2"><span class="callout">2</span></a> </dt><dd><div class="para">
							Snapshot copy method only: Specify the storage provider.
						</div></dd><dt><a href="#CO33-3"><span class="callout">3</span></a> </dt><dd><div class="para">
							AWS only: Specify the bucket name.
						</div></dd><dt><a href="#CO33-4"><span class="callout">4</span></a> </dt><dd><div class="para">
							AWS only: Specify the bucket region, for example, <code class="literal">us-east-1</code>.
						</div></dd><dt><a href="#CO33-5"><span class="callout">5</span></a> </dt><dd><div class="para">
							Specify the name of the <code class="literal">Secret</code> object that you created for the storage.
						</div></dd><dt><a href="#CO33-6"><span class="callout">6</span></a> </dt><dd><div class="para">
							AWS only: If you are using the AWS Key Management Service, specify the unique identifier of the key.
						</div></dd><dt><a href="#CO33-7"><span class="callout">7</span></a> </dt><dd><div class="para">
							AWS only: If you granted public access to the AWS bucket, specify the bucket URL.
						</div></dd><dt><a href="#CO33-8"><span class="callout">8</span></a> </dt><dd><div class="para">
							AWS only: Specify the AWS signature version for authenticating requests to the bucket, for example, <code class="literal">4</code>.
						</div></dd><dt><a href="#CO33-9"><span class="callout">9</span></a> </dt><dd><div class="para">
							Snapshot copy method only: Specify the geographical region of the clusters.
						</div></dd><dt><a href="#CO33-10"><span class="callout">10</span></a> </dt><dd><div class="para">
							Snapshot copy method only: Specify the name of the <code class="literal">Secret</code> object that you created for the storage.
						</div></dd><dt><a href="#CO33-11"><span class="callout">11</span></a> </dt><dd><div class="para">
							Set to <code class="literal">true</code> to validate the cluster.
						</div></dd></dl></div></section></section><section class="section" id="logs-and-debugging-tools_troubleshooting-3-4"><div class="titlepage"><div><div><h2 class="title">12.3. Logs and debugging tools</h2></div></div></div><p>
				This section describes logs and debugging tools that you can use for troubleshooting.
			</p><section class="section" id="migration-viewing-migration-plan-resources_troubleshooting-3-4"><div class="titlepage"><div><div><h3 class="title">12.3.1. Viewing migration plan resources</h3></div></div></div><p>
					You can view migration plan resources to monitor a running migration or to troubleshoot a failed migration by using the MTC web console and the command line interface (CLI).
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							In the MTC web console, click <span class="strong strong"><strong>Migration Plans</strong></span>.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Migrations</strong></span> number next to a migration plan to view the <span class="strong strong"><strong>Migrations</strong></span> page.
						</li><li class="listitem">
							Click a migration to view the <span class="strong strong"><strong>Migration details</strong></span>.
						</li><li class="listitem"><p class="simpara">
							Expand <span class="strong strong"><strong>Migration resources</strong></span> to view the migration resources and their status in a tree view.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								To troubleshoot a failed migration, start with a high-level resource that has failed and then work down the resource tree towards the lower-level resources.
							</p></div></div></li><li class="listitem"><p class="simpara">
							Click the Options menu 
							<span class="inlinemediaobject"><img src="https://access.redhat.com/webassets/avalon/d/OpenShift_Container_Platform-4.13-Migrating_from_version_3_to_4-en-US/images/f468284ec3cc9bf27e6bd2c83849ca50/kebab.png" alt="kebab"/></span>
							 next to a resource and select one of the following options:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
									<span class="strong strong"><strong>Copy <code class="literal">oc describe</code> command</strong></span> copies the command to your clipboard.
								</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p class="simpara">
											Log in to the relevant cluster and then run the command.
										</p><p class="simpara">
											The conditions and events of the resource are displayed in YAML format.
										</p></li></ul></div></li><li class="listitem"><p class="simpara">
									<span class="strong strong"><strong>Copy <code class="literal">oc logs</code> command</strong></span> copies the command to your clipboard.
								</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p class="simpara">
											Log in to the relevant cluster and then run the command.
										</p><p class="simpara">
											If the resource supports log filtering, a filtered log is displayed.
										</p></li></ul></div></li><li class="listitem"><p class="simpara">
									<span class="strong strong"><strong>View JSON</strong></span> displays the resource data in JSON format in a web browser.
								</p><p class="simpara">
									The data is the same as the output for the <code class="literal">oc get &lt;resource&gt;</code> command.
								</p></li></ul></div></li></ol></div></section><section class="section" id="migration-viewing-migration-plan-log_troubleshooting-3-4"><div class="titlepage"><div><div><h3 class="title">12.3.2. Viewing a migration plan log</h3></div></div></div><p>
					You can view an aggregated log for a migration plan. You use the MTC web console to copy a command to your clipboard and then run the command from the command line interface (CLI).
				</p><p>
					The command displays the filtered logs of the following pods:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<code class="literal">Migration Controller</code>
						</li><li class="listitem">
							<code class="literal">Velero</code>
						</li><li class="listitem">
							<code class="literal">Restic</code>
						</li><li class="listitem">
							<code class="literal">Rsync</code>
						</li><li class="listitem">
							<code class="literal">Stunnel</code>
						</li><li class="listitem">
							<code class="literal">Registry</code>
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							In the MTC web console, click <span class="strong strong"><strong>Migration Plans</strong></span>.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>Migrations</strong></span> number next to a migration plan.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>View logs</strong></span>.
						</li><li class="listitem">
							Click the Copy icon to copy the <code class="literal">oc logs</code> command to your clipboard.
						</li><li class="listitem"><p class="simpara">
							Log in to the relevant cluster and enter the command on the CLI.
						</p><p class="simpara">
							The aggregated log for the migration plan is displayed.
						</p></li></ol></div></section><section class="section" id="migration-using-mig-log-reader_troubleshooting-3-4"><div class="titlepage"><div><div><h3 class="title">12.3.3. Using the migration log reader</h3></div></div></div><p>
					You can use the migration log reader to display a single filtered view of all the migration logs.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Get the <code class="literal">mig-log-reader</code> pod:
						</p><pre class="programlisting language-terminal">$ oc -n openshift-migration get pods | grep log</pre></li><li class="listitem"><p class="simpara">
							Enter the following command to display a single migration log:
						</p><pre class="programlisting language-terminal">$ oc -n openshift-migration logs -f &lt;mig-log-reader-pod&gt; -c color <span id="CO34-1"><!--Empty--></span><span class="callout">1</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO34-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									The <code class="literal">-c plain</code> option displays the log without colors.
								</div></dd></dl></div></li></ol></div></section><section class="section" id="migration-accessing-performance-metrics_troubleshooting-3-4"><div class="titlepage"><div><div><h3 class="title">12.3.4. Accessing performance metrics</h3></div></div></div><p>
					The <code class="literal">MigrationController</code> custom resource (CR) records metrics and pulls them into on-cluster monitoring storage. You can query the metrics by using Prometheus Query Language (PromQL) to diagnose migration performance issues. All metrics are reset when the Migration Controller pod restarts.
				</p><p>
					You can access the performance metrics and run queries by using the OpenShift Container Platform web console.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							In the OpenShift Container Platform web console, click <span class="strong strong"><strong>Observe</strong></span> → <span class="strong strong"><strong>Metrics</strong></span>.
						</li><li class="listitem"><p class="simpara">
							Enter a PromQL query, select a time window to display, and click <span class="strong strong"><strong>Run Queries</strong></span>.
						</p><p class="simpara">
							If your web browser does not display all the results, use the Prometheus console.
						</p></li></ol></div><section class="section" id="migration-provided-metrics_troubleshooting-3-4"><div class="titlepage"><div><div><h4 class="title">12.3.4.1. Provided metrics</h4></div></div></div><p>
						The <code class="literal">MigrationController</code> custom resource (CR) provides metrics for the <code class="literal">MigMigration</code> CR count and for its API requests.
					</p><section class="section" id="cam_app_workload_migrations-metric_troubleshooting-3-4"><div class="titlepage"><div><div><h5 class="title">12.3.4.1.1. cam_app_workload_migrations</h5></div></div></div><p>
							This metric is a count of <code class="literal">MigMigration</code> CRs over time. It is useful for viewing alongside the <code class="literal">mtc_client_request_count</code> and <code class="literal">mtc_client_request_elapsed</code> metrics to collate API request information with migration status changes. This metric is included in Telemetry.
						</p><div class="table" id="idm139748678312656"><p class="title"><strong>Table 12.1. cam_app_workload_migrations metric</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"><!--Empty--></col><col style="width: 33%; " class="col_2"><!--Empty--></col><col style="width: 33%; " class="col_3"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139748678306880" scope="col">Queryable label name</th><th align="left" valign="top" id="idm139748678305792" scope="col">Sample label values</th><th align="left" valign="top" id="idm139748678304704" scope="col">Label description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139748678306880"> <p>
											status
										</p>
										 </td><td align="left" valign="top" headers="idm139748678305792"> <p>
											<code class="literal">running</code>, <code class="literal">idle</code>, <code class="literal">failed</code>, <code class="literal">completed</code>
										</p>
										 </td><td align="left" valign="top" headers="idm139748678304704"> <p>
											Status of the <code class="literal">MigMigration</code> CR
										</p>
										 </td></tr><tr><td align="left" valign="top" headers="idm139748678306880"> <p>
											type
										</p>
										 </td><td align="left" valign="top" headers="idm139748678305792"> <p>
											stage, final
										</p>
										 </td><td align="left" valign="top" headers="idm139748678304704"> <p>
											Type of the <code class="literal">MigMigration</code> CR
										</p>
										 </td></tr></tbody></table></div></div></section><section class="section" id="mtc_client_request_count-metric_troubleshooting-3-4"><div class="titlepage"><div><div><h5 class="title">12.3.4.1.2. mtc_client_request_count</h5></div></div></div><p>
							This metric is a cumulative count of Kubernetes API requests that <code class="literal">MigrationController</code> issued. It is not included in Telemetry.
						</p><div class="table" id="idm139748678286640"><p class="title"><strong>Table 12.2. mtc_client_request_count metric</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"><!--Empty--></col><col style="width: 33%; " class="col_2"><!--Empty--></col><col style="width: 33%; " class="col_3"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139748678280864" scope="col">Queryable label name</th><th align="left" valign="top" id="idm139748679862128" scope="col">Sample label values</th><th align="left" valign="top" id="idm139748679861040" scope="col">Label description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139748678280864"> <p>
											cluster
										</p>
										 </td><td align="left" valign="top" headers="idm139748679862128"> <p>
											<code class="literal">https://migcluster-url:443</code>
										</p>
										 </td><td align="left" valign="top" headers="idm139748679861040"> <p>
											Cluster that the request was issued against
										</p>
										 </td></tr><tr><td align="left" valign="top" headers="idm139748678280864"> <p>
											component
										</p>
										 </td><td align="left" valign="top" headers="idm139748679862128"> <p>
											<code class="literal">MigPlan</code>, <code class="literal">MigCluster</code>
										</p>
										 </td><td align="left" valign="top" headers="idm139748679861040"> <p>
											Sub-controller API that issued request
										</p>
										 </td></tr><tr><td align="left" valign="top" headers="idm139748678280864"> <p>
											function
										</p>
										 </td><td align="left" valign="top" headers="idm139748679862128"> <p>
											<code class="literal">(*ReconcileMigPlan).Reconcile</code>
										</p>
										 </td><td align="left" valign="top" headers="idm139748679861040"> <p>
											Function that the request was issued from
										</p>
										 </td></tr><tr><td align="left" valign="top" headers="idm139748678280864"> <p>
											kind
										</p>
										 </td><td align="left" valign="top" headers="idm139748679862128"> <p>
											<code class="literal">SecretList</code>, <code class="literal">Deployment</code>
										</p>
										 </td><td align="left" valign="top" headers="idm139748679861040"> <p>
											Kubernetes kind the request was issued for
										</p>
										 </td></tr></tbody></table></div></div></section><section class="section" id="mtc_client_request_elapsed-metric_troubleshooting-3-4"><div class="titlepage"><div><div><h5 class="title">12.3.4.1.3. mtc_client_request_elapsed</h5></div></div></div><p>
							This metric is a cumulative latency, in milliseconds, of Kubernetes API requests that <code class="literal">MigrationController</code> issued. It is not included in Telemetry.
						</p><div class="table" id="idm139748679832368"><p class="title"><strong>Table 12.3. mtc_client_request_elapsed metric</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"><!--Empty--></col><col style="width: 33%; " class="col_2"><!--Empty--></col><col style="width: 33%; " class="col_3"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139748679897120" scope="col">Queryable label name</th><th align="left" valign="top" id="idm139748679896032" scope="col">Sample label values</th><th align="left" valign="top" id="idm139748679894944" scope="col">Label description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139748679897120"> <p>
											cluster
										</p>
										 </td><td align="left" valign="top" headers="idm139748679896032"> <p>
											<code class="literal">https://cluster-url.com:443</code>
										</p>
										 </td><td align="left" valign="top" headers="idm139748679894944"> <p>
											Cluster that the request was issued against
										</p>
										 </td></tr><tr><td align="left" valign="top" headers="idm139748679897120"> <p>
											component
										</p>
										 </td><td align="left" valign="top" headers="idm139748679896032"> <p>
											<code class="literal">migplan</code>, <code class="literal">migcluster</code>
										</p>
										 </td><td align="left" valign="top" headers="idm139748679894944"> <p>
											Sub-controller API that issued request
										</p>
										 </td></tr><tr><td align="left" valign="top" headers="idm139748679897120"> <p>
											function
										</p>
										 </td><td align="left" valign="top" headers="idm139748679896032"> <p>
											<code class="literal">(*ReconcileMigPlan).Reconcile</code>
										</p>
										 </td><td align="left" valign="top" headers="idm139748679894944"> <p>
											Function that the request was issued from
										</p>
										 </td></tr><tr><td align="left" valign="top" headers="idm139748679897120"> <p>
											kind
										</p>
										 </td><td align="left" valign="top" headers="idm139748679896032"> <p>
											<code class="literal">SecretList</code>, <code class="literal">Deployment</code>
										</p>
										 </td><td align="left" valign="top" headers="idm139748679894944"> <p>
											Kubernetes resource that the request was issued for
										</p>
										 </td></tr></tbody></table></div></div></section><section class="section" id="useful-queries_troubleshooting-3-4"><div class="titlepage"><div><div><h5 class="title">12.3.4.1.4. Useful queries</h5></div></div></div><p>
							The table lists some helpful queries that can be used for monitoring performance.
						</p><div class="table" id="idm139748679866784"><p class="title"><strong>Table 12.4. Useful queries</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--></col><col style="width: 50%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139748680533136" scope="col">Query</th><th align="left" valign="top" id="idm139748680532048" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139748680533136"> <p>
											<code class="literal">mtc_client_request_count</code>
										</p>
										 </td><td align="left" valign="top" headers="idm139748680532048"> <p>
											Number of API requests issued, sorted by request type
										</p>
										 </td></tr><tr><td align="left" valign="top" headers="idm139748680533136"> <p>
											<code class="literal">sum(mtc_client_request_count)</code>
										</p>
										 </td><td align="left" valign="top" headers="idm139748680532048"> <p>
											Total number of API requests issued
										</p>
										 </td></tr><tr><td align="left" valign="top" headers="idm139748680533136"> <p>
											<code class="literal">mtc_client_request_elapsed</code>
										</p>
										 </td><td align="left" valign="top" headers="idm139748680532048"> <p>
											API request latency, sorted by request type
										</p>
										 </td></tr><tr><td align="left" valign="top" headers="idm139748680533136"> <p>
											<code class="literal">sum(mtc_client_request_elapsed)</code>
										</p>
										 </td><td align="left" valign="top" headers="idm139748680532048"> <p>
											Total latency of API requests
										</p>
										 </td></tr><tr><td align="left" valign="top" headers="idm139748680533136"> <p>
											<code class="literal">sum(mtc_client_request_elapsed) / sum(mtc_client_request_count)</code>
										</p>
										 </td><td align="left" valign="top" headers="idm139748680532048"> <p>
											Average latency of API requests
										</p>
										 </td></tr><tr><td align="left" valign="top" headers="idm139748680533136"> <p>
											<code class="literal">mtc_client_request_elapsed / mtc_client_request_count</code>
										</p>
										 </td><td align="left" valign="top" headers="idm139748680532048"> <p>
											Average latency of API requests, sorted by request type
										</p>
										 </td></tr><tr><td align="left" valign="top" headers="idm139748680533136"> <p>
											<code class="literal">cam_app_workload_migrations{status="running"} * 100</code>
										</p>
										 </td><td align="left" valign="top" headers="idm139748680532048"> <p>
											Count of running migrations, multiplied by 100 for easier viewing alongside request counts
										</p>
										 </td></tr></tbody></table></div></div></section></section></section><section class="section" id="migration-using-must-gather_troubleshooting-3-4"><div class="titlepage"><div><div><h3 class="title">12.3.5. Using the must-gather tool</h3></div></div></div><p>
					You can collect logs, metrics, and information about MTC custom resources by using the <code class="literal">must-gather</code> tool.
				</p><p>
					The <code class="literal">must-gather</code> data must be attached to all customer cases.
				</p><p>
					You can collect data for a one-hour or a 24-hour period and view the data with the Prometheus console.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							You must be logged in to the OpenShift Container Platform cluster as a user with the <code class="literal">cluster-admin</code> role.
						</li><li class="listitem">
							You must have the OpenShift CLI (<code class="literal">oc</code>) installed.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Navigate to the directory where you want to store the <code class="literal">must-gather</code> data.
						</li><li class="listitem"><p class="simpara">
							Run the <code class="literal">oc adm must-gather</code> command for one of the following data collection options:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
									To collect data for the past hour:
								</p><pre class="programlisting language-terminal">$ oc adm must-gather --image=registry.redhat.io/rhmtc/openshift-migration-must-gather-rhel8:v1.8</pre><p class="simpara">
									The data is saved as <code class="literal">must-gather/must-gather.tar.gz</code>. You can upload this file to a support case on the <a class="link" href="https://access.redhat.com/">Red Hat Customer Portal</a>.
								</p></li><li class="listitem"><p class="simpara">
									To collect data for the past 24 hours:
								</p><pre class="programlisting language-terminal">$ oc adm must-gather --image=registry.redhat.io/rhmtc/openshift-migration-must-gather-rhel8:v1.8 \
  -- /usr/bin/gather_metrics_dump</pre><p class="simpara">
									This operation can take a long time. The data is saved as <code class="literal">must-gather/metrics/prom_data.tar.gz</code>.
								</p></li></ul></div></li></ol></div></section><section class="section" id="migration-debugging-velero-resources_troubleshooting-3-4"><div class="titlepage"><div><div><h3 class="title">12.3.6. Debugging Velero resources with the Velero CLI tool</h3></div></div></div><p>
					You can debug <code class="literal">Backup</code> and <code class="literal">Restore</code> custom resources (CRs) and retrieve logs with the Velero CLI tool.
				</p><p>
					The Velero CLI tool provides more detailed information than the OpenShift CLI tool.
				</p><h5 id="velero-command-syntax_troubleshooting-3-4">Syntax</h5><p>
					Use the <code class="literal">oc exec</code> command to run a Velero CLI command:
				</p><pre class="programlisting language-terminal">$ oc -n openshift-migration exec deployment/velero -c velero -- ./velero \
  &lt;backup_restore_cr&gt; &lt;command&gt; &lt;cr_name&gt;</pre><div class="formalpara"><p class="title"><strong>Example</strong></p><p>
						
<pre class="programlisting language-terminal">$ oc -n openshift-migration exec deployment/velero -c velero -- ./velero \
  backup describe 0e44ae00-5dc3-11eb-9ca8-df7e5254778b-2d8ql</pre>

					</p></div><h5 id="velero-help-option_troubleshooting-3-4">Help option</h5><p>
					Use the <code class="literal">velero --help</code> option to list all Velero CLI commands:
				</p><pre class="programlisting language-terminal">$ oc -n openshift-migration exec deployment/velero -c velero -- ./velero \
  --help</pre><h5 id="velero-describe-command_troubleshooting-3-4">Describe command</h5><p>
					Use the <code class="literal">velero describe</code> command to retrieve a summary of warnings and errors associated with a <code class="literal">Backup</code> or <code class="literal">Restore</code> CR:
				</p><pre class="programlisting language-terminal">$ oc -n openshift-migration exec deployment/velero -c velero -- ./velero \
  &lt;backup_restore_cr&gt; describe &lt;cr_name&gt;</pre><div class="formalpara"><p class="title"><strong>Example</strong></p><p>
						
<pre class="programlisting language-terminal">$ oc -n openshift-migration exec deployment/velero -c velero -- ./velero \
  backup describe 0e44ae00-5dc3-11eb-9ca8-df7e5254778b-2d8ql</pre>

					</p></div><h5 id="velero-logs-command_troubleshooting-3-4">Logs command</h5><p>
					Use the <code class="literal">velero logs</code> command to retrieve the logs of a <code class="literal">Backup</code> or <code class="literal">Restore</code> CR:
				</p><pre class="programlisting language-terminal">$ oc -n openshift-migration exec deployment/velero -c velero -- ./velero \
  &lt;backup_restore_cr&gt; logs &lt;cr_name&gt;</pre><div class="formalpara"><p class="title"><strong>Example</strong></p><p>
						
<pre class="programlisting language-terminal">$ oc -n openshift-migration exec deployment/velero -c velero -- ./velero \
  restore logs ccc7c2d0-6017-11eb-afab-85d0007f5a19-x4lbf</pre>

					</p></div></section><section class="section" id="migration-partial-failure-velero_troubleshooting-3-4"><div class="titlepage"><div><div><h3 class="title">12.3.7. Debugging a partial migration failure</h3></div></div></div><p>
					You can debug a partial migration failure warning message by using the Velero CLI to examine the <code class="literal">Restore</code> custom resource (CR) logs.
				</p><p>
					A partial failure occurs when Velero encounters an issue that does not cause a migration to fail. For example, if a custom resource definition (CRD) is missing or if there is a discrepancy between CRD versions on the source and target clusters, the migration completes but the CR is not created on the target cluster.
				</p><p>
					Velero logs the issue as a partial failure and then processes the rest of the objects in the <code class="literal">Backup</code> CR.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Check the status of a <code class="literal">MigMigration</code> CR:
						</p><pre class="programlisting language-terminal">$ oc get migmigration &lt;migmigration&gt; -o yaml</pre><div class="formalpara"><p class="title"><strong>Example output</strong></p><p>
								
<pre class="programlisting language-yaml">status:
  conditions:
  - category: Warn
    durable: true
    lastTransitionTime: "2021-01-26T20:48:40Z"
    message: 'Final Restore openshift-migration/ccc7c2d0-6017-11eb-afab-85d0007f5a19-x4lbf: partially failed on destination cluster'
    status: "True"
    type: VeleroFinalRestorePartiallyFailed
  - category: Advisory
    durable: true
    lastTransitionTime: "2021-01-26T20:48:42Z"
    message: The migration has completed with warnings, please look at `Warn` conditions.
    reason: Completed
    status: "True"
    type: SucceededWithWarnings</pre>

							</p></div></li><li class="listitem"><p class="simpara">
							Check the status of the <code class="literal">Restore</code> CR by using the Velero <code class="literal">describe</code> command:
						</p><pre class="programlisting language-yaml">$ oc -n {namespace} exec deployment/velero -c velero -- ./velero \
  restore describe &lt;restore&gt;</pre><div class="formalpara"><p class="title"><strong>Example output</strong></p><p>
								
<pre class="programlisting language-text">Phase:  PartiallyFailed (run 'velero restore logs ccc7c2d0-6017-11eb-afab-85d0007f5a19-x4lbf' for more information)

Errors:
  Velero:     &lt;none&gt;
  Cluster:    &lt;none&gt;
  Namespaces:
    migration-example:  error restoring example.com/migration-example/migration-example: the server could not find the requested resource</pre>

							</p></div></li><li class="listitem"><p class="simpara">
							Check the <code class="literal">Restore</code> CR logs by using the Velero <code class="literal">logs</code> command:
						</p><pre class="programlisting language-yaml">$ oc -n {namespace} exec deployment/velero -c velero -- ./velero \
  restore logs &lt;restore&gt;</pre><div class="formalpara"><p class="title"><strong>Example output</strong></p><p>
								
<pre class="programlisting language-yaml">time="2021-01-26T20:48:37Z" level=info msg="Attempting to restore migration-example: migration-example" logSource="pkg/restore/restore.go:1107" restore=openshift-migration/ccc7c2d0-6017-11eb-afab-85d0007f5a19-x4lbf
time="2021-01-26T20:48:37Z" level=info msg="error restoring migration-example: the server could not find the requested resource" logSource="pkg/restore/restore.go:1170" restore=openshift-migration/ccc7c2d0-6017-11eb-afab-85d0007f5a19-x4lbf</pre>

							</p></div><p class="simpara">
							The <code class="literal">Restore</code> CR log error message, <code class="literal">the server could not find the requested resource</code>, indicates the cause of the partially failed migration.
						</p></li></ol></div></section><section class="section" id="migration-using-mtc-crs-for-troubleshooting_troubleshooting-3-4"><div class="titlepage"><div><div><h3 class="title">12.3.8. Using MTC custom resources for troubleshooting</h3></div></div></div><p>
					You can check the following Migration Toolkit for Containers (MTC) custom resources (CRs) to troubleshoot a failed migration:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<code class="literal">MigCluster</code>
						</li><li class="listitem">
							<code class="literal">MigStorage</code>
						</li><li class="listitem">
							<code class="literal">MigPlan</code>
						</li><li class="listitem"><p class="simpara">
							<code class="literal">BackupStorageLocation</code>
						</p><p class="simpara">
							The <code class="literal">BackupStorageLocation</code> CR contains a <code class="literal">migrationcontroller</code> label to identify the MTC instance that created the CR:
						</p><pre class="programlisting language-yaml">    labels:
      migrationcontroller: ebe13bee-c803-47d0-a9e9-83f380328b93</pre></li><li class="listitem"><p class="simpara">
							<code class="literal">VolumeSnapshotLocation</code>
						</p><p class="simpara">
							The <code class="literal">VolumeSnapshotLocation</code> CR contains a <code class="literal">migrationcontroller</code> label to identify the MTC instance that created the CR:
						</p><pre class="programlisting language-yaml">    labels:
      migrationcontroller: ebe13bee-c803-47d0-a9e9-83f380328b93</pre></li><li class="listitem">
							<code class="literal">MigMigration</code>
						</li><li class="listitem"><p class="simpara">
							<code class="literal">Backup</code>
						</p><p class="simpara">
							MTC changes the reclaim policy of migrated persistent volumes (PVs) to <code class="literal">Retain</code> on the target cluster. The <code class="literal">Backup</code> CR contains an <code class="literal">openshift.io/orig-reclaim-policy</code> annotation that indicates the original reclaim policy. You can manually restore the reclaim policy of the migrated PVs.
						</p></li><li class="listitem">
							<code class="literal">Restore</code>
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							List the <code class="literal">MigMigration</code> CRs in the <code class="literal">openshift-migration</code> namespace:
						</p><pre class="programlisting language-terminal">$ oc get migmigration -n openshift-migration</pre><div class="formalpara"><p class="title"><strong>Example output</strong></p><p>
								
<pre class="programlisting language-terminal">NAME                                   AGE
88435fe0-c9f8-11e9-85e6-5d593ce65e10   6m42s</pre>

							</p></div></li><li class="listitem"><p class="simpara">
							Inspect the <code class="literal">MigMigration</code> CR:
						</p><pre class="programlisting language-terminal">$ oc describe migmigration 88435fe0-c9f8-11e9-85e6-5d593ce65e10 -n openshift-migration</pre><p class="simpara">
							The output is similar to the following examples.
						</p></li></ol></div><div class="formalpara"><p class="title"><strong><code class="literal">MigMigration</code> example output</strong></p><p>
						
<pre class="programlisting language-text">name:         88435fe0-c9f8-11e9-85e6-5d593ce65e10
namespace:    openshift-migration
labels:       &lt;none&gt;
annotations:  touch: 3b48b543-b53e-4e44-9d34-33563f0f8147
apiVersion:  migration.openshift.io/v1alpha1
kind:         MigMigration
metadata:
  creationTimestamp:  2019-08-29T01:01:29Z
  generation:          20
  resourceVersion:    88179
  selfLink:           /apis/migration.openshift.io/v1alpha1/namespaces/openshift-migration/migmigrations/88435fe0-c9f8-11e9-85e6-5d593ce65e10
  uid:                 8886de4c-c9f8-11e9-95ad-0205fe66cbb6
spec:
  migPlanRef:
    name:        socks-shop-mig-plan
    namespace:   openshift-migration
  quiescePods:  true
  stage:         false
status:
  conditions:
    category:              Advisory
    durable:               True
    lastTransitionTime:  2019-08-29T01:03:40Z
    message:               The migration has completed successfully.
    reason:                Completed
    status:                True
    type:                  Succeeded
  phase:                   Completed
  startTimestamp:         2019-08-29T01:01:29Z
events:                    &lt;none&gt;</pre>

					</p></div><div class="formalpara"><p class="title"><strong><code class="literal">Velero</code> backup CR #2 example output that describes the PV data</strong></p><p>
						
<pre class="programlisting language-yaml">apiVersion: velero.io/v1
kind: Backup
metadata:
  annotations:
    openshift.io/migrate-copy-phase: final
    openshift.io/migrate-quiesce-pods: "true"
    openshift.io/migration-registry: 172.30.105.179:5000
    openshift.io/migration-registry-dir: /socks-shop-mig-plan-registry-44dd3bd5-c9f8-11e9-95ad-0205fe66cbb6
    openshift.io/orig-reclaim-policy: delete
  creationTimestamp: "2019-08-29T01:03:15Z"
  generateName: 88435fe0-c9f8-11e9-85e6-5d593ce65e10-
  generation: 1
  labels:
    app.kubernetes.io/part-of: migration
    migmigration: 8886de4c-c9f8-11e9-95ad-0205fe66cbb6
    migration-stage-backup: 8886de4c-c9f8-11e9-95ad-0205fe66cbb6
    velero.io/storage-location: myrepo-vpzq9
  name: 88435fe0-c9f8-11e9-85e6-5d593ce65e10-59gb7
  namespace: openshift-migration
  resourceVersion: "87313"
  selfLink: /apis/velero.io/v1/namespaces/openshift-migration/backups/88435fe0-c9f8-11e9-85e6-5d593ce65e10-59gb7
  uid: c80dbbc0-c9f8-11e9-95ad-0205fe66cbb6
spec:
  excludedNamespaces: []
  excludedResources: []
  hooks:
    resources: []
  includeClusterResources: null
  includedNamespaces:
  - sock-shop
  includedResources:
  - persistentvolumes
  - persistentvolumeclaims
  - namespaces
  - imagestreams
  - imagestreamtags
  - secrets
  - configmaps
  - pods
  labelSelector:
    matchLabels:
      migration-included-stage-backup: 8886de4c-c9f8-11e9-95ad-0205fe66cbb6
  storageLocation: myrepo-vpzq9
  ttl: 720h0m0s
  volumeSnapshotLocations:
  - myrepo-wv6fx
status:
  completionTimestamp: "2019-08-29T01:02:36Z"
  errors: 0
  expiration: "2019-09-28T01:02:35Z"
  phase: Completed
  startTimestamp: "2019-08-29T01:02:35Z"
  validationErrors: null
  version: 1
  volumeSnapshotsAttempted: 0
  volumeSnapshotsCompleted: 0
  warnings: 0</pre>

					</p></div><div class="formalpara"><p class="title"><strong><code class="literal">Velero</code> restore CR #2 example output that describes the Kubernetes resources</strong></p><p>
						
<pre class="programlisting language-yaml">apiVersion: velero.io/v1
kind: Restore
metadata:
  annotations:
    openshift.io/migrate-copy-phase: final
    openshift.io/migrate-quiesce-pods: "true"
    openshift.io/migration-registry: 172.30.90.187:5000
    openshift.io/migration-registry-dir: /socks-shop-mig-plan-registry-36f54ca7-c925-11e9-825a-06fa9fb68c88
  creationTimestamp: "2019-08-28T00:09:49Z"
  generateName: e13a1b60-c927-11e9-9555-d129df7f3b96-
  generation: 3
  labels:
    app.kubernetes.io/part-of: migration
    migmigration: e18252c9-c927-11e9-825a-06fa9fb68c88
    migration-final-restore: e18252c9-c927-11e9-825a-06fa9fb68c88
  name: e13a1b60-c927-11e9-9555-d129df7f3b96-gb8nx
  namespace: openshift-migration
  resourceVersion: "82329"
  selfLink: /apis/velero.io/v1/namespaces/openshift-migration/restores/e13a1b60-c927-11e9-9555-d129df7f3b96-gb8nx
  uid: 26983ec0-c928-11e9-825a-06fa9fb68c88
spec:
  backupName: e13a1b60-c927-11e9-9555-d129df7f3b96-sz24f
  excludedNamespaces: null
  excludedResources:
  - nodes
  - events
  - events.events.k8s.io
  - backups.velero.io
  - restores.velero.io
  - resticrepositories.velero.io
  includedNamespaces: null
  includedResources: null
  namespaceMapping: null
  restorePVs: true
status:
  errors: 0
  failureReason: ""
  phase: Completed
  validationErrors: null
  warnings: 15</pre>

					</p></div></section></section><section class="section" id="common-issues-and-concerns_troubleshooting-3-4"><div class="titlepage"><div><div><h2 class="title">12.4. Common issues and concerns</h2></div></div></div><p>
				This section describes common issues and concerns that can cause issues during migration.
			</p><section class="section" id="migration-updating-deprecated-internal-images_troubleshooting-3-4"><div class="titlepage"><div><div><h3 class="title">12.4.1. Updating deprecated internal images</h3></div></div></div><p>
					If your application uses images from the <code class="literal">openshift</code> namespace, the required versions of the images must be present on the target cluster.
				</p><p>
					If an OpenShift Container Platform 3 image is deprecated in OpenShift Container Platform 4.13, you can manually update the image stream tag by using <code class="literal">podman</code>.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							You must have <code class="literal">podman</code> installed.
						</li><li class="listitem">
							You must be logged in as a user with <code class="literal">cluster-admin</code> privileges.
						</li><li class="listitem">
							If you are using insecure registries, add your registry host values to the <code class="literal">[registries.insecure]</code> section of <code class="literal">/etc/container/registries.conf</code> to ensure that <code class="literal">podman</code> does not encounter a TLS verification error.
						</li><li class="listitem">
							The internal registries must be exposed on the source and target clusters.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Ensure that the internal registries are exposed on the OpenShift Container Platform 3 and 4 clusters.
						</p><p class="simpara">
							The OpenShift image registry is exposed by default on OpenShift Container Platform 4.
						</p></li><li class="listitem">
							If you are using insecure registries, add your registry host values to the <code class="literal">[registries.insecure]</code> section of <code class="literal">/etc/container/registries.conf</code> to ensure that <code class="literal">podman</code> does not encounter a TLS verification error.
						</li><li class="listitem"><p class="simpara">
							Log in to the OpenShift Container Platform 3 registry:
						</p><pre class="programlisting language-terminal">$ podman login -u $(oc whoami) -p $(oc whoami -t) --tls-verify=false &lt;registry_url&gt;:&lt;port&gt;</pre></li><li class="listitem"><p class="simpara">
							Log in to the OpenShift Container Platform 4 registry:
						</p><pre class="programlisting language-terminal">$ podman login -u $(oc whoami) -p $(oc whoami -t) --tls-verify=false &lt;registry_url&gt;:&lt;port&gt;</pre></li><li class="listitem"><p class="simpara">
							Pull the OpenShift Container Platform 3 image:
						</p><pre class="programlisting language-terminal">$ podman pull &lt;registry_url&gt;:&lt;port&gt;/openshift/&lt;image&gt;</pre></li><li class="listitem"><p class="simpara">
							Tag the OpenShift Container Platform 3 image for the OpenShift Container Platform 4 registry:
						</p><pre class="programlisting language-terminal">$ podman tag &lt;registry_url&gt;:&lt;port&gt;/openshift/&lt;image&gt; \ <span id="CO35-1"><!--Empty--></span><span class="callout">1</span>
  &lt;registry_url&gt;:&lt;port&gt;/openshift/&lt;image&gt; <span id="CO35-2"><!--Empty--></span><span class="callout">2</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO35-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specify the registry URL and port for the OpenShift Container Platform 3 cluster.
								</div></dd><dt><a href="#CO35-2"><span class="callout">2</span></a> </dt><dd><div class="para">
									Specify the registry URL and port for the OpenShift Container Platform 4 cluster.
								</div></dd></dl></div></li><li class="listitem"><p class="simpara">
							Push the image to the OpenShift Container Platform 4 registry:
						</p><pre class="programlisting language-terminal">$ podman push &lt;registry_url&gt;:&lt;port&gt;/openshift/&lt;image&gt; <span id="CO36-1"><!--Empty--></span><span class="callout">1</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO36-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specify the OpenShift Container Platform 4 cluster.
								</div></dd></dl></div></li><li class="listitem"><p class="simpara">
							Verify that the image has a valid image stream:
						</p><pre class="programlisting language-terminal">$ oc get imagestream -n openshift | grep &lt;image&gt;</pre><div class="formalpara"><p class="title"><strong>Example output</strong></p><p>
								
<pre class="programlisting language-terminal">NAME      IMAGE REPOSITORY                                                      TAGS    UPDATED
my_image  image-registry.openshift-image-registry.svc:5000/openshift/my_image  latest  32 seconds ago</pre>

							</p></div></li></ol></div></section><section class="section" id="migration-dvm-error-node-selectors_troubleshooting-3-4"><div class="titlepage"><div><div><h3 class="title">12.4.2. Direct volume migration does not complete</h3></div></div></div><p>
					If direct volume migration does not complete, the target cluster might not have the same <code class="literal">node-selector</code> annotations as the source cluster.
				</p><p>
					Migration Toolkit for Containers (MTC) migrates namespaces with all annotations to preserve security context constraints and scheduling requirements. During direct volume migration, MTC creates Rsync transfer pods on the target cluster in the namespaces that were migrated from the source cluster. If a target cluster namespace does not have the same annotations as the source cluster namespace, the Rsync transfer pods cannot be scheduled. The Rsync pods remain in a <code class="literal">Pending</code> state.
				</p><p>
					You can identify and fix this issue by performing the following procedure.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Check the status of the <code class="literal">MigMigration</code> CR:
						</p><pre class="programlisting language-terminal">$ oc describe migmigration &lt;pod&gt; -n openshift-migration</pre><p class="simpara">
							The output includes the following status message:
						</p><div class="formalpara"><p class="title"><strong>Example output</strong></p><p>
								
<pre class="programlisting language-terminal">Some or all transfer pods are not running for more than 10 mins on destination cluster</pre>

							</p></div></li><li class="listitem"><p class="simpara">
							On the source cluster, obtain the details of a migrated namespace:
						</p><pre class="programlisting language-terminal">$ oc get namespace &lt;namespace&gt; -o yaml <span id="CO37-1"><!--Empty--></span><span class="callout">1</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO37-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specify the migrated namespace.
								</div></dd></dl></div></li><li class="listitem"><p class="simpara">
							On the target cluster, edit the migrated namespace:
						</p><pre class="programlisting language-terminal">$ oc edit namespace &lt;namespace&gt;</pre></li><li class="listitem"><p class="simpara">
							Add the missing <code class="literal">openshift.io/node-selector</code> annotations to the migrated namespace as in the following example:
						</p><pre class="programlisting language-yaml">apiVersion: v1
kind: Namespace
metadata:
  annotations:
    openshift.io/node-selector: "region=east"
...</pre></li><li class="listitem">
							Run the migration plan again.
						</li></ol></div></section><section class="section" id="migration-error-messages_troubleshooting-3-4"><div class="titlepage"><div><div><h3 class="title">12.4.3. Error messages and resolutions</h3></div></div></div><p>
					This section describes common error messages you might encounter with the Migration Toolkit for Containers (MTC) and how to resolve their underlying causes.
				</p><section class="section" id="ca-certificate-error-displayed-when-accessing-console-for-first-time_troubleshooting-3-4"><div class="titlepage"><div><div><h4 class="title">12.4.3.1. CA certificate error displayed when accessing the MTC console for the first time</h4></div></div></div><p>
						If a <code class="literal">CA certificate error</code> message is displayed the first time you try to access the MTC console, the likely cause is the use of self-signed CA certificates in one of the clusters.
					</p><p>
						To resolve this issue, navigate to the <code class="literal">oauth-authorization-server</code> URL displayed in the error message and accept the certificate. To resolve this issue permanently, add the certificate to the trust store of your web browser.
					</p><p>
						If an <code class="literal">Unauthorized</code> message is displayed after you have accepted the certificate, navigate to the MTC console and refresh the web page.
					</p></section><section class="section" id="oauth-timeout-error-in-console_troubleshooting-3-4"><div class="titlepage"><div><div><h4 class="title">12.4.3.2. OAuth timeout error in the MTC console</h4></div></div></div><p>
						If a <code class="literal">connection has timed out</code> message is displayed in the MTC console after you have accepted a self-signed certificate, the causes are likely to be the following:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Interrupted network access to the OAuth server
							</li><li class="listitem">
								Interrupted network access to the OpenShift Container Platform console
							</li><li class="listitem">
								Proxy configuration that blocks access to the <code class="literal">oauth-authorization-server</code> URL. See <a class="link" href="https://access.redhat.com/solutions/5514491">MTC console inaccessible because of OAuth timeout error</a> for details.
							</li></ul></div><p>
						To determine the cause of the timeout:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Inspect the MTC console web page with a browser web inspector.
							</li><li class="listitem">
								Check the <code class="literal">Migration UI</code> pod log for errors.
							</li></ul></div></section><section class="section" id="certificate-signed-by-unknown-authority-error_troubleshooting-3-4"><div class="titlepage"><div><div><h4 class="title">12.4.3.3. Certificate signed by unknown authority error</h4></div></div></div><p>
						If you use a self-signed certificate to secure a cluster or a replication repository for the Migration Toolkit for Containers (MTC), certificate verification might fail with the following error message: <code class="literal">Certificate signed by unknown authority</code>.
					</p><p>
						You can create a custom CA certificate bundle file and upload it in the MTC web console when you add a cluster or a replication repository.
					</p><div class="formalpara"><p class="title"><strong>Procedure</strong></p><p>
							Download a CA certificate from a remote endpoint and save it as a CA bundle file:
						</p></div><pre class="programlisting language-terminal">$ echo -n | openssl s_client -connect &lt;host_FQDN&gt;:&lt;port&gt; \ <span id="CO38-1"><!--Empty--></span><span class="callout">1</span>
  | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' &gt; &lt;ca_bundle.cert&gt; <span id="CO38-2"><!--Empty--></span><span class="callout">2</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO38-1"><span class="callout">1</span></a> </dt><dd><div class="para">
								Specify the host FQDN and port of the endpoint, for example, <code class="literal">api.my-cluster.example.com:6443</code>.
							</div></dd><dt><a href="#CO38-2"><span class="callout">2</span></a> </dt><dd><div class="para">
								Specify the name of the CA bundle file.
							</div></dd></dl></div></section><section class="section" id="backup-storage-location-errors-in-velero-pod-log_troubleshooting-3-4"><div class="titlepage"><div><div><h4 class="title">12.4.3.4. Backup storage location errors in the Velero pod log</h4></div></div></div><p>
						If a <code class="literal">Velero</code> <code class="literal">Backup</code> custom resource contains a reference to a backup storage location (BSL) that does not exist, the <code class="literal">Velero</code> pod log might display the following error messages:
					</p><pre class="programlisting language-terminal">$ oc logs &lt;Velero_Pod&gt; -n openshift-migration</pre><div class="formalpara"><p class="title"><strong>Example output</strong></p><p>
							
<pre class="programlisting language-terminal">level=error msg="Error checking repository for stale locks" error="error getting backup storage location: BackupStorageLocation.velero.io \"ts-dpa-1\" not found" error.file="/remote-source/src/github.com/vmware-tanzu/velero/pkg/restic/repository_manager.go:259"</pre>

						</p></div><p>
						You can ignore these error messages. A missing BSL cannot cause a migration to fail.
					</p></section><section class="section" id="pod-volume-backup-timeout-error-in-velero-pod-log_troubleshooting-3-4"><div class="titlepage"><div><div><h4 class="title">12.4.3.5. Pod volume backup timeout error in the Velero pod log</h4></div></div></div><p>
						If a migration fails because Restic times out, the following error is displayed in the <code class="literal">Velero</code> pod log.
					</p><pre class="programlisting language-terminal">level=error msg="Error backing up item" backup=velero/monitoring error="timed out waiting for all PodVolumeBackups to complete" error.file="/go/src/github.com/heptio/velero/pkg/restic/backupper.go:165" error.function="github.com/heptio/velero/pkg/restic.(*backupper).BackupPodVolumes" group=v1</pre><p>
						The default value of <code class="literal">restic_timeout</code> is one hour. You can increase this parameter for large migrations, keeping in mind that a higher value may delay the return of error messages.
					</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
								In the OpenShift Container Platform web console, navigate to <span class="strong strong"><strong>Operators</strong></span> → <span class="strong strong"><strong>Installed Operators</strong></span>.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Migration Toolkit for Containers Operator</strong></span>.
							</li><li class="listitem">
								In the <span class="strong strong"><strong>MigrationController</strong></span> tab, click <span class="strong strong"><strong>migration-controller</strong></span>.
							</li><li class="listitem"><p class="simpara">
								In the <span class="strong strong"><strong>YAML</strong></span> tab, update the following parameter value:
							</p><pre class="programlisting language-yaml">spec:
  restic_timeout: 1h <span id="CO39-1"><!--Empty--></span><span class="callout">1</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO39-1"><span class="callout">1</span></a> </dt><dd><div class="para">
										Valid units are <code class="literal">h</code> (hours), <code class="literal">m</code> (minutes), and <code class="literal">s</code> (seconds), for example, <code class="literal">3h30m15s</code>.
									</div></dd></dl></div></li><li class="listitem">
								Click <span class="strong strong"><strong>Save</strong></span>.
							</li></ol></div></section><section class="section" id="restic-verification-errors-in-migmigration-custom-resource_troubleshooting-3-4"><div class="titlepage"><div><div><h4 class="title">12.4.3.6. Restic verification errors in the MigMigration custom resource</h4></div></div></div><p>
						If data verification fails when migrating a persistent volume with the file system data copy method, the following error is displayed in the <code class="literal">MigMigration</code> CR.
					</p><div class="formalpara"><p class="title"><strong>Example output</strong></p><p>
							
<pre class="programlisting language-yaml">status:
  conditions:
  - category: Warn
    durable: true
    lastTransitionTime: 2020-04-16T20:35:16Z
    message: There were verify errors found in 1 Restic volume restores. See restore `&lt;registry-example-migration-rvwcm&gt;`
      for details <span id="CO40-1"><!--Empty--></span><span class="callout">1</span>
    status: "True"
    type: ResticVerifyErrors <span id="CO40-2"><!--Empty--></span><span class="callout">2</span></pre>

						</p></div><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO40-1"><span class="callout">1</span></a> </dt><dd><div class="para">
								The error message identifies the <code class="literal">Restore</code> CR name.
							</div></dd><dt><a href="#CO40-2"><span class="callout">2</span></a> </dt><dd><div class="para">
								<code class="literal">ResticVerifyErrors</code> is a general error warning type that includes verification errors.
							</div></dd></dl></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							A data verification error does not cause the migration process to fail.
						</p></div></div><p>
						You can check the <code class="literal">Restore</code> CR to identify the source of the data verification error.
					</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
								Log in to the target cluster.
							</li><li class="listitem"><p class="simpara">
								View the <code class="literal">Restore</code> CR:
							</p><pre class="programlisting language-terminal">$ oc describe &lt;registry-example-migration-rvwcm&gt; -n openshift-migration</pre><p class="simpara">
								The output identifies the persistent volume with <code class="literal">PodVolumeRestore</code> errors.
							</p><div class="formalpara"><p class="title"><strong>Example output</strong></p><p>
									
<pre class="programlisting language-yaml">status:
  phase: Completed
  podVolumeRestoreErrors:
  - kind: PodVolumeRestore
    name: &lt;registry-example-migration-rvwcm-98t49&gt;
    namespace: openshift-migration
  podVolumeRestoreResticErrors:
  - kind: PodVolumeRestore
    name: &lt;registry-example-migration-rvwcm-98t49&gt;
    namespace: openshift-migration</pre>

								</p></div></li><li class="listitem"><p class="simpara">
								View the <code class="literal">PodVolumeRestore</code> CR:
							</p><pre class="programlisting language-terminal">$ oc describe &lt;migration-example-rvwcm-98t49&gt;</pre><p class="simpara">
								The output identifies the <code class="literal">Restic</code> pod that logged the errors.
							</p><div class="formalpara"><p class="title"><strong>Example output</strong></p><p>
									
<pre class="programlisting language-yaml">  completionTimestamp: 2020-05-01T20:49:12Z
  errors: 1
  resticErrors: 1
  ...
  resticPod: &lt;restic-nr2v5&gt;</pre>

								</p></div></li><li class="listitem"><p class="simpara">
								View the <code class="literal">Restic</code> pod log to locate the errors:
							</p><pre class="programlisting language-terminal">$ oc logs -f &lt;restic-nr2v5&gt;</pre></li></ol></div></section><section class="section" id="restic-permission-error-when-migrating-from-nfs-storage-with-root-squash-enabled_troubleshooting-3-4"><div class="titlepage"><div><div><h4 class="title">12.4.3.7. Restic permission error when migrating from NFS storage with root_squash enabled</h4></div></div></div><p>
						If you are migrating data from NFS storage and <code class="literal">root_squash</code> is enabled, <code class="literal">Restic</code> maps to <code class="literal">nfsnobody</code> and does not have permission to perform the migration. The following error is displayed in the <code class="literal">Restic</code> pod log.
					</p><div class="formalpara"><p class="title"><strong>Example output</strong></p><p>
							
<pre class="programlisting language-terminal">backup=openshift-migration/&lt;backup_id&gt; controller=pod-volume-backup error="fork/exec /usr/bin/restic: permission denied" error.file="/go/src/github.com/vmware-tanzu/velero/pkg/controller/pod_volume_backup_controller.go:280" error.function="github.com/vmware-tanzu/velero/pkg/controller.(*podVolumeBackupController).processBackup" logSource="pkg/controller/pod_volume_backup_controller.go:280" name=&lt;backup_id&gt; namespace=openshift-migration</pre>

						</p></div><p>
						You can resolve this issue by creating a supplemental group for Restic and adding the group ID to the <code class="literal">MigrationController</code> CR manifest.
					</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
								Create a supplemental group for Restic on the NFS storage.
							</li><li class="listitem">
								Set the <code class="literal">setgid</code> bit on the NFS directories so that group ownership is inherited.
							</li><li class="listitem"><p class="simpara">
								Add the <code class="literal">restic_supplemental_groups</code> parameter to the <code class="literal">MigrationController</code> CR manifest on the source and target clusters:
							</p><pre class="programlisting language-yaml">spec:
  restic_supplemental_groups: &lt;group_id&gt; <span id="CO41-1"><!--Empty--></span><span class="callout">1</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO41-1"><span class="callout">1</span></a> </dt><dd><div class="para">
										Specify the supplemental group ID.
									</div></dd></dl></div></li><li class="listitem">
								Wait for the <code class="literal">Restic</code> pods to restart so that the changes are applied.
							</li></ol></div></section></section><section class="section" id="migration-known-issues_troubleshooting-3-4"><div class="titlepage"><div><div><h3 class="title">12.4.4. Known issues</h3></div></div></div><p>
					This release has the following known issues:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							During migration, the Migration Toolkit for Containers (MTC) preserves the following namespace annotations:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									<code class="literal">openshift.io/sa.scc.mcs</code>
								</li><li class="listitem">
									<code class="literal">openshift.io/sa.scc.supplemental-groups</code>
								</li><li class="listitem"><p class="simpara">
									<code class="literal">openshift.io/sa.scc.uid-range</code>
								</p><p class="simpara">
									These annotations preserve the UID range, ensuring that the containers retain their file system permissions on the target cluster. There is a risk that the migrated UIDs could duplicate UIDs within an existing or future namespace on the target cluster. (<a class="link" href="https://bugzilla.redhat.com/show_bug.cgi?id=1748440"><span class="strong strong"><strong>BZ#1748440</strong></span></a>)
								</p></li></ul></div></li><li class="listitem">
							Most cluster-scoped resources are not yet handled by MTC. If your applications require cluster-scoped resources, you might have to create them manually on the target cluster.
						</li><li class="listitem">
							If a migration fails, the migration plan does not retain custom PV settings for quiesced pods. You must manually roll back the migration, delete the migration plan, and create a new migration plan with your PV settings. (<a class="link" href="https://bugzilla.redhat.com/show_bug.cgi?id=1784899"><span class="strong strong"><strong>BZ#1784899</strong></span></a>)
						</li><li class="listitem">
							If a large migration fails because Restic times out, you can increase the <code class="literal">restic_timeout</code> parameter value (default: <code class="literal">1h</code>) in the <code class="literal">MigrationController</code> custom resource (CR) manifest.
						</li><li class="listitem">
							If you select the data verification option for PVs that are migrated with the file system copy method, performance is significantly slower.
						</li><li class="listitem"><p class="simpara">
							If you are migrating data from NFS storage and <code class="literal">root_squash</code> is enabled, <code class="literal">Restic</code> maps to <code class="literal">nfsnobody</code>. The migration fails and a permission error is displayed in the <code class="literal">Restic</code> pod log. (<a class="link" href="https://bugzilla.redhat.com/show_bug.cgi?id=1873641"><span class="strong strong"><strong>BZ#1873641</strong></span></a>)
						</p><p class="simpara">
							You can resolve this issue by adding supplemental groups for <code class="literal">Restic</code> to the <code class="literal">MigrationController</code> CR manifest:
						</p><pre class="programlisting language-yaml">spec:
...
  restic_supplemental_groups:
  - 5555
  - 6666</pre></li><li class="listitem">
							If you perform direct volume migration with nodes that are in different availability zones or availability sets, the migration might fail because the migrated pods cannot access the PVC. (<a class="link" href="https://bugzilla.redhat.com/show_bug.cgi?id=1947487"><span class="strong strong"><strong>BZ#1947487</strong></span></a>)
						</li></ul></div></section></section><section class="section" id="rolling-back-migration_troubleshooting-3-4"><div class="titlepage"><div><div><h2 class="title">12.5. Rolling back a migration</h2></div></div></div><p>
				You can roll back a migration by using the MTC web console or the CLI.
			</p><p>
				You can also <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/migrating_from_version_3_to_4/#migration-rolling-back-migration-manually_troubleshooting-3-4">roll back a migration manually</a>.
			</p><section class="section" id="migration-rolling-back-migration-web-console_troubleshooting-3-4"><div class="titlepage"><div><div><h3 class="title">12.5.1. Rolling back a migration by using the MTC web console</h3></div></div></div><p>
					You can roll back a migration by using the Migration Toolkit for Containers (MTC) web console.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						The following resources remain in the migrated namespaces for debugging after a failed direct volume migration (DVM):
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Config maps (source and destination clusters)
							</li><li class="listitem">
								<code class="literal">Secret</code> objects (source and destination clusters)
							</li><li class="listitem">
								<code class="literal">Rsync</code> CRs (source cluster)
							</li></ul></div><p>
						These resources do not affect rollback. You can delete them manually.
					</p><p>
						If you later run the same migration plan successfully, the resources from the failed migration are deleted automatically.
					</p></div></div><p>
					If your application was stopped during a failed migration, you must roll back the migration to prevent data corruption in the persistent volume.
				</p><p>
					Rollback is not required if the application was not stopped during migration because the original application is still running on the source cluster.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							In the MTC web console, click <span class="strong strong"><strong>Migration plans</strong></span>.
						</li><li class="listitem">
							Click the Options menu 
							<span class="inlinemediaobject"><img src="https://access.redhat.com/webassets/avalon/d/OpenShift_Container_Platform-4.13-Migrating_from_version_3_to_4-en-US/images/f468284ec3cc9bf27e6bd2c83849ca50/kebab.png" alt="kebab"/></span>
							 beside a migration plan and select <span class="strong strong"><strong>Rollback</strong></span> under <span class="strong strong"><strong>Migration</strong></span>.
						</li><li class="listitem"><p class="simpara">
							Click <span class="strong strong"><strong>Rollback</strong></span> and wait for rollback to complete.
						</p><p class="simpara">
							In the migration plan details, <span class="strong strong"><strong>Rollback succeeded</strong></span> is displayed.
						</p></li><li class="listitem"><p class="simpara">
							Verify that rollback was successful in the OpenShift Container Platform web console of the source cluster:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									Click <span class="strong strong"><strong>Home</strong></span> → <span class="strong strong"><strong>Projects</strong></span>.
								</li><li class="listitem">
									Click the migrated project to view its status.
								</li><li class="listitem">
									In the <span class="strong strong"><strong>Routes</strong></span> section, click <span class="strong strong"><strong>Location</strong></span> to verify that the application is functioning, if applicable.
								</li><li class="listitem">
									Click <span class="strong strong"><strong>Workloads</strong></span> → <span class="strong strong"><strong>Pods</strong></span> to verify that the pods are running in the migrated namespace.
								</li><li class="listitem">
									Click <span class="strong strong"><strong>Storage</strong></span> → <span class="strong strong"><strong>Persistent volumes</strong></span> to verify that the migrated persistent volume is correctly provisioned.
								</li></ol></div></li></ol></div></section><section class="section" id="migration-rolling-back-migration-cli_troubleshooting-3-4"><div class="titlepage"><div><div><h3 class="title">12.5.2. Rolling back a migration from the command line interface</h3></div></div></div><p>
					You can roll back a migration by creating a <code class="literal">MigMigration</code> custom resource (CR) from the command line interface.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						The following resources remain in the migrated namespaces for debugging after a failed direct volume migration (DVM):
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Config maps (source and destination clusters)
							</li><li class="listitem">
								<code class="literal">Secret</code> objects (source and destination clusters)
							</li><li class="listitem">
								<code class="literal">Rsync</code> CRs (source cluster)
							</li></ul></div><p>
						These resources do not affect rollback. You can delete them manually.
					</p><p>
						If you later run the same migration plan successfully, the resources from the failed migration are deleted automatically.
					</p></div></div><p>
					If your application was stopped during a failed migration, you must roll back the migration to prevent data corruption in the persistent volume.
				</p><p>
					Rollback is not required if the application was not stopped during migration because the original application is still running on the source cluster.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">MigMigration</code> CR based on the following example:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: migration.openshift.io/v1alpha1
kind: MigMigration
metadata:
  labels:
    controller-tools.k8s.io: "1.0"
  name: &lt;migmigration&gt;
  namespace: openshift-migration
spec:
...
  rollback: true
...
  migPlanRef:
    name: &lt;migplan&gt; <span id="CO42-1"><!--Empty--></span><span class="callout">1</span>
    namespace: openshift-migration
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO42-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Specify the name of the associated <code class="literal">MigPlan</code> CR.
								</div></dd></dl></div></li><li class="listitem">
							In the MTC web console, verify that the migrated project resources have been removed from the target cluster.
						</li><li class="listitem">
							Verify that the migrated project resources are present in the source cluster and that the application is running.
						</li></ol></div></section><section class="section" id="migration-rolling-back-migration-manually_troubleshooting-3-4"><div class="titlepage"><div><div><h3 class="title">12.5.3. Rolling back a migration manually</h3></div></div></div><p>
					You can roll back a failed migration manually by deleting the <code class="literal">stage</code> pods and unquiescing the application.
				</p><p>
					If you run the same migration plan successfully, the resources from the failed migration are deleted automatically.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						The following resources remain in the migrated namespaces after a failed direct volume migration (DVM):
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Config maps (source and destination clusters)
							</li><li class="listitem">
								<code class="literal">Secret</code> objects (source and destination clusters)
							</li><li class="listitem">
								<code class="literal">Rsync</code> CRs (source cluster)
							</li></ul></div><p>
						These resources do not affect rollback. You can delete them manually.
					</p></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Delete the <code class="literal">stage</code> pods on all clusters:
						</p><pre class="programlisting language-terminal">$ oc delete $(oc get pods -l migration.openshift.io/is-stage-pod -n &lt;namespace&gt;) <span id="CO43-1"><!--Empty--></span><span class="callout">1</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO43-1"><span class="callout">1</span></a> </dt><dd><div class="para">
									Namespaces specified in the <code class="literal">MigPlan</code> CR.
								</div></dd></dl></div></li><li class="listitem"><p class="simpara">
							Unquiesce the application on the source cluster by scaling the replicas to their premigration number:
						</p><pre class="programlisting language-terminal">$ oc scale deployment &lt;deployment&gt; --replicas=&lt;premigration_replicas&gt;</pre><p class="simpara">
							The <code class="literal">migration.openshift.io/preQuiesceReplicas</code> annotation in the <code class="literal">Deployment</code> CR displays the premigration number of replicas:
						</p><pre class="programlisting language-yaml">apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: "1"
    migration.openshift.io/preQuiesceReplicas: "1"</pre></li><li class="listitem"><p class="simpara">
							Verify that the application pods are running on the source cluster:
						</p><pre class="programlisting language-terminal">$ oc get pod -n &lt;namespace&gt;</pre></li></ol></div><h4 id="additional-resources-uninstalling_troubleshooting-3-4">Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/operators/#olm-deleting-operators-from-a-cluster-using-web-console_olm-deleting-operators-from-cluster">Deleting Operators from a cluster using the web console</a>
						</li></ul></div></section></section></section><div><div xml:lang="en-US" class="legalnotice" id="idm139748690128400"><h1 class="legalnotice">Legal Notice</h1><div class="para">
		Copyright <span class="trademark"><!--Empty--></span>© 2023 Red Hat, Inc.
	</div><div class="para">
		The text of and illustrations in this document are licensed by Red Hat under a Creative Commons Attribution–Share Alike 3.0 Unported license ("CC-BY-SA"). An explanation of CC-BY-SA is available at <a class="uri" href="http://creativecommons.org/licenses/by-sa/3.0/">http://creativecommons.org/licenses/by-sa/3.0/</a>. In accordance with CC-BY-SA, if you distribute this document or an adaptation of it, you must provide the URL for the original version.
	</div><div class="para">
		Red Hat, as the licensor of this document, waives the right to enforce, and agrees not to assert, Section 4d of CC-BY-SA to the fullest extent permitted by applicable law.
	</div><div class="para">
		Red Hat, Red Hat Enterprise Linux, the Shadowman logo, the Red Hat logo, JBoss, OpenShift, Fedora, the Infinity logo, and RHCE are trademarks of Red Hat, Inc., registered in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Linux</span>® is the registered trademark of Linus Torvalds in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Java</span>® is a registered trademark of Oracle and/or its affiliates.
	</div><div class="para">
		<span class="trademark">XFS</span>® is a trademark of Silicon Graphics International Corp. or its subsidiaries in the United States and/or other countries.
	</div><div class="para">
		<span class="trademark">MySQL</span>® is a registered trademark of MySQL AB in the United States, the European Union and other countries.
	</div><div class="para">
		<span class="trademark">Node.js</span>® is an official trademark of Joyent. Red Hat is not formally related to or endorsed by the official Joyent Node.js open source or commercial project.
	</div><div class="para">
		The <span class="trademark">OpenStack</span>® Word Mark and OpenStack logo are either registered trademarks/service marks or trademarks/service marks of the OpenStack Foundation, in the United States and other countries and are used with the OpenStack Foundation's permission. We are not affiliated with, endorsed or sponsored by the OpenStack Foundation, or the OpenStack community.
	</div><div class="para">
		All other trademarks are the property of their respective owners.
	</div></div></div></div>


  <nav class="pvof-doc__book-nav">
  <ol class="book-nav__list">
              </ol>
</nav>


          </div>
              </div>
              <div id="comments-footer" class="book-comments">
          

  

        </div>
          </div>
  </article>
<meta itemscope="" itemref="md1">



    </div>
      <!-- CP_PRIMER_FOOTER -->            </div>
        </main>
    </div>
    <!--googleoff: all-->
    <div id="to-top"><a class="btn_slideto" href="#masthead" aria-label="Back to Top"><span class="web-icon-upload"></span></a></div>
    <footer class="footer-main">
        <div class="footer-top">
            <div class="container">

              <div class="brand">
                <a href="https://redhat.com">
                  <svg class="rh-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 613 145">
                    <defs>
                      <style>
                        .rh-logo-hat {
                          fill: #e00;
                        }
                        .rh-logo-type {
                          fill: #fff;
                        }
                      </style>
                    </defs>
                    <title>Red Hat</title>
                    <path
                      class="rh-logo-hat"
                      d="M127.47,83.49c12.51,0,30.61-2.58,30.61-17.46a14,14,0,0,0-.31-3.42l-7.45-32.36c-1.72-7.12-3.23-10.35-15.73-16.6C124.89,8.69,103.76.5,97.51.5,91.69.5,90,8,83.06,8c-6.68,0-11.64-5.6-17.89-5.6-6,0-9.91,4.09-12.93,12.5,0,0-8.41,23.72-9.49,27.16A6.43,6.43,0,0,0,42.53,44c0,9.22,36.3,39.45,84.94,39.45M160,72.07c1.73,8.19,1.73,9.05,1.73,10.13,0,14-15.74,21.77-36.43,21.77C78.54,104,37.58,76.6,37.58,58.49a18.45,18.45,0,0,1,1.51-7.33C22.27,52,.5,55,.5,74.22c0,31.48,74.59,70.28,133.65,70.28,45.28,0,56.7-20.48,56.7-36.65,0-12.72-11-27.16-30.83-35.78"/>
                      <path class="rh-logo-band"
                      d="M160,72.07c1.73,8.19,1.73,9.05,1.73,10.13,0,14-15.74,21.77-36.43,21.77C78.54,104,37.58,76.6,37.58,58.49a18.45,18.45,0,0,1,1.51-7.33l3.66-9.06A6.43,6.43,0,0,0,42.53,44c0,9.22,36.3,39.45,84.94,39.45,12.51,0,30.61-2.58,30.61-17.46a14,14,0,0,0-.31-3.42Z"/>
                      <path
                      class="rh-logo-type"
                      d="M579.74,92.8c0,11.89,7.15,17.67,20.19,17.67a52.11,52.11,0,0,0,11.89-1.68V95a24.84,24.84,0,0,1-7.68,1.16c-5.37,0-7.36-1.68-7.36-6.73V68.3h15.56V54.1H596.78v-18l-17,3.68V54.1H568.49V68.3h11.25Zm-53,.32c0-3.68,3.69-5.47,9.26-5.47a43.12,43.12,0,0,1,10.1,1.26v7.15a21.51,21.51,0,0,1-10.63,2.63c-5.46,0-8.73-2.1-8.73-5.57m5.2,17.56c6,0,10.84-1.26,15.36-4.31v3.37h16.82V74.08c0-13.56-9.14-21-24.39-21-8.52,0-16.94,2-26,6.1l6.1,12.52c6.52-2.74,12-4.42,16.83-4.42,7,0,10.62,2.73,10.62,8.31v2.73a49.53,49.53,0,0,0-12.62-1.58c-14.31,0-22.93,6-22.93,16.73,0,9.78,7.78,17.24,20.19,17.24m-92.44-.94h18.09V80.92h30.29v28.82H506V36.12H487.93V64.41H457.64V36.12H439.55ZM370.62,81.87c0-8,6.31-14.1,14.62-14.1A17.22,17.22,0,0,1,397,72.09V91.54A16.36,16.36,0,0,1,385.24,96c-8.2,0-14.62-6.1-14.62-14.09m26.61,27.87h16.83V32.44l-17,3.68V57.05a28.3,28.3,0,0,0-14.2-3.68c-16.19,0-28.92,12.51-28.92,28.5a28.25,28.25,0,0,0,28.4,28.6,25.12,25.12,0,0,0,14.93-4.83ZM320,67c5.36,0,9.88,3.47,11.67,8.83H308.47C310.15,70.3,314.36,67,320,67M291.33,82c0,16.2,13.25,28.82,30.28,28.82,9.36,0,16.2-2.53,23.25-8.42l-11.26-10c-2.63,2.74-6.52,4.21-11.14,4.21a14.39,14.39,0,0,1-13.68-8.83h39.65V83.55c0-17.67-11.88-30.39-28.08-30.39a28.57,28.57,0,0,0-29,28.81M262,51.58c6,0,9.36,3.78,9.36,8.31S268,68.2,262,68.2H244.11V51.58Zm-36,58.16h18.09V82.92h13.77l13.89,26.82H292l-16.2-29.45a22.27,22.27,0,0,0,13.88-20.72c0-13.25-10.41-23.45-26-23.45H226Z"/>
                  </svg>
                </a>
              </div>

              <div role="navigation" aria-label="quick">
                  <h3>Quick Links</h3>
                  <ul>
                      <li><a class="download-software" href="https://access.redhat.com/downloads/">Downloads</a></li>
                      <li><a class="manage-subscriptions" href="https://access.redhat.com/management">Subscriptions</a></li>
                      <li><a class="support-cases" href="https://access.redhat.com/support">Support Cases</a></li>
                      <li><a class="customer-service" href="https://access.redhat.com/support/customer-service">Customer Service</a></li>
                      <li><a class="quick-docs" href="https://access.redhat.com/documentation">Product Documentation</a></li>
                  </ul>
              </div>

              <div role="navigation" aria-label="help">
                  <h3>Help</h3>
                  <ul>
                      <li><a class="contact-us" href="https://access.redhat.com/support/contact/">Contact Us</a></li>
                      <li><a class="cp-faqs" href="https://access.redhat.com/articles/33844">Customer Portal FAQ</a></li>
                      <li><a class="login-problems" href="https://access.redhat.com/help/login_assistance">Log-in Assistance</a></li>
                  </ul>
              </div>

              <div role="navigation" aria-label="site">
                  <h3>Site Info</h3>
                  <ul>
                      <li><a class="trust-red-hat" href="https://www.redhat.com/en/trust">Trust Red Hat</a></li>
                      <li><a class="browser-support-policy" href="https://www.redhat.com/en/about/browser-support">Browser Support Policy</a></li>
                      <li><a class="accessibility" href="https://www.redhat.com/en/about/digital-accessibility">Accessibility</a></li>
                      <li><a class="recognition" href="https://access.redhat.com/recognition/">Awards and Recognition</a></li>
                      <li><a class="colophon" href="https://access.redhat.com/help/colophon/">Colophon</a></li>
                  </ul>
              </div>

              <div role="navigation" aria-label="other">
                  <h3>Related Sites</h3>
                  <ul>
                      <li><a href="https://www.redhat.com/" class="red-hat-com">redhat.com</a></li>
                      <li><a href="http://developers.redhat.com/" class="red-hat-developers">developers.redhat.com</a></li>
                      <li><a href="https://connect.redhat.com/" class="partner-connect">connect.redhat.com</a></li>
                      <li><a href="https://cloud.redhat.com/" class="cloud-com">cloud.redhat.com</a></li>
                  </ul>
              </div>

              <div role="navigation" aria-label="about">
                  <h3>About</h3>
                  <ul>
                      <li><a href="https://access.redhat.com/subscription-value" class="subscription-value">Red Hat Subscription Value</a></li>
                      <li><a href="https://www.redhat.com/about/" class="about-red-hat">About Red Hat</a></li>
                      <li><a href="http://jobs.redhat.com" class="about-jobs">Red Hat Jobs</a></li>
                  </ul>
              </div>

            </div>
        </div>

        <div class="anchor">
            <div class="container">
                <div class="status-legal">
                    <a hidden href="https://status.redhat.com" class="status-page-widget">
                        <span class="status-description"></span>
                        <span class="status-dot shape-circle"></span>
                    </a>
                    <div class="legal-copyright">
                        <div class="copyright">Copyright © 2023 Red Hat, Inc.</div>
                        <div role="navigation" aria-label="legal" class="legal">
                            <ul>
                                <li><a href="http://www.redhat.com/en/about/privacy-policy" class="privacy-policy">Privacy Statement</a></li>
                                <li><a href="https://www.redhat.com/en/about/terms-use" class="terms-of-use">Terms of Use</a></li>
                                <li><a href="http://www.redhat.com/en/about/all-policies-guidelines" class="all-policies">All Policies and Guidelines</a></li>
                                <li><a id="teconsent"></a></li>
                            </ul>
                            <div id="privacy_policy">We've updated our <a href='http://www.redhat.com/en/about/privacy-policy' class='privacy-policy'>Privacy Statement</a> effective September 15, 2023.
                            </div>
                          </div>
                        </div>
                </div>
                <div class="social">
                    <a href="http://www.redhat.com/summit/" class="summit">
                        <img src="https://access.redhat.com/chrome_themes/nimbus/img/rh-summit-red-a.svg" alt="Red Hat Summit" /> <span class="offscreen">Red Hat Summit</span>
                    </a>

                    <div class="social-media">
                        <a href="https://twitter.com/RedHat" class="sm-icon twitter"><span class="nicon-twitter"></span><span class="offscreen">Twitter</span></a>                        
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- TrustArc -->
    <div id="consent_blackbar"></div> 
    <!--googleon: all-->
</div>
<!-- /CP_PRIMER_FOOTER -->


  </div>

    
  </body>
</html>
